<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Giraph è¿è¡Œæµç¨‹ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2019%2F09%2F14%2FGiraph%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡ä¸»è¦åˆ†æäº† Giraph1.3 SNAPSHOT çš„ Job æäº¤å’Œåˆå§‹åŒ–çš„è¿‡ç¨‹ã€‚å…¶ä¸­ Job æäº¤éƒ¨åˆ†çš„åˆ†ææ ¹æ®è¿è¡Œåœ¨ Standalone æ¨¡å¼ä¸‹çš„ Hadoop éƒ¨åˆ†è¿›è¡Œï¼Œåˆ†æä»…æ¶‰åŠæœ¬åœ°è¿è¡Œæ—¶æ‰§è¡Œçš„ä»£ç ï¼Œ è€Œåˆå§‹åŒ–éƒ¨åˆ†åˆ™ä¸»è¦æ ¹æ®é›†ç¾¤æ¨¡å¼è¿›è¡Œåˆ†æã€‚ ç¤ºä¾‹ Job è¯¥éƒ¨åˆ†ä¸å±äºæºç ï¼Œè€Œæ˜¯ä¸ºäº†æ–¹ä¾¿åˆ†æè¿è¡Œçš„ä¸€ä¸ªç¤ºä¾‹ Jobï¼ŒJob çš„å…·ä½“é…ç½®å’Œè¿è¡Œåœ¨ Giraph ç¼–ç¨‹å®è·µåŠæºç è°ƒè¯• ä¸€æ–‡ä¸­å·²ç»è¯´æ˜ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ Job æäº¤è¿‡ç¨‹å¦‚ä¸‹ï¼š 1234567891011121314151617181920GiraphConfiguration conf = new GiraphConfiguration(new Configuration());//æŒ‡å®šè®¡ç®—ç±»conf.setComputationClass(Shortestpath.class);//è®¾ç½®è¾“å…¥å’Œè¾“å‡ºæ ¼å¼conf.setVertexInputFormatClass(JsonLongDoubleFloatDoubleVertexInputFormat.class);conf.setVertexOutputFormatClass(IdWithValueTextOutputFormat.class);//è®¾ç½®æœ¬åœ°è¿è¡Œæ¨¡å¼ï¼Œæ–¹ä¾¿è°ƒè¯•æŸ¥çœ‹æºç conf.setLocalTestMode(true);//è®¾ç½® Worker é…ç½®conf.setWorkerConfiguration(1, 1, 100);//æœ¬åœ°æ¨¡å¼ä¸‹è¿è¡Œä¸åˆ† Master å’Œ WorkerGiraphConstants.SPLIT_Master_Worker.set(conf, false);GiraphJob job = new GiraphJob(conf, Shortestpath.class.getSimpleName());//è®¾ç½®è¾“å…¥å’Œè¾“å‡ºè·¯å¾„GiraphTextInputFormat.setVertexInputPath(conf, new Path(INPUT_PATH));GiraphTextOutputFormat.setOutputPath(job.getInternalJob(), new Path(OUTPUT_PATH));â€¢â€¢â€¢â€¢â€¢â€¢//å‘ Giraph æäº¤ Jobjob.run(true); é¦–å…ˆæŒ‡å®šä¸€ç³»åˆ—å‚æ•°ï¼Œç„¶åè°ƒç”¨ job.run(true) å‘ Giraph æäº¤ Job Giraph å‘ Hadoop æäº¤ Job Giraph æ˜¯åŸºäº Hadoop å¼€å‘çš„ï¼Œå› æ­¤åœ¨å‘ Giraph æäº¤ Job ä¹‹åï¼ŒGiraph å†…éƒ¨è¿˜ä¼šå‘ Hadoop æäº¤ Jobã€‚æœ¬éƒ¨åˆ†ä¸»è¦åˆ†æ Giraph å¦‚ä½•å‘ Hadoop æäº¤ Jobã€‚é¦–å…ˆæŸ¥çœ‹ run æ–¹æ³•ï¼š org.apache.giraph.job.GiraphJob#run 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990/** * Runs the actual graph application through Hadoop Map-Reduce. * * @param verbose If true, provide verbose output, false otherwise * @return True if success, false otherwise * @throws ClassNotFoundException * @throws InterruptedException * @throws IOException */public final boolean run(boolean verbose) throws IOException, InterruptedException, ClassNotFoundException &#123; //æ›´æ”¹ Job çš„ counter æ•°é‡é™åˆ¶ setIntConfIfDefault("mapreduce.job.counters.limit", 512); //è®¾ç½® Giraph ä¸­ Worker æˆ–è€… Master å†…å­˜ä¸Šé™ setIntConfIfDefault("mapred.job.map.memory.mb", 1024); setIntConfIfDefault("mapred.job.reduce.memory.mb", 0); // Speculative execution doesn't make sense for Giraph giraphConfiguration.setBoolean( "mapred.map.tasks.speculative.execution", false); // Set the ping interval to 5 minutes instead of one minute Client.setPingInterval(giraphConfiguration, 60000 * 5); // è®¾ç½®ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ çš„ Jar åŒ…çš„ class giraphConfiguration.setBoolean("mapreduce.user.classpath.first", true); giraphConfiguration.setBoolean("mapreduce.job.user.classpath.first", true); //ä¸åš Checkpoint çš„æ—¶å€™æœ€å¤§å°è¯•æ•°ä¸º 1ï¼Œä¸ºäº†è®©ä¸èƒ½æ¢å¤çš„ Job æ›´å¿«çš„ç»“æŸ if (giraphConfiguration.getCheckpointFrequency() == 0) &#123; int oldMaxTaskAttempts = giraphConfiguration.getMaxTaskAttempts(); giraphConfiguration.setMaxTaskAttempts(1); â€¢â€¢â€¢â€¢â€¢â€¢ &#125; ImmutableClassesGiraphConfiguration conf = new ImmutableClassesGiraphConfiguration(giraphConfiguration); checkLocalJobRunnerConfiguration(conf); int tryCount = 0; //é»˜è®¤æ˜¯ org.apache.giraph.job.DefaultGiraphJobRetryChecker GiraphJobRetryChecker retryChecker = conf.getJobRetryChecker(); while (true) &#123; â€¢â€¢â€¢â€¢â€¢â€¢ tryCount++; //åˆ›å»ºä¸€ä¸ª Hadoop Job Job submittedJob = new Job(conf, jobName); if (submittedJob.getJar() == null) &#123; submittedJob.setJarByClass(getClass()); &#125; //Giraph ä¸éœ€è¦æ‰§è¡Œ Reduce ä»»åŠ¡ submittedJob.setNumReduceTasks(0); //è®¾ç½® Mapper submittedJob.setMapperClass(GraphMapper.class); //è®¾ç½®è¾“å…¥æ ¼å¼ submittedJob.setInputFormatClass(BspInputFormat.class); //è®¾ç½®è¾“å‡ºæ ¼å¼ï¼Œé»˜è®¤æƒ…å†µæ˜¯ org.apache.giraph.bsp.BspOutputFormat submittedJob.setOutputFormatClass( GiraphConstants.HADOOP_OUTPUT_FORMAT_CLASS.get(conf)); â€¢â€¢â€¢â€¢â€¢â€¢ //æäº¤ Job submittedJob.submit(); â€¢â€¢â€¢â€¢â€¢â€¢ //è·å– Job è¿è¡Œç»“æœ boolean passed = submittedJob.waitForCompletion(verbose); â€¢â€¢â€¢â€¢â€¢â€¢ //å¦‚æœè¿è¡Œå¤±è´¥åˆ™ä¼šå°è¯•é‡å¯ Job if (!passed) &#123; //é»˜è®¤æƒ…å†µï¼ˆæŒ‡æ²¡æœ‰æŒ‡å®š JobRetryChecker æƒ…å†µï¼‰è¿”å› nullï¼Œå³æ°¸è¿œä¸ä¼šé‡å¯ Job String restartFrom = retryChecker.shouldRestartCheckpoint(submittedJob); if (restartFrom != null) &#123; GiraphConstants.RESTART_JOB_ID.set(conf, restartFrom); continue; &#125; &#125; //å¦‚æœ Job è¿è¡ŒæˆåŠŸæˆ–è€…å¤±è´¥æƒ…å†µä¸‹ä¸å°è¯•é‡æ–°è¿è¡Œï¼ˆé»˜è®¤æƒ…å†µä¸‹æ°¸è¿œä¸ä¼šå°è¯•å°è¯•é‡æ–°è¿è¡Œï¼‰ if (passed || !retryChecker.shouldRetry(submittedJob, tryCount)) &#123; return passed; &#125; â€¢â€¢â€¢â€¢â€¢â€¢â€¢ &#125;&#125; run æ–¹æ³•ä¸­é¦–å…ˆä¼šå¯¹ Hadoop å’Œ Giraph è¿›è¡Œé…ç½®ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª Hadoop Job å¯¹è±¡ã€‚åœ¨è®¾ç½®å¥½ Hadoop Job çš„ MapperClass å’Œè¾“å…¥è¾“å‡ºæ ¼å¼ç­‰ç›¸å…³ä¿¡æ¯åï¼Œå³ä¼šè°ƒç”¨ submit å‘ Hadoop æäº¤ Jobã€‚ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°æ•´ä¸ªè¿‡ç¨‹ä¸æäº¤æ™®é€šçš„ Hadoop Job åŸºæœ¬æ— å¼‚ã€‚ Hadoop å†…éƒ¨è¿è¡Œ åœ¨ Giraph è°ƒç”¨ submit å‘ Hadoop æäº¤ Job ä¹‹åï¼Œç¨‹åºçš„è¿è¡Œå°±ä¼šè¿›å…¥åˆ° Hadoop å†…éƒ¨ï¼Œå¯¹äºè¯¥éƒ¨åˆ†ä¸»è¦éœ€è¦äº†è§£ Hadoop å¦‚ä½•å¯åŠ¨ Giraph çš„ MapTaskã€‚ å†…éƒ¨æäº¤ Job org.apache.hadoop.mapreduce.Job#submit 1234567891011121314151617public void submit() throws IOException, InterruptedException, ClassNotFoundException &#123; ensureState(JobState.DEFINE); //è®¾ç½®ç”¨æ–°çš„ API setUseNewAPI(); connect(); final JobSubmitter submitter = getJobSubmitter(cluster.getFileSystem(), cluster.getClient()); //æäº¤ Job åˆ°ç³»ç»Ÿ status = ugi.doAs(new PrivilegedExceptionAction&lt;JobStatus&gt;() &#123; public JobStatus run() throws IOException, InterruptedException, ClassNotFoundException &#123; return submitter.submitJobInternal(Job.this, cluster); &#125; &#125;); state = JobState.RUNNING; â€¢â€¢â€¢â€¢â€¢â€¢&#125; submit æ–¹æ³•å†…éƒ¨ä¼šåˆ›å»º JobSubmitter å¯¹è±¡ï¼Œç„¶åé€šè¿‡ submitJobInternal æ–¹æ³•è¿›ä¸€æ­¥æäº¤ Jobã€‚ org.apache.hadoop.mapreduce.JobSubmitter#submitJobInternal 1234567891011121314151617181920212223242526JobStatus submitJobInternal(Job job, Cluster cluster) throws ClassNotFoundException, InterruptedException, IOException &#123; â€¢â€¢â€¢â€¢â€¢â€¢ Configuration conf = job.getConfiguration(); addMRFrameworkToDistributedCache(conf); //è·å¾—æš‚å­˜ç›®å½•ï¼Œ é»˜è®¤æƒ…å†µä¸‹è·¯å¾„ç”Ÿæˆåœ¨ /tmp/hadoop/mapred/staging ä¸‹ Path jobStagingArea = JobSubmissionFiles.getStagingDir(cluster, conf); â€¢â€¢â€¢â€¢â€¢â€¢ //ç”Ÿæˆ Job ID JobID jobId = submitClient.getNewJobID(); //è®¾ç½® Job ID job.setJobID(jobId); //è·å¾—æäº¤ Job çš„ç›®å½• Path submitJobDir = new Path(jobStagingArea, jobId.toString()); JobStatus status = null; â€¢â€¢â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢â€¢â€¢ //å®é™…æäº¤ Job status = submitClient.submitJob( jobId, submitJobDir.toString(), job.getCredentials()); â€¢â€¢â€¢â€¢â€¢â€¢&#125; åœ¨ submitJobInternal ä¸­ï¼ŒHadoop ä¼šé€šè¿‡ submitClient å®é™…æäº¤ Jobã€‚submitClient æ˜¯ä¸€ä¸ª ClientProtocol æ¥å£ï¼Œå…¶æœ‰ä¸¤ä¸ªå®ç°ï¼Œç”±äºæäº¤ Job çš„æ—¶å€™ Hadoop è¿è¡Œåœ¨ Standalone æ¨¡å¼ä¸‹ï¼Œæ‰€ä»¥è¿™é‡Œ submitClient çš„å®ç°æ˜¯ LocalJobRunnerã€‚ å¯åŠ¨ MapTask org.apache.hadoop.mapred.LocalJobRunner#submitJob 1234567public org.apache.hadoop.mapreduce.JobStatus submitJob( org.apache.hadoop.mapreduce.JobID jobid, String jobSubmitDir, Credentials credentials) throws IOException &#123; Job job = new Job(JobID.downgrade(jobid), jobSubmitDir); job.job.setCredentials(credentials); return job.status;&#125; org.apache.hadoop.mapred.LocalJobRunner.Job#Job 12345public Job(JobID jobid, String jobSubmitDir) throws IOException &#123; â€¢â€¢â€¢â€¢â€¢â€¢ this.start();&#125; submitJob å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª Job å¯¹è±¡ï¼Œè¿™é‡Œçš„ Job æ˜¯ç»§æ‰¿äº† Thread çš„ LocalJobRunner çš„å†…éƒ¨ç±»ã€‚é€šè¿‡æ„é€ æ–¹æ³•å¯ä»¥çŸ¥é“ï¼ŒsubmitJob åœ¨åˆ›å»º Job çš„åŒæ—¶ä¹Ÿå¼€å¯äº†çº¿ç¨‹ï¼Œæ‰€ä»¥éœ€è¦æŸ¥çœ‹ Job#run æ–¹æ³•ã€‚ org.apache.hadoop.mapred.LocalJobRunner.Job#run 1234567891011121314151617181920212223242526@Overridepublic void run() &#123; JobID jobId = profile.getJobID(); JobContext jContext = new JobContextImpl(job, jobId); â€¢â€¢â€¢â€¢â€¢â€¢ Map&lt;TaskAttemptID, MapOutputFile&gt; mapOutputFiles = Collections.synchronizedMap(new HashMap&lt;TaskAttemptID, MapOutputFile&gt;()); //è·å–éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ List&lt;RunnableWithThrowable&gt; mapRunnables = getMapTaskRunnables( taskSplitMetaInfos, jobId, mapOutputFiles); initCounters(mapRunnables.size(), numReduceTasks); ExecutorService mapService = createMapExecutor(); //è¿è¡Œä»»åŠ¡ runTasks(mapRunnables, mapService, "map"); â€¢â€¢â€¢â€¢â€¢â€¢ // delete the temporary directory in output directory outputCommitter.commitJob(jContext); status.setCleanupProgress(1.0f); â€¢â€¢â€¢â€¢â€¢â€¢&#125; org.apache.hadoop.mapred.LocalJobRunner.Job#getMapTaskRunnables 123456789101112131415protected List&lt;RunnableWithThrowable&gt; getMapTaskRunnables( TaskSplitMetaInfo [] taskInfo, JobID jobId, Map&lt;TaskAttemptID, MapOutputFile&gt; mapOutputFiles) &#123; int numTasks = 0; ArrayList&lt;RunnableWithThrowable&gt; list = new ArrayList&lt;RunnableWithThrowable&gt;(); //ç”Ÿæˆå¯¹åº”æ•°é‡çš„ MapTaskRunnable for (TaskSplitMetaInfo task : taskInfo) &#123; list.add(new MapTaskRunnable(task, numTasks++, jobId, mapOutputFiles)); &#125; return list;&#125; org.apache.hadoop.mapred.LocalJobRunner.Job#runTasks 123456789101112131415161718192021private void runTasks(List&lt;RunnableWithThrowable&gt; runnables, ExecutorService service, String taskType) throws Exception &#123; //æäº¤ä»»åŠ¡ for (Runnable r : runnables) &#123; service.submit(r); &#125; try &#123; service.shutdown(); // Instructs queue to drain. // Wait for tasks to finish; do not use a time-based timeout. // (See http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6179024) LOG.info("Waiting for " + taskType + " tasks"); service.awaitTermination(Long.MAX_VALUE, TimeUnit.NANOSECONDS); &#125; catch (InterruptedException ie) &#123; // Cancel all threads. service.shutdownNow(); throw ie; &#125; â€¢â€¢â€¢â€¢â€¢â€¢&#125; å¯¹äº Job#run æ–¹æ³•åº”è¯¥ä¸»è¦å…³æ³¨ MapTaskRunnable çš„ç”Ÿæˆå’Œæ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ° Hadoop ä¼šé€šè¿‡ getMapTaskRunnables æ–¹æ³•æ ¹æ®åˆ†é…çš„ Task çš„æ•°é‡ç”Ÿæˆå¯¹åº”æ•°é‡çš„ MapTaskRunnableï¼Œç„¶åä¼šè°ƒç”¨ runTasks æ–¹æ³•å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡ã€‚ MapTaskRunnable ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± åç»§ç»­å…³æ³¨ MapTaskRunnable#run æ–¹æ³• org.apache.hadoop.mapred.LocalJobRunner.Job.MapTaskRunnable#run 123456789101112131415public void run() &#123; try &#123; â€¢â€¢â€¢â€¢â€¢â€¢ MapTask map = new MapTask(systemJobFile.toString(), mapId, taskId, info.getSplitIndex(), 1); â€¢â€¢â€¢â€¢â€¢â€¢ try &#123; â€¢â€¢â€¢â€¢â€¢â€¢ map.run(localConf, Job.this); â€¢â€¢â€¢â€¢â€¢â€¢ &#125; catch (Throwable e) &#123; this.storedException = e; &#125; &#125;&#125; ä» MapTaskRunnable#run ä¸­å¯ä»¥çœ‹åˆ°å…¶åˆ›å»ºäº†ä¸€ä¸ª MapTask å¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº† MapTask#run æ–¹æ³•ã€‚ org.apache.hadoop.mapred.MapTask#run 1234567891011121314151617@Overridepublic void run(final JobConf job, final TaskUmbilicalProtocol umbilical)throws IOException, ClassNotFoundException, InterruptedException &#123; â€¢â€¢â€¢â€¢â€¢â€¢ //org.apache.hadoop.mapreduce.Job#submit è®¾ç½®äº† useNewApiï¼Œæ‰€ä»¥è¿”å› true boolean useNewApi = job.getUseNewMapper(); â€¢â€¢â€¢â€¢â€¢â€¢ if (useNewApi) &#123; runNewMapper(job, splitMetaInfo, umbilical, reporter); &#125; else &#123; runOldMapper(job, splitMetaInfo, umbilical, reporter); &#125; done(umbilical, reporter);&#125; MapTask#run ä¸­ä¼šè°ƒç”¨ runNewMapper æ–¹æ³•ï¼Œæ‰€ä»¥ç»§ç»­æŸ¥çœ‹è¯¥æ–¹æ³• org.apache.hadoop.mapred.MapTask#runNewMapper 123456789101112131415161718192021222324252627282930313233343536373839private &lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt; void runNewMapper(final JobConf job, final TaskSplitIndex splitIndex, final TaskUmbilicalProtocol umbilical, TaskReporter reporter ) throws IOException, ClassNotFoundException, InterruptedException &#123; // make a task context so we can get the classes org.apache.hadoop.mapreduce.TaskAttemptContext taskContext = new org.apache.hadoop.mapreduce.task.TaskAttemptContextImpl(job, getTaskID(), reporter); // åå°„è·å–è®¾ç½®çš„ MapperClass å®ä¾‹å¯¹è±¡ org.apache.hadoop.mapreduce.Mapper&lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt; mapper = (org.apache.hadoop.mapreduce.Mapper&lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt;) ReflectionUtils.newInstance(taskContext.getMapperClass(), job); â€¢â€¢â€¢â€¢â€¢â€¢ //åˆ›å»º Context org.apache.hadoop.mapreduce.MapContext&lt;INKEY, INVALUE, OUTKEY, OUTVALUE&gt; mapContext = new MapContextImpl&lt;INKEY, INVALUE, OUTKEY, OUTVALUE&gt;(job, getTaskID(), input, output, committer, reporter, split); org.apache.hadoop.mapreduce.Mapper&lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt;.Context mapperContext = new WrappedMapper&lt;INKEY, INVALUE, OUTKEY, OUTVALUE&gt;().getMapContext( mapContext); try &#123; â€¢â€¢â€¢â€¢â€¢â€¢ mapper.run(mapperContext); â€¢â€¢â€¢â€¢â€¢â€¢ &#125; finally &#123; â€¢â€¢â€¢â€¢â€¢â€¢ &#125;&#125; MapTask#runNewMapper æ–¹æ³•ä¸­ä¼šé€šè¿‡åå°„åˆ›å»ºè®¾ç½®çš„ MapperClass çš„å¯¹è±¡ï¼Œå³ org.apache.giraph.job.GiraphJob#run ä¸­è®¾å®šçš„ GraphMapper ç±»çš„å¯¹è±¡ã€‚åœ¨è·å–åˆ° GraphMapper å¯¹è±¡åï¼Œç³»ç»Ÿä¼šè°ƒç”¨å…¶ run æ–¹æ³•ï¼Œä»è€Œä½¿å¾—ç¨‹åºçš„æ‰§è¡Œè¿›å…¥åˆ° Giraph éƒ¨åˆ†ã€‚ Giraph æ‰§è¡Œ Job org.apache.giraph.graph.GraphMapper#run 1234567891011121314151617@Overridepublic void run(Context context) throws IOException, InterruptedException &#123; // Notify the master quicker if there is Worker failure rather than // waiting for ZooKeeper to timeout and delete the ephemeral znodes try &#123; //åˆå§‹åŒ– setup(context); //æ‰§è¡Œè®¡ç®— while (context.nextKeyValue()) &#123; graphTaskManager.execute(); &#125; //æ¸…ç† cleanup(context); &#125; catch (RuntimeException e) &#123; â€¢â€¢â€¢â€¢â€¢â€¢ &#125;&#125; ä» GraphMapper#run æ–¹æ³•å¯ä»¥çœ‹åˆ°ä¸€ä¸ª Giraph Job çš„æ‰§è¡Œèƒ½å¤Ÿåˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼š åˆå§‹åŒ– æ‰§è¡Œè®¡ç®— æ¸…ç† ä¸‹é¢é’ˆå¯¹åˆå§‹åŒ–è¿‡ç¨‹è¿›è¡Œåˆ†æ åˆå§‹åŒ– org.apache.giraph.graph.GraphMapper#setup 123456789@Overridepublic void setup(Context context) throws IOException, InterruptedException &#123; // Execute all Giraph-related role(s) assigned to this compute node. // Roles can include "Master," "Worker," "zookeeper," or . . . ? graphTaskManager = new GraphTaskManager&lt;I, V, E&gt;(context); graphTaskManager.setup( DistributedCache.getLocalCacheArchives(context.getConfiguration()));&#125; GraphMapper#setup æ–¹æ³•ä¸­ä¼šåˆ›å»º GraphTaskManager å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ setup æ–¹æ³• org.apache.giraph.graph.GraphTaskManager#setup 12345678910111213141516171819202122232425262728public void setup(Path[] zkPathList) throws IOException, InterruptedException &#123; Configuration hadoopConf = context.getConfiguration(); //åˆå§‹åŒ–ä¸€äº›é…ç½® conf = new ImmutableClassesGiraphConfiguration&lt;I, V, E&gt;(hadoopConf); â€¢â€¢â€¢â€¢â€¢â€¢ //ä»é…ç½®ä¸­è¯»å– Zookeeper çš„è¿æ¥ä¿¡æ¯ï¼Œæ²¡æœ‰æä¾›å¤–éƒ¨ Zookeeper æƒ…å†µä¸‹ä¸ºç©º String serverPortList = conf.getZookeeperList(); //å¦‚æœæ²¡æœ‰æä¾›å¤–éƒ¨ Zookeeper åˆ™éœ€è¦è‡ªå·±å¯åŠ¨ Zookeeper if (serverPortList.isEmpty()) &#123; if (startZooKeeperManager()) &#123; return; // ZK connect/startup failed &#125; &#125; else &#123; createZooKeeperCounter(serverPortList); &#125; â€¢â€¢â€¢â€¢â€¢â€¢ this.graphFunctions = determineGraphFunctions(conf, zkManager); if (zkManager != null &amp;&amp; this.graphFunctions.isMaster()) &#123; //å°†ç”± Master åˆ›å»ºçš„æ–‡ä»¶å¤¹æ ‡è®°ä¸ºåˆ é™¤ï¼Œæ–‡ä»¶ç³»ç»Ÿå…³é—­æ—¶å°†ä¼šåˆ é™¤æ–‡ä»¶ zkManager.cleanupOnExit(); &#125; try &#123; //åˆå§‹åŒ– BSP æœåŠ¡ instantiateBspService(); &#125; catch (IOException e) &#123; â€¢â€¢â€¢â€¢â€¢â€¢ &#125;&#125; GraphTaskManager#setup æ–¹æ³•ä¸»è¦åšä¸‰ä»¶äº‹ï¼š è·å– Zookeeper è¿æ¥ä¿¡æ¯ å†³å®šè¿›ç¨‹çš„è§’è‰² åˆå§‹åŒ– BSP æœåŠ¡ è·å– Zookeeper è¿æ¥ä¿¡æ¯ GraphTaskManager#setup ä¸­ä¼šé€šè¿‡ conf.getZookeeperList() è·å¾— Zookeeper çš„è¿æ¥ä¿¡æ¯ã€‚å¦‚æœæä¾›äº†å¤–éƒ¨ Zookeeper åˆ™ç›´æ¥è¿”å›è¿æ¥ä¿¡æ¯ï¼Œä½†å¦‚æœæ²¡æœ‰æä¾›å¤–éƒ¨ Zookeeper æ—¶ï¼ŒgetZookeeperList() ä¼šè¿”å›ç©ºå€¼ã€‚æ­¤æ—¶ GraphTaskManager#setup ä¼šè°ƒç”¨ startZooKeeperManager æ–¹æ³•åœ¨æŸä¸€ä¸ª Task å¯åŠ¨ Zookeeperã€‚ org.apache.giraph.graph.GraphTaskManager#startZooKeeperManager 1234567891011121314151617181920212223/** * Instantiate and configure ZooKeeperManager for this job. This will * result in a Giraph-owned Zookeeper instance, a connection to an * existing quorum as specified in the job configuration, or task failure * @return true if this task should terminate */private boolean startZooKeeperManager() throws IOException, InterruptedException &#123; zkManager = new ZooKeeperManager(context, conf); context.setStatus("setup: Setting up Zookeeper manager."); zkManager.setup(); //å¦‚æœè®¡ç®—å·²ç»ç»“æŸåˆ™ä¸éœ€è¦å†å¯åŠ¨ Zookeeperï¼Œ //å¤§éƒ¨åˆ†æƒ…å†µåº”è¯¥ä¼šåœ¨æ²¡æœ‰æä¾›å¤–éƒ¨ Zookeeper ä¸”é‡å¯ Task æ—¶å€™èµ·ä½œç”¨ if (zkManager.computationDone()) &#123; done = true; return true; &#125; zkManager.onlineZooKeeperServer(); //æ›´æ–° Zookeeper è¿æ¥ä¿¡æ¯ï¼Œåˆ›å»ºè®¡æ•°å™¨ String serverPortList = zkManager.getZooKeeperServerPortString(); conf.setZookeeperList(serverPortList); createZooKeeperCounter(serverPortList); return false;&#125; startZooKeeperManager ä¸­é¦–å…ˆä¼šåˆ›å»º ZooKeeperManager å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶ setup æ–¹æ³• org.apache.giraph.zk.ZooKeeperManager#setup 1234public void setup() throws IOException, InterruptedException &#123; createCandidateStamp(); getZooKeeperServerList();&#125; ZooKeeperManager#setup æ–¹æ³•ä¸­ä¼šé¦–å…ˆè°ƒç”¨ createCandidateStamp æ–¹æ³• org.apache.giraph.zk.ZooKeeperManager#createCandidateStamp 1234567891011121314151617181920212223242526272829/** * Create a HDFS stamp for this task. If another task already * created it, then this one will fail, which is fine. */public void createCandidateStamp() &#123; â€¢â€¢â€¢â€¢â€¢â€¢ fs.mkdirs(baseDirectory); â€¢â€¢â€¢â€¢â€¢â€¢ fs.mkdirs(serverDirectory); â€¢â€¢â€¢â€¢â€¢â€¢ if (!fs.getFileStatus(baseDirectory).isDir()) &#123; throw new IllegalArgumentException( "createCandidateStamp: " + baseDirectory + " is not a directory, but should be."); &#125; â€¢â€¢â€¢â€¢â€¢â€¢ //æ ¹æ® hostname å’Œ taskPartition ç”Ÿæˆæ–‡ä»¶å Path myCandidacyPath = new Path( taskDirectory, myHostname + HOSTNAME_TASK_SEPARATOR + taskPartition); try &#123; â€¢â€¢â€¢â€¢â€¢â€¢ fs.createNewFile(myCandidacyPath); &#125; catch (IOException e) &#123; LOG.error("createCandidateStamp: Failed (maybe previous task " + "failed) to create filestamp " + myCandidacyPath, e); &#125;&#125; åœ¨ createCandidateStamp æ–¹æ³•ä¸­ï¼Œæ¯ä¸ª Task ä¼šæ ¹æ®è‡ªå·±çš„ hostname å’Œ taskPartition åœ¨ _bsp/_defaultZkManagerDir/_task ä¸‹åˆ›å»ºå¯¹åº”æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å°†ä¼šåœ¨ç³»ç»Ÿé€‰æ‹©æŸä¸ª Task å¯åŠ¨ Zookeeper æœåŠ¡æ—¶ç”¨åˆ°ã€‚å…·ä½“ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å›¾ä¸­ hostname æ˜¯ localhost çš„åŸå› åœ¨äºï¼Œè¿è¡Œæºç çš„æ—¶å€™ Hadoop å¤„äº Standalone æ¨¡å¼ã€‚ åœ¨ createCandidateStamp æ‰§è¡Œå®Œæˆä¹‹åï¼ŒZooKeeperManager#setup ä¼šæ¥ç€è°ƒç”¨ getZooKeeperServerList org.apache.giraph.zk.ZooKeeperManager#getZooKeeperServerList 123456789101112131415161718192021222324252627282930313233343536373839404142434445private void getZooKeeperServerList() throws IOException, InterruptedException &#123; String serverListFile; //taskPartition ä¸º 0 çš„ Task ä¼šåˆ›å»º zooKeeperServerList if (taskPartition == 0) &#123; //0 å· Task å¦‚æœé‡å¯æ£€æŸ¥åˆ°å·²ç»æœ‰ serverList åˆ™ä¸ä¼šé‡æ–°åˆ›å»º serverListFile = getServerListFile(); if (serverListFile == null) &#123; //åˆ›å»º serverList createZooKeeperServerList(); &#125; &#125; while (true) &#123; //å…¶ä½™ Task ç­‰å¾… serverList çš„åˆ›å»º serverListFile = getServerListFile(); â€¢â€¢â€¢â€¢â€¢â€¢ if (serverListFile != null) &#123; break; &#125; //å‡å°‘ CPU çš„å ç”¨ try &#123; Thread.sleep(pollMsecs); &#125; catch (InterruptedException e) &#123; LOG.warn("getZooKeeperServerList: Strange interrupted " + "exception " + e.getMessage()); &#125; &#125; //è§£æ serverList ä¸­çš„ä¿¡æ¯ String[] serverHostList = serverListFile.substring( ZOOKEEPER_SERVER_LIST_FILE_PREFIX.length()).split( HOSTNAME_TASK_SEPARATOR); â€¢â€¢â€¢â€¢â€¢â€¢ //è·å¾— Zookeeper æœåŠ¡æ‰€åœ¨èŠ‚ç‚¹çš„ hostname zkServerHost = serverHostList[0]; //è·å¾—åº”è¯¥å¯åŠ¨ Zookeeper æœåŠ¡çš„ Task çš„ taskPartition zkServerTask = Integer.parseInt(serverHostList[1]); //å„ä¸ª Task æ›´æ–°è‡ªå·±çš„ zkServerPortString updateZkPortString(); &#125; getZooKeeperServerList æ–¹æ³•ä¼šæ ¹æ® taskPartition è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯ 0 å· Task åˆ™ä¼šå…ˆè°ƒç”¨ createZooKeeperServerList åˆ›å»º serverListFileï¼ˆserverListFile è¡¨æ˜äº† Zookeeper æœåŠ¡æ‰€åœ¨çš„ hostname å’Œ taskPartitionï¼‰ï¼Œè€Œå¦‚æœæ˜¯é 0 å· Task åˆ™ä¼šè¿›è¡Œè½®è¯¢æ¥è·å– serverListFile çš„æ–‡ä»¶åã€‚åœ¨è·å–åˆ°æ–‡ä»¶ååä¼šå¯¹å…¶è¿›è¡Œè§£ææ¥æ›´æ–° zkServerHostã€zkServerTask ä»¥åŠ zkServerPortStringã€‚ æ¥ä¸‹æ¥ä¼šå¯¹ createZooKeeperServerList å’Œ getZooKeeperServerList è¿›è¡Œåˆ†æä»¥ä¾¿æ›´å¥½çš„ç†è§£ç³»ç»Ÿå¦‚ä½•é€‰å–å¯åŠ¨ Zookeeper æœåŠ¡çš„ Task org.apache.giraph.zk.ZooKeeperManager#createZooKeeperServerList 12345678910111213141516171819202122232425262728293031private void createZooKeeperServerList() throws IOException, InterruptedException &#123; String host; String task; while (true) &#123; //è¿”å› Task ä¸‹æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶åæ ¼å¼æ ¡éªŒçš„è¿‡ç¨‹ï¼Œä¼šå»æ‰ä»¥ . å¼€å¤´å’Œ crc ç»“å°¾æ–‡ä»¶ FileStatus [] fileStatusArray = fs.listStatus(taskDirectory); if (fileStatusArray.length &gt; 0) &#123; //é€‰å–ç¬¬ä¸€ä½çš„å…ƒæ•°æ®æ ‡è¯†çš„ Task å»å¯åŠ¨ Zookeeper æœåŠ¡ FileStatus fileStatus = fileStatusArray[0]; //è§£æä¿¡æ¯ String[] hostnameTaskArray = fileStatus.getPath().getName().split( HOSTNAME_TASK_SEPARATOR); â€¢â€¢â€¢â€¢â€¢â€¢ host = hostnameTaskArray[0]; task = hostnameTaskArray[1]; break; &#125; Thread.sleep(pollMsecs); &#125; //æ ¹æ®è§£æçš„ä¿¡æ¯ç”Ÿæˆ serverListFile æ–‡ä»¶å String serverListFile = ZOOKEEPER_SERVER_LIST_FILE_PREFIX + host + HOSTNAME_TASK_SEPARATOR + task; Path serverListPath = new Path(baseDirectory, serverListFile); â€¢â€¢â€¢â€¢â€¢â€¢ &#125; //åˆ›å»ºæ–‡ä»¶ fs.createNewFile(serverListPath);&#125; createZooKeeperServerList ä¸­ä¼šè·å–æ‰€æœ‰ Task åœ¨ createCandidateStamp æ–¹æ³•ä¸­åˆ›å»ºçš„æ–‡ä»¶çš„æ–‡ä»¶åï¼Œç„¶åé€‰å–è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ ‡è¯†çš„ Task ä¿¡æ¯å»åˆ›å»º serverListFileã€‚ org.apache.giraph.zk.ZooKeeperManager#getServerListFile 1234567891011121314private String getServerListFile() throws IOException &#123; String serverListFile = null; //baseDirectory æ˜¯ _bsp/_defaultZkManagerDirï¼Œåˆ—å‡ºæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å…ƒæ•°æ® FileStatus [] fileStatusArray = fs.listStatus(baseDirectory); for (FileStatus fileStatus : fileStatusArray) &#123; //ç­›é€‰æ–‡ä»¶åä¸­å«æœ‰ zkServerList_ çš„æ–‡ä»¶ï¼Œå³ taskpartition ä¸º 0 task åˆ›å»ºçš„ serverListFile if (fileStatus.getPath().getName().startsWith( ZOOKEEPER_SERVER_LIST_FILE_PREFIX)) &#123; serverListFile = fileStatus.getPath().getName(); break; &#125; &#125; return serverListFile;&#125; getServerListFile ä¼šè·å– baseDirectory ä¸‹çš„æ–‡ä»¶å…ƒæ•°æ®ï¼Œç„¶åç­›é€‰å‡ºå¯¹åº”çš„ serverListFileï¼Œæœ€åè¿”å›å…¶æ–‡ä»¶åã€‚ æ¥ç€å›åˆ° startZooKeeperManager æ–¹æ³•ä¸­ï¼Œåœ¨é€‰å®šäº†å¯åŠ¨ Zookeeper æœåŠ¡çš„ Task åï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­è®¡ç®—æ˜¯å¦å®Œæˆï¼Œå¦‚æœå·²ç»å®Œæˆåˆ™è¡¨æ˜æ— éœ€å†ç»§ç»­è¿è¡Œã€‚å¦åˆ™ä¼šè°ƒç”¨ onlineZooKeeperServer æ–¹æ³•å¯åŠ¨ Zookeeper æœåŠ¡ã€‚ org.apache.giraph.zk.ZooKeeperManager#onlineZooKeeperServer 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122public void onlineZooKeeperServer() throws IOException &#123; //å¦‚æœå½“å‰ task çš„ taskPartition ç­‰äº zkServerTaskï¼Œåˆ™éœ€è¦å¯åŠ¨ Zookeeper æœåŠ¡ if (zkServerTask == taskPartition) &#123; File zkDirFile = new File(this.zkDir); try &#123; //åˆ é™¤æ—§çš„æ–‡ä»¶å¤¹ â€¢â€¢â€¢â€¢â€¢â€¢ FileUtils.deleteDirectory(zkDirFile); &#125; catch (IOException e) &#123; â€¢â€¢â€¢â€¢â€¢â€¢ &#125; //ç”Ÿæˆ Zookeeper é…ç½® generateZooKeeperConfig(); synchronized (this) &#123; zkRunner = createRunner(); //å¯åŠ¨ Zookeeper æœåŠ¡ int port = zkRunner.start(zkDir, config); if (port &gt; 0) &#123; zkBasePort = port; updateZkPortString(); &#125; &#125; // Once the server is up and running, notify that this server is up // and running by dropping a ready stamp. int connectAttempts = 0; final int maxConnectAttempts = conf.getZookeeperConnectionAttempts(); while (connectAttempts &lt; maxConnectAttempts) &#123; try &#123; â€¢â€¢â€¢â€¢â€¢â€¢ //è¿æ¥ Zookeeper æœåŠ¡ InetSocketAddress zkServerAddress = new InetSocketAddress(myHostname, zkBasePort); Socket testServerSock = new Socket(); testServerSock.connect(zkServerAddress, 5000); â€¢â€¢â€¢â€¢â€¢â€¢ break; &#125; catch (SocketTimeoutException e) &#123; LOG.warn("onlineZooKeeperServers: Got " + "SocketTimeoutException", e); &#125; catch (ConnectException e) &#123; LOG.warn("onlineZooKeeperServers: Got " + "ConnectException", e); &#125; catch (IOException e) &#123; LOG.warn("onlineZooKeeperServers: Got " + "IOException", e); &#125; ++connectAttempts; try &#123; Thread.sleep(pollMsecs); &#125; catch (InterruptedException e) &#123; LOG.warn("onlineZooKeeperServers: Sleep of " + pollMsecs + " interrupted - " + e.getMessage()); &#125; &#125; //è¶…è¿‡æœ€å¤§çš„å°è¯•æ•°ï¼Œè¿æ¥å¤±è´¥ if (connectAttempts == maxConnectAttempts) &#123; throw new IllegalStateException( "onlineZooKeeperServers: Failed to connect in " + connectAttempts + " tries!"); &#125; // Path myReadyPath = new Path( serverDirectory, myHostname + HOSTNAME_TASK_SEPARATOR + taskPartition + HOSTNAME_TASK_SEPARATOR + zkBasePort); try &#123; â€¢â€¢â€¢â€¢â€¢â€¢ //åˆ›å»ºæ–‡ä»¶è¡¨æ˜ Zookeeper æœåŠ¡å·²ç»å‡†å¤‡å¥½ï¼Œå¹¶ä¸”æä¾›è¿æ¥çš„ä¿¡æ¯ fs.createNewFile(myReadyPath); &#125; catch (IOException e) &#123; â€¢â€¢â€¢â€¢â€¢â€¢ &#125; &#125; else &#123; //å…¶ä½™ Task ç­‰å¾… Zookeeper æœåŠ¡çš„å¯åŠ¨ int readyRetrievalAttempt = 0; String foundServer = null; while (true) &#123; try &#123; FileStatus [] fileStatusArray = fs.listStatus(serverDirectory); //æ£€æŸ¥ serverDirectory æ–‡ä»¶å¤¹ä¸‹æ˜¯å¦ç”Ÿæˆäº† Zookeeper è¿æ¥ä¿¡æ¯æ–‡ä»¶ if ((fileStatusArray != null) &amp;&amp; (fileStatusArray.length &gt; 0)) &#123; //è§£ææ–‡ä»¶ä¸­çš„è¿æ¥ä¿¡æ¯ for (int i = 0; i &lt; fileStatusArray.length; ++i) &#123; String[] hostnameTaskArray = fileStatusArray[i].getPath().getName().split( HOSTNAME_TASK_SEPARATOR); if (hostnameTaskArray.length != 3) &#123; throw new RuntimeException( "getZooKeeperServerList: Task 0 failed " + "to parse " + fileStatusArray[i].getPath().getName()); &#125; //zookeeper æœåŠ¡æ‰€åœ¨åœ°å€ foundServer = hostnameTaskArray[0]; //zookeeper æœåŠ¡çš„è¿æ¥ç«¯å£ zkBasePort = Integer.parseInt(hostnameTaskArray[2]); //æ›´æ–° zookeeper çš„è¿æ¥ä¿¡æ¯ updateZkPortString(); &#125; â€¢â€¢â€¢â€¢â€¢â€¢ //æŸ¥çœ‹ hostname æ˜¯å¦ç›¸åŒï¼Œç›¸åŒåˆ™è·³å‡ºç­‰å¾…ï¼Œå…·ä½“åœºæ™¯å°šæœªæƒ³åˆ° if (zkServerHost.equals(foundServer)) &#123; break; &#125; &#125; else &#123; â€¢â€¢â€¢â€¢â€¢â€¢ &#125; Thread.sleep(pollMsecs); ++readyRetrievalAttempt; &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125; catch (InterruptedException e) &#123; â€¢â€¢â€¢â€¢â€¢â€¢ &#125; &#125; &#125;&#125; å¯ä»¥çœ‹åˆ° onlineZooKeeperServer å®é™…åšäº†ä¸¤ä»¶äº‹æƒ…ï¼šä¸€æ˜¯åœ¨é€‰å®šçš„ Task ä¸Šå¯åŠ¨ Zookeeper æœåŠ¡ï¼Œå¹¶åˆ›å»ºæ–‡ä»¶è¡¨æ˜æœåŠ¡å·²ç»å‡†å¤‡å¥½ã€‚äºŒæ˜¯æ‰€æœ‰æœªå¯åŠ¨ Zookeeper æœåŠ¡çš„ Task å»æ›´æ–° Zookeeper çš„è¿æ¥ä¿¡æ¯ã€‚ åˆ†é…è§’è‰² åœ¨å¯åŠ¨å®Œæˆ Zookeeper æœåŠ¡ä¹‹åç³»ç»Ÿä¼šæ›´æ–° Zookeeper ç›¸å…³çš„é…ç½®ä¿¡æ¯ç„¶åè¿”å›åˆ° org.apache.giraph.graph.GraphTaskManager#setup æ–¹æ³•ä¸­ï¼Œä¹‹åä¼šè°ƒç”¨ determineGraphFunctions org.apache.giraph.graph.GraphTaskManager#determineGraphFunctions 123456789101112131415161718192021222324252627282930313233343536373839private static GraphFunctions determineGraphFunctions( ImmutableClassesGiraphConfiguration conf, ZooKeeperManager zkManager) &#123; //åˆ¤æ–­æ˜¯æœ¬åœ°æ¨¡å¼è¿˜æ˜¯é›†ç¾¤æ¨¡å¼ï¼Œæœ¬åœ°æ¨¡å¼åªä¼šå¯åŠ¨ä¸€ä¸ª Task boolean splitMasterWorker = conf.getSplitMasterWorker(); //è·å–å½“å‰ Task çš„ taskPartition int taskPartition = conf.getTaskPartition(); //åˆ¤æ–­æ˜¯å¦æä¾›äº†å¤–éƒ¨çš„ Zookeeper boolean zkAlreadyProvided = conf.isZookeeperExternal(); //åˆå§‹æ—¶åˆ» Task çš„è§’è‰² GraphFunctions functions = GraphFunctions.UNKNOWN; if (!splitMasterWorker) &#123; //æœ¬åœ°æ¨¡å¼ä¸‹å¦‚æœæ˜¯å†…éƒ¨å¯åŠ¨ Zookeeper åˆ™ Task å……å½“æ‰€æœ‰çš„è§’è‰²ï¼Œå¦åˆ™å……å½“ Master å’Œ Worker if ((zkManager != null) &amp;&amp; zkManager.runsZooKeeper()) &#123; functions = GraphFunctions.ALL; &#125; else &#123; functions = GraphFunctions.ALL_EXCEPT_ZOOKEEPER; &#125; &#125; else &#123; if (zkAlreadyProvided) &#123; //å¦‚æœæœ‰å¤–éƒ¨ Zookeeper åˆ™ 0 å· Task å°±æ˜¯ Masterï¼Œå…¶ä½™çš„éƒ½æ˜¯ Worker if (taskPartition == 0) &#123; functions = GraphFunctions.Master_ONLY; &#125; else &#123; functions = GraphFunctions.Worker_ONLY; &#125; &#125; else &#123; //å¦‚æœæ˜¯å†…éƒ¨å¯åŠ¨çš„ Zookeeper æœåŠ¡ï¼Œ //åˆ™å¯åŠ¨ Zookeeper æœåŠ¡çš„ Task å……å½“ Master å’Œ zookeeper è§’è‰²ï¼Œå…¶ä½™ä¸º Worker if ((zkManager != null) &amp;&amp; zkManager.runsZooKeeper()) &#123; functions = GraphFunctions.Master_ZOOKEEPER_ONLY; &#125; else &#123; functions = GraphFunctions.Worker_ONLY; &#125; &#125; &#125; return functions;&#125; determineGraphFunctions ä¸»è¦æ˜¯å¯¹ Task çš„è§’è‰²è¿›è¡Œåˆ¤æ–­ï¼Œç³»ç»Ÿæä¾›äº† 6 ç§è§’è‰²ï¼š UNKNOWN è¡¨æ˜ Task çš„è§’è‰²è¿˜æœªçŸ¥ Master_ONLY è¡¨æ˜ Task æ˜¯ Master Master_ZOOKEEPER_ONLY è¡¨æ˜ Task æ—¢æ˜¯ Master ä¹Ÿæ˜¯ Zookeeper Worker_ONLY è¡¨æ˜ Task åªæ˜¯ Worker ALL è¡¨æ˜ Task æ—¢æ˜¯ Master ä¹Ÿæ˜¯ Worker å’Œ Zookeeper ALL_EXCEPT_ZOOKEEPER è¡¨æ˜ Task æ—¢æ˜¯ Master ä¹Ÿæ˜¯ Worker åˆå§‹åŒ– BSP åœ¨å†³å®šå„ä¸ª Task çš„è§’è‰²ä¹‹åï¼Œç³»ç»Ÿä¼šè°ƒç”¨ instantiateBspService åˆå§‹åŒ– BSP æœåŠ¡ã€‚ org.apache.giraph.graph.GraphTaskManager#instantiateBspService 1234567891011121314151617181920private void instantiateBspService()throws IOException, InterruptedException &#123; if (graphFunctions.isMaster()) &#123; â€¢â€¢â€¢â€¢â€¢â€¢ //åˆ›å»º Master å¯¹è±¡ serviceMaster = new BspServiceMaster&lt;I, V, E&gt;(context, this); //Master è¿è¡Œåœ¨çº¿ç¨‹é‡Œé¢ MasterThread = new MasterThread&lt;I, V, E&gt;(serviceMaster, context); MasterThread.setUncaughtExceptionHandler( createUncaughtExceptionHandler()); MasterThread.start(); &#125; if (graphFunctions.isWorker()) &#123; â€¢â€¢â€¢â€¢â€¢â€¢ //åˆ›å»º Worker å¯¹è±¡ serviceWorker = new BspServiceWorker&lt;I, V, E&gt;(context, this); installGCMonitoring(); â€¢â€¢â€¢â€¢â€¢â€¢ &#125;&#125; instantiateBspService ä¸­å¯¹äº Master ä¸»è¦æ˜¯åˆ›å»º serviceMaster å¯¹è±¡ï¼Œç„¶åå¯åŠ¨ MasterThread çº¿ç¨‹ï¼Œå¯¹äº Worker åˆ™æ˜¯åˆ›å»º serviceWorker å¯¹è±¡ã€‚ æ€»ç»“ æ€»çš„æ¥è¯´ï¼ŒGiraph çš„ Job æäº¤å’Œåˆå§‹åŒ–ä¾æ®ä»¥ä¸‹æµç¨‹æ¥æ‰§è¡Œï¼š ç”¨æˆ·å‘ Giraph æäº¤ Job Giraph å‘ Hadoop æäº¤ Job Hadoop å¯åŠ¨ MapTaskï¼Œå¹¶æ‰§è¡Œ GraphMapper çš„ run æ–¹æ³• GraphMapper åˆ›å»º GraphTaskManager å¯¹è±¡è¿›è¡Œåˆå§‹åŒ– åˆå§‹åŒ–è¿‡ç¨‹é¦–å…ˆè·å– Zookeeper è¿æ¥ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰å¤–ç½® Zookeeper åˆ™éœ€è¦ä»æ‰€æœ‰ MapTask ä¸­è¿›è¡Œé€‰å– Task æ¥å¯åŠ¨ Zookeeper æœåŠ¡ã€‚ è·å–åˆ° Zookeeper è¿æ¥ä¿¡æ¯ä¹‹åä¼šæ ¹æ® determineGraphFunctions åˆ†é…è§’è‰²ï¼Œç”±æ­¤åŒºåˆ† MapTask ä¸­çš„ Master å’Œ Worker åˆ†é…å®Œè§’è‰²ä¹‹ååˆ™ä¼šé€šè¿‡ instantiateBspService æ¥åˆå§‹åŒ– BSP æœåŠ¡ï¼Œç”±æ­¤ç»“æŸæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ã€‚]]></content>
      <categories>
        <category>Giraph æºç åˆ†æ</category>
      </categories>
      <tags>
        <tag>å›¾è®¡ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Giraph ç¼–ç¨‹å®è·µåŠæºç ç¼–è¯‘è°ƒè¯•]]></title>
    <url>%2F2019%2F09%2F07%2FGiraph%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5%E5%8F%8A%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡ä¸»è¦æ€»ç»“äº†å¦‚ä½•åˆ©ç”¨ Giraph æä¾›çš„ API å®ç°å›¾è®¡ç®—ç¼–ç¨‹ï¼Œå¹¶è¯´æ˜äº†å°† Giraph æºç å¯¼å…¥ IDEA è¿›è¡Œè°ƒè¯•çš„è¿‡ç¨‹ã€‚ ç¼–ç¨‹å®è·µ æœ¬éƒ¨åˆ†é€šè¿‡å®ç°æœ€çŸ­è·¯å¾„ç®—æ³•è¯´æ˜ Giraph çš„ç¼–ç¨‹æµç¨‹ åˆ›å»º Maven å·¥ç¨‹ æ·»åŠ ç›¸å…³ä¾èµ– 123456789101112131415161718192021&lt;dependencies&gt; &lt;!--æ·»åŠ  Giraph ä¾èµ–--&gt;&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.giraph&lt;/groupId&gt; &lt;artifactId&gt;giraph-core&lt;/artifactId&gt; &lt;version&gt;1.2.0-hadoop2&lt;/version&gt; &lt;/dependency&gt; &lt;!--æ·»åŠ  Hadoop ä¾èµ–--&gt;&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-common&lt;/artifactId&gt; &lt;version&gt;2.5.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt; &lt;version&gt;2.5.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; åˆ›å»º ShortestPathComputation ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import org.apache.giraph.edge.Edge;import org.apache.giraph.graph.BasicComputation;import org.apache.giraph.graph.Vertex;import org.apache.hadoop.io.DoubleWritable;import org.apache.hadoop.io.FloatWritable;import org.apache.hadoop.io.LongWritable;import java.io.IOException;public class ShortestPathComputation extends BasicComputation&lt;LongWritable, DoubleWritable, FloatWritable, DoubleWritable&gt; &#123; /** * éœ€è¦è®¡ç®—æœ€çŸ­è·¯å¾„çš„æºé¡¶ç‚¹ */ private static final int SOURCE_VERTEX = 0; /** * è¡¨ç¤ºèŠ‚ç‚¹ä¸å¯è¾¾ */ private static final double UNREACHABLE = Double.MAX_VALUE; /** * @param vertex å¾…å¤„ç†çš„é¡¶ç‚¹ * @param messages vertex æ¥æ”¶åˆ°çš„æ¥è‡ªå…¶ä½™é¡¶ç‚¹çš„ message */ @Override public void compute(Vertex&lt;LongWritable, DoubleWritable, FloatWritable&gt; vertex, Iterable&lt;DoubleWritable&gt; messages) throws IOException &#123; if (getSuperstep() == 0) &#123; //è¶…æ­¥ 0 æ—¶æºé¡¶ç‚¹æœ€çŸ­è·¯å¾„è®¾ç½®ä¸º 0ï¼Œå…¶ä½™é¡¶ç‚¹è®¾ç½®ä¸ºä¸å¯è¾¾ï¼Œå¹¶ä¸”æºé¡¶ç‚¹éœ€è¦å‘å…¶å®ƒé¡¶ç‚¹å‘é€æœ€çŸ­è·ç¦»message if (vertex.getId().get() == SOURCE_VERTEX) &#123; vertex.setValue(new DoubleWritable(0)); sendDist(vertex); &#125; else &#123; vertex.setValue(new DoubleWritable(UNREACHABLE)); &#125; &#125; else &#123; //éå†å¤„ç†ä»å…¶ä½™é¡¶ç‚¹æ”¶åˆ°çš„ messageï¼Œ // æŸ¥çœ‹ message ä¸­ä¼ é€’çš„æœ€çŸ­è·ç¦»æ˜¯å¦å°äºå½“å‰çš„æœ€çŸ­è·ç¦»ï¼Œå¦‚æœæ˜¯åˆ™è¿›è¡Œæ›´æ–° for (DoubleWritable message : messages) &#123; if (message.get() &lt; vertex.getValue().get()) &#123; vertex.setValue(message); sendDist(vertex); &#125; &#125; &#125; //ä¸»åŠ¨å°†é¡¶ç‚¹ç½®äºä¸æ´»è·ƒçŠ¶æ€ï¼Œå¦‚æœé¡¶ç‚¹æ”¶åˆ° messageï¼Œç³»ç»Ÿä¼šå°†é¡¶ç‚¹å†åº¦æ¿€æ´» vertex.voteToHalt(); &#125; /** * å‘é€é¡¶ç‚¹ vertex åˆ°å…¶é‚»æ¥é¡¶ç‚¹çš„æœ€çŸ­è·ç¦» */ private void sendDist(Vertex&lt;LongWritable, DoubleWritable, FloatWritable&gt; vertex) &#123; for (Edge&lt;LongWritable, FloatWritable&gt; edge : vertex.getEdges()) &#123; double distance = vertex.getValue().get() + edge.getValue().get(); sendMessage(edge.getTargetVertexId(), new DoubleWritable(distance)); &#125; &#125;&#125; ShortestPathComputation ç»§æ‰¿äº† BasicComputationï¼Œå¯¹äº BasicComputation ä¸­æŒ‡å®šçš„å››ä¸ªç±»å‹å‚æ•°ï¼Œå…¶å«ä¹‰ä¾æ¬¡ä¸º Vertex id Vertex data Edge data Message æ•´ä¸ªè®¡ç®—çš„è¿‡ç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼š Superstep 0 çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åæºå¤´é¡¶ç‚¹å‘é‚»æ¥é¡¶ç‚¹å‘é€å¯èƒ½çš„æœ€çŸ­è·¯å¾„ message ä¸‹ä¸€ Superstep é‚»æ¥é¡¶ç‚¹å¤„ç†æ¥æ”¶åˆ°çš„ message ç„¶åå’Œé¡¶ç‚¹å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœ message å°äºé¡¶ç‚¹å€¼åˆ™å¯¹é¡¶ç‚¹å€¼è¿›è¡Œæ›´æ–°ï¼Œå¹¶å‘é‚»æ¥é¡¶ç‚¹å‘é€å¯èƒ½çš„æœ€çŸ­è·¯å¾„ messageã€‚ é‡å¤ 2 ç›´åˆ°æ‰€æœ‰çš„é¡¶ç‚¹å¤„äºä¸æ´»è·ƒçŠ¶æ€ï¼Œæœ€åç»“æŸè®¡ç®—è¿›è¡Œè¾“å‡ºã€‚ æäº¤éªŒè¯ éªŒè¯éƒ¨åˆ†åŸºäº Pseudo-Distributed æ¨¡å¼çš„ Hadoop è¿›è¡Œ ä¸Šä¼ æµ‹è¯•æ–‡ä»¶åˆ° HDFS 12345678$HADOOP_HOME/bin/hdfs dfs -put giraph_data.txt &lt;your_input_path&gt;/shortestpath#giraph_data ä¸­çš„æ•°æ®ï¼Œæ ¼å¼ä¸º [source_id,source_value,[[dest_id, edge_value],...]]ï¼Œ# å¦‚ [0,0,[[1,1],[3,3]]] è¡¨ç¤ºé¡¶ç‚¹åºå·ä¸º 0ï¼Œé¡¶ç‚¹å€¼ä¸º 0ï¼Œå­˜åœ¨åºå· 0 åˆ° åºå· 1 çš„è¾¹ï¼Œå€¼ä¸º 1ï¼Œå­˜åœ¨åºå· 0 åˆ°åºå· 3 çš„è¾¹ï¼Œå€¼ä¸º 3ã€‚[0,100,[[1,1],[3,3]]][1,20,[[0,1],[2,2],[3,1]]][2,90,[[1,2],[4,4]]][3,50,[[0,3],[1,1],[4,4]]][4,80,[[3,4],[2,4]]] å°†å·¥ç¨‹æ‰“åŒ…ä¸º jar æ–‡ä»¶ï¼Œå¹¶æäº¤åˆ° Hadoop 1$HADOOP_HOME/bin/hadoop jar Examples.jar org.apache.giraph.GiraphRunner com.ikroal.shortestpath.ShortestPathComputation -vif org.apache.giraph.io.formats.JsonLongDoubleFloatDoubleVertexInputFormat -vip &lt;your_input_path&gt;/giraph_data.txt -vof org.apache.giraph.io.formats.IdWithValueTextOutputFormat -op &lt;your_output&gt;/shortestpaths -w 1 æäº¤ä»»åŠ¡çš„è¿‡ç¨‹åŸºæœ¬ä¸ä¸€èˆ¬çš„æäº¤è¿‡ç¨‹ä¸€è‡´ï¼Œåªæ˜¯è¿˜é¢å¤–æŒ‡å®šäº† Giraph è¿è¡Œæ‰€éœ€è¦çš„å‚æ•°ï¼Œå¯¹äºç›¸å…³å‚æ•°çš„è§£é‡Šè¯·å‚è€ƒ Giraph ç¯å¢ƒæ­å»º ã€‚ æŸ¥çœ‹ç»“æœ è¿è¡Œä¹‹åå°†ä¼šåœ¨è¾“å‡ºè·¯å¾„ä¸‹çœ‹åˆ°è¾“å‡ºæ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸º 123450 0.01 1.02 3.03 2.04 6.0 æ€»ç»“ Giraph çš„ç¼–ç¨‹è¿‡ç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼š ç»§æ‰¿ BasicComputationï¼Œå®ç° compute æ–¹æ³• compute æ–¹æ³•ä¸»è¦å®Œæˆé¡¶ç‚¹çš„è®¡ç®—æ›´æ–°å’Œå¿…è¦çš„æ¶ˆæ¯å‘é€ å‘½ä»¤è¡Œæäº¤ Job ç”±äºç³»ç»Ÿå·²ç»æä¾›äº† GiraphRunner çš„ä¸»ç±»ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹ç”¨æˆ·ä¸éœ€è¦ç¼–å†™ Job çš„é…ç½®å’Œæäº¤è¿‡ç¨‹ï¼Œä½†æ˜¯å¦‚æœ GiraphRunner ä¸æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸»ç±»ç„¶åå‘½ä»¤è¡Œæäº¤çš„æ—¶å€™è¿›è¡ŒæŒ‡å®š ä»¥ä¸Šä»…ä»…è¯´æ˜äº†æœ€åŸºæœ¬çš„ Giraph ç¼–ç¨‹è¿‡ç¨‹ï¼Œä½†å¦‚æœæƒ³è¦å®ç°æ€§èƒ½æœ€ä¼˜çš„å›¾è®¡ç®—è¿‡ç¨‹ï¼Œåˆ™è¿˜éœ€è¦è€ƒè™‘ç¼–ç¨‹è¿‡ç¨‹ä¸­åˆ©ç”¨ Aggregators å’Œ Combiners æœºåˆ¶ï¼Œç›¸å…³ç¤ºä¾‹å¯ä»¥å‚è€ƒ giraph æºç çš„ giraph-examples éƒ¨åˆ†ã€‚ æºç ç¼–è¯‘è°ƒè¯• ç¯å¢ƒè¦æ±‚ Giraph æºç çš„ç¼–è¯‘è°ƒè¯•è¦æ±‚ Java 1.8ã€Maven 3 ä»¥ä¸Šç‰ˆæœ¬ä»¥åŠ Hadoop2.5.1 å¯¼å…¥æºç  ä¸‹è½½æºç  1git clone https://github.com/apache/giraph.git ç¼–è¯‘æºç  1mvn -Phadoop_2 -DskipTests clean package æˆåŠŸåå°†ä¼šè¾“å‡º ä½¿ç”¨ IDEA æ‰“å¼€ giraph æºç ç›®å½• åœ¨ Maven çš„ Profies é¡µé¢é€‰æ‹© hadoop2 ( é»˜è®¤æ˜¯ hadoop1 ) å¢åŠ è‡ªå®šä¹‰å…¥å£ Giraph æä¾›äº†ä¸€ä¸ªä½äº giraph-core/src/main/java/org/apache/giraph ä¸‹çš„å…¥å£ç±» GiraphRunnerã€‚ä½†è¯¥ç±»æ¯”è¾ƒç¹çå¹¶ä¸”ä¸èƒ½è‡ªåŠ¨åˆ é™¤è¾“å‡ºæ–‡ä»¶ï¼Œä¸å¤ªåˆ©äºæœ¬åœ°è°ƒè¯•é˜…è¯» Giraph çš„æºç ã€‚å› æ­¤æœ€å¥½æ˜¯å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„å…¥å£ç±»ã€‚ åœ¨ org.apache.giraph åŒ…ä¸‹åˆ›å»º custom åŒ… åœ¨ custom åŒ…ä¸‹åˆ›å»ºç”¨äºæµ‹è¯•çš„ Shortestpath ç±»ï¼ˆå†…å®¹ä¸ç¼–ç¨‹å®è·µéƒ¨åˆ†ä¸€è‡´ï¼‰ åœ¨ custom åŒ…ä¸‹åˆ›å»ºè‡ªå®šä¹‰å…¥å£ç±» CustomRunner 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667import org.apache.giraph.conf.GiraphConfiguration;import org.apache.giraph.conf.GiraphConstants;import org.apache.giraph.io.formats.*;import org.apache.giraph.job.GiraphJob;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import java.io.File;public class CustomRunner &#123; /** * è¾“å…¥è·¯å¾„ */ private static final String INPUT_PATH = "giraph-core/src/main/resources/input/graph_data.txt"; /** * è¾“å‡ºè·¯å¾„ */ private static final String OUTPUT_PATH = "giraph-core/src/main/resources/output/shortestPath"; public static void main(String[] args) throws Exception &#123; GiraphConfiguration conf = new GiraphConfiguration(new Configuration()); conf.setComputationClass(Shortestpath.class); //è®¾ç½®è¾“å…¥å’Œè¾“å‡ºæ ¼å¼ conf.setVertexInputFormatClass(JsonLongDoubleFloatDoubleVertexInputFormat.class); conf.setVertexOutputFormatClass(IdWithValueTextOutputFormat.class); //è®¾ç½®æœ¬åœ°è¿è¡Œæ¨¡å¼ conf.setLocalTestMode(true); //è®¾ç½® worker é…ç½® conf.setWorkerConfiguration(1, 1, 100); //å¯é€‰ï¼Œå¦‚æœè¦å­¦ä¹  Checkpoint æœºåˆ¶åº”è¯¥è®¾ç½® conf.setCheckpointFrequency(4); GiraphConstants.SPLIT_MASTER_WORKER.set(conf, false); GiraphJob job = new GiraphJob(conf, Shortestpath.class.getSimpleName()); //è®¾ç½®è¾“å…¥å’Œè¾“å‡ºè·¯å¾„ GiraphTextInputFormat.setVertexInputPath(conf, new Path(INPUT_PATH)); GiraphTextOutputFormat.setOutputPath(job.getInternalJob(), new Path(OUTPUT_PATH)); //åˆ é™¤ä¹‹å‰çš„è¾“å‡º deletePath(OUTPUT_PATH, true); job.run(true); &#125; /** * ç”¨äºåˆ é™¤è¾“å‡ºç›®å½• * * @param path ç›®å½•è·¯å¾„ */ public static void deletePath(String path, boolean isDirectory) &#123; File file = new File(path); if (file.exists()) &#123; //æœ¬åœ°ç›®å½•é€’å½’åˆ é™¤ if (isDirectory) &#123; File[] subFiles = file.listFiles(); for (File subFile : subFiles) &#123; if (subFile.isFile()) &#123; subFile.delete(); &#125; else &#123; deletePath(subFile.getPath(), true); &#125; &#125; &#125; file.delete(); &#125; &#125;&#125; åœ¨ resources æ–‡ä»¶å¤¹åˆ›å»º input æ–‡ä»¶å¤¹å¹¶æ”¾å…¥ç¼–ç¨‹å®è·µä¸­çš„æµ‹è¯•æ•°æ® graph_data.txt éªŒè¯ ä¿®æ”¹é…ç½®å¹¶è¿è¡Œå¦‚æœåœ¨ resources æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°è¾“å‡ºæ–‡ä»¶ï¼Œè¯æ˜æ·»åŠ è‡ªå®šä¹‰å…¥å£æˆåŠŸï¼Œæ­¤æ—¶å¯ä»¥è¿›è¡Œæ–­ç‚¹è°ƒè¯• é—®é¢˜ è¿è¡Œæ—¶æç¤º TestYarnJob ä¸­çš„ MiniYARNCluster ç¼ºå¤±é—®é¢˜ å¯¹äº Test éƒ¨åˆ†çš„å†…å®¹å› ä¸ºä¸å½±å“æºç é˜…è¯»ï¼Œå¯ä»¥å°†å‡ºé”™éƒ¨åˆ†æ³¨é‡Šæ‰ Thanks Introduction to Apache Giraph Building and Testing]]></content>
      <categories>
        <category>Giraph åŸºç¡€</category>
      </categories>
      <tags>
        <tag>å›¾è®¡ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Giraph ç¯å¢ƒæ­å»º]]></title>
    <url>%2F2019%2F08%2F17%2FGiraph%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Giraph çš„ç¯å¢ƒæ­å»ºè¿‡ç¨‹ è¿è¡Œæ¨¡å¼ Giraph æ˜¯åŸºäº Hadoop å¼€å‘çš„ä¸Šå±‚åº”ç”¨ï¼Œå› æ­¤å…¶è¿è¡Œæ¨¡å¼å–å†³äº Hadoop çš„è¿è¡Œæ¨¡å¼ã€‚å…³äº Hadoop çš„è¿è¡Œæ¨¡å¼è¯·å‚ç…§ HadoopåŸºç¡€ä¹‹æ­å»ºç¯å¢ƒ ä¸€æ–‡ã€‚ æ­å»ºè¿‡ç¨‹ æœ¬æ¬¡ç¯å¢ƒæ­å»ºåŸºäº Hadoop 2.5.1 ä»¥åŠ Giraph 1.2.0ï¼Œç³»ç»Ÿç¯å¢ƒæ˜¯ Ubuntu 18.04ï¼ŒJDK ç‰ˆæœ¬æ˜¯ openjdk8ã€‚ é…ç½® Hadoop çš„ç¯å¢ƒ é¦–å…ˆä¸‹è½½ Hadoop 2.5.1ï¼Œç„¶åå‚è€ƒ HadoopåŸºç¡€ä¹‹æ­å»ºç¯å¢ƒ å®Œæˆé…ç½®ï¼Œè¿™é‡Œä¸ºäº†ç®€å•èµ·è§ä»…ä½¿ç”¨äº†é»˜è®¤çš„ Standalone æ¨¡å¼ã€‚ é…ç½® Giraph ä¸‹è½½ Giraph 1.2.0ï¼Œç„¶åè¿›è¡Œè§£å‹å³å¯ã€‚ é…ç½®ç¯å¢ƒå˜é‡ ä¸ºäº†æ›´å¥½ä½¿ç”¨ Giraph ï¼Œéœ€è¦é…ç½®å¦‚ä¸‹ä¸‰ä¸ªç¯å¢ƒå˜é‡ 123456#Setting Hadoopexport HADOOP_HOME="/your_path/hadoop-2.5.1"export HADOOP_CONF_DIR="$HADOOP_HOME/etc/hadoop"#Setting Giraphexport GIRAPH_HOME="/your_path/giraph-1.2.0-hadoop2-for-hadoop-2.5.1" éªŒè¯ç¯å¢ƒ åœ¨ Giraph åŒçº§ç›®å½•ä¸‹åˆ›å»º input æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ input æ–‡ä»¶å¤¹å†…åˆ›å»º tiny_graph.txt æ–‡ä»¶ 1234567891011mkdir inputcd input touch tiny_graph.txtvim tiny_graph.txt#åœ¨æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹æ•°æ®ï¼Œå…¶æ ¼å¼ä¸º [source_id,source_value,[[dest_id, edge_value],...]]ï¼Œå¦‚ [0,0,[[1,1],[3,3]]] è¡¨ç¤ºé¡¶ç‚¹åºå·ä¸º 0ï¼Œé¡¶ç‚¹å€¼ä¸º 0ï¼Œå­˜åœ¨åºå· 0 åˆ° åºå· 1 çš„è¾¹ï¼Œå€¼ä¸º 1ï¼Œå­˜åœ¨åºå· 0 åˆ°åºå· 3 çš„è¾¹ï¼Œå€¼ä¸º 3ã€‚[0,0,[[1,1],[3,3]]][1,0,[[0,1],[2,2],[3,1]]][2,0,[[1,2],[4,4]]][3,0,[[0,3],[1,1],[4,4]]][4,0,[[3,4],[2,4]]] åœ¨ Giraph çš„åŒçº§ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ 1$GIRAPH_HOME/bin/giraph $GIRAPH_HOME/giraph-examples-1.2.0-hadoop2.jar org.apache.giraph.examples.SimpleShortestPathsComputation -vif org.apache.giraph.io.formats.JsonLongDoubleFloatDoubleVertexInputFormat -vip ./input/tiny_graph.txt -vof org.apache.giraph.io.formats.IdWithValueTextOutputFormat -op ./output/shortestpaths -w 1 -ca giraph.SplitMasterWorker=false è¿™è¡Œå‘½ä»¤å®è´¨æ˜¯å‘ Hadoop æäº¤ä¸€ä¸ª Jobï¼Œgiraph-examples-1.2.0-hadoop2.jar æ˜¯æäº¤çš„ jar æ–‡ä»¶ï¼ŒSimpleShortestPathsComputation è¡¨ç¤º Giraph å°†ä¼šè¿è¡Œçš„è®¡ç®—ç±»ã€‚å…¶ä½™çš„å„é¡¹å‚æ•°å«ä¹‰ä¸ºï¼š -vif ç”¨äºæŒ‡å®šè¾“å…¥æ•°æ®çš„æ ¼å¼ -vip ç”¨äºæŒ‡å®šè¾“å…¥æ•°æ®çš„è·¯å¾„ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡ŒæŒ‡å®šäº†å‰ä¸€æ­¥ä¸­åˆ›å»ºçš„ tiny_graph.txt æ–‡ä»¶ -vof ç”¨äºæŒ‡å®šè¾“å‡ºæ ¼å¼ -op ç”¨äºæŒ‡å®šè¾“å‡ºè·¯å¾„ï¼Œè¿™é‡ŒæŒ‡å®šçš„è·¯å¾„æ˜¯ input åŒçº§ç›®å½•ä¸‹çš„ output æ–‡ä»¶å¤¹ä¸‹çš„ shortestpaths æ–‡ä»¶å¤¹ -w ç”¨äºæŒ‡å®š worker çš„æ•°é‡ï¼Œè¿™é‡Œç”±äºåœ¨æœ¬åœ°è¿è¡Œåªèƒ½æŒ‡å®šä¸º 1 ä¸ª -ca è¡¨æ˜æŒ‡å®šå‚æ•°ä¸ºè‡ªå®šä¹‰çš„å‚æ•°ï¼Œè¿™é‡ŒæŒ‡å®š giraph.SplitMasterWorker ä¸º falseï¼Œè¡¨æ˜ä¸åŒºåˆ† Master å’Œ Workerï¼ˆæœ¬åœ°è¿è¡Œå¿…é¡»æŒ‡å®šï¼‰ã€‚æ›´å¤šçš„è‡ªå®šä¹‰å‚æ•°è¯·å‚è€ƒ ğŸ”— æŸ¥çœ‹ç»“æœ è¿è¡Œç»“æŸä¹‹åè¿›å…¥ output/shortestpaths å°†ä¼šçœ‹åˆ°è¾“å‡ºæ–‡ä»¶ part-m-00000ï¼Œå…¶å†…å®¹ä¸ºï¼š 123450 1.01 0.02 2.03 1.04 5.0 è¿™é‡Œçš„éªŒè¯æ˜¯é’ˆå¯¹ Standalone æ¨¡å¼è€Œè¨€ï¼Œå¦‚æœéœ€è¦åœ¨ Pseudo-Distributed å’Œ Full-Distributed æ¨¡å¼ä¸‹è¿›è¡ŒéªŒè¯ï¼Œåªéœ€è¦æŠŠç›¸åº”çš„è¾“å…¥æ–‡ä»¶ä¸Šä¼ åˆ° HDFSï¼Œç„¶åæ›´æ”¹æ‰§è¡Œå‘½ä»¤ä¸­çš„è¾“å…¥è·¯å¾„å’Œè¾“å‡ºè·¯å¾„å³å¯ã€‚ Thanks Quick Start]]></content>
      <categories>
        <category>Giraph åŸºç¡€</category>
      </categories>
      <tags>
        <tag>å›¾è®¡ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Giraph ç®€ä»‹]]></title>
    <url>%2F2019%2F08%2F11%2FGiraph%E7%AE%80%E4%BB%8B%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡ä¸»è¦é˜è¿°äº† Giraph ç”±æ¥åŠå…¶ä½œç”¨ï¼Œå¹¶æ ¹æ® Giraph çš„ç³»ç»Ÿæ¶æ„å’Œè®¡ç®—æ¨¡å‹ç®€è¦ä»‹ç»äº† Giraph çš„è¿è¡Œæµç¨‹ã€‚ ä»€ä¹ˆæ˜¯ Giraph Giraph æ˜¯ Google äº 2010 å¹´å‘å¸ƒçš„è®ºæ–‡ Pregel: a system for large-scale graph processing çš„å¼€æºå®ç°ã€‚Giraph æ˜¯ä»¥ Hadoop ä¸ºåŸºç¡€å¼€å‘çš„ä¸Šå±‚åº”ç”¨ï¼Œå…¶ç³»ç»Ÿæ¶æ„å’Œè®¡ç®—æ¨¡å‹ä¸ Pregel ä¿æŒäº†ä¸€è‡´ã€‚åŒæ—¶ä¹Ÿåœ¨ Pregel æ¨¡å‹ä¸Šå¢åŠ äº†ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œå¦‚ï¼šout-of-core computationã€edge-oriented input ç­‰ã€‚Giraph çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡å›¾çš„åˆ†å¸ƒå¼è®¡ç®—é—®é¢˜ã€‚é€šè¿‡éšè—åˆ†å¸ƒå¼å’Œå¹¶è¡Œè®¡ç®—çš„ç»†èŠ‚ä»¥åŠæä¾›ä¸€å¥—ç”¨äºæè¿°å›¾ç®—æ³•çš„ APIï¼ŒGiraph ä¸ä»…æ‹¥æœ‰äº†å¾ˆå¥½çš„å¯æ‰©å±•æ€§ï¼Œè¿˜é™ä½äº†åˆ†å¸ƒå¼å›¾è®¡ç®—çš„ä½¿ç”¨é—¨æ§›ã€‚ ç³»ç»Ÿæ¶æ„ ä¸Šå›¾è“è‰²éƒ¨åˆ†æ ‡è¯†äº† Giraph çš„ç³»ç»Ÿæ¶æ„ï¼Œå¯ä»¥çœ‹åˆ° Giraph å®è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ª Master/Slave çš„æ¶æ„ï¼Œä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆï¼š Master Master å®è´¨ä¸Šè¿è¡Œåœ¨ Hadoop çš„ MapTask ä¸Šï¼Œ å…¶ä¸»è¦ä½œç”¨æ˜¯å¯¹è¾“å…¥å›¾è¿›è¡Œåˆ†åŒºã€åè°ƒ Worker çš„æ´»åŠ¨ã€ç»´æŠ¤ä¸€ä»½å­˜æ´»çš„ Worker åˆ—è¡¨ï¼ˆåŒ…æ‹¬ Worker çš„æ ‡è¯†ç¬¦ã€åœ°å€ä¿¡æ¯ç­‰ï¼‰ä»¥åŠæ›´æ–° Job çš„çŠ¶æ€ã€‚ Worker ä¸ Master ä¸€æ ·ï¼ŒWorker ä¹Ÿè¿è¡Œåœ¨ Hadoop çš„ MapTask ä¸Šï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ç»´æŠ¤å·²åˆ†é…å›¾çš„çŠ¶æ€ã€‚ Zookeeper åœ¨ Giraph ä¸­ Zookeeper çš„ä¸»è¦ä½œç”¨æ˜¯ Master é€‰ä¸¾ã€å‘½åæœåŠ¡ä»¥åŠåè°ƒæœåŠ¡ã€‚å›¾ä¸­æ˜¾ç¤ºçš„ Zookeeper æ˜¯å¤–ç½®çŠ¶æ€ï¼Œä½†å®é™…ä¸Šå¦‚æœä¸ç»™ Giraph æä¾›å¤–ç½® Zookeeperï¼Œé‚£ä¹ˆ Giraph å°†ä¼šåœ¨ Master æ‰€åœ¨èŠ‚ç‚¹ä¸Šè‡ªè¡Œå¯åŠ¨ä¸€ä¸ª Zookeeper æ¥æä¾›æœåŠ¡ã€‚ è®¡ç®—æ¨¡å‹ ä¸Šå›¾æ˜¾ç¤ºäº† Giraph çš„æ•´ä¸ªè®¡ç®—æ¨¡å‹ï¼Œä¸»è¦ç”±è¾“å…¥ã€ä¸€ç³»åˆ— Superstep è¿­ä»£è®¡ç®—ã€è¾“å‡ºæ„æˆï¼Œå…¶ä¸­è¿™äº› Superstep è¢«ç§°ä¹‹ä¸º BSP(Bulk Synchronous Parallelism) æ¨¡å‹ã€‚ BSP æ¨¡å‹ BSP æ¨¡å‹æ˜¯ä¸€ä¸ªå—åŒæ­¥å¹¶è¡Œæ¨¡å‹ï¼Œå…¶ç”±è®¸å¤šä¸ª Superstep ç»„æˆã€‚å¯¹äº BSP æ¨¡å‹è€Œè¨€ï¼Œå…¶åœ¨ Superstep å†…çš„æ“ä½œæ˜¯å¹¶è¡Œçš„ï¼Œä½†åœ¨ä¸¤ä¸ª Superstep ä¹‹é—´åˆ™æ˜¯ç”±ä¸€ä¸ªåŒæ­¥æ“ä½œè¿›è¡Œéš”ç¦»çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ Superstep(N + 1) ä¼šç­‰å¾… Superstep(N) æ‰§è¡Œå®Œæˆä¹‹åæ‰ä¼šå¼€å§‹ã€‚ ä¸Šå›¾æ˜¾ç¤ºäº† Superstep çš„ç»“æ„å›¾ï¼Œä¸€ä¸ª Superstep ç”±å±€éƒ¨è®¡ç®—ã€é€šè®¯ã€æ …æ åŒæ­¥ ä¸‰ä¸ªéƒ¨åˆ†æ„æˆã€‚å¯ä»¥çœ‹åˆ°å³ä½¿æœ‰éƒ¨åˆ†çš„è®¡ç®—æ¯”è¾ƒå¿«ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯ä¼šåœ¨æ …æ åŒæ­¥è¿™é‡Œåœä¸‹ç­‰å¾…å…¶ä½™çš„è®¡ç®—å®Œæˆã€‚åœ¨å›¾è®¡ç®—ä¸­åº”ç”¨è¿™ç§æ¨¡å‹çš„å¥½å¤„æ˜¯ï¼šå¯ä»¥è§£å†³å›¾è®¡ç®—çš„åŒæ­¥é—®é¢˜ï¼ŒåŒæ­¥æ¨¡å‹æœ‰åˆ©äºæ¨æ–­ç¨‹åºè¯­ä¹‰ï¼ˆå³åˆ©äºç¼–ç¨‹ï¼‰ï¼Œå¹¶ä¸”æ¶ˆé™¤äº†æ­»é”å’Œæ•°æ®ç«äº‰çš„é—®é¢˜ã€‚ è®¡ç®—è¿‡ç¨‹ ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªè®¡ç®—å›¾ä¸­é¡¶ç‚¹æœ€å¤§å€¼çš„è¿‡ç¨‹ï¼Œå…¶ä¸­æ·±è‰²çš„é¡¶ç‚¹è¡¨ç¤ºæœ¬æ¬¡ Superstep ç»“æŸä¹‹åå°†è‡ªå·±æ ‡è®°ä¸ºä¸æ´»è·ƒçŠ¶æ€ï¼ˆå³ä¸å†éœ€è¦è¿›è¡Œè®¡ç®—ï¼‰ï¼Œå½“æ‰€æœ‰é¡¶ç‚¹å‡å¤„äºä¸æ´»è·ƒçŠ¶æ€çš„æ—¶å€™å³è¡¨æ˜è®¡ç®—ç»“æŸã€‚ä¸‹é¢é’ˆå¯¹å„ä¸ª Superstep è¿›è¡Œåˆ†æï¼š Superstep0 Superstep0 æ—¶æ‰€æœ‰çš„é¡¶ç‚¹å¤„äºæ´»è·ƒçŠ¶æ€å¹¶æ²¿å‡ºè¾¹å‘é€å…¶é¡¶ç‚¹å€¼ Superstep1 Superstep1 æ—¶æ¯ä¸ªé¡¶ç‚¹å¤„ç† Superstep0 å‘æ¥çš„é¡¶ç‚¹å€¼ï¼Œç¬¬ä¸€ã€å››ä¸ªé¡¶ç‚¹[ä»å·¦å¾€å³è®¡æ•°]å‘ç°æœ‰æ›´å¤§çš„é¡¶ç‚¹å€¼ 6ï¼Œæ‰€ä»¥æ›´æ–°å…¶é¡¶ç‚¹å€¼ä¸º 6 ï¼Œå¹¶æ²¿å‡ºè¾¹å‘é€æ›´æ–°ä¹‹åçš„é¡¶ç‚¹å€¼ã€‚è€Œç¬¬äºŒã€ä¸‰ä¸ªé¡¶ç‚¹å‘ç°å¹¶æ²¡æœ‰æ¯”å®ƒä»¬é¡¶ç‚¹å€¼æ›´å¤§çš„é¡¶ç‚¹å€¼ï¼Œå› æ­¤ä¸¤ä¸ªé¡¶ç‚¹å°†è‡ªèº«æ ‡è®°ä¸ºä¸æ´»è·ƒçŠ¶æ€ã€‚ Superstep2 Superstep2 æ—¶ç”±äºç¬¬äºŒä¸ªé¡¶ç‚¹æ”¶åˆ°äº† Superstep1 å‘é€è¿‡æ¥çš„é¡¶ç‚¹å€¼ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šå°†ç¬¬äºŒä¸ªé¡¶ç‚¹æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€ç„¶åå»å¤„ç†æ¥æ”¶åˆ°çš„é¡¶ç‚¹å€¼ï¼Œä½†ç¬¬äºŒä¸ªé¡¶ç‚¹ä¾æ—§å‘ç°æ²¡æœ‰æ¯”å®ƒæ›´å¤§çš„é¡¶ç‚¹å€¼ï¼Œæ‰€ä»¥ä¼šå†æ¬¡æ ‡è®°è‡ªå·±ä¸ºä¸æ´»è·ƒçŠ¶æ€ã€‚ç¬¬ä¸€ã€å››ä¸ªé¡¶ç‚¹ç”±äºæ²¡æœ‰æ¥æ”¶åˆ° Superstep1 å‘æ¥çš„é¡¶ç‚¹å€¼ï¼Œæ‰€ä»¥ä¼šå°†å…¶æ ‡è®°ä¸ºä¸æ´»è·ƒçŠ¶æ€ã€‚ç¬¬ä¸‰ä¸ªé¡¶ç‚¹åœ¨å¤„ç† Superstep1 å‘æ¥çš„é¡¶ç‚¹å€¼æ—¶ï¼Œå‘ç°äº†æ¯”å®ƒæ›´å¤§çš„é¡¶ç‚¹å€¼ 6ï¼Œæ‰€ä»¥ä¼šè¿›è¡Œæ›´æ–°ç„¶åæ²¿å‡ºè¾¹å‘é€æ›´æ–°ä¹‹åçš„é¡¶ç‚¹å€¼ã€‚ Superstep3 Superstep3 é˜¶æ®µåªæœ‰ç¬¬äºŒã€å››é¡¶ç‚¹æ¥æ”¶åˆ°äº† Superstep2 å‘æ¥çš„é¡¶ç‚¹å€¼ï¼Œæ‰€ä»¥è·Ÿ Superstep2 ä¸­å¤„ç†æ–¹å¼ä¸€è‡´ï¼Œç³»ç»Ÿå…ˆæ ‡è®°ä¸ºè¿™ä¸¤ä¸ªé¡¶ç‚¹ä¸ºæ´»è·ƒçŠ¶æ€ï¼Œé¡¶ç‚¹æ¯”è¾ƒæ¥æ”¶çš„é¡¶ç‚¹å€¼ä¹‹åå°†è‡ªèº«æ ‡è®°ä¸ºä¸æ´»è·ƒçŠ¶æ€ã€‚è‡³äºç¬¬ä¸€ã€å››é¡¶ç‚¹å› ä¸ºå¤„äºä¸æ´»è·ƒçŠ¶æ€ä¸”æ²¡æœ‰æ”¶åˆ°ä¸Šä¸€ä¸ªè¶…æ­¥æ¥æ”¶åˆ°çš„é¡¶ç‚¹å€¼ï¼Œæ‰€ä»¥ä¸ä¼šè¿›è¡Œå¤„ç†ä»è€Œä¾æ—§ä¿æŒä¸æ´»è·ƒçŠ¶æ€ã€‚è‡³æ­¤æ•´ä¸ªè®¡ç®—è¿‡ç¨‹å°±ç»“æŸäº†ã€‚ è¿è¡Œæµç¨‹ åœ¨äº†è§£äº† Giraph çš„ç³»ç»Ÿæ¶æ„å’Œè®¡ç®—æ¨¡å‹ä¹‹åï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ Giraph çš„æ•´ä¸ªè¿è¡Œæµç¨‹ï¼š Giraph å‘ Hadoop æäº¤ Job ä¹‹åï¼ŒZookeeper å°†ä¼šé€‰å‡ºä¸€ä¸ª MapTask ä½œä¸º Giraph çš„ Masterï¼Œå…¶ä½™çš„ MapTask åˆ™ä½œä¸º Workerã€‚ç„¶åè¿™äº› Worker ä¼šé€šè¿‡ Zookeeper å‘½åæœåŠ¡æ‰¾åˆ° Masterï¼Œå¹¶å‘ Master è¿›è¡Œæ³¨å†Œã€‚ Master å°†ä¼šå¯¹è¾“å…¥å›¾è¿›è¡Œåˆ†åŒºï¼Œå¹¶å‘é€åˆ†åŒºä¿¡æ¯ç»™ Workerï¼ŒWoker ä¼šå¯¹åˆ†åŒºè¿›è¡Œè¯»å–ï¼ŒæœŸé—´å¯èƒ½ä¼šå‘ç”Ÿ Worker ä¹‹é—´çš„åˆ†åŒºäº¤æ¢ã€‚ ä¹‹å Master ä¼šå¼€å§‹åè°ƒ Worker è¿­ä»£æ‰§è¡Œ Superstepï¼ŒWorker å°†ä¼šåœ¨ Superstep ä¸­å®Œæˆé¡¶ç‚¹çš„è®¡ç®—è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰çš„é¡¶ç‚¹å¤„äºä¸æ´»è·ƒçŠ¶æ€ä¹‹åç»“æŸè®¡ç®—ã€‚ åœ¨è®¡ç®—ç»“æŸä¹‹åï¼ŒGiraph å°†ä¼šæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„æ ¼å¼è¾“å‡ºç»“æœã€‚ æ€»ç»“ ä¸Šè¿°ç®€è¦ä»‹ç»äº† Giraph çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œå³æ¶æ„å’Œè®¡ç®—æ¨¡å‹ã€‚ä½†é™¤æ­¤ä¹‹å¤–ï¼ŒGiraph ä¸­è¿˜æœ‰é‡è¦çš„ä¼˜åŒ–å’Œå®¹é”™æœºåˆ¶å°šæœªä»‹ç»ï¼Œè¿™äº›éƒ½éœ€è¦åç»­å­¦ä¹ çš„æ—¶å€™è¿›è¡Œæ•´ç†åˆ†æã€‚ Thanks Pregel: a system for large-scale graph processing Pregelï¼ˆå›¾è®¡ç®—ï¼‰æŠ€æœ¯åŸç† BSPæ¨¡å‹çš„ç›¸å…³è®²è§£ ä»BSPæ¨¡å‹åˆ°Apache Hama Introduction to Apache Giraph]]></content>
      <categories>
        <category>Giraph åŸºç¡€</category>
      </categories>
      <tags>
        <tag>å›¾è®¡ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoop åŸºç¡€ä¹‹ HDFS å…¥é—¨]]></title>
    <url>%2F2019%2F05%2F11%2FHadoop%E5%9F%BA%E7%A1%80%E4%B9%8BHDFS%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡ä¸»è¦ä»‹ç»äº† HDFS çš„ä½“ç³»æ¶æ„ä»¥åŠå…¶æ‰§è¡Œæµç¨‹ï¼Œå¹¶ç»™å‡ºäº†è¯»å†™æ“ä½œçš„ç¼–ç¨‹å®ä¾‹ï¼Œå¸Œæœ›å¯¹ HDFS æœ‰ä¸ªåˆæ­¥çš„è®¤è¯†ã€‚ ç®€ä»‹ HDFS (Hadoop Distributed File System) æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å•†ä¸š PC ä¸Šçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶è®¾è®¡æ€æƒ³æºè‡ªäº Google 2003 å¹´å‘å¸ƒçš„è®ºæ–‡ The Google File System ã€‚HDFSçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡æ•°æ®å­˜å‚¨å’Œç®¡ç†çš„é—®é¢˜ã€‚ ä½“ç³»æ¶æ„ ä¸Šå›¾è¡¨æ˜ HDFS æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ master/slave æ¶æ„ï¼Œä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆï¼š NameNodeï¼ˆmaster èŠ‚ç‚¹ï¼‰ å…ƒæ•°æ®ï¼ˆMetaDataï¼‰çš„ç®¡ç†ï¼Œå…¶ä¸­å…ƒæ•°æ®ç”±æ–‡ä»¶è·¯å¾„åã€æ•°æ®å—IDä»¥åŠå­˜å‚¨ä½ç½®ç­‰ä¿¡æ¯æ„æˆ ç®¡ç† HDFS çš„åå­—ç©ºé—´ã€‚ SecondaryNameNode å®šæœŸåˆå¹¶ NameNode çš„ edit logsï¼ˆå¯¹æ–‡ä»¶ç³»ç»Ÿçš„æ”¹åŠ¨åºåˆ—ï¼‰ åˆ° fsimageï¼ˆå¯¹æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å¿«ç…§ï¼‰ï¼Œå¹¶æ‹·è´ä¿®æ”¹åçš„ fsimage åˆ° NameNodeã€‚ æä¾›ä¸€ä¸ª NameNode çš„æ£€æŸ¥ç‚¹ï¼ˆåˆ‡å¿Œè®¤ä¸ºæ˜¯ NameNode çš„å¤‡ä»½ï¼‰ï¼Œå¯ç”¨äº NameNode çš„æ•…éšœæ¢å¤ã€‚ DataNodeï¼ˆslave èŠ‚ç‚¹ï¼‰ æä¾›æ–‡ä»¶å­˜å‚¨å’Œè¿›è¡Œæ•°æ®å—æ“ä½œã€‚ å‘¨æœŸæ€§çš„å‘ NameNode æ±‡æŠ¥å—ä¿¡æ¯ã€‚ è¿™é‡Œå¯¹å›¾ä¸­å‡ºç°çš„ä¸€äº›æ¦‚å¿µè¿›è¡Œè¯´æ˜ï¼š Replicationï¼ˆå‰¯æœ¬ï¼‰ ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯ç”¨ï¼ŒHDFS ä¼šå¯¹å†™å…¥çš„æ•°æ®è¿›è¡Œå†—ä½™å­˜å‚¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šä¿å­˜ 3 ä»½ã€‚ Blocks Block æ˜¯æœ€åŸºæœ¬çš„å­˜å‚¨å’Œæ“ä½œå•ä½ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸º 128Mï¼‰ï¼Œè¿™é‡Œçš„ Block ä¸æ˜¯æŒ‡ç‰©ç† Block ï¼Œè€Œæ˜¯æŒ‡æ–‡ä»¶ç³»ç»Ÿçš„ Blockï¼Œå…¶å¤§å°ä¸€èˆ¬æ˜¯ç‰©ç† Block çš„æ•´æ•°å€ã€‚ æ‰§è¡Œæµç¨‹ è¯»æ–‡ä»¶ è¯»æ–‡ä»¶çš„è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š Client å‘ NameNode å‘èµ·è¯·æ±‚è·å–æ–‡ä»¶æ•°æ®å—ä½ç½®ä¿¡æ¯ Client æŒ‰ç…§æ•°æ®å—è· Client çš„è¿œè¿‘ä¾æ¬¡è¿›è¡Œè¿æ¥ç„¶åè¯»å–æ•°æ® å†™æ–‡ä»¶ å†™æ–‡ä»¶çš„è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š Client å‘ NameNode å‘èµ·å†™æ–‡ä»¶çš„è¯·æ±‚è·å¾—å¯å†™çš„ DataNode åˆ—è¡¨ç­‰ä¿¡æ¯ Client æ ¹æ® HDFS è®¾å®šçš„åˆ†å—å¤§å°å¯¹æ–‡ä»¶è¿›è¡Œåˆ†å— Client å’Œ NameNode åˆ†é…çš„ DataNode æ„æˆ pipeline å¹¶è¿›è¡Œæ•°æ®å†™å…¥ å†™å…¥å®Œæˆä¹‹åï¼ŒNameNode æ¥æ”¶æ¥è‡ª DataNode çš„æ¶ˆæ¯è¿›è¡Œå…ƒæ•°æ®çš„æ›´æ–° å¸¸ç”¨å‘½ä»¤ æ–‡ä»¶æ“ä½œ åˆ—å‡ºæ–‡ä»¶ 1hdfs dfs -ls &lt;path&gt; åˆ›å»ºç›®å½• 1hdfs dfs -mkdir &lt;path&gt; ä¸Šä¼ æ–‡ä»¶ 1hdfs dfs -put &lt;localsrc&gt; &lt;dst&gt; è¾“å‡ºæ–‡ä»¶å†…å®¹ 1hdfs dfs -cat &lt;src&gt; æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ° 1hdfs dfs -get &lt;src&gt; &lt;localdst&gt; åˆ é™¤æ–‡ä»¶å’Œç›®å½• 12hdfs dfs -rm &lt;src&gt;hdfs dfs -rmdir &lt;dir&gt; ç®¡ç† æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯ 1hdfs dfsadmin -report è¿›å…¥å’Œé€€å‡ºå®‰å…¨æ¨¡å¼ï¼ˆè¯¥æ¨¡å¼ä¸å…è®¸æ–‡ä»¶ç³»ç»Ÿæœ‰ä»»ä½•ä¿®æ”¹ï¼‰ 12hdfs dfsadmin -safemode enterhdfs dfsadmin -safemode leave ç¼–ç¨‹å®ä¾‹ IDEA æ–°å»º Maven é¡¹ç›® å‹¾é€‰ç›¸å…³é€‰é¡¹åï¼Œç‚¹å‡» next å¡«å…¥é¡¹ç›®ç›¸å…³ä¿¡æ¯å³å¯ pom.xml ä¸­æ·»åŠ ä¾èµ– 12345678910111213141516171819&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-common&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; //æ ¹æ® Hadoop ç‰ˆæœ¬è¿›è¡Œé€‰æ‹© &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-hdfs&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; è¯»å†™æ–‡ä»¶ åˆ›å»º Sample ç±»ç¼–å†™ç›¸åº”çš„è¯»å†™å‡½æ•° Sample ç±» 123456789101112131415161718192021222324252627282930313233343536373839import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FSDataInputStream;import org.apache.hadoop.fs.FSDataOutputStream;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import java.io.*;/** * @author ikroal */public class Sample &#123; //é»˜è®¤çš„ HDFS åœ°å€ private static final String DEFAULT_FS = "hdfs://localhost:9000"; private static final String PATH = DEFAULT_FS + "/tmp/demo.txt"; private static final String DEFAULT_FILE = "demo.txt"; public static void main(String[] args) &#123; Configuration conf = new Configuration(); FileSystem fs = null; conf.set("fs.defaultFS", DEFAULT_FS); //é…ç½® HDFS åœ°å€ try &#123; fs = FileSystem.get(conf); write(fs, DEFAULT_FILE, PATH); read(fs, PATH); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if (fs != null) &#123; fs.close(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; write å‡½æ•° 123456789101112131415161718192021222324252627282930/*** è¿›è¡Œæ–‡ä»¶å†™å…¥* @param inputPath å¾…å†™å…¥æ–‡ä»¶è·¯å¾„* @param outPath HDFS çš„å†™å…¥è·¯å¾„*/public static void write(FileSystem fileSystem, String inputPath, String outPath) &#123; FSDataOutputStream outputStream = null; FileInputStream inputStream = null; try &#123; outputStream = fileSystem.create(new Path(outPath)); //è·å¾— HDFS çš„å†™å…¥æµ inputStream = new FileInputStream(inputPath); //è¯»å–æœ¬åœ°æ–‡ä»¶ int data; while ((data = inputStream.read()) != -1) &#123; //å†™å…¥æ“ä½œ outputStream.write(data); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if (outputStream != null) &#123; outputStream.close(); &#125; if (inputStream != null) &#123; inputStream.close(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; read å‡½æ•° 1234567891011121314151617181920212223242526272829/*** è¿›è¡Œæ–‡ä»¶è¯»å–* @param path HDFS ä¸Šå¾…è¯»å–æ–‡ä»¶è·¯å¾„*/public static void read(FileSystem fileSystem, String path) &#123; FSDataInputStream inputStream = null; BufferedReader reader = null; try &#123; inputStream = fileSystem.open(new Path(path)); //è·å– HDFS è¯»å–æµ reader = new BufferedReader(new InputStreamReader(inputStream)); String content; while ((content = reader.readLine()) != null) &#123; //è¯»å–å¹¶è¾“å‡ºåˆ°æ§åˆ¶å° System.out.println(content); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if (inputStream != null) &#123; inputStream.close(); &#125; if (reader != null) &#123; reader.close(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; åœ¨å·¥ç¨‹æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºè®¡åˆ’ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆè¿™é‡Œæ˜¯ demo.txtï¼‰ï¼Œå¡«å…¥ Hello Worldï¼ å¯åŠ¨ Hadoop ç„¶åè¿è¡Œç¨‹åºæŸ¥çœ‹ç»“æœ é€šè¿‡ http://localhost:50070/explorer.html#/ å¯ä»¥æŸ¥çœ‹å†™å…¥ç»“æœ æ§åˆ¶å°åˆ™ä¼šè¾“å‡ºä¸Šä¼ æ–‡ä»¶çš„å†…å®¹ Thanks åˆæ­¥æŒæ¡HDFSçš„æ¶æ„åŠåŸç† æ·±å…¥ç†è§£HDFSï¼šHadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ HDFSè¯»å†™æµç¨‹ï¼ˆå²ä¸Šæœ€ç²¾ç‚¼è¯¦ç»†ï¼‰ Hadoopå­¦ä¹ ä¹‹è·¯ï¼ˆåä¸€ï¼‰HDFSçš„è¯»å†™è¯¦è§£]]></content>
      <categories>
        <category>Hadoop åŸºç¡€</category>
      </categories>
      <tags>
        <tag>BigData</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoop åŸºç¡€ä¹‹æ­å»ºç¯å¢ƒ]]></title>
    <url>%2F2019%2F05%2F04%2FHadoop%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Hadoop çš„ä¸‰ç§è¿è¡Œæ¨¡å¼ä»¥åŠé…ç½®çš„æ–¹å¼ã€‚ è¿è¡Œæ¨¡å¼ Hadoop çš„è¿è¡Œæ¨¡å¼åˆ†ä¸ºä¸‰ç§ï¼š Standaloneï¼ˆæœ¬åœ°æ¨¡å¼/å•æœºæ¨¡å¼/localæ¨¡å¼ï¼‰ è¯¥æ¨¡å¼ä¸‹æ²¡æœ‰ä»»ä½•å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨æˆ·ç¨‹åºå’Œ Hadoop ç¨‹åºè¿è¡Œåœ¨åŒä¸€ä¸ª Java è¿›ç¨‹ï¼Œä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè€Œä¸æ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ­¤æ¨¡å¼ä¸‹ä¸€èˆ¬ç”¨äºæœ¬åœ°è°ƒè¯•ã€‚ Pseudo-Distributedï¼ˆä¼ªé›†ç¾¤æ¨¡å¼ï¼‰ åœ¨å•æœºä¸Šæ¨¡æ‹Ÿé›†ç¾¤æ¨¡å¼ï¼Œå„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨å•ç‹¬çš„ Java è¿›ç¨‹å½“ä¸­ï¼Œä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ HDFS Fully-Distributedï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰ å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨é›†ç¾¤ä¸Šï¼Œä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿæ˜¯ HDFS é…ç½®è¿‡ç¨‹ æœ¬æ¬¡é…ç½®åŸºäº Hadoop2.9.2ï¼Œå…¶ä¸­ Standalone åœ¨ CentOS 7.2 ç³»ç»Ÿä¸‹è¿›è¡Œé…ç½®ï¼Œ Pseudo-Distributed æ¨¡å¼åœ¨ MacOS 10.14.4 ä¸Šè¿›è¡Œé…ç½®ï¼ŒFully-Distributed æ¨¡å¼åœ¨è…¾è®¯äº‘ä¸»æœºä¸Šè¿›è¡Œé…ç½®ï¼Œé›†ç¾¤ç”±ä¸¤å°äº‘ä¸»æœºç»„æˆï¼Œåˆ†åˆ«è¿è¡Œ Ubuntu 14.04.1 å’Œ CentOS 7.2 ç³»ç»Ÿã€‚ ç¯å¢ƒå‡†å¤‡ Java 7/8 Hadoop 2.7.x to 2.x æ”¯æŒ Java 7/8ï¼Œå…¶å®ƒ Hadoop ç‰ˆæœ¬æ”¯æŒçš„ Java ç‰ˆæœ¬è¯·ç‚¹å‡» ğŸ”— è¿›è¡ŒæŸ¥è¯¢ ä¸‹è½½ï¼š 1sudo yum install java-1.8.0-openjdk-devel //centos å®‰è£… Java8ï¼Œubuntu ä¸‹éœ€è¦ç”¨ apt-get è¿›è¡Œå®‰è£… é…ç½®ç¯å¢ƒå˜é‡ï¼š 1234cd ~vi .bash_profileexport JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.i386source .bash_profile ssh å’Œ rsync: ç”¨ ssh å’Œ rsync å‘½ä»¤æµ‹è¯•åå‘ç° Centos æœ¬èº«å°±æœ‰ï¼Œæ‰€ä»¥æ— é¡»è¿›è¡Œå®‰è£…ã€‚ Hadoop 12sudo wget http://mirror.bit.edu.cn/apache/hadoop/common/hadoop-2.9.2/hadoop-2.9.2.tar.gztar -zxvf hadoop-2.9.2.tar.gz è¿™é‡Œçš„ä¸‹è½½åœ°å€æœ€å¥½æ ¹æ®äº‘ä¸»æœºæ‰€åœ¨çš„åŒºåŸŸè¿›è¡Œé€‰æ‹©ï¼Œå¦‚æœæ˜¯å›½å†…çš„äº‘ä¸»æœºæœ€å¥½ä½¿ç”¨å›½å†…çš„é•œåƒåœ°å€ï¼Œè¿™æ ·ä¸‹è½½ä¼šå¿«å¾ˆå¤šã€‚ Standalone æ¨¡å¼ ä¸‹è½½è§£å‹ä¹‹åçš„ Hadoop é»˜è®¤å°±æ˜¯ Standalone æ¨¡å¼ï¼Œå¯ç›´æ¥è¿è¡Œ wordcount è¿›è¡Œæµ‹è¯• 12345mkdir input //hadoop çš„åŒçº§ç›®å½•åˆ›å»ºcp hadoop-2.9.2/LICENSE.txt input/hadoop-2.9.2/bin/hadoop jar hadoop-2.9.2/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.9.2.jar wordcount input output //è¿è¡Œ wordcountcat output/part-r-00000 //æŸ¥çœ‹ç»“æœ åŒæ—¶å†å¼€ä¸€ä¸ªç»ˆç«¯åœ¨ä½œä¸šè¿è¡Œçš„æ—¶å€™è¾“å…¥ jps æŸ¥çœ‹è¿›ç¨‹ å¯ä»¥çœ‹åˆ° Standalone æ¨¡å¼ä¸‹ Hadoop åªä¼šå¯åŠ¨ RunJar è¿›ç¨‹æ¥è¿è¡Œæ•´ä¸ªä½œä¸š Pseudo-Distributed æ¨¡å¼ ä¿®æ”¹ etc/hadoop/core-site.xml 1234567891011&lt;configuration&gt; &lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;!--é…ç½®è®¿é—® nameNode çš„ URI--&gt; &lt;value&gt;hdfs://localhost:9000&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;!--æŒ‡å®šä¸´æ—¶ç›®å½•ï¼ŒMapReduce å’Œ HDFS çš„è®¸å¤šè·¯å¾„é…ç½®ä¾èµ–æ­¤è·¯å¾„--&gt; &lt;value&gt;/home/hadoop/tmp&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; ä¿®æ”¹ etc/hadoop/hdfs-site.xml 1234567891011&lt;configuration&gt; &lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;!--é…ç½®æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡--&gt; &lt;value&gt;1&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.permissions&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;!--å…³é—­é˜²ç«å¢™--&gt; &lt;/property&gt;&lt;/configuration&gt; é…ç½®å…å¯†ç™»å½• 1234ssh localhost æµ‹è¯•èƒ½å¦å…å¯†ç™»å½•ï¼ˆå¦‚æœèƒ½å¤Ÿåˆ™è·³è¿‡ä»¥ä¸‹æ“ä½œï¼‰ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsacat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keyschmod 0600 ~/.ssh/authorized_keys ä¿®æ”¹ etc/hadoop/hadoop-env.shï¼ˆå¦‚æœæç¤ºæ‰¾ä¸åˆ° JAVA_HOMEï¼‰ 1export JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.i386 //ä¸Šé¢é…ç½®çš„ JAVA_HOME å¥½åƒæ²¡èµ·ä½œç”¨ æ ¼å¼åŒ– HDFS 1bin/hdfs namenode -format å¯åŠ¨ HDFS 1sbin/start-dfs.sh å¯åŠ¨åè¾“å…¥ jps çœ‹åˆ°ä»¥ä¸‹è¿›ç¨‹å³æˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡ http://localhost:50070/ è®¿é—® NameNode è¿è¡Œ wordcount 123456bin/hdfs dfs -mkdir /userbin/hdfs dfs -mkdir /user/&lt;username&gt;bin/hdfs dfs -mkdir /user/&lt;username&gt;/inputbin/hdfs dfs -put LICENSE.txt /user/&lt;username&gt;/input //åˆ›å»ºæ–‡ä»¶å¤¹å¹¶ä¸Šä¼ æ–‡ä»¶bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.9.2.jar wordcount input output //è¿è¡Œ wordcountbin/hdfs dfs -cat output/part-r-00000 //æ˜¾ç¤ºç»“æœ åœ¨å¦ä¸€ç»ˆç«¯è¾“å…¥ jps å¯ä»¥çœ‹åˆ°è¿è¡Œæ—¶çš„ä»¥ä¸‹è¿›ç¨‹ ä¾æ—§æ˜¯ç”¨ RunJar æäº¤ï¼Œåªæ˜¯è¯»å–å’Œå†™å…¥é‡‡ç”¨äº† HDFSã€‚ é€šè¿‡ YARN æ‰§è¡Œ Jobï¼ˆå¯é€‰é…ç½®ï¼Œä¸è¿‡ä¸ºäº†æ›´æ¥è¿‘çœŸå®é›†ç¾¤è¿˜æ˜¯å»ºè®®é…ç½®ï¼‰ ä¿®æ”¹ etc/hadoop/mapred-site.xml 12cp etc/hadoop/mapred-site.xml.template etc/hadoop/mapred-site.xmlvi etc/hadoop/mapred-site.xml å¢åŠ ä»¥ä¸‹å†…å®¹ 123456&lt;configuration&gt; &lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;!--è¡¨æ˜è¿è¡Œåœ¨ YARN ä¸Š--&gt; &lt;value&gt;yarn&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; ä¿®æ”¹ etc/hadoop/yarn-site.xml 1234567891011&lt;configuration&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;&lt;!--è®¾ç½®resourcemanagerçš„hostname--&gt; &lt;value&gt;localhost&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;!--æŒ‡å®š nodemanager è·å–æ•°æ®çš„æ–¹å¼--&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; å¯åŠ¨ YARN 1sbin/start-yarn.sh å¯åŠ¨æˆåŠŸåå¯ä»¥é€šè¿‡ http://localhost:8088/ è®¿é—® ResourceManager èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¾“å…¥ jps ä¼šæ˜¾ç¤ºä»¥ä¸‹è¿›ç¨‹ å…¶ä¸­ ResourceManager å’Œ NodeManager æ˜¯å±äº YARN çš„è¿›ç¨‹ã€‚ é‡å¤ 7 çš„æ“ä½œï¼Œè¾“å…¥ jps æŸ¥è¯¢è¿›ç¨‹ å¯ä»¥çœ‹åˆ°æ–°å¢åŠ äº† YarnChild è¿›ç¨‹å’Œ MRAppMaster è¿›ç¨‹ï¼Œä¹‹æ‰€ä»¥æœ‰ä¸¤ä¸ª YarnChild è¿›ç¨‹æ˜¯å› ä¸ºè¾“å…¥æ–‡ä»¶å¤¹ä¸­å­˜åœ¨ä¸¤ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œè¿™è¯´æ˜äº† MapReduce æ˜¯é€šè¿‡åˆ›å»ºå¤šä¸ªè¿›ç¨‹å¹¶è¡Œè®¡ç®—çš„ã€‚ Fully-Distributed æ¨¡å¼ é›†ç¾¤åŒ…æ‹¬ä¸¤ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ååˆ†åˆ«ä¸º master å’Œ slaveï¼Œmaster å’Œ slave çš„èŠ‚ç‚¹é…ç½®è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼Œä»¥ä¸‹æ˜¯é…ç½®è¿‡ç¨‹ï¼ˆä¸¤ä¸ªèŠ‚ç‚¹å·®å¼‚é…ç½®ä¼šè¿›è¡Œæ³¨æ˜ï¼Œå»ºè®®å…ˆé…ç½®å¥½ master èŠ‚ç‚¹çš„ Hadoopï¼Œç„¶åç”¨ scp å‘½ä»¤å¤åˆ¶åˆ° slave èŠ‚ç‚¹è¿›è¡Œä¿®æ”¹ã€‚ï¼‰ï¼š ä¿®æ”¹ /etc/hosts 12152.136.76.12 master //è…¾è®¯äº‘å…¬ç½‘ip94.191.43.137 slave å…å¯†ç™»å½•ï¼ˆâš ï¸ä¸¤ä¸ªèŠ‚ç‚¹çš„ç™»å½•åå¿…é¡»ä¸€è‡´ï¼Œè¿™é‡Œéƒ½ä¸º rootï¼‰ 123456789master èŠ‚ç‚¹é…ç½®æœ¬æœºå…å¯†ç™»å½•ä»¥åŠç§»åŠ¨å…¬é’¥åˆ°å­èŠ‚ç‚¹ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsacat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keyschmod 0600 ~/.ssh/authorized_keysscp ~/.ssh/id_rsa.pub root@slave:~/slave èŠ‚ç‚¹é…ç½® master èŠ‚ç‚¹å…å¯†ç™»å½•cat ~/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keyschmod 600 ~/.ssh/authorized_keys ä¿®æ”¹ etc/hadoop/core-site.xml 1234567891011&lt;configuration&gt; &lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;!--é…ç½®è®¿é—® nameNode çš„ URI--&gt; &lt;value&gt;hdfs://localhost:9000&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;!--æŒ‡å®šä¸´æ—¶ç›®å½•ï¼ŒMapReduce å’Œ HDFS çš„è®¸å¤šè·¯å¾„é…ç½®ä¾èµ–æ­¤è·¯å¾„--&gt; &lt;value&gt;/home/hadoop/tmp&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; ä¿®æ”¹ etc/hadoop/hdfs-site.xml 12345678910111213141516&lt;configuration&gt; &lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;!--é…ç½®æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡--&gt; &lt;value&gt;1&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.permissions&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;!--å…³é—­é˜²ç«å¢™--&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt; &lt;value&gt;slave:50090&lt;/value&gt; &lt;!-- æŒ‡å®šsecondarynamenodeä½ç½® --&gt; &lt;/property&gt;&lt;/configuration&gt; ä¿®æ”¹ etc/hadoop/mapred-site.xml 123456&lt;configuration&gt; &lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;!--è¡¨æ˜è¿è¡Œåœ¨ YARN ä¸Š--&gt; &lt;value&gt;yarn&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; ä¿®æ”¹ etc/hadoop/yarn-site.xml 1234567891011&lt;configuration&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;&lt;!--è®¾ç½®resourcemanagerçš„hostname--&gt; &lt;value&gt;master&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;!--æŒ‡å®š nodemanager è·å–æ•°æ®çš„æ–¹å¼--&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; ä¿®æ”¹ etc/hadoop/hadoop-env.sh 12export JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.i386 //master å’Œ slave å¡«å…¥å„è‡ªè·¯å¾„export HADOOP_LOG_DIR=/root/hadoop/hadoop-2.9.2/logs //å¯ä»¥è‡ªå·±é€‰å®š ä¿®æ”¹ etc/hadoop/mapred-env.sh 1export JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.i386 ä¿®æ”¹ etc/hadoop/yarn-env.sh 12export JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.i386 export YARN_LOG_DIR=/root/hadoop/hadoop-2.9.2/logs ä¿®æ”¹ etc/hadoop/slaves 12masterslave å¯åŠ¨ HDFS å’Œ YARN 123bin/hdfs namenode -format //é¦–æ¬¡è¿è¡Œæ—¶æ ¼å¼åŒ–sbin/start-dfs.shsbin/start-yarn.sh åœ¨ master å’Œ slave èŠ‚ç‚¹åˆ†åˆ«è¾“å…¥ jps åæœ‰ æ­¤æ—¶å¯ä»¥é€šè¿‡ http://152.136.76.12:8080 (ip ä¸º master çš„å…¬ç½‘ ip) ä»¥åŠ http://152.136.76.12:50070 åˆ†åˆ«è®¿é—® HDFS çš„ web ç•Œé¢å’Œ YARN çš„ web ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ° HDFS ä¸‹æœ‰ä¸€ä¸ª slave èŠ‚ç‚¹ï¼ŒYARN ä¸‹æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ è¿è¡Œ wordcountï¼ˆä¸ä¼ªåˆ†å¸ƒå¼ä¸­ä¸€è‡´ï¼‰ 123456bin/hdfs dfs -mkdir /userbin/hdfs dfs -mkdir /user/&lt;username&gt;bin/hdfs dfs -mkdir /user/&lt;username&gt;/inputbin/hdfs dfs -put LICENSE.txt /user/&lt;username&gt;/input bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.9.2.jar wordcount input outputbin/hdfs dfs -cat output/part-r-00000 ç»§ç»­ç”¨ jps æŸ¥çœ‹ä¸¤å°ä¸»æœºçš„è¿›ç¨‹ å¯ä»¥çœ‹åˆ°é›†ç¾¤æ¨¡å¼ä¸­çš„è¿›ç¨‹ä¸ä¼ªé›†ç¾¤æ¨¡å¼ä¸­çš„è¿›ç¨‹æ²¡æœ‰åŒºåˆ«ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºè¿›ç¨‹åœ¨ä¸åŒçš„ä¸»æœºä¸Šè¿è¡Œã€‚ é”™è¯¯ è¿™é‡Œä¸»è¦è®°å½•é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€éƒ¨åˆ†é”™è¯¯ Container exited with a non-zero exit code 1. Error file: prelaunch.err. è¯¥é”™è¯¯æ˜¯åœ¨è…¾è®¯äº‘ä¸»æœºä¸Šé…ç½®çš„ä¼ªé›†ç¾¤æ¨¡å¼è¿è¡Œ wordcount æ—¶å‡ºç°çš„ï¼Œå°è¯•äº†ç½‘ä¸Šçš„ä¸€äº›åŠæ³•éƒ½æ²¡æœ‰è§£å†³ã€‚æœ€åé‡‡ç”¨è‡ªå·±ç”µè„‘é…ç½®å†è¿è¡Œä¸€éæˆåŠŸï¼Œå¯èƒ½æ˜¯å› ä¸ºäº‘ä¸»æœºçš„é…ç½®é—®é¢˜ã€‚ åœ¨ YARN ä¸Šè¿è¡Œ Java.net.ConnectException: Connection refused å¯èƒ½æ˜¯é˜²ç«å¢™çš„åŸå› ï¼Œæ ¹æ® ğŸ”— ä¸­çš„æç¤ºè§£å†³ æ— æ³•å¤–ç½‘è®¿é—®VMä¸­çš„ Hadoop YARN çš„8088ç«¯å£ æ— æ³•é€šè¿‡äº‘ä¸»æœº ip:8088 è®¿é—® YARN çš„ Web é¡µé¢æ—¶ï¼Œä¸å¦¨é€šè¿‡ netstat -nlp | grep java æŸ¥çœ‹å½“å‰æä¾› web æœåŠ¡çš„ç«¯å£ï¼Œå¦‚æœ ip æ˜¯ 127.0.0.1 è¯æ˜å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹ hostsï¼Œå…·ä½“è¿‡ç¨‹è§ ğŸ”—ã€‚ slave: bash: line 0: cd: /root/hadoop/hadoop-2.9.2: No such file or directory é…ç½®é›†ç¾¤æ¨¡å¼æ—¶å‡ºç°ï¼Œä¸»è¦åŸå› æ˜¯æ‰‹åŠ¨é…ç½® slave æ—¶ Hadoop å­˜æ”¾è·¯å¾„ä¸ master ä¸ä¸€è‡´ï¼Œåªéœ€è¦å°† slave çš„ Hadoop æ”¾åœ¨ä¸ master çš„åŒä¸€è·¯å¾„ä¸‹å³å¯è§£å†³ã€‚ Thanks Hadoopå®Œå…¨åˆ†å¸ƒå¼éƒ¨ç½² Hadoopä¸‰ç§æ¨¡å¼ä»‹ç» hadoopçš„ä¸‰ç§è¿è¡Œæ¨¡å¼åŒºåˆ«åŠé…ç½®è¯¦è§£]]></content>
      <categories>
        <category>Hadoop åŸºç¡€</category>
      </categories>
      <tags>
        <tag>BigData</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoop åŸºç¡€ä¹‹ç”Ÿæ€åœˆ]]></title>
    <url>%2F2019%2F04%2F21%2FHadoop%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%94%9F%E6%80%81%E5%9C%88%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡ä¸»è¦ç›®çš„æ˜¯ä»‹ç» Hadoop çš„åŸºæœ¬æ¶æ„ä»¥åŠè¡ç”Ÿå‡ºæ¥çš„å„ç§å·¥å…·ï¼Œä»¥æœŸå¯¹ Hadoop æœ‰ä¸ªæ•´ä½“çš„è®¤è¯†ã€‚ Hadoop ç”Ÿæ€ç³»ç»Ÿ Hadoop ç”Ÿæ€ç³»ç»Ÿæ˜¯æŒ‡ä»¥ åˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ HDFSã€åˆ†å¸ƒå¼çš„è®¡ç®—æ¡†æ¶ MapReduce ä»¥åŠèµ„æºç®¡ç†å™¨ YARNä¸ºåŸºç¡€æ„æˆçš„åˆ†å¸ƒå¼æ•°æ®å¤„ç†ç³»ç»Ÿï¼Œå…¶ç»“æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‹é¢å°†å¯¹å›¾ä¸­å„é¡¹ç»„ä»¶åšä¸€ä¸ªä»‹ç» HDFS HDFS æ˜¯ Google äº 2003 å‘è¡¨çš„ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ GFS è®ºæ–‡çš„å¼€æºå®ç°ç‰ˆæœ¬ï¼Œä¸»è¦ç›®çš„æ˜¯ä½¿ç”¨æ™®é€šå•†ä¸šç”µè„‘è§£å†³å¤§é‡æ•°æ®çš„å­˜å‚¨ä»¥åŠè¯»å–é€Ÿåº¦é—®é¢˜ï¼Œåœ¨ GFS å‡ºç°ä¹‹å‰ä¸€èˆ¬ä¸»è¦åœ¨å•å°è®¡ç®—æœºç”¨ RAID æ¥æé«˜æ•°æ®å­˜å‚¨é‡å’Œè¯»å–é€Ÿåº¦ã€‚ä½†æ˜¯é‡‡ç”¨ RAID ä¸€æ–¹é¢æˆæœ¬æ¯”è¾ƒé«˜ï¼ˆéœ€æ±‚å¤ªé«˜æ—¶å¯èƒ½åªæœ‰è¶…çº§è®¡ç®—æœºæ‰èƒ½æ»¡è¶³ï¼‰ï¼Œå¦ä¸€æ–¹é¢æ•°æ®é‡è¿‡å¤§æ—¶å¯èƒ½è¶…çº§è®¡ç®—æœºä¹Ÿæ— æ³•æ»¡è¶³éœ€æ±‚ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±éœ€è¦é‡‡å–åˆ†å¸ƒå¼çš„æ–¹å¼å»æ»¡è¶³æ‰©å¤§å­˜å‚¨ï¼ˆå¤šå°æœºå™¨å¤šä¸ªç£ç›˜ï¼‰å’Œå¢åŠ è¯»å–é€Ÿåº¦çš„éœ€æ±‚ï¼ˆå¤šå°æœºå™¨å¯ä»¥åŒæ—¶è¯»ï¼‰ã€‚ MapReduce MapReduce æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„è®¡ç®—æ¡†æ¶ï¼Œåœ¨ MapReduce å‡ºç°ä¹‹å‰å°±å·²ç»æœ‰äº†åˆ†å¸ƒå¼è®¡ç®—è¿™ä¸ªæ¦‚å¿µã€‚ä½†æ˜¯å¤§å¤šæ•°åˆ†å¸ƒå¼è®¡ç®—åªèƒ½ä¸“é—¨ç”¨äºå¤„ç†ä¸€ç±»è¿ç®—ï¼Œè€Œ Google åœ¨å¤§é‡å®è·µä¸­æ€»ç»“å‡ºäº†ä¸€ä¸ªé€šç”¨çš„ç¼–ç¨‹æ¨¡å‹ï¼š map å’Œ reduceã€‚å…¶ä¸­ map æ˜¯æŒ‡åˆ†å¼€è®¡ç®—çš„è¿‡ç¨‹ï¼Œè€Œ reduce æ˜¯æŒ‡åˆå¹¶ç»“æœçš„è¿‡ç¨‹ã€‚è€Œåœ¨è¿™ä¸€ç¼–ç¨‹æ¨¡å‹æ·»åŠ çš„ä¸€ç³»åˆ—æœºåˆ¶å’Œæ“ä½œæ„æˆäº† MapReduceã€‚MapReduce å¤§å¤§é™ä½äº†åˆ†å¸ƒå¼è®¡ç®—çš„é—¨æ§›ï¼Œå¯¹äºå¼€å‘äººå‘˜è€Œè¨€åªéœ€è¦ç¼–å†™ä¸€ç³»åˆ— map å’Œ reduce å‡½æ•°å³å¯å®Œæˆæ‰€éœ€çš„åˆ†å¸ƒå¼è®¡ç®—è¿‡ç¨‹ã€‚ YARN YARN æ˜¯ä¸€ä¸ªèµ„æºç®¡ç†æ¡†æ¶ï¼Œä¸»è¦ä½œç”¨æ˜¯è´Ÿè´£é›†ç¾¤çš„èµ„æºè°ƒåº¦å’Œä½œä¸šä»»åŠ¡ç®¡ç†ã€‚YARN çš„å‡ºç°æºäº Hadoop ä¸èƒ½æ»¡è¶³ç»Ÿä¸€ä½¿ç”¨é›†ç¾¤èµ„æºçš„éœ€æ±‚ï¼Œå› ä¸º Hadoop1 ä¸­é›†ç¾¤çš„èµ„æºè°ƒåº¦å’Œä»»åŠ¡ç®¡ç†ä¸ MapReduce çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ï¼Œè€Œåç»­å‡ºç°çš„ Sparkã€Storm ç­‰åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿå…¶æ¶æ„å’Œæ‰§è¡Œè¿‡ç¨‹ä¸ MapReduce ä¸åŒï¼Œæ— æ³•ç›´æ¥å‘ Hadoop ç”³è¯·é›†ç¾¤èµ„æºã€‚æ‰€ä»¥ä¸ºäº†å®ç°é›†ç¾¤èµ„æºçš„ç»Ÿä¸€ç®¡ç†ï¼Œåœ¨ Hadoop2 ä¸­å¯¹ MapReduce è¿›è¡Œäº†ä¸€ä¸ªè§£è€¦ï¼ŒæŠ½ç¦»å‡ºäº† YARN è¿™ä¸ªæ¡†æ¶ã€‚ ZooKeeper Zookeeper ä¸»è¦ä½œç”¨æ˜¯æä¾›ä¸€ä¸ªåˆ†å¸ƒå¼ã€é«˜å¯ç”¨çš„åè°ƒæœåŠ¡ï¼Œè§£å†³åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ•°æ®ç®¡ç†é—®é¢˜ï¼šç»Ÿä¸€å‘½åï¼ŒçŠ¶æ€åŒæ­¥ï¼Œé›†ç¾¤ç®¡ç†ï¼Œé…ç½®åŒæ­¥ç­‰ã€‚ Pig è™½ç„¶ MapReduce æå¤§çš„ç®€åŒ–äº†åˆ†å¸ƒå¼è®¡ç®—ç¼–ç¨‹çš„é—¨æ§›ï¼Œä½†æ˜¯ Yahoo çš„å·¥ç¨‹å¸ˆä¾ç„¶è§‰å¾— MapReduce ç¼–ç¨‹å¤ªè¿‡éº»çƒ¦ï¼Œæ‰€ä»¥ä»–ä»¬ä¾¿å¼€å‘äº† Pig è¿™ä¸ªè„šæœ¬è¯­è¨€ç”¨äºæè¿°å¯¹å¤§æ•°æ®é›†çš„æ“ä½œã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡ç¼–è¯‘ Pig è„šæœ¬ç”Ÿæˆå¯¹åº”çš„ MapReduce ç¨‹åºã€‚ Hive ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ SQL çš„å·¥ç¨‹å¸ˆä½¿ç”¨ MapReduceï¼ŒFacebook çš„å·¥ç¨‹å¸ˆå¼€å‘äº† Hiveï¼Œé€šè¿‡ Hive ç†Ÿæ‚‰æ•°æ®åº“çš„å·¥ç¨‹å¸ˆå¯ä»¥æ— é—¨æ§›çš„ä½¿ç”¨ MapReduceã€‚ Mahout Mahout çš„ä¸»è¦ç›®æ ‡æ˜¯åˆ›å»ºä¸€äº›å¯æ‰©å±•çš„æœºå™¨å­¦ä¹ é¢†åŸŸç»å…¸ç®—æ³•çš„å®ç°ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜æ›´åŠ æ–¹ä¾¿å¿«æ·åœ°åˆ›å»ºæ™ºèƒ½åº”ç”¨ç¨‹åºã€‚Mahout ç°åœ¨å·²ç»åŒ…å«äº†èšç±»ã€åˆ†ç±»ã€æ¨èå¼•æ“ï¼ˆååŒè¿‡æ»¤ï¼‰å’Œé¢‘ç¹é›†æŒ–æ˜ç­‰å¹¿æ³›ä½¿ç”¨çš„æ•°æ®æŒ–æ˜æ–¹æ³•ã€‚ Tez Tez æ˜¯ Apache æœ€æ–°å¼€æºçš„æ”¯æŒ DAG ä½œä¸šçš„è®¡ç®—æ¡†æ¶ï¼Œå®ƒç›´æ¥æºäº MapReduce æ¡†æ¶ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°† Map å’Œ Reduce ä¸¤ä¸ªæ“ä½œè¿›ä¸€æ­¥æ‹†åˆ†ï¼Œå³ Map è¢«æ‹†åˆ†æˆ Inputã€Processorã€Sortã€Mergeå’ŒOutputï¼Œ Reduce è¢«æ‹†åˆ†æˆ Inputã€Shuffleã€Sortã€Mergeã€Processor å’Œ Output ç­‰ã€‚ Hase HBase æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨ HDFS ä¹‹ä¸Šï¼Œé¢å‘åˆ—çš„é’ˆå¯¹ç»“æ„åŒ–æ•°æ®çš„å¯ä¼¸ç¼©ã€é«˜å¯é ã€é«˜æ€§èƒ½ã€åˆ†å¸ƒå¼å’Œé¢å‘åˆ—çš„åŠ¨æ€æ¨¡å¼æ•°æ®åº“ã€‚ Flume Cloudera å¼€æºçš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œå…·æœ‰åˆ†å¸ƒå¼ã€é«˜å¯é ã€é«˜å®¹é”™ã€æ˜“äºå®šåˆ¶å’Œæ‰©å±•çš„ç‰¹ç‚¹ã€‚ Sqoop Sqoop æ˜¯ SQL-to-Hadoop çš„ç¼©å†™ï¼Œä¸»è¦ç”¨äºä¼ ç»Ÿæ•°æ®åº“å’Œ Hadoop ä¹‹å‰ä¼ è¾“æ•°æ®ã€‚æ•°æ®çš„å¯¼å…¥å’Œå¯¼å‡ºæœ¬è´¨ä¸Šæ˜¯Mapreduce ç¨‹åºï¼Œå……åˆ†åˆ©ç”¨äº† MR çš„å¹¶è¡ŒåŒ–å’Œå®¹é”™æ€§ã€‚ Ambari Ambari çš„ä½œç”¨æ¥è¯´ï¼Œå°±æ˜¯åˆ›å»ºã€ç®¡ç†ã€ç›‘è§† Hadoop çš„é›†ç¾¤ï¼Œæ˜¯ä¸ºäº†è®© Hadoop ä»¥åŠç›¸å…³çš„å¤§æ•°æ®è½¯ä»¶æ›´å®¹æ˜“ä½¿ç”¨çš„ä¸€ä¸ª web å·¥å…·ã€‚ æ€»ç»“ æ€»çš„æ¥è¯´ HDFS ã€MapReduce ä»¥åŠ YARN æ˜¯ Hadoop çš„æ ¸å¿ƒç»„ä»¶ï¼Œè€Œæˆ‘ä»¬å­¦ä¹  Hadoop æœ€å¥½ä»æ ¸å¿ƒç»„ä»¶å¼€å§‹å­¦ä¹ å…¶åŸç†æœºåˆ¶ï¼Œå†é€æ¸å¾€ä¸Šå±‚è¿›è¡Œäº†è§£ã€‚ Thanks Hadoopç”Ÿæ€åœˆæ€»ç»“â€”â€”å¤§æ•°æ® hadoopç”Ÿæ€åœˆå„ä¸ªç»„ä»¶ç®€ä»‹ å¤§æ•°æ®æŠ€æœ¯Hadoopå…¥é—¨ç†è®ºç³»åˆ—ä¹‹ä¸€----hadoopç”Ÿæ€åœˆä»‹ç» ä»0å¼€å§‹å­¦å¤§æ•°æ®---æå®¢æ—¶é—´]]></content>
      <categories>
        <category>Hadoop åŸºç¡€</category>
      </categories>
      <tags>
        <tag>BigData</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java åŸºç¡€ä¹‹é›†åˆæ¡†æ¶(ä¸€)ï¼šé›†åˆæ¡†æ¶]]></title>
    <url>%2F2018%2F03%2F17%2FJava%E5%9F%BA%E7%A1%80%E4%B9%8B%E9%9B%86%E5%90%88-%E4%B8%80%2F</url>
    <content type="text"><![CDATA[é—®é¢˜ é›†åˆç±»åº”è¯¥æ˜¯å¹³æ—¶ä½¿ç”¨çš„éå¸¸é¢‘ç¹çš„ç±»äº†ï¼Œä½†æ˜¯å¯¹å…¶å†…éƒ¨æ„æˆå´ä¸€ç›´ä¸å¤ªæ¸…æ™°ï¼Œæ‰€ä»¥å¸Œæœ›é€šè¿‡æœ¬ç¯‡æ–‡ç« å°è¯•å»ç†è§£é›†åˆæ¡†æ¶çš„æ•´ä½“è®¾è®¡ä»¥åŠé›†åˆå­˜åœ¨çš„å¿…è¦æ€§ã€‚åœ¨å¼€å§‹åˆ†æä¹‹å‰é¦–å…ˆè®©æˆ‘ä»¬æ€è€ƒä»¥ä¸‹é—®é¢˜ï¼š é›†åˆå­˜åœ¨çš„æ„ä¹‰ï¼Œé›†åˆå’Œæ•°ç»„çš„åŒºåˆ« é›†åˆæ¡†æ¶çš„è®¾è®¡æ„å›¾ é›†åˆçš„å¸¸ç”¨æ“ä½œ é›†åˆå­˜åœ¨çš„æ„ä¹‰ä»¥åŠä¸æ•°ç»„çš„åŒºåˆ« æƒ³è¦äº†è§£ Java ä¸ºä»€ä¹ˆä¼šè®¾è®¡é›†åˆï¼Œå°±å¾—å…ˆæ˜ç™½é›†åˆçš„å‡ºç°è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œå…³äºè¿™ä¸€é—®é¢˜ã€ŒJava ç¼–ç¨‹æ€æƒ³ã€ä¸­æ˜¯è¿™ä¹ˆæè¿°çš„ å¦‚æœä¸€ä¸ªç¨‹åºä¸­åªåŒ…å«å›ºå®šæ•°é‡çš„ä¸”å…¶ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯å·²çŸ¥çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç¨‹åºã€‚ é€šå¸¸ï¼Œç¨‹åºæ€»æ˜¯æ ¹æ®è¿è¡Œæ—¶æ‰çŸ¥é“çš„æŸäº›æ¡ä»¶å»åˆ›å»ºæ–°å¯¹è±¡ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œä¸ä¼šçŸ¥é“æ‰€éœ€å¯¹è±¡çš„æ•°é‡ï¼Œç”šè‡³ä¸çŸ¥é“ç¡®åˆ‡çš„ç±»å‹ã€‚ æ‰€ä»¥ä¹‹æ‰€ä»¥éœ€è¦é›†åˆæ˜¯å› ä¸ºåœ¨ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ä¼šéœ€è¦ä¿å­˜æ•°é‡ä¸å®šã€ç±»å‹ä¸å®šçš„æ•°æ®ã€‚ é’ˆå¯¹æ•°é‡ä¸å®šè€ƒè™‘ä¸‹é¢è¿™ç§æƒ…å†µ 123456789101112131415161718public class Demo &#123; private static final int COUNT = 10; private static final String STOP_FLAG = "s"; public static void main(String[] args) &#123; Scanner scanner = new Scanner(System.in); String collection[] = new String[COUNT]; System.out.println("è¾“å…¥å³å°†ä¿å­˜çš„æ•°æ®"); int i = 0; while (!(collection[i] = scanner.next()).equals(STOP_FLAG)) &#123; i++; &#125; scanner.close(); for (i = 0; i &lt; collection.length; i++) &#123; System.out.print(collection[i] + " "); &#125; &#125;&#125; ä½œä¸ºä¸€ä¸ªç®€å•çš„è¾“å…¥ç¨‹åºï¼Œé‡‡ç”¨æ•°ç»„çš„å½¢å¼å»ä¿å­˜ç”¨æˆ·çš„è¾“å…¥ï¼Œå½“ç”¨æˆ·çš„è¾“å…¥è¶…è¿‡æ•°ç»„å¯å®¹çº³çš„æ•°é‡çš„æ—¶å€™ä¾¿ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸ªé—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿä¸€ç§æ–¹å¼æ˜¯å°†æ•°ç»„çš„æ•°é‡åˆ†é…çš„è¶³å¤Ÿå¤§ï¼Œä½†æ˜¯é‡‡å–è¿™ç§æ–¹å¼ææœ‰å¯èƒ½æµªè´¹å†…å­˜ç©ºé—´ã€‚å¦ä¸€ç§æ–¹å¼åˆ™æ˜¯åŠ¨æ€æ‰©å±•å¤§å°ï¼Œé€šè¿‡åŠ¨æ€æ‰©å±•å¤§å°æ—¢èƒ½å¤Ÿå®¹çº³è¶³å¤Ÿå¤šçš„å…ƒç´ ï¼Œåˆèƒ½å¤ŸèŠ‚çº¦å†…å­˜ç©ºé—´ã€‚è€Œé›†åˆæ­£å…·å¤‡åŠ¨æ€æ‰©å±•å¤§å°è¿™ä¸€ç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé›†åˆå°±ä½“ç°å‡ºäº†å®ƒçš„ä½œç”¨ã€‚ è‡³äºç±»å‹ä¸å®šï¼Œè€ƒè™‘å¦ä¸€ç§æƒ…å†µ 123456789101112131415161718192021222324252627282930313233package com.rookieyang.collections;public class DataArray &#123; private String datas[]; private int index; private static final int COUNT = 5; public DataArray() &#123; datas = new String[COUNT]; &#125; //ä¹Ÿå¯è‡ªè¡Œå¯¹æ•°ç»„è¿›è¡ŒåŠ¨æ€æ‰©å±•ï¼Œè¿™é‡Œåªæ˜¯æµ‹è¯• public void addData(String data)&#123; try &#123; datas[index] = data; index++; &#125; catch (IndexOutOfBoundsException e) &#123; System.out.println("è¶…å‡ºæœ€å¤§çš„å­˜å‚¨èŒƒå›´"); &#125; &#125;&#125;package com.rookieyang.collections;import java.util.List;public class DataCollection&lt;T&gt; &#123; private List&lt;T&gt; datas; public void addData(T data) &#123; datas.add(data); &#125;&#125; å¯ä»¥çœ‹å‡ºå¯¹äºæ•°ç»„è€Œè¨€åœ¨åŠ¨æ€æ·»åŠ æ•°æ®ä¼šç•¥æ˜¾éº»çƒ¦ï¼Œè€Œä¸”åªèƒ½ä¿å­˜ String ç±»å‹æ•°æ®ï¼Œä½†å¯¹äºé‡‡ç”¨é›†åˆè€Œè¨€ï¼Œä½¿ç”¨èµ·æ¥ä¸ä»…ç®€å•è€Œä¸”å…¶æ‰©å±•æ€§ä¹Ÿå¼ºï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å†³å®šé›†åˆä¸­ä¿å­˜ä½•ç§ç±»å‹æ•°æ®ï¼Œè¿™å°±å®ç°äº†ä»£ç çš„å¤ç”¨ã€‚ å¯¹äºé›†åˆå’Œæ•°ç»„è€Œè¨€ï¼Œå…¶ä¸»è¦åŒºåˆ«å¦‚ä¸‹ æ•°ç»„æ˜¯é™æ€çš„ï¼Œä¸€ä¸ªæ•°ç»„å®ä¾‹å…·æœ‰å›ºå®šçš„å¤§å°ï¼Œé›†åˆæ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€è¦åŠ¨æ€æ‰©å±•å¤§å° æ•°ç»„æ—¢å¯ä»¥ä¿å­˜åŸºæœ¬ç±»å‹ï¼Œä¹Ÿå¯ä¿å­˜å¼•ç”¨ç±»å‹ï¼Œé›†åˆåªèƒ½ä¿å­˜å¼•ç”¨ç±»å‹ï¼Œåœ¨ä¿å­˜åŸºæœ¬ç±»å‹çš„æ—¶å€™ä¼šè‡ªåŠ¨è£…ç®± é›†åˆæ•´ä½“æ¡†æ¶åˆ†æ é¦–å…ˆçœ‹ä¸‹é›†åˆçš„æ•´ä½“æ¡†æ¶å›¾ï¼Œå¯¹äºé›†åˆè€Œè¨€ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šCollection å’Œ Mapï¼Œå…¶ä¸­ Collection ä¸»è¦ä¿å­˜çš„æ˜¯å•ä¸ªå…ƒç´ ï¼Œè€Œ Map åˆ™å¯ä»¥å°†æŸäº›å¯¹è±¡ä¸å…¶å®ƒä¸€äº›å¯¹è±¡å­˜åœ¨çš„å…³ç³»ç”¨ key-value æ–¹å¼ä¿å­˜ä¸‹æ¥ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†å°±è¿™ä¸¤ä¸ªéƒ¨åˆ†å±•å¼€åˆ†æã€‚ Collection æ¥å£ ç»“æ„åˆ†æ è¿™é‡Œä¸ºäº†æ–¹ä¾¿åˆ†æåªå±•ç¤ºäº†æ¥å£çš„ç»§æ‰¿ç»“æ„ é¦–å…ˆæŸ¥çœ‹ Iterable 123456789101112131415public interface Iterable&lt;T&gt; &#123; Iterator&lt;T&gt; iterator(); default void forEach(Consumer&lt;? super T&gt; action) &#123; Objects.requireNonNull(action); for (T t : this) &#123; action.accept(t); &#125; &#125; default Spliterator&lt;T&gt; spliterator() &#123; return Spliterators.spliteratorUnknownSize(iterator(), 0); &#125;&#125; Itrable æ¥å£ä¸­æ‹¥æœ‰ä¸€ä¸ª iterator æ–¹æ³•ä»¥åŠä¸¤ä¸ª 1.8 æ·»åŠ çš„é»˜è®¤æ–¹æ³•ï¼š iteratorï¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ç”¨äºéå† forEachï¼šæ ¹æ®ç»™å®šçš„ action å¤„ç†æ¯ä¸ªå…ƒç´  spliteratorï¼šæä¾›äº†ä¸€ä¸ªç”¨äºå¹¶è¡Œéå†çš„è¿­ä»£å™¨ï¼Œç”±äºè¿™é‡Œä¸»è¦æ¢è®¨ç»“æ„è®¾è®¡ï¼Œæ‰€ä»¥æš‚ä¸”ä¸å±•å¼€è¯´æ˜ çœ‹åˆ°è¿™é‡Œæˆ‘äº§ç”Ÿäº†ç¬¬ä¸€ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆ Collection ä¸ç›´æ¥ç»§æ‰¿ Iterator æ¥å£ï¼Œè€Œéœ€è¦ç”¨ Iterable è¿›è¡ŒåŒ…è£…ä¹‹åå†ç»§æ‰¿å‘¢ï¼Ÿ è¿™é‡Œå‡è®¾å­˜åœ¨ä¸€ä¸ª CustomizeCollection æ¥å£åœ¨åŒ…å«äº† Collection æ¥å£æ–¹æ³•çš„åŸºç¡€ä¸Šç»§æ‰¿äº† Iterator æ¥å£è€Œä¸æ˜¯ Iterableï¼ˆæˆ–è€…æ˜¯ç›´æ¥åŒ…å«äº† Collection æ¥å£æ–¹æ³•ä»¥åŠ Iterator æ¥å£æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬å®ç° CustomizeCollection æ¥å£çš„æ—¶å€™æ‰€å¾—åˆ°çš„ CustomizeClass ç±»ç»“æ„å°†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥çœ‹åˆ°å¦‚æœæƒ³å®ç° CustomizeCollection åˆ™å¿…é¡»è¦å®ç° Iterator æ¥å£æ–¹æ³•ï¼Œå¾ˆæ˜¾ç„¶é‡‡ç”¨è¿™ç§æ–¹å¼å¯èƒ½å¯¼è‡´åœ¨ä¸åŒçš„ CustomizeCollection æ¥å£å®ç°ç±»ä¸­å­˜åœ¨ç›¸åŒçš„ Itrator æ¥å£æ–¹æ³•å®ç°ï¼ˆéå†è¿™ä¸€æ“ä½œæŸäº›æ—¶å€™å¯èƒ½æ˜¯é€šç”¨çš„ï¼‰ï¼Œè¿™æ ·ä¸€æ¥å°±é™ä½äº†ä»£ç çš„å¤ç”¨æ€§ï¼Œå¦å¤–ä»å•ä¸€èŒè´£çš„è§’åº¦æ¥è€ƒè™‘ï¼ŒCustomizeCollection æ¥å£ä¸­æ‰åˆäº†é›†åˆå…ƒç´ çš„ç®¡ç†åŠŸèƒ½ä»¥åŠè¿­ä»£å™¨çš„åŠŸèƒ½ï¼Œè€Œé‡‡ç”¨ Iterable åŒ…è£…ä¹‹ååˆ™å¯ä»¥å°†è¿™ä¸¤ä¸ªåŠŸèƒ½è¿›è¡Œä¸€å®šç¨‹åº¦ä¸Šçš„åˆ†å‰²ã€‚ æ¥ç€ä» Collection åˆå»¶å±•å‡ºä¸‰ä¸ªæ¥å£ï¼Œè¿™ä¸‰ä¸ªæ¥å£æ˜¯å¯¹é›†åˆåŠŸèƒ½çš„å…·ä½“åŒ–ï¼š Set è¡¨ç¤ºçš„æ˜¯æ— åºã€ä¸å­˜åœ¨é‡å¤å…ƒç´ çš„é›†åˆ List è¡¨ç¤ºçš„æ˜¯ä¸€ç§æœ‰åºã€å¯é‡å¤å…ƒç´ çš„é›†åˆ Queue è¡¨ç¤ºçš„æ˜¯ä¸€ç§é˜Ÿåˆ—ï¼Œå…¶å®é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ç§æœ‰åºçš„é›†åˆï¼Œä½†ä¹‹æ‰€ä»¥ä¼šå•ç‹¬è®¾è®¡å‡ºä¸€ä¸ªæ¥å£çš„åŸå› åœ¨äºï¼ŒQueue æ¥å£å»é™¤äº†å¾ˆå¤šä¸éœ€è¦çš„åŠŸèƒ½ï¼Œä½¿å¾—æ¥å£æœ¬èº«æ›´ç¬¦åˆå•ä¸€èŒè´£ä»¥åŠæ¥å£éš”ç¦»åŸåˆ™ã€‚ åŠŸèƒ½åˆ†æ Collection æ¥å£çš„åŠŸèƒ½å¤§è‡´æ¦‚æ‹¬å¦‚ä¸‹ï¼ˆæš‚ä¸ä»‹ç» 1.8 å¼•å…¥çš„é»˜è®¤æ–¹æ³•ï¼‰ å¢åŠ  boolean add(E e) å¢åŠ å•å…ƒå…ƒç´  boolean addAll(Collection&lt;? extends E&gt; c) å¢åŠ é›†åˆ c çš„å…ƒç´  åˆ é™¤ boolean remove(Object o) ç§»é™¤å…ƒç´  boolean removeAll(Collection&lt;?&gt; c) ç§»é™¤é›†åˆ c çš„å…ƒç´  void clear() æ¸…ç©ºé›†åˆ æŸ¥è¯¢ boolean contains(Object o) æŸ¥è¯¢é›†åˆæ˜¯å¦å­˜åœ¨å…ƒç´  o boolean containsAll(Collection&lt;?&gt; c)æŸ¥è¯¢å½“å‰é›†åˆæ˜¯å¦å­˜åœ¨é›†åˆ c ä¸­çš„æ‰€æœ‰å…ƒç´  boolean isEmpty() æŸ¥è¯¢æ˜¯å¦é›†åˆä¸ºç©º int size() æŸ¥è¯¢é›†åˆçš„å¤§å° å…¶å®ƒ Iterator iterator() è¿”å›è¿­ä»£å™¨ boolean retainAll(Collection&lt;?&gt; c) å–å½“å‰é›†åˆå’Œé›†åˆ c çš„äº¤é›† Set æ¥å£ä¸ Colleciton æ¥å£å®šä¹‰çš„æ–¹æ³•å®Œå…¨ä¸€è‡´ List æ¥å£åœ¨ Collectiion æ¥å£åŸºç¡€ä¸Šæ–°å¢äº†ä¸€äº›ä¸ç´¢å¼•æœ‰å…³çš„æ–¹æ³• å¢åŠ  void add(int index, E element) åœ¨ index å¤„æ’å…¥å…ƒç´  åˆ é™¤ E remove(int index) åˆ é™¤ index å¤„çš„å…ƒç´  ä¿®æ”¹ E set(int index, E element) ä¿®æ”¹ index çš„å…ƒç´ ä¸º element æŸ¥è¯¢ E get(int index) è·å– index å¤„çš„å…ƒç´  int indexOf(Object o) è·å–å…ƒç´  o ç¬¬ä¸€æ¬¡å‡ºç°çš„ index int lastIndexOf(Object o) è·å–å…ƒç´  o æœ€åä¸€æ¬¡å‡ºç°çš„ index å…¶å®ƒ ListIterator listIterator() è¿”å› ListIterator ç±»å‹çš„è¿­ä»£å™¨ ListIterator listIterator(int index) è¿”å›ä» index å¼€å§‹çš„ ListIterator ç±»å‹çš„è¿­ä»£å™¨ Queue æ¥å£æ–°å¢çš„æ–¹æ³•å¦‚ä¸‹ å‡ºé˜Ÿ E peek() å‡ºé˜Ÿä½†æ˜¯ä¸åˆ é™¤å…ƒç´ ï¼Œåœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™è¿”å› null E element() å‡ºé˜Ÿä½†æ˜¯ä¸åˆ é™¤å…ƒç´ ï¼Œåœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ E poll() å‡ºé˜Ÿå¹¶ä¸”åˆ é™¤å…ƒç´ ï¼Œåœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™è¿”å›null E remove() å‡ºé˜Ÿå¹¶ä¸”åˆ é™¤å…ƒç´ ï¼Œåœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ å…¥é˜Ÿ boolean offer(E e) Map æ¥å£ ç»“æ„åˆ†æ Map æ˜¯ä¸€ä¸ªå•ä¸€çš„æ¥å£ï¼Œå¹¶æ²¡æœ‰åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ï¼Œä½†åœ¨ Map æ¥å£çš„å†…éƒ¨æœ‰ä¸€ä¸ª Entry æ¥å£ï¼š 1234567891011121314interface Entry&lt;K,V&gt; &#123; K getKey(); V getValue(); V setValue(V value); boolean equals(Object o); int hashCode(); .....&#125; å¯ä»¥çœ‹åˆ° Entry é‡Œé¢å°è£…çš„éƒ½æ˜¯å’Œ Map ä¸­å…ƒç´ æœ‰å…³çš„æ“ä½œï¼Œè¿™ä¸€æ¥å£ä¸»è¦ç”¨æ¥è§„å®š Map ä¸­ç”¨æ¥å­˜å‚¨ key-value æ‰€éœ€è¦æä¾›çš„åŠŸèƒ½ åŠŸèƒ½åˆ†æ Map æ¥å£çš„åŠŸèƒ½å¤§è‡´å¦‚ä¸‹ï¼š å¢åŠ æˆ–ä¿®æ”¹ V put(K key, V value) å­˜å‚¨ key å’Œ valueï¼Œå¦‚æœ key å·²ç»å­˜åœ¨åˆ™ä¼šå°†åŸæ¥çš„ value æ›¿æ¢ä¸ºæ–°çš„ value void putAll(Map&lt;? extends K, ? extends V&gt; m) å°† m ä¸­çš„ key å’Œ value æ·»åŠ åˆ°å½“å‰ Map ä¸­ åˆ é™¤ V remove(Object key) ç§»é™¤æŒ‡å®šçš„ key ä»¥åŠå…³è”çš„ value void clear() æ¸…ç©º Map æŸ¥æ‰¾ V get(Object key) è·å– key å…³è”çš„ value boolean containsKey(Object key) åˆ¤æ–­å½“å‰ Map æ˜¯å¦åŒ…å«æŒ‡å®šçš„ key boolean containsValue(Object value) åˆ¤æ–­å½“å‰Map æ˜¯å¦åŒ…å«æŒ‡å®šçš„ value boolean isEmpty() åˆ¤æ–­å½“å‰ Map æ˜¯å¦ä¸ºç©º int size() è·å–å½“å‰ Map çš„å¤§å° å…¶å®ƒ Set keySet() å°† key ç”Ÿæˆ Set é›†åˆ Collection values() å°† value ç”Ÿæˆé›†åˆ Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet() å°† Map ä¸­ä¿å­˜çš„å…ƒç´ ç”Ÿæˆ Set é›†åˆï¼Œä¸€èˆ¬ç”¨äºéå†é›†åˆ ä» Map æ¥å£æ‰€æä¾›çš„æ–¹æ³•æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†æ–¹æ³•å…¶å®ä¸ Collection æ¥å£ä¸­æ— å¼‚ï¼Œåªæ˜¯åœ¨ Collection ä¸­æ˜¯å¯¹å•ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯åœ¨ Map æ¥å£ä¸­æ˜¯å¯¹ key-value è¿™ç§å…³è”å…ƒç´ è¿›è¡Œæ“ä½œã€‚ æ€»ç»“ Java é›†åˆæ¡†æ¶ä»¥ Colleciton å’Œ Map ä¸ºåŸºç¡€ï¼Œé«˜åº¦æŠ½è±¡äº†å¯¹å•ä¸ªå…ƒç´ ä»¥åŠé”®å€¼å¯¹çš„æ“ä½œï¼Œè€Œåœ¨æ­¤åŸºç¡€ä¸Šä¸ºäº†å‡è½»ä¸šåŠ¡å¼€å‘éš¾åº¦ï¼Œé›†åˆæ¡†æ¶åˆæä¾›äº†å¤šä¸ªå®ç°ç±»ä»¥ä¾›ä½¿ç”¨ï¼Œå°½ç®¡çœ‹èµ·æ¥é”™ç»¼å¤æ‚ï¼Œä½†æ˜¯åªè¦äº†è§£æ ¸å¿ƒçš„æ¥å£ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ä¾¿å¯å¯¹é›†åˆæ¡†æ¶æœ‰ä¸ªè¾ƒä¸ºæ¸…æ™°çš„è®¤è¯†ã€‚]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é›†åˆ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidå¯åŠ¨è¿‡ç¨‹ç®€æï¼ˆå››ï¼‰ä¹‹Lanucherçš„å¯åŠ¨]]></title>
    <url>%2F2018%2F02%2F28%2FAndroid%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E7%AE%80%E6%9E%90%EF%BC%88%E5%9B%9B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å‰è¨€ é€šè¿‡Androidå¯åŠ¨è¿‡ç¨‹ç®€æï¼ˆä¸‰ï¼‰è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å·²ç»å¤§è‡´äº†è§£äº†æœåŠ¡æ˜¯å¦‚ä½•è¢«å¯åŠ¨çš„ï¼Œæ¥ç€æœ¬æ–‡å°†ä¼šåˆ†æç³»ç»Ÿå¯åŠ¨çš„æœ€åä¸€æ­¥ï¼Œå³ Launcher çš„å¯åŠ¨ã€‚ Lanucherçš„å¯åŠ¨æµç¨‹ åœ¨ SystemServer ä¸­å¯åŠ¨çš„è¿™ä¹ˆå¤šæœåŠ¡å½“ä¸­ ActivityManagerService æ˜¯è´Ÿè´£å››å¤§ç»„ä»¶çš„å¯åŠ¨ã€åˆ‡æ¢ã€è°ƒåº¦çš„ï¼Œæ‰€ä»¥ Launcher çš„å¯åŠ¨ä¸ ActivityManagerService ç¦»ä¸å¼€å…³ç³» frameworks/base/services/java/com/android/server/SystemServer.java 1234567891011121314151617181920private void startOtherServices() &#123; .... // We now tell the activity manager it is okay to run third party // code. It will call back into us once it has gotten to the state // where third party code can really run (but before it has actually // started launching the initial applications), for us to complete our // initialization. mActivityManagerService.systemReady(new Runnable() &#123; @Override public void run() &#123; .... try &#123; startSystemUi(context); &#125; catch (Throwable e) &#123; reportWtf("starting System UI", e); &#125; ... &#125;);&#125; å¯ä»¥çœ‹åˆ°åœ¨ startOtherServices ä¸­è°ƒç”¨äº† mActivityManagerService çš„ systemReady æ–¹æ³•ï¼Œå¹¶åœ¨ä¼ å…¥çš„ Runnable å¯¹è±¡ä¸­å¯åŠ¨äº† SystemUiï¼Œæ¥ç€ç»§ç»­æŸ¥çœ‹ systemReady æ–¹æ³• frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public void systemReady(final Runnable goingCallback) &#123; synchronized(this) &#123; //ç¬¬ä¸€æ¬¡ä¸ºfalseä¸ä¼šè¿›å…¥ if (mSystemReady) &#123; // If we're done calling all the receivers, run the next "boot phase" passed in // by the SystemServer if (goingCallback != null) &#123; goingCallback.run(); &#125; return; &#125; .... mSystemReady = true; &#125; ... synchronized(this) &#123; // Make sure we have no pre-ready processes sitting around. if (mFactoryTest == FactoryTest.FACTORY_TEST_LOW_LEVEL) &#123; .... &#125; &#125; ... //æ‰§è¡Œä¼ å…¥çš„Runnableå¯¹è±¡ if (goingCallback != null) goingCallback.run(); ... synchronized (this) &#123; // Only start up encryption-aware persistent apps; once user is // unlocked we'll come back around and start unaware apps startPersistentApps(PackageManager.MATCH_DIRECT_BOOT_AWARE); // Start up initial activity. mBooting = true; // Enable home activity for system user, so that the system can always boot ... //å¯åŠ¨Lanucherçš„ä¸»Activity startHomeActivityLocked(currentUserId, "systemReady"); ... mStackSupervisor.resumeFocusedStackTopActivityLocked(); mUserController.sendUserSwitchBroadcastsLocked(-1, currentUserId); &#125;&#125; åœ¨ systemReady æ–¹æ³•ä¸­ä¼šè°ƒç”¨ startHomeActivityLocked 123456789101112131415161718192021222324252627282930boolean startHomeActivityLocked(int userId, String reason) &#123; if (mFactoryTest == FactoryTest.FACTORY_TEST_LOW_LEVEL &amp;&amp; mTopAction == null) &#123; // We are running in factory test mode, but unable to find // the factory test app, so just sit around displaying the // error message and don't try to start anything. return false; &#125; //æ„å»ºå¯åŠ¨Lanucherä¸»Activityçš„Intentå¯¹è±¡ Intent intent = getHomeIntent(); ActivityInfo aInfo = resolveActivityInfo(intent, STOCK_PM_FLAGS, userId); if (aInfo != null) &#123; intent.setComponent(new ComponentName(aInfo.applicationInfo.packageName, aInfo.name)); // Don't do this if the home app is currently being // instrumented. aInfo = new ActivityInfo(aInfo); aInfo.applicationInfo = getAppInfoForUser(aInfo.applicationInfo, userId); ProcessRecord app = getProcessRecordLocked(aInfo.processName, aInfo.applicationInfo.uid, true); if (app == null || app.instrumentationClass == null) &#123; intent.setFlags(intent.getFlags() | Intent.FLAG_ACTIVITY_NEW_TASK); //å¯åŠ¨Lanucherä¸»Activity mActivityStarter.startHomeActivityLocked(intent, aInfo, reason); &#125; &#125; else &#123; Slog.wtf(TAG, "No home screen found for " + intent, new Throwable()); &#125; return true;&#125; è¿›å…¥ startHomeActivityLocked æ–¹æ³•ä¹‹åå¯ä»¥çœ‹åˆ°è°ƒç”¨äº† getHomeIntent è¿”å›äº†ä¸€ä¸ª Intentï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å¯åŠ¨ä¸€ä¸ª Activity çš„ä¿¡æ¯éƒ½æ˜¯é€šè¿‡ Intent è¿›è¡Œä¼ é€’çš„ï¼Œæ‰€ä»¥ç»§ç»­æŸ¥çœ‹ getHomeIntent çœ‹çœ‹ Intent åŒ…å«çš„ä¿¡æ¯ 12345678910Intent getHomeIntent() &#123; //mTopAction æ˜¯ android.intent.action.MAIN Intent intent = new Intent(mTopAction, mTopData != null ? Uri.parse(mTopData) : null); intent.setComponent(mTopComponent); intent.addFlags(Intent.FLAG_DEBUG_TRIAGED_MISSING); if (mFactoryTest != FactoryTest.FACTORY_TEST_LOW_LEVEL) &#123; intent.addCategory(Intent.CATEGORY_HOME); &#125; return intent;&#125; åœ¨ getHomeIntent ä¸­é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª Intent å¯¹è±¡ï¼Œç„¶åç»™è¿™ä¸ªå¯¹è±¡å¢åŠ äº†ä¸€ä¸ª categoryï¼Œcategory å¯¹åº”çš„ä¿¡æ¯æ˜¯ android.intent.category.HOMEï¼ŒæŸ¥æ‰¾ Lanucher3 çš„ AndroidManifest.xml å¯ä»¥çœ‹è§ 12345678910111213141516171819&lt;activity android:name="com.android.launcher3.Launcher" android:launchMode="singleTask" android:clearTaskOnLaunch="true" android:stateNotNeeded="true" android:theme="@style/Theme" android:windowSoftInputMode="adjustPan" android:screenOrientation="nosensor" android:configChanges="keyboard|keyboardHidden|navigation" android:resumeWhilePausing="true" android:taskAffinity="" android:enabled="true"&gt; &lt;intent-filter&gt; &lt;action android:name="android.intent.action.MAIN" /&gt; &lt;category android:name="android.intent.category.HOME" /&gt; &lt;category android:name="android.intent.category.DEFAULT" /&gt; &lt;category android:name="android.intent.category.MONKEY"/&gt; &lt;/intent-filter&gt;&lt;/activity&gt; è¿™è¯´æ˜å³å°†å¯åŠ¨çš„ Activity æ˜¯ com.android.launcher3.Launcherï¼Œç°åœ¨å›åˆ° startHomeActivityLocked æ–¹æ³•ä¸­ï¼Œç»§ç»­å¾€ä¸‹çœ‹å¯ä»¥çŸ¥é“åœ¨å¾—åˆ° Intent å¯¹è±¡ä¹‹åï¼Œæœ€åæ˜¯é€šè¿‡ ActivityStarter çš„ startHomeActivityLocked å¯åŠ¨äº† Launcherã€‚ä¹‹åçš„éƒ¨åˆ†ç”±äºæ¶‰åŠåˆ° Lanucher æºç å’Œ Activity å¯åŠ¨çš„ç»†è‡´æµç¨‹ï¼Œæ‰€ä»¥å°±æš‚æ—¶ä¸åšåˆ†æäº†ã€‚ æ€»ç»“ é€šè¿‡å››ç¯‡æ–‡ç« çš„åˆ†æå¯¹ç³»ç»Ÿå¯åŠ¨çš„è¿‡ç¨‹æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„äº†è§£ï¼Œä½†æ˜¯é™äºæ°´å¹³æœ‰é™ï¼Œæœ‰äº›éƒ¨åˆ†åˆ†æçš„æ¯”è¾ƒç²—ç³™ï¼Œå¸Œæœ›ä¹‹ååœ¨æ°´å¹³æå‡ä¹‹åèƒ½å¤Ÿå¯¹å„ä¸ªéƒ¨åˆ†è¿›è¡Œè¿›ä¸€æ­¥çš„å®Œå–„ï¼Œä¾‹å¦‚ï¼šBinderã€ActivityManagerServiceã€Acitvity çš„å¯åŠ¨è¿‡ç¨‹ç­‰ç­‰ã€‚ æœ€åå€Ÿç”¨ Gityuan Androidç³»ç»Ÿå¼€ç¯‡ä¸­çš„ä¸€å¼ å›¾ç‰‡è¯´æ˜ç³»ç»Ÿå¯åŠ¨çš„è¿‡ç¨‹ Thanks Androidç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼ˆå››ï¼‰Launcherå¯åŠ¨è¿‡ç¨‹ä¸ç³»ç»Ÿå¯åŠ¨æµç¨‹]]></content>
      <categories>
        <category>Androidè¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç™½è¯æ·±åº¦å­¦ä¹ -åŸºç¡€ç¯‡]]></title>
    <url>%2F2018%2F01%2F28%2F%E7%99%BD%E8%AF%9D%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%AF%87%2F</url>
    <content type="text"><![CDATA[æ”¶è· ã€Œç™½è¯æ·±åº¦å­¦ä¹ ä¸TensorFlowã€çš„åŸºç¡€ç¯‡ä¸»è¦å†…å®¹ä¸ºâ€œæœºå™¨å­¦ä¹ æ˜¯ä»€ä¹ˆâ€ã€â€œæ·±åº¦å­¦ä¹ æ˜¯ä»€ä¹ˆâ€ä»¥åŠâ€œTensorFlowâ€æ¡†æ¶ç‰¹æ€§ä¸å®‰è£…ï¼Œé€šè¿‡é˜…è¯»åŸºç¡€ç¯‡çš„å†…å®¹å¤§è‡´äº†è§£äº†ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„æ¦‚å¿µ æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„åŒºåˆ« æœºå™¨å­¦ä¹ çš„å¸¸ç”¨æ–¹æ³• å®‰è£…TensorFlowæ¡†æ¶ ç¬¬ä¸€ç«  æœºå™¨å­¦ä¹ æ˜¯ä»€ä¹ˆ æœºå™¨å­¦ä¹ æ˜¯äººç±»å®šä¹‰ä¸€å®šçš„è®¡ç®—æœºç®—æ³•ï¼Œè®©è®¡ç®—æœºæ ¹æ®è¾“å…¥çš„æ ·æœ¬å’Œä¸€äº›äººç±»çš„å¹²é¢„æ¥æ€»ç»“å¹¶å½’çº³å…¶ç‰¹å¾å’Œç‰¹ç‚¹ï¼Œå¹¶ç”¨è¿™äº›ç‰¹å¾å’Œç‰¹ç‚¹ä¸ä¸€å®šçš„å­¦ä¹ ç›®æ ‡å½¢æˆæ˜ å°„å…³ç³»ï¼Œè¿›è€Œè‡ªåŠ¨åŒ–åœ°åšå‡ºç›¸åº”ååº”çš„è¿‡ç¨‹ã€‚ æœºå™¨å­¦ä¹ çš„ç›®çš„ äººç±»å­¦ä¹ çš„ç›®çš„æ˜¯æŒæ¡çŸ¥è¯†ã€æŒæ¡èƒ½åŠ›ã€æŒæ¡æŠ€å·§ç„¶åæœ€ç»ˆèƒ½å¤Ÿè¿›è¡Œæ¯”è¾ƒå¤æ‚çš„æˆ–è€…é«˜è¦æ±‚çš„å·¥ä½œã€‚ç›¸ä¼¼çš„æœºå™¨å­¦ä¹ çš„æœ€ç»ˆç›®çš„åœ¨äºè®©è®¡ç®—æœºèƒ½å¤Ÿç‹¬ç«‹æˆ–è€…åŠç‹¬ç«‹çš„è¿›è¡Œç›¸å¯¹å¤æ‚æˆ–è€…é«˜è¦æ±‚çš„å·¥ä½œã€‚ æœºå™¨å­¦ä¹ ä¸éæœºå™¨å­¦ä¹ çš„åŒºåˆ«åœ¨äºè¿‡å»çš„è®¡ç®—æœºåœ¨ç¨‹åºç»™å®šçš„æƒ…å†µä¸‹ï¼Œå…¶è¡Œä¸ºé€»è¾‘å°±å·²ç»ç¡®å®šäº†ï¼Œè€Œæœºå™¨å­¦ä¹ åˆ™éœ€è¦é€šè¿‡æ ·æœ¬è¿›è¡Œç»Ÿè®¡å½’çº³ç„¶åæ‰ä¼šç¡®å®šå…¶è¡Œä¸ºé€»è¾‘ã€‚æ‰€ä»¥é€šè¿‡æœºå™¨å­¦ä¹ å¯ä»¥è¿›è¡Œç›¸ç‰‡è¯†åˆ«ä¿¡æ¯ã€æ–°é—»çš„è‡ªåŠ¨åˆ†ç±»ç­‰å·¥ä½œã€‚å› ä¸ºè®¡ç®—æœºäº‹å…ˆæ˜¯ä¸ä¼šçŸ¥é“éœ€è¦æå–çš„ä¿¡æ¯åœ¨ç»™å®šçš„ç›¸ç‰‡ä¸­æ‰€å…·å¤‡çš„ç‰¹å¾ï¼Œåªæœ‰é€šè¿‡æœºå™¨å­¦ä¹ ä¸æ–­çš„ç»Ÿè®¡å½’çº³æ‰èƒ½å¾—å‡ºé€‚åˆè¯†åˆ«å¤§å¤šæ•°ç›¸ç‰‡ä¸­æ‰€éœ€æå–çš„ä¿¡æ¯çš„æ¨¡å‹ã€‚ æœºå™¨å­¦ä¹ çš„åˆ†ç±» ä»å­¦ä¹ çš„ç§ç±»æ¥è¯´ï¼Œæœºå™¨å­¦ä¹ ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼šæœ‰ç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ æœ‰ç›‘ç£å­¦ä¹ æ˜¯æŒ‡å…ˆå¯¹ç»™äºˆçš„æ ·æœ¬è¿›è¡Œæ€»ç»“å¾—å‡ºåˆ†ç±»è§„åˆ™ï¼Œä¹‹åæ ¹æ®è¿™ä¸ªè§„åˆ™è¿›è¡Œåˆ†ç±»æ“ä½œï¼Œå¯¹äºæœ‰ç›‘ç£å­¦ä¹ è€Œè¨€åŸºæœ¬åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼š è®­ç»ƒ è®­ç»ƒçš„è¿‡ç¨‹ä¸»è¦æ˜¯æ‹¿ä¸€å®šå…·æœ‰æ ‡ç­¾çš„æ ·æœ¬è¿›è¡Œç»Ÿè®¡å’Œå½’çº³æ€»ç»“å‡ºä¸€ä¸ªæ¨¡å‹ éªŒè¯ éªŒè¯çš„è¿‡ç¨‹ä¸»è¦æ˜¯æ‹¿ä¸€äº›æœªåˆ†ç±»çš„æ ·æœ¬å¯¹è¿™ä¸ªæ¨¡å‹è¿›è¡ŒéªŒè¯ï¼Œåˆ¤æ–­å…¶æ˜¯å¦å…·æœ‰æ³›åŒ–æ€§(generalization)ã€‚ æµ‹è¯• æµ‹è¯•åˆ™æ˜¯ç”¨ä¸€å®šé‡çš„æ ·æœ¬åˆ¤æ–­æ¨¡å‹çš„è¯†åˆ«èƒ½åŠ› æ— ç›‘ç£å­¦ä¹ åˆ™æ˜¯åœ¨è·å¾—è®­ç»ƒçš„å‘é‡æ•°æ®ååœ¨æ²¡æœ‰æ ‡ç­¾çš„æƒ…å†µä¸‹å°è¯•æ‰¾å‡ºå…¶å†…éƒ¨è•´å«å…³ç³»çš„ä¸€ç§æŒ–æ˜å·¥ä½œã€‚ æœ‰ç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ çš„åŒºåˆ«åœ¨äºå‰è€…çš„è¾“å…¥æ•°æ®å…·æœ‰æ ‡ç­¾ï¼Œè€Œåè€…çš„è¾“å…¥æ•°æ®æ²¡æœ‰æ ‡ç­¾ æœºå™¨å­¦ä¹ çš„å¸¸ç”¨æ–¹æ³• èšç±» èšç±»æ˜¯æŒ‡å°†ç‰©ç†å¯¹è±¡æˆ–æŠ½è±¡å¯¹è±¡çš„é›†åˆåˆ†ç»„ä¸ºç”±å½¼æ­¤ç±»ä¼¼çš„å¯¹è±¡ç»„æˆå¤šä¸ªç±»çš„åˆ†æè¿‡ç¨‹ ç‰¹å¾å½¢æ€çš„ç›¸åŒæˆ–è¿‘ä¼¼çš„åˆ’åœ¨ä¸€ä¸ªæ¦‚å¿µä¸‹ï¼Œç‰¹å¾å½¢æ€ä¸åŒçš„åˆ’åœ¨ä¸åŒæ¦‚å¿µä¸‹ èšç±»å¸¸ç”¨çš„ç®—æ³•æœ‰ K-Meansã€DBSCAN ç­‰å‡ ç§ï¼Œå…¶åŸºæœ¬æ€è·¯éƒ½æ˜¯åˆ©ç”¨æ¯ä¸ªå‘é‡ä¹‹é—´çš„è·ç¦»ï¼Œä»è¿œè¿‘åˆ¤æ–­æ˜¯å¦ä»å±äºåŒä¸€ç±»åˆ«ã€‚ å›å½’ å›å½’æ˜¯ä¸€ä¸ªã€Œç”±æœç´¢å› ã€çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸€ç§å½’çº³çš„æ€æƒ³ï¼Œå½“æˆ‘ä»¬çœ‹åˆ°å¤§é‡çš„äº‹å®æ‰€å‘ˆç°çš„æ ·æ€å»æ¨æ–­åŸå› æˆ–å®¢è§‚è•´å«çš„å…³ç³»æ˜¯å¦‚ä½•çš„ã€‚ å›å½’çš„è®­ç»ƒè¿‡ç¨‹ä¸€èˆ¬å¦‚ä¸‹ï¼š æ ¹æ®è§‚å¯Ÿå’Œå½’çº³æ ·æœ¬ï¼ˆè®­ç»ƒé›†ï¼‰çš„ç»“æœæ¨æ–­å‘é‡å’Œæœ€ç»ˆçš„å‡½æ•°å€¼å‘ˆç°å¦‚ä¸‹æ˜ å°„å…³ç³» \[ y=f(x)=wx+b \] è¿™é‡Œçš„ \(w\) å’Œ \(x\) åˆ†åˆ«æ˜¯ \(1*n\) å’Œ \(n*1\) çš„çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯è¯´æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯æ±‚è§£ w å’Œ b ä»£å…¥æ ·æœ¬å€¼ï¼ˆéªŒè¯é›†ï¼‰å¾—åˆ°è¯¯å·®å’Œ \(Loss\) \[ Loss=\sum_{i=1}^n|wx_i+b-y_i| \] è¿™é‡Œçš„ \(wx_i+b\) æ˜¯æ ¹æ®ç¬¬ä¸€æ­¥æ¨æ–­å…³ç³»è®¡ç®—å‡ºçš„å€¼ï¼Œ\(y_i\) æ˜¯å®é™…è§‚æµ‹åˆ°çš„å€¼ï¼Œå°†æ‰€æœ‰æµ‹è¯•çš„è¯¯å·®ç›¸åŠ ä¹‹åå³å¯å¾—åˆ°æ€»çš„è¯¯å·®ï¼Œ\(Loss\) è¶Šå°åˆ™ä»£è¡¨æ˜ å°„å…³ç³»è¶Šç²¾ç¡® è¿™é‡Œä»¥çº¿æ€§å›å½’ä¸ºä¾‹ï¼Œè‡³äºéçº¿æ€§å›å½’è¿‡ç¨‹æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯æ˜ å°„å…³ç³»å’Œ \(Loss\) å‡½æ•°æœ‰äº›ä¸åŒã€‚ åˆ†ç±» åˆ†ç±»è¿™ä¸ªæ¦‚å¿µä¸€ç›´éƒ½å¾ˆç†Ÿæ‚‰ï¼Œå…·ä½“åˆ°æœºå™¨å­¦ä¹ å½“ä¸­åˆ™æ˜¯åˆ©ç”¨æˆ‘ä»¬ç¼–å†™çš„åˆ†ç±»å™¨å¯¹æ ·æœ¬è¿›è¡Œåˆ†ç±»ï¼Œè€Œåˆ¤æ–­è¿™ç§åˆ†ç±»å™¨æ˜¯å¦åˆç†çš„åŸåˆ™åœ¨äºå¬å›ç‡å’Œç²¾ç¡®ç‡è¿™ä¸¤ä¸ªæŒ‡æ ‡ å¬å›ç‡æ˜¯æ£€ç´¢å‡ºçš„ç›¸å…³æ ·æœ¬å’Œæ ·æœ¬åº“ä¸­æ‰€æœ‰çš„ç›¸å…³æ ·æœ¬çš„æ¯”ç‡ï¼Œè¡¡é‡çš„æ˜¯åˆ†ç±»å™¨çš„æŸ¥å…¨ç‡ ç²¾ç¡®ç‡æ˜¯æ£€ç´¢å‡ºçš„ç›¸å…³æ ·æœ¬æ•°ä¸æ£€ç´¢å‡ºæ ·æœ¬æ€»æ•°çš„æ¯”ç‡ï¼Œè¡¡é‡çš„æ˜¯åˆ†ç±»å™¨çš„æŸ¥å‡†ç‡ åˆ†ç±»çš„è®­ç»ƒè¿‡ç¨‹å’Œå›å½’çš„è®­ç»ƒè¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼š è¾“å…¥æ ·æœ¬å’Œåˆ†ç±»æ ‡ç­¾ å»ºç«‹æ˜ å°„å‡è¯´çš„æŸä¸ª\(y=f(x)\) æ±‚è§£å‡ºå…¨å±€çš„æŸå¤±å‡½æ•°\(Loss\)å’Œå¾…å®šç³»æ•°\(w\)çš„æ˜ å°„å…³ç³»ï¼Œ\(Loss=g(w)\) é€šè¿‡è¿­ä»£ä¼˜åŒ–é€æ­¥é™ä½\(Loss\)ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ª\(w\)èƒ½ä½¿å¬å›ç‡å’Œç²¾ç¡®ç‡æ»¡è¶³å½“å‰åœºæ™¯éœ€è¦ ç¬¬äºŒç«  æ·±åº¦å­¦ä¹ æ˜¯ä»€ä¹ˆ æ·±åº¦å­¦ä¹ æ˜¯æŒ‡åŸºäºæ·±åº¦ç¥ç»ç½‘ç»œã€Œdeep neural networksã€çš„å­¦ä¹ ï¼Œä¹Ÿå°±æ˜¯æ·±åº¦äººå·¥ç¥ç»ç½‘ç»œæ‰€è¿›è¡Œçš„å­¦ä¹ è¿‡ç¨‹ã€‚ æ·±åº¦ç¥ç»ç½‘ç»œçš„ç»„æˆ æ·±åº¦ç¥ç»ç½‘ç»œç”±å¤šä¸ªç¥ç»å…ƒç»„æˆï¼Œè€Œç¥ç»å…ƒæ˜¯äººç±»å—åˆ°ç”Ÿç‰©ç¥ç»ç»†èƒç»“æ„å¯å‘è€Œç ”ç©¶å‡ºçš„ä¸€ç§ç®—æ³•ä½“ç³»ï¼Œä¸€ä¸ªå®Œæ•´çš„ç¥ç»å…ƒç”±çº¿æ€§æ¨¡å‹å’Œæ¿€åŠ±å‡½æ•°ä¸¤éƒ¨åˆ†é¦–å°¾ç›¸æ¥ç»„æˆã€‚åŸºæœ¬æ¨¡å‹å¦‚ä¸‹ï¼šå…¶ä¸­\(wx+b\)æ˜¯çº¿æ€§æ¨¡å‹ï¼Œ\(\int\)è¡¨ç¤ºæ¿€åŠ±å‡½æ•° å¸¸è§çš„æ¿€åŠ±å‡½æ•°æœ‰å¦‚ä¸‹å‡ ç§ï¼š Sigmoid å‡½æ•° \[ f(x)={1 \over 1+e^{-(wx+b)}} \] Tanh å‡½æ•° \[ tanh(x)={e^x-e^{-x}\over e^x+e^{-x}} \] ReLu å‡½æ•° \[ y=max(x,0) \] Linear å‡½æ•° \[ f(x)=x \] å¯¹äºç¥ç»ç½‘ç»œè€Œè¨€ä¸»è¦åˆ†ä¸ºä¸‰å±‚ï¼šè¾“å…¥å±‚ (input layer)ã€éšè—å±‚ (hidden layer)ã€è¾“å‡ºå±‚ (output layer) è¾“å…¥å±‚ç›´æ¥æ¥æ”¶è¾“å…¥çš„å‘é‡ï¼Œä¸å¯¹æ•°æ®è¿›è¡Œä»»ä½•å¤„ç† éšè—å±‚å¯ä»¥æœ‰ä¸€å±‚æˆ–è€…å¤šå±‚ è¾“å‡ºå±‚æ˜¯æœ€åä¸€å±‚ï¼Œç”¨äºè¾“å‡ºæ•´ä¸ªç½‘ç»œå¤„ç†çš„å€¼ï¼Œè¿™ä¸ªå€¼å¯èƒ½æ˜¯ä¸€ä¸ªåˆ†ç±»å‘é‡å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç±»ä¼¼çº¿æ€§å›å½’äº§ç”Ÿçš„è¿ç»­çš„å€¼ æ·±åº¦å­¦ä¹ å’Œæœºå™¨å­¦ä¹ çš„åŒºåˆ« æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„å­é›†ï¼Œå½“æ·±åº¦å­¦ä¹ å’Œä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ çš„åŒºåˆ«åœ¨äºï¼Œä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ é€šå¸¸æ˜¯éœ€è¦äººæå‰è¿›è¡Œç‰¹å¾æå–ï¼ŒæŠŠæå–è¿‡çš„ç‰¹å¾å‘é‡åŒ–åå†ä¸¢ç»™æ¨¡å‹å»è®­ç»ƒï¼Œè¿™é‡Œäººè¦åšç›¸å½“çš„å‰ç½®å·¥ä½œã€‚è€Œæ·±åº¦å­¦ä¹ é€šå¸¸å¯ä»¥é‡‡ç”¨ End-to-End çš„å­¦ä¹ æ–¹å¼ï¼Œè¾“å…¥çš„å†…å®¹åªéœ€è¦åšå¾ˆå°‘çš„ä¸€äº›å½’ä¸€åŒ– (normalization)ã€ç™½åŒ– (whitening) ç­‰å¤„ç†å°±å¯ä»¥ä¸¢ç»™æ¨¡å‹å»è®­ç»ƒï¼Œé€šå¸¸ä¸éœ€è¦äººåšç‰¹å¾æå–çš„å·¥ä½œã€‚ ç¬¬ä¸‰ç«  å®‰è£… TensorFlow æ¡†æ¶ æœ¬æ¬¡å®‰è£…ç¯å¢ƒæ˜¯ macosã€Python3 å®‰è£… Anaconda åœ¨ Anaconda å®˜ç½‘ ä¸‹è½½ Python3.6 ç‰ˆæœ¬ pkg æ–‡ä»¶è¿›è¡Œå®‰è£… å»ºç«‹ TensorFlow è¿è¡Œç¯å¢ƒ 12conda create -n tensorflow python=3.6source activate tensorflow å®‰è£… TensorFlow 1pip3 install tensorflow æµ‹è¯• TensorFlow 12345678910&gt;&gt;&gt; import tensorflow as tf&gt;&gt;&gt; hello = tf.constant('Hello,TensorFlow!')&gt;&gt;&gt; sess = tf.Session()&gt;&gt;&gt; print(sess.run(hello))b'Hello,TensorFlow!'&gt;&gt;&gt; a = tf.constant(10)&gt;&gt;&gt; b = tf.constant(32)&gt;&gt;&gt; print(sess.run(a + b))42]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>ç™½è¯æ·±åº¦å­¦ä¹ ä¸TensorFlow</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidå¯åŠ¨è¿‡ç¨‹ç®€æï¼ˆä¸‰ï¼‰ä¹‹ SystemServer è¿›ç¨‹]]></title>
    <url>%2F2018%2F01%2F22%2FAndroid%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E7%AE%80%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨Androidå¯åŠ¨è¿‡ç¨‹ç®€æï¼ˆäºŒï¼‰ä¸­å·²ç»å¤§è‡´åˆ†æäº† zygote è¿›ç¨‹çš„å¯åŠ¨è¿‡ç¨‹å½“ä¸­æ‰€åšçš„ä¸»è¦å·¥ä½œï¼Œæœ¬ç¯‡å°†ç»§ç»­å¯¹ SystemServer çš„å¯åŠ¨è¿‡ç¨‹è¿›è¡Œåˆ†æã€‚ SystemServer å¯åŠ¨è¿‡ç¨‹ ä¸Šæ–‡è¯´åˆ° SystemServer è¿›ç¨‹åœ¨ ZygoteInit.java ä¸­è¢«åˆ›å»ºï¼Œç„¶åä¾¿ä¼šåœ¨ SystemServer è¿›ç¨‹è°ƒç”¨ handleSystemServerProcess æ–¹æ³•å¤„ç† SystemServer è¿›ç¨‹çš„å‰©ä½™å·¥ä½œ frameworks/base/core/java/com/android/internal/os/ZygoteInit.java 1234567891011121314151617181920212223242526272829303132333435private static void handleSystemServerProcess( ZygoteConnection.Arguments parsedArgs) throws ZygoteInit.MethodAndArgsCaller &#123; //SystemServer è¿›ç¨‹ä¸éœ€è¦è¿›è¡ŒSocketé€šä¿¡ï¼Œæ‰€ä»¥å…³é—­ closeServerSocket(); ... //è®¾ç½®è¿›ç¨‹åä¸ºsystem_server if (parsedArgs.niceName != null) &#123; Process.setArgV0(parsedArgs.niceName); &#125; final String systemServerClasspath = Os.getenv("SYSTEMSERVERCLASSPATH"); ... //è¿™é‡Œ parsedArgs.invokeWith ä¸º null if (parsedArgs.invokeWith != null) &#123; .... &#125; else &#123; ClassLoader cl = null; if (systemServerClasspath != null) &#123; //åˆ›å»º SystemServer çš„ç±»åŠ è½½å™¨å¯¹è±¡ cl = createSystemServerClassLoader(systemServerClasspath, parsedArgs.targetSdkVersion); Thread.currentThread().setContextClassLoader(cl); &#125; //å°†å‰©ä½™å‚æ•°ä¼ é€’ç»™ SystemServer RuntimeInit.zygoteInit(parsedArgs.targetSdkVersion, parsedArgs.remainingArgs, cl); &#125; /* should never reach here */&#125; åœ¨ handleSystemServerProcess æ–¹æ³•ä¸­é¦–å…ˆä¼šå…³é—­æ‰ Socket è¿æ¥ï¼Œç„¶åä¼šæ ¹æ®ä¼ é€’è¿‡æ¥çš„å‚æ•°è®¾ç½®è¿›ç¨‹åç§°ï¼Œåœ¨è®¾ç½®å®Œè¿›ç¨‹åç§°ä¹‹åï¼Œç”±äº parseArgs çš„æˆå‘˜ invokeWith ä¸º nullï¼Œæ‰€ä»¥ä¼šåˆ©ç”¨ systemServerClasspath åˆ›å»ºå¯¹åº”çš„ç±»åŠ è½½å™¨å¯¹è±¡ï¼Œæœ€åä¼šé€šè¿‡ RuntimeInit çš„ zygoteInit æ–¹æ³•å°†å‰©ä½™å‚æ•°ä¼ é€’ç»™ SystemServerã€‚ RuntimeInit åˆ†æ frameworks/base/core/java/com/android/internal/os/RuntimeInit.java 1234567891011public static final void zygoteInit(int targetSdkVersion, String[] argv, ClassLoader classLoader) throws ZygoteInit.MethodAndArgsCaller &#123; if (DEBUG) Slog.d(TAG, "RuntimeInit: Starting application from zygote"); Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, "RuntimeInit"); redirectLogStreams(); commonInit(); nativeZygoteInit(); applicationInit(targetSdkVersion, argv, classLoader);&#125; zygoteInit ä¸­ä¾æ¬¡è°ƒç”¨äº† nativeZygoteInit å’Œ applicationInitï¼Œå…¶ä¸­å‰è€…å¯åŠ¨äº†ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè€Œåè€…åˆ™ä¼šè°ƒç”¨äº† SystemServer ç±»çš„ main æ–¹æ³•ã€‚ å¯åŠ¨çº¿ç¨‹æ±  nativeZygoteInit å®é™…ä¸Šå¯¹åº”ç€ com_android_internal_os_RuntimeInit_nativeZygoteInit frameworks/base/core/jni/AndroidRuntime.cpp 1234567891011121314static const JNINativeMethod gMethods[] = &#123; &#123; "nativeFinishInit", "()V", (void*) com_android_internal_os_RuntimeInit_nativeFinishInit &#125;, &#123; "nativeZygoteInit", "()V", (void*) com_android_internal_os_RuntimeInit_nativeZygoteInit &#125;, &#123; "nativeSetExitWithoutCleanup", "(Z)V", (void*) com_android_internal_os_RuntimeInit_nativeSetExitWithoutCleanup &#125;,&#125;;int register_com_android_internal_os_RuntimeInit(JNIEnv* env)&#123; return jniRegisterNativeMethods(env, "com/android/internal/os/RuntimeInit", gMethods, NELEM(gMethods));&#125; ç»§ç»­æŸ¥çœ‹ com_android_internal_os_RuntimeInit_nativeZygoteInit å¯ä»¥çŸ¥é“æœ€ç»ˆè°ƒç”¨äº† gCurRuntime çš„ onZygoteInit æ–¹æ³•ï¼Œè€Œ gCurRuntime å®é™…ä¸Šæ˜¯ä¸€ä¸ª AndroidRuntime çš„æŒ‡é’ˆ 1234static void com_android_internal_os_RuntimeInit_nativeZygoteInit(JNIEnv* env, jobject clazz)&#123; gCurRuntime-&gt;onZygoteInit();&#125; onZygoteInit çš„å…·ä½“å®ç°åœ¨ AndroidRuntime çš„å­ç±» AppRuntime ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆé€šè¿‡ startThreadPool å¯åŠ¨äº†çº¿ç¨‹æ±  frameworks/base/cmds/app_process/app_main.cpp 123456virtual void onZygoteInit()&#123; sp&lt;ProcessState&gt; proc = ProcessState::self(); ALOGV("App process: starting thread pool.\n"); proc-&gt;startThreadPool();&#125; è°ƒç”¨ SystemServer çš„ main æ–¹æ³• frameworks/base/core/java/com/android/internal/os/RuntimeInit.java 1234567891011121314151617181920private static void applicationInit(int targetSdkVersion, String[] argv, ClassLoader classLoader) throws ZygoteInit.MethodAndArgsCaller &#123; ... //æ ¹æ® argv æ„å»º RuntimeInit.Argumentsï¼Œè¿™é‡Œçš„ argv[] å®é™…ä¸Šæ˜¯ â€œcom.android.server.SystemServerâ€ final Arguments args; try &#123; args = new Arguments(argv); &#125; catch (IllegalArgumentException ex) &#123; Slog.e(TAG, ex.getMessage()); // let the process exit return; &#125; // The end of of the RuntimeInit event (see #zygoteInit). Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER); // Remaining arguments are passed to the start class's static main invokeStaticMain(args.startClass, args.startArgs, classLoader);&#125; åœ¨ applicationInit æ–¹æ³•ä¸­ä¼šå¯¹ argv è¿›è¡Œè§£æåˆ›å»º RuntimeInit.Arguments å‚æ•°ï¼Œç„¶åä¼šè°ƒç”¨ invokeStaticMain 12345678910111213141516171819202122232425262728293031323334353637383940private static void invokeStaticMain(String className, String[] argv, ClassLoader classLoader) throws ZygoteInit.MethodAndArgsCaller &#123; Class&lt;?&gt; cl; try &#123; //è·å–SystemServerçš„Classå¯¹è±¡ cl = Class.forName(className, true, classLoader); &#125; catch (ClassNotFoundException ex) &#123; throw new RuntimeException( "Missing class when invoking static main " + className, ex); &#125; Method m; try &#123; //è·å– main æ–¹æ³• m = cl.getMethod("main", new Class[] &#123; String[].class &#125;); &#125; catch (NoSuchMethodException ex) &#123; throw new RuntimeException( "Missing static main on " + className, ex); &#125; catch (SecurityException ex) &#123; throw new RuntimeException( "Problem getting static main on " + className, ex); &#125; //è·å–æ–¹æ³•ä¿®é¥°ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯å…¥å£ main æ–¹æ³• int modifiers = m.getModifiers(); if (! (Modifier.isStatic(modifiers) &amp;&amp; Modifier.isPublic(modifiers))) &#123; throw new RuntimeException( "Main method is not public and static on " + className); &#125; /* * This throw gets caught in ZygoteInit.main(), which responds * by invoking the exception's run() method. This arrangement * clears up all the stack frames that were required in setting * up the process. */ throw new ZygoteInit.MethodAndArgsCaller(m, argv);&#125; åœ¨ invokeStaticMain æ–¹æ³•ä¸­ä¼šé€šè¿‡æ–¹æ³•ç­¾åè·å–åˆ° SystemServer çš„ main æ–¹æ³•ï¼Œä¹‹åä¼šæŠ›å‡º MethodAndArgsCaller å¼‚å¸¸ï¼Œç„¶ååœ¨ ZygoteInit çš„ main æ–¹æ³•ä¸­è¿›è¡Œæ•è·ï¼Œæ•è·ä¹‹åä¼šæ‰§è¡Œ MethodAndArgsCaller çš„ run æ–¹æ³•ï¼Œè€Œåœ¨ run æ–¹æ³•ä¸­ä¼šå®Œæˆå¯¹ SystemServer çš„ main æ–¹æ³•çš„è°ƒç”¨ 1234567891011121314151617181920212223242526//MethodAndArgsCaller çš„ run æ–¹æ³•public void run() &#123; try &#123; mMethod.invoke(null, new Object[] &#123; mArgs &#125;); &#125; catch (IllegalAccessException ex) &#123; throw new RuntimeException(ex); &#125; catch (InvocationTargetException ex) &#123; Throwable cause = ex.getCause(); if (cause instanceof RuntimeException) &#123; throw (RuntimeException) cause; &#125; else if (cause instanceof Error) &#123; throw (Error) cause; &#125; throw new RuntimeException(ex); &#125;&#125;//ZygoteInit æ•è·å¼‚å¸¸//frameworks/base/core/java/com/android/internal/os/ZygoteInit.javapublic static void main(String argv[]) &#123; ... &#125; catch (MethodAndArgsCaller caller) &#123; caller.run(); &#125; ....&#125; SystemServer åˆ†æ 123public static void main(String[] args) &#123; new SystemServer().run();&#125; SystemServer çš„ main æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ª SystemServer å¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†å…¶ run æ–¹æ³•ï¼Œæ‰€ä»¥ç»§ç»­çœ‹ run æ–¹æ³•éƒ¨åˆ† 123456789101112131415161718192021222324252627282930313233343536373839private void run() &#123; try &#123; ... //åˆ›å»º SystemServer ä¸»çº¿ç¨‹çš„ Looper Looper.prepareMainLooper(); // åˆå§‹åŒ– mSystemContext createSystemContext(); // åˆ›å»º SystemServiceManager å¯¹è±¡ mSystemServiceManager = new SystemServiceManager(mSystemContext); LocalServices.addService(SystemServiceManager.class, mSystemServiceManager); &#125; finally &#123; Trace.traceEnd(Trace.TRACE_TAG_SYSTEM_SERVER); &#125; // å¯åŠ¨æœåŠ¡ try &#123; Trace.traceBegin(Trace.TRACE_TAG_SYSTEM_SERVER, "StartServices"); startBootstrapServices(); startCoreServices(); startOtherServices(); &#125; catch (Throwable ex) &#123; Slog.e("System", "******************************************"); Slog.e("System", "************ Failure starting system services", ex); throw ex; &#125; finally &#123; Trace.traceEnd(Trace.TRACE_TAG_SYSTEM_SERVER); &#125; // For debug builds, log event loop stalls to dropbox for analysis. if (StrictMode.conditionallyEnableDebugLogging()) &#123; Slog.i(TAG, "Enabled StrictMode for system server main thread."); &#125; // Loop forever. Looper.loop(); throw new RuntimeException("Main thread loop unexpectedly exited");&#125; åœ¨ run æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè°ƒç”¨ Looper.prepareMainLooper() åˆ›å»ºäº†å½“å‰ä¸»çº¿ç¨‹çš„ Looperï¼Œä¹‹åä¼šè°ƒç”¨ createSystemContext åˆå§‹åŒ– mSystemContext å®ä¾‹ï¼Œè¿™é‡Œçš„ mSystemContext æ˜¯ä¸€ä¸ª ContextImpl å®ä¾‹ï¼Œä¸»è¦ç”¨äºåˆå§‹åŒ–ä¸€äº› Serviceï¼Œæœ€ååˆ™æ˜¯å¯åŠ¨ç³»ç»Ÿå„é¡¹æœåŠ¡ã€‚ å¯åŠ¨ç³»ç»ŸæœåŠ¡ ä»å¯åŠ¨æœåŠ¡çš„è¿‡ç¨‹ä¸­çœ‹ï¼Œç³»ç»Ÿå°†æœåŠ¡åˆ†ä¸ºä¸‰ç±»ï¼š å¼•å¯¼æœåŠ¡----------startBootstrapServices() Installerã€ActivityManagerServiceã€PackageManagerService ç­‰ æ ¸å¿ƒæœåŠ¡----------startCoreServices() BatteryServiceã€UsageStatsServiceã€WebViewUpdateService å…¶å®ƒæœåŠ¡----------startOtherServices() AlarmManagerServiceã€VibratorService ç­‰ è€Œå¯¹äºæœåŠ¡çš„å¯åŠ¨æ–¹å¼è€Œè¨€ä¹Ÿåˆ†ä¸ºä¸‰ç§ï¼ˆå¯åŠ¨æ–¹å¼ä¸æœåŠ¡ç±»åˆ«å¹¶ä¸å¯¹åº”ï¼‰ï¼š mSystemServiceManager.startService() 12345678910111213141516171819202122232425262728public &lt;T extends SystemService&gt; T startService(Class&lt;T&gt; serviceClass) &#123; try &#123; final String name = serviceClass.getName(); ... //åˆ›å»ºServiceå®ä¾‹ final T service; try &#123; Constructor&lt;T&gt; constructor = serviceClass.getConstructor(Context.class); service = constructor.newInstance(mContext); &#125; catch (InstantiationException ex) &#123; .... &#125; // åŠ å…¥ List&lt;SystemService&gt; å½“ä¸­ mServices.add(service); //å›è°ƒ Service çš„ onStart æ–¹æ³• try &#123; service.onStart(); &#125; catch (RuntimeException ex) &#123; throw new RuntimeException("Failed to start service " + name + ": onStart threw an exception", ex); &#125; return service; &#125; finally &#123; Trace.traceEnd(Trace.TRACE_TAG_SYSTEM_SERVER); &#125;&#125; ä»è¿™é‡Œå¯ä»¥çœ‹å‡º startService å¯åŠ¨çš„æœåŠ¡éƒ½æ˜¯ SystemService çš„å­ç±»ï¼Œå¯åŠ¨çš„è¿‡ç¨‹æ˜¯å…ˆå¯¹æœåŠ¡ç±»è¿›è¡ŒåŠ è½½ï¼ŒåŠ è½½ä¹‹åè¿›è¡Œå®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–ä¹‹ååˆ™ä¼šè°ƒç”¨å®ä¾‹çš„ onStart æ–¹æ³•ã€‚ xxxService.main() è¿™ç§æ–¹å¼ä¸»è¦åœ¨å¯åŠ¨ä»¥ä¸‹ä¸‰ä¸ªæœåŠ¡ä¸­ç”¨åˆ° PackageManagerService OtaDexoptService WindowManagerService è¿™é‡Œä»¥ PackageManagerService ä¸ºä¾‹è¿›è¡Œåˆ†æ 12345678910111213public static PackageManagerService main(Context context, Installer installer, boolean factoryTest, boolean onlyCore) &#123; // Self-check for initial settings. PackageManagerServiceCompilerMapping.checkProperties(); PackageManagerService m = new PackageManagerService(context, installer, factoryTest, onlyCore); m.enableSystemUserPackages(); //æ³¨å†Œå¯åŠ¨æœåŠ¡ ServiceManager.addService("package", m); return m;&#125; å¯ä»¥çœ‹åˆ°åœ¨ main æ–¹æ³•ä¸­ç›´æ¥åˆ›å»ºäº† PackageManagerService çš„å®ä¾‹ï¼Œç„¶åé€šè¿‡ ServiceManager è¿›è¡Œæ³¨å†Œå¯åŠ¨ã€‚ ServiceManager.addService() 1ServiceManager.addService("scheduling_policy", new SchedulingPolicyService()); ServiceManager æ¶‰åŠåˆ° Binder æš‚ä¸åšåˆ†æ ä¸Šæ–‡ä¸­æåˆ°äº†æœåŠ¡çš„æ³¨å†Œï¼Œå¯¹äºæœåŠ¡çš„æ³¨å†Œè€Œè¨€å®é™…ä¸Šåˆ†ä¸ºä¸¤ç§ï¼šä¸€æ˜¯ ServiceManager.addServiceï¼ŒäºŒæ˜¯ LocalServices.addService 12345678910111213141516171819202122232425262728293031/** * This class is used in a similar way as ServiceManager, except the services registered here * are not Binder objects and are only available in the same process. * * Once all services are converted to the SystemService interface, this class can be absorbed * into SystemServiceManager. * * &#123;@hide&#125; */public final class LocalServices &#123; private LocalServices() &#123;&#125; private static final ArrayMap&lt;Class&lt;?&gt;, Object&gt; sLocalServiceObjects = new ArrayMap&lt;Class&lt;?&gt;, Object&gt;(); ... /** * Adds a service instance of the specified interface to the global registry of local services. */ public static &lt;T&gt; void addService(Class&lt;T&gt; type, T service) &#123; synchronized (sLocalServiceObjects) &#123; if (sLocalServiceObjects.containsKey(type)) &#123; throw new IllegalStateException("Overriding service registration"); &#125; sLocalServiceObjects.put(type, service); &#125; &#125; ...&#125; æŸ¥çœ‹ LocalServices çš„ç±»æè¿°å¯ä»¥çŸ¥é“ LocalServices ä¸ ServiceManager ç”¨å¤„ç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºServiceManager ç”¨äºä¸åŒè¿›ç¨‹é—´è·å– Serviceï¼Œè€Œ LocalServices åªèƒ½å¤Ÿç”¨äºåŒä¸€è¿›ç¨‹ä¸­è·å– Serviceã€‚ æ€»ç»“ è‡³æ­¤å¤§æ¦‚å°±èƒ½çŸ¥é“åœ¨ SystemServer å¯åŠ¨è¿‡ç¨‹ä¸­ä¸»è¦åšäº†ä¸‰ä»¶äº‹ å¼€å¯çº¿ç¨‹æ±  åˆ›å»º SystemServerManager å¯¹è±¡è´Ÿè´£ç»§æ‰¿è‡ª SystemService çš„æœåŠ¡çš„åˆ›å»ºã€å¯åŠ¨ä»¥åŠç”Ÿå‘½å‘¨æœŸçš„ç®¡ç† å¯åŠ¨ç³»ç»Ÿçš„æœåŠ¡ Thanks Androidç³»ç»Ÿå¯åŠ¨-SystemServerä¸Šç¯‡ Androidç³»ç»Ÿå¯åŠ¨-SystemServerä¸‹ç¯‡ Androidç³»ç»ŸæœåŠ¡çš„æ³¨å†Œæ–¹å¼ Androidç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼ˆä¸‰ï¼‰è§£æSyetemServerè¿›ç¨‹å¯åŠ¨è¿‡ç¨‹]]></content>
      <categories>
        <category>Androidè¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaåŸºç¡€ä¹‹æ³¨è§£]]></title>
    <url>%2F2018%2F01%2F15%2FJava%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%B3%A8%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[é—®é¢˜ å…³äºæ³¨è§£é¦–å…ˆè¯·æ€è€ƒä¸€ä¸‹ä»¥ä¸‹é—®é¢˜ï¼š æ³¨è§£æ˜¯ä»€ä¹ˆï¼Ÿ æ³¨è§£çš„ä¸»è¦ä½¿ç”¨åœºæ™¯ï¼Ÿ æ³¨è§£å¯ä»¥åˆ†ä¸ºå“ªäº›ç±»å‹ï¼Ÿ æ³¨è§£çš„å¤„ç†è¿‡ç¨‹ï¼Ÿ æ¥ä¸‹æ¥æˆ‘ä»¬å°†å¯¹è¿™å‡ ä¸ªé—®é¢˜è¿›è¡Œæ¢è®¨ æ³¨è§£ç®€ä»‹ Annotations, a form of metadata, provide data about a program that is not part of the program itself. Annotations have no direct effect on the operation of the code they annotate. ä¸Šè¿°æ˜¯å®˜æ–¹ç»™å‡ºçš„å…³äºæ³¨è§£çš„å®šä¹‰ï¼Œå¤§è‡´æ„æ€æ˜¯æ³¨è§£æ˜¯å…ƒæ•°æ®ï¼ˆMetaDataï¼‰çš„ä¸€ç§å½¢å¼ï¼Œå®ƒç”¨äºæä¾›ä¸€äº›å’Œç¨‹åºå…ƒç´ æœ‰å…³çš„å…ƒæ•°æ®ï¼Œè¿™äº›æ•°æ®æœ¬èº«ä¸å±äºç¨‹åºï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šç›´æ¥å½±å“ç¨‹åºçš„æ“ä½œã€‚ ä¸ºäº†æ›´ç›´è§‚çš„ç†è§£æ³¨è§£çš„æ¦‚å¿µï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥äº†è§£å…ƒæ•°æ®è¿™ä¸ªæ¦‚å¿µï¼Œå…³äºå…ƒæ•°æ® Wiki ä¸Šçš„æè¿°å¦‚ä¸‹ï¼š Metadata is &quot;data [information] that provides information about other data&quot;ï¼ŒFor example, a digital image may include metadata that describes how large the picture is, the color depth, the image resolution, when the image was created, the shutter speed, and other data. å…ƒæ•°æ®æ˜¯æè¿°æ•°æ®çš„æ•°æ®ï¼Œå¯¹äºä¸€å¼ ç›¸ç‰‡è€Œè¨€å…ƒæ•°æ®åŒ…æ‹¬ç›¸ç‰‡çš„å¤§å°ã€è‰²å½©æ·±åº¦ã€å›¾ç‰‡çš„åˆ†è¾¨ç‡ã€å›¾ç‰‡å»ºç«‹æ—¶é—´ä»¥åŠå¿«é—¨é€Ÿåº¦ç­‰ç›¸å…³æ•°æ®ã€‚ ç»“åˆä¸¤è€…å¯ä»¥å¾—åˆ°ï¼šæ³¨è§£æ˜¯ä¸€ç§ç”¨äºæè¿°ç¨‹åºå…ƒç´ ä¿¡æ¯çš„ä¿®é¥°ç¬¦ï¼Œå¯ä»¥ç”¨æ¥ä¿®é¥°åŒ…ã€ç±»ã€æ„é€ å™¨ã€æ–¹æ³•ã€æˆå‘˜å˜é‡ã€å‚æ•°ã€å±€éƒ¨å˜é‡ã€‚ è¿™é‡Œå†ç»“åˆå…·ä½“çš„åœºæ™¯è¿›è¡Œç†è§£ï¼š 12@BindView(R.id.toolbar)public Toolbar mToolbar; å¯¹äºæˆå‘˜å˜é‡ mToolbar è€Œè¨€ï¼Œå…¶åŸºæœ¬çš„ä¿¡æ¯åŒ…å« widthã€heigthã€idï¼Œé€šè¿‡æ³¨è§£æˆ‘ä»¬èƒ½å¤Ÿå¾ˆæ˜ç¡®çš„æè¿°å®ƒçš„ id ä¿¡æ¯ã€‚ æ³¨è§£çš„ä¸»è¦ä½¿ç”¨åœºæ™¯ è¦æ˜ç™½æ³¨è§£çš„ä½¿ç”¨åœºæ™¯ï¼Œé¦–å…ˆéœ€è¦äº†è§£çš„æ˜¯æ³¨è§£çš„ä¸»è¦ä½œç”¨ï¼š Information for the compilerâ€” Annotations can be used by the compiler to detect errors or suppress warnings. Compile-time and deployment-time processingâ€” Software tools can process annotation information to generate code, XML files, and so forth. Runtime processingâ€” Some annotations are available to be examined at runtime. æ¥ä¸‹æ¥ä¸¾å‡ ä¸ªå¸¸è§çš„ä¾‹å­è¯´æ˜ï¼š ä¸ºç¼–è¯‘å™¨æä¾›ä¿¡æ¯ç”¨äºæ£€æµ‹é”™è¯¯æˆ–è€…æŠ‘åˆ¶è­¦å‘Š 12345@SuppressWarnings("unchecked")public void addItems(@NonNull String item) &#123; List list = new ArrayList(); list.add(item);&#125; ç¼–è¯‘æ—¶å’Œéƒ¨ç½²æ—¶é€šè¿‡å¯¹æ³¨è§£è¿›è¡Œå¤„ç†ç”Ÿæˆä»£ç ã€XML æ–‡ä»¶ç­‰ æ¯”è¾ƒå¸¸è§çš„å¦‚butterknifeï¼Œbutterknife èƒ½å¤Ÿé€šè¿‡æ³¨è§£è‡ªåŠ¨ç”Ÿæˆ findViewById çš„ä»£ç ï¼Œæœ‰åŠ©äºå‡è½»æ ·æ¿ä»£ç çš„è´Ÿæ‹…ã€‚ 12@BindView(R.id.toolbar)public Toolbar mToolbar; è¿è¡Œæ—¶é€šè¿‡æ³¨è§£è¿›è¡Œæ£€æŸ¥å¤„ç† åœ¨è¿è¡Œæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„æœºåˆ¶å¯¹æ³¨è§£æä¾›çš„ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼Œç„¶åå®ç°éœ€è¦çš„åŠŸèƒ½ã€‚ åœ¨æ˜ç¡®äº†æ³¨è§£çš„ä¸»è¦ä½œç”¨ä¹‹åï¼Œæ³¨è§£çš„ä½¿ç”¨åœºæ™¯å°±å·²ç»å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸ºç¨‹åºä¸­çš„å…ƒç´ æä¾›ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™äº›ä¿¡æ¯éœ€è¦å¾—åˆ°å¤„ç†çš„æ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨æ³¨è§£ã€‚ æ³¨è§£çš„åˆ†ç±» åŸºæœ¬æ³¨è§£ Java æä¾›äº† 5 ä¸ªåŸºæœ¬çš„ Annotation æ³¨è§£å ä½œç”¨ @Override é™å®šé‡å†™çˆ¶ç±»æ–¹æ³• @Deprecated è¡¨ç¤ºæŸä¸ªç¨‹åºå…ƒç´ å·²ç»è¿‡æ—¶ @SuppressWarnings æŠ‘åˆ¶ç¼–è¯‘å™¨çš„è­¦å‘Š @SafeVarargs æŠ‘åˆ¶å †æ±¡æŸ“è­¦å‘Š @FunctionalInterface æŒ‡å®šæŸä¸ªæ¥å£å¿…é¡»æ˜¯å‡½æ•°å¼æ¥å£ æ¥ä¸‹æ¥èŠèŠå®ƒä»¬çš„ä½¿ç”¨ Override 123456789101112public class FatherClass &#123; public void overridedMethod() &#123; &#125; &#125;public class BaseAnnotationUse extends FatherClass&#123; @Override public void overridedMethod() &#123; super.overridedMethod(); &#125;&#125; Overrideçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š å¸®åŠ©æ£€æŸ¥æ˜¯å¦æ­£ç¡®çš„å¤å†™äº†çˆ¶ç±»ä¸­çš„å·²æœ‰æ–¹æ³•ï¼ˆå¦‚æœä¸å°å¿ƒæ‹¼å†™é”™è¯¯æˆ–è€…æ–¹æ³•ç­¾åå¯¹ä¸ä¸Šè¢«è¦†ç›–çš„æ–¹æ³•ï¼Œç¼–è¾‘å™¨éƒ½ä¼šå‘å‡ºè­¦å‘Šä¿¡æ¯ï¼‰ è¡¨ç¤ºå½“å‰æ–¹æ³•å®šä¹‰å°†è¦†ç›–è¶…ç±»çš„æ–¹æ³•ã€‚ å¦‚æœæ²¡æœ‰æ­£ç¡®çš„å¤å†™çˆ¶ç±»ä¸­çš„æ–¹æ³•åˆ™ä¼šæç¤º Method does not override method from its superclassã€‚ Deprecated åœ¨ FatherClass å¢åŠ å¦‚ä¸‹æ–¹æ³•ï¼š 1234@Deprecatedpublic void deprecatedMethod() &#123;&#125; ç„¶ååœ¨ BaseAnnotationUse ä¸­å¢åŠ ï¼š 123public void useDeprecatedMethod() &#123; deprecatedMethod();&#125; è¿™ä¸ªæ—¶å€™å°†ä¼šçœ‹åˆ° deprecatedMethod() æ˜¾ç¤ºçº¢è‰²ï¼Œå¹¶ä¸”ç¼–è¾‘å™¨æç¤ºdeprecatedMethod() å·²ç»è¿‡æ—¶äº† SuppressWarning å¯¹ BaseAnnotationUse ä¸­çš„ useDeprecatedMethod æ–¹æ³•è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ 1234@SuppressWarnings("deprecation")public void useDeprecatedMethod() &#123; deprecatedMethod();&#125; é€šè¿‡å¢åŠ  SuppressWarning æŠ‘åˆ¶äº† Deprecated çš„è­¦å‘Šï¼ŒdeprecatedMethod() çš„çº¢è‰²å°†ä¼šæ¶ˆå¤± SafeVarargs 1234@SafeVarargspublic static void faultyMethod(List&lt;String&gt;... listStrArray) &#123; List[] listArray = listStrArray;&#125; å½“æŠŠä¸€ä¸ªä¸å¸¦æ³›å‹çš„å¯¹è±¡èµ‹ç»™ä¸€ä¸ªå¸¦æ³›å‹çš„å˜é‡çš„æ—¶å€™ï¼Œå¾€å¾€å°†ä¼šå¯¼è‡´â€å †æ±¡æŸ“â€œï¼Œæ‰€ä»¥åœ¨ Java 7 ä¸­å¢åŠ äº† SafeVarargs ç”¨äºæŠ‘åˆ¶å †æ±¡æŸ“çš„è­¦å‘Šï¼ŒSafeVarargs åªèƒ½ç”¨åœ¨å‚æ•°é•¿åº¦å¯å˜çš„æ–¹æ³•æˆ–æ„é€ æ–¹æ³•ä¸Šï¼Œä¸”æ–¹æ³•å¿…é¡»å£°æ˜ä¸ºstaticæˆ–finalï¼Œå¦åˆ™ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚ FunctionalInterface 1234@FunctionalInterfacepublic interface BaseInterface &#123; int add(int x, int y);&#125; FunctionalInterface æ˜¯ Java 8 ä¸“é—¨ä¸º Lambda è¡¨è¾¾å¼æ–°å¢çš„ï¼Œé€šè¿‡ FunctionalInterface å¯ä»¥é™åˆ¶æ¥å£ä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¦‚æœåœ¨ BaseInterface æ¥å£ä¸­æ–°å¢æŠ½è±¡æ–¹æ³•ï¼Œç¼–è¯‘æ—¶å°†ä¼šæç¤º BaseInterface ä¸æ˜¯å‡½æ•°å¼æ¥å£ã€‚ å…ƒæ³¨è§£ JDK åœ¨ java.lang.annotation ä¸­å†…ç½®äº† 6 ç§å…ƒæ³¨è§£ï¼Œé™¤äº† Native ä¹‹å¤–éƒ½ç”¨äºä¿®é¥°å…¶å®ƒçš„ Annotation å®šä¹‰ æ³¨è§£å ä½œç”¨ @Retention æŒ‡å®šè¢«ä¿®é¥°çš„æ³¨è§£çš„ä¿ç•™æ—¶é—´ @Target æŒ‡å®šè¢«ä¿®é¥°çš„æ³¨è§£å¯ä»¥ä¿®é¥°çš„ç¨‹åºå…ƒç´  @Documented æŒ‡å®šè¢«ä¿®é¥°çš„æ³¨è§£å¯ä»¥è¢« javadoc æå–æˆæ–‡æ¡£ @Inherited æŒ‡å®šè¢«ä¿®é¥°çš„æ³¨è§£å…·æœ‰ç»§æ‰¿æ€§ï¼Œå¦‚æœæŸä¸ªç±»ä½¿ç”¨äº†è¢« @Inherited ä¿®é¥°çš„æ³¨è§£ï¼Œé‚£ä¹ˆå…¶å­ç±»å°†è‡ªåŠ¨è¢«è¯¥æ³¨è§£ä¿®é¥° @Repeatable ç”¨äºå®šä¹‰é‡å¤æ³¨è§£ @Native è¡¨ç¤ºå®šä¹‰å¸¸é‡å€¼çš„å­—æ®µå¯ä»¥ä»æœ¬åœ°ä»£ç å¼•ç”¨ã€‚ æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»å‰äº”ç§ï¼Œ@Native å®åœ¨æ˜¯ä¸å¸¸ç”¨ Retention 12345678910@Documented@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.ANNOTATION_TYPE)public @interface Retention &#123; /** * Returns the retention policy. * @return the retention policy */ RetentionPolicy value();&#125; Retentionçš„å®šä¹‰å¦‚ä¸Šï¼Œå…¶æ‹¥æœ‰ä¸€ä¸ª RetentionPolicy ç±»å‹çš„æˆå‘˜å˜é‡ï¼ŒRetentionPolicy æ˜¯æšä¸¾ç±»ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæšä¸¾å€¼ï¼š RetentionPolicy.SOURCE æ³¨è§£åªèƒ½ä¿ç•™åœ¨æºæ–‡ä»¶å½“ä¸­ï¼Œç¼–è¯‘å™¨ä¸ä¼šç¼–è¯‘è¿™ç§æ³¨è§£ RetentionPolicy.CLASS æ³¨è§£èƒ½å¤Ÿä¿ç•™åœ¨ class æ–‡ä»¶å½“ä¸­ï¼Œä½†æ˜¯å½“ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼ŒJVM ä¸èƒ½å¤Ÿè·å–åˆ°æ³¨è§£ä¿¡æ¯ RetentionPolicy.RUNTIME æ³¨è§£èƒ½å¤Ÿä¿ç•™åœ¨ class æ–‡ä»¶å½“ä¸­ï¼Œç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼ŒJVM ä¹Ÿèƒ½å¤Ÿè·å–åˆ°æ³¨è§£ä¿¡æ¯ï¼Œç¨‹åºèƒ½å¤Ÿé€šè¿‡åå°„å»è·å–åˆ° Annotation ä¿¡æ¯ Target 123456789101112@Documented@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.ANNOTATION_TYPE)public @interface Target &#123; /** * Returns an array of the kinds of elements an annotation type * can be applied to. * @return an array of the kinds of elements an annotation type * can be applied to */ ElementType[] value();&#125; ElementType ä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œå…¶æšä¸¾å€¼å’Œæ„ä¹‰æ˜¯ï¼š ElementType.TYPE è¡¨æ˜æ³¨è§£å¯ä»¥ä¿®é¥°ç±»ã€æ¥å£æˆ–è€…æšä¸¾å®šä¹‰ ElementType.FIELD è¡¨æ˜æ³¨è§£å¯ä»¥ä¿®é¥°æˆå‘˜å˜é‡ ElementType.METHOD è¡¨æ˜æ³¨è§£å¯ä»¥ä¿®é¥°æ–¹æ³•å®šä¹‰ ElementType.PARAMETER è¡¨æ˜æ³¨è§£å¯ä»¥ä¿®é¥°å‚æ•° ElementType.CONSTRUCTOR è¡¨æ˜æ³¨è§£å¯ä»¥ä¿®é¥°æ„é€ å‡½æ•° ElementType.LOCAL_VARIABLE è¡¨æ˜æ³¨è§£å¯ä»¥ä¿®é¥°å±€éƒ¨å˜é‡ ElementType.ANNOTATION_TYPE è¡¨æ˜æ³¨è§£å¯ä»¥ä¿®é¥°æ³¨è§£ ElementType.PACKAGE è¡¨æ˜æ³¨è§£å¯ä»¥ä¿®é¥°åŒ…å®šä¹‰ ElementType.TYPE_PARAMETER è¡¨æ˜æ³¨è§£åªèƒ½å®šä¹‰ç¨‹åºå…ƒç´ çš„ä¿®é¥° ElementType.TYPE_USE è¡¨æ˜æ³¨è§£ä¸ä»…å¯ä»¥åœ¨å®šä¹‰ç¨‹åºå…ƒç´ çš„æ—¶å€™ä½¿ç”¨ï¼Œè¿˜å¯ä»¥åœ¨åˆ›å»ºå¯¹è±¡ã€ç±»å‹è½¬æ¢ã€ä½¿ç”¨ implements å®ç°æ¥å£ã€ä½¿ç”¨ throws å£°æ˜æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ä½¿ç”¨ Documented å¯¹äºä½¿ç”¨è¢« @Documented ä¿®é¥°çš„æ³¨è§£å’Œä¸å¸¦ @Documented ä¿®é¥°çš„æ³¨è§£ï¼Œå…¶åŒºåˆ«å¦‚ä¸‹ï¼š annotation_1 annotation_2 Inherited Inherited çš„ç»§æ‰¿ä½œç”¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¾‹å­æ¥ä½“ç°ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª Interitable æ³¨è§£ 12345@Retention(RetentionPolicy.CLASS)@Target(ElementType.TYPE)@Inheritedpublic @interface Inheritable &#123;&#125; ç„¶ååˆ›å»ºä¸€ä¸ªç”± Inheritable ä¿®é¥°çš„ Base ç±» 123@Inheritablepublic class Base &#123;&#125; æœ€ååˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª Base ç±»çš„ InheritableTest ç±» 1234567public class InheritableTest extends Base &#123; public static void main(String[] args) &#123; //åˆ¤æ–­æ˜¯å¦è¢« Inheritable æ³¨è§£ System.out.println(InheritableTest.class.isAnnotationPresent(Inheritable.class)); &#125;&#125; è¿è¡Œä¹‹åå¯ä»¥å‘ç°ç»“æœä¸º true Repeatable Repeatable æ˜¯ Java8 æ–°å¢çš„æ³¨è§£ï¼Œç”¨äºå®šä¹‰é‡å¤æ³¨è§£ï¼Œåœ¨ Java8 ä¹‹å‰çš„é‡å¤æ³¨è§£åªèƒ½å†™æˆä»¥ä¸‹å½¢å¼ 123456789@Infos(&#123;@Info(name = &quot;zhangsan&quot;), @Info(name = &quot;lisi&quot;)&#125;)private Person mPerson;public class Person &#123; private String mName; private int mAge; private int mHeight; private int mWeight;&#125; å…¶ä¸­ Info å’Œ Infos åˆ†åˆ«æ˜¯ 12345678910111213@Target(ElementType.FIELD)@Retention(RetentionPolicy.CLASS)public @interface Info &#123; String name();&#125;@Retention(RetentionPolicy.CLASS)@Target(ElementType.FIELD)public @interface Infos &#123; Info[] value();&#125; ç”±äº Infos ä¸­ä¿ç•™äº† Info çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ Infos çš„ä¿ç•™æ—¶é—´ä¸èƒ½æ¯” Info å°‘ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°†ä¼šæŠ¥é”™ã€‚å¦‚æœ Info çš„ä¿ç•™æ—¶é—´æ˜¯ RUNTIMEï¼Œè€Œ Infos çš„ä¿ç•™æ—¶é—´æ˜¯ SOURCEï¼Œé‚£ä¹ˆ JVM æœ€ç»ˆä¼šä¸¢å¼ƒ Infos ä»¥åŠ Infos ä¸­çš„ Info ä¿¡æ¯ï¼Œè¿™ä¸ Info æœŸæœ›çš„ä¿ç•™æ—¶é—´ç›¸çŸ›ç›¾ã€‚ è‡ªå®šä¹‰æ³¨è§£ JDK å†…ç½®çš„æ³¨è§£å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬è¿˜éœ€è¦å­¦ä¼šè‡ªå®šä¹‰æ³¨è§£ï¼Œå®šä¹‰ä¸€ä¸ªæ³¨è§£éœ€è¦ç”¨åˆ° @Interface å…³é”®å­— 12345678910111213141516171819@Target(ElementType.FIELD)@Retention(RetentionPolicy.RUNTIME)public @interface BindView &#123; /** * @return View çš„ Id */ int value();&#125;@Target(ElementType.FIELD)@Retention(RetentionPolicy.RUNTIME)public @interface BindOnClickListener &#123; /** * @return å®ç° OnClickListener æ¥å£çš„ç±» */ Class&lt;? extends OnClickListener&gt; value();&#125; ä¸Šé¢å®šä¹‰äº†ä¸¤ä¸ªæ³¨è§£ç”¨äºç»‘å®š View çš„ id ä»¥åŠ ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶ä¸”æŒ‡å®šäº†æ³¨è§£å¯ä»¥ä¿®é¥°çš„å…ƒç´ ä»¥åŠä¿ç•™æ—¶é—´ï¼Œå¯ä»¥çœ‹åˆ°å®šä¹‰ä¸€ä¸ªæ³¨è§£ä¸å®šä¹‰ä¸€ä¸ªæ¥å£éå¸¸ç±»ä¼¼ï¼Œè€Œå®é™…ä¸Šæ¯ä¸ªæ³¨è§£éƒ½æ˜¯ç»§æ‰¿è‡ª Annotation æ¥å£çš„æ¥å£ï¼Œåç¼–è¯‘ BindView ç”Ÿæˆçš„ class æ–‡ä»¶å¯ä»¥çœ‹åˆ° 1234Compiled from "BindView.java"public interface com.rookieyang.runtimeannotation.customizeannotation.BindView extends java.lang.annotation.Annotation &#123; public abstract int value();&#125; è¿™é‡Œè‡ªå®šä¹‰çš„æ³¨è§£éƒ½æ˜¯å«æœ‰æˆå‘˜å˜é‡çš„ï¼Œè€Œæ³¨è§£é™¤äº†æŒ‰ç…§åŸºæœ¬æ³¨è§£ã€å…ƒæ³¨è§£ã€è‡ªå®šä¹‰æ³¨è§£è¿›è¡Œåˆ†ç±»ä¹‹å¤–ï¼Œæˆ‘è¿˜å¯ä»¥æ ¹æ®æ˜¯å¦åŒ…å«æˆå‘˜å˜é‡å°†å®ƒåˆ†ä¸ºä¸¤ç±»ï¼š æ ‡è®°æ³¨è§£ï¼šè¿™ç§æ³¨è§£æ²¡æœ‰æˆå‘˜å˜é‡ï¼Œå®ƒä»…ä»…é€šè¿‡æ˜¯å¦å­˜åœ¨æ¥æä¾›ä¿¡æ¯ï¼Œå¦‚@Overrideã€@Deprecated å…ƒæ•°æ®æ³¨è§£ï¼šè¿™ç§æ³¨è§£åŒ…å«æˆå‘˜å˜é‡ï¼Œå®ƒé€šè¿‡æˆå‘˜å˜é‡æä¾›æ›´å¤šçš„ä¿¡æ¯ï¼Œå¦‚@Retentionã€@Target æ³¨è§£çš„å¤„ç† åœ¨ä½¿ç”¨è‡ªå®šä¹‰çš„æ³¨è§£çš„æ—¶å€™ï¼Œå¦‚æœä¸æä¾›æ³¨è§£çš„å¤„ç†å·¥å…·ï¼Œæ³¨è§£æ˜¯ä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆçš„ï¼Œæ³¨è§£çš„å¤„ç†æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯è¿è¡Œæ—¶å¤„ç†æ³¨è§£ï¼Œä¸€ç§æ˜¯ç¼–è¯‘æ—¶å¤„ç†æ³¨è§£ã€‚ è¿è¡Œæ—¶å¤„ç†æ³¨è§£ è¿è¡Œæ—¶å¤„ç†æ³¨è§£ä¸»è¦åˆ©ç”¨ Java çš„åå°„æœºåˆ¶ï¼Œæ¥ä¸‹æ¥å°†ç»“åˆå…·ä½“å®ä¾‹è¯´æ˜å¦‚ä½•é€šè¿‡åå°„å¤„ç†æ³¨è§£ã€‚ é¦–å…ˆåˆ©ç”¨è‡ªå®šä¹‰æ³¨è§£éƒ¨åˆ†å®šä¹‰çš„ä¸¤ä¸ªæ³¨è§£ BindView å’Œ BindOnClickListener å¯¹ View è¿›è¡Œæ³¨è§£ 123@BindView(R.id.hello_world)@BindOnClickListener(CustomizeOnClickListener.class)private Button mHelloWorld; ç„¶ååœ¨ Activity ä¸­å®šä¹‰ä¸€ä¸ª CustomizeOnClickListener å†…éƒ¨ç±» 12345678class CustomizeOnClickListener implements OnClickListener &#123; @Override public void onClick(View view) &#123; Toast.makeText(MainActivity.this, R.string.hello_world, Toast.LENGTH_SHORT).show(); &#125;&#125; æ¥ç€å®šä¹‰ä¸€ä¸ªå¤„ç†æ³¨è§£çš„ç±» 12345678910111213141516171819202122232425262728293031323334353637383940public class AnnotationProcess &#123; public static void process(Object obj) &#123; Field[] fields = obj.getClass().getDeclaredFields(); Activity activity; if (!(obj instanceof Activity)) &#123; throw new RuntimeException("ä¼ å…¥çš„å‚æ•°ä¸æ˜¯Activity"); &#125; activity = (Activity) obj; for (Field field : fields) &#123; try &#123; View view = null; field.setAccessible(true ); BindView bindView = field.getAnnotation(BindView.class); BindOnClickListener bindOnClickListener = field .getAnnotation(BindOnClickListener.class); //åˆ¤æ–­æ˜¯å¦æ˜¯ View boolean isView = View.class.isAssignableFrom(field.getType()); if (bindView != null &amp;&amp; isView) &#123; view = activity.findViewById(bindView.value()); //è®¾ç½® obj å¯¹è±¡å½“ä¸­çš„ field å€¼ä¸º view field.set(obj, view); &#125; if (bindOnClickListener != null &amp;&amp; isView &amp;&amp; view != null) &#123; Class&lt;? extends OnClickListener&gt; listener = bindOnClickListener.value(); //å®ä¾‹åŒ– CustomizeOnClickListener å†…éƒ¨ç±» OnClickListener onClickListener = listener.getConstructor( obj.getClass()).newInstance(activity); view.setOnClickListener(onClickListener); &#125; &#125; catch (Exception e) &#123; Log.i(obj.getClass().getSimpleName(), e.getMessage()); &#125; &#125; &#125;&#125; æœ€ååœ¨ Activity ä¸­è°ƒç”¨å³å¯ï¼š 1AnnotationProcess.process(this); ç¼–è¯‘æ—¶å¤„ç†æ³¨è§£ ç›¸å¯¹ä¸è¿è¡Œæ—¶åˆ©ç”¨åå°„å¤„ç†æ³¨è§£ä¼šæœ‰æ€§èƒ½æŸå¤±è€Œè¨€ï¼Œç¼–è¯‘æ—¶å¤„ç†æ³¨è§£åˆ©ç”¨ APTï¼ˆAnnotation Processing Toolï¼‰å¯¹æ³¨è§£è¿›è¡Œå¤„ç†ç„¶åç”Ÿæˆä»£ç ã€XML æ–‡ä»¶ï¼Œåˆ©ç”¨ APT å»å¤„ç†æ³¨è§£æ€§èƒ½æ›´å¥½ã€‚å‚ç…§ JDK æ–‡æ¡£ä¸­å¯¹äº Processor æ¥å£çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´çŸ¥é“æ³¨è§£å¤„ç†å™¨çš„å·¥ä½œæµç¨‹ If an existing Processor object is not being used, to create an instance of a processor the tool calls the no-arg constructor of the processor class. Next, the tool calls the init method with an appropriate ProcessingEnvironment. Afterwards, the tool calls getSupportedAnnotationTypes, getSupportedOptions, and getSupportedSourceVersion. These methods are only called once per run, not on each round. As appropriate, the tool calls the process method on the Processor object; a new Processor object is not created for each round. ç¼–è¯‘å·¥å…·å°†ä¼šé€šè¿‡æ³¨è§£å¤„ç†å™¨çš„æ— å‚æ„é€ å‡½æ•°å®ä¾‹åŒ–ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨å¯¹è±¡ï¼Œç„¶åè°ƒç”¨æ³¨è§£å¤„ç†å™¨çš„ init æ–¹æ³•å¹¶ä¼ å…¥ ProcessingEnvironmentï¼Œä¹‹ååˆ™è°ƒç”¨ getSupportedAnnotationTypesï¼ŒgetSupportedOptionså’ŒgetSupportedSourceVersionï¼Œæœ€åå°†ä¼šè°ƒç”¨ process æ–¹æ³•ã€‚ æ¥ä¸‹æ¥å°†è¯´æ˜å¦‚ä½•åˆ©ç”¨ APT ç”Ÿæˆä¸€ä¸ªç±»æ–‡ä»¶ç”¨äºæ˜¾ç¤º HelloWorldï¼š é¦–å…ˆéœ€è¦æ˜ç¡®å¸Œæœ›ç”Ÿæˆçš„ç±»æ–‡ä»¶ï¼š 123456789101112package com.rookieyang.myannotationtwo;import android.content.Context;import android.widget.Toast;public class MainActivity_HelloWorld &#123; public static void show(Context context) &#123; Toast.makeText(context, "HelloWorld", Toast.LENGTH_SHORT).show(); &#125;&#125; æƒ³è¦ç”Ÿæˆè¿™ä¸ªç±»æ–‡ä»¶éœ€è¦è·å–åˆ°ä¸¤ç‚¹ä¿¡æ¯ï¼šåŒ…åå’Œç±»åï¼Œé€šè¿‡åŒ…åå¯ä»¥ä½¿ç±»æ–‡ä»¶ç”Ÿæˆåœ¨ä½¿ç”¨æ³¨è§£çš„åŒ…ä¸‹ï¼Œä¾¿äºè§£ææ³¨è§£çš„æ—¶å€™åŠ è½½ç±»æ–‡ä»¶ï¼Œé€šè¿‡ç±»ååŠ ä¸Š &quot;_HelloWorld&quot; ç¡®ä¿ç”Ÿæˆçš„ç±»æ–‡ä»¶å”¯ä¸€å­˜åœ¨ï¼ŒåŒæ—¶ä¹Ÿè¾¾åˆ°äº†ä½¿ç”¨æ³¨è§£çš„ç±»å’Œç”Ÿæˆçš„ç±»ç»‘å®šçš„æ•ˆæœã€‚ æ¥ä¸‹æ¥éœ€è¦åˆ›å»ºä¸¤ä¸ª Moduleï¼Œå…¶ä¸­ä¸€ä¸ªå®šä¹‰äº†æ‰€æœ‰çš„æ³¨è§£ï¼Œå¦å¤–ä¸€ä¸ªå®šä¹‰äº† APTï¼Œä¹‹æ‰€ä»¥éœ€è¦å®šä¹‰ä¸¤ä¸ª Module çš„åŸå› ï¼Œå…¶ä¸€ä¸ºäº†è®©å·¥ç¨‹ç»“æ„æ›´æ¸…æ™°ï¼Œå¦ä¸€æ–¹é¢å®šä¹‰ APT éœ€è¦ç”¨åˆ° javax åŒ…ã€‚æ•´ä½“çš„å·¥ç¨‹ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¹‹åéœ€è¦ä¸º annotations-compiler å’Œ app æ¨¡å—å¼•å…¥ç›¸å…³ä¾èµ– 1234567annotations-compiler æ¨¡å—compile 'com.google.auto.service:auto-service:1.0-rc3'compile project(path: ':annotations')app æ¨¡å—compile project(path: ':annotations')annotationProcessor project(':annotations-compiler') å…¶ä¸­ auto-service çš„ä½œç”¨æ˜¯å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸‹åˆ—æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯å£°æ˜æ³¨è§£å¤„ç†å™¨ã€‚ annotationProcessor åˆ™æ˜¯ä¸ºæ¨¡å—æŒ‡å®šæ³¨è§£å¤„ç†å™¨ é…ç½®ä¹‹åé¦–å…ˆåœ¨ annotations æ¨¡å—å®šä¹‰ä¸€ä¸ª HelloWorld æ³¨è§£ 1234@Target(ElementType.FIELD)@Retention(RetentionPolicy.CLASS)public @interface HelloWorld &#123;&#125; ç„¶ååœ¨ annotations-compiler æ¨¡å—ç¼–å†™å¯¹åº”æ³¨è§£å¤„ç†å™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495//æ ‡è¯†ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨@AutoService(Processor.class)public class AnnotationsCompiler extends AbstractProcessor &#123; private Elements mElements; private Filer mFiler; private Messager mMessager; /* * ç”¨äºåˆå§‹åŒ– mElementsã€mFilerã€mMessager */ @Override public synchronized void init(ProcessingEnvironment processingEnvi) &#123; super.init(processingEnvi); mElements = processingEnvi.getElementUtils(); mFiler = processingEnvi.getFiler(); mMessager = processingEnvi.getMessager(); &#125; /** * * @param elements å®é™…ä¸Šä¼ å…¥çš„éƒ½æ˜¯ &#123;@link #getSupportedAnnotationTypes()&#125; * ä¸­æ”¯æŒçš„å¹¶ä¸”è¢«æ‰«æåˆ°ï¼ˆä½¿ç”¨è¿‡ï¼‰æ³¨è§£å…ƒç´ ï¼Œä¾‹å¦‚è¿™é‡Œè·å–åˆ°çš„ç±»å…ƒç´ å°±æ˜¯ HelloWorld æ³¨è§£ * @param roundEnvi ä¸€ä¸ªæ³¨è§£å¤„ç†å·¥å…·æ¡†æ¶ï¼Œé€šè¿‡å®ƒå¯ä»¥æŸ¥è¯¢åˆ°ä½¿ç”¨äº†æ³¨è§£çš„å…ƒç´  * @return è¿”å›å¤„ç†ç»“æœ */ @Override public boolean process(Set&lt;? extends TypeElement&gt; elements, RoundEnvironment roundEnvi) &#123; String packageName; String className; //è·å–ä½¿ç”¨äº† HelloWorld æ³¨è§£çš„å…ƒç´  for (Element element : roundEnvi.getElementsAnnotatedWith(HelloWorld.class)) &#123; //é€šè¿‡ Elements å»è·å–åŒ…å packageName = mElements.getPackageOf(element).toString(); //HelloWorld æ³¨è§£åªèƒ½è¢«ç”¨åœ¨æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥é€šè¿‡è·å–å¤–å±‚å…ƒç´ å°±å¯ä»¥è·å–åˆ°ä½¿ç”¨æ³¨è§£çš„å…ƒç´ æ‰€åœ¨çš„ç±» className = element.getEnclosingElement().getSimpleName() + "_HelloWorld"; try &#123; //é€šè¿‡ Filer æŒ‡å®šçš„è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ª java æºæ–‡ä»¶ï¼Œç„¶åå†™å…¥å¯¹åº”çš„ä»£ç  JavaFileObject javaFileObject = mFiler.createSourceFile( packageName + "." + className); Writer writer = javaFileObject.openWriter(); writer.write("package " + packageName + ";\n\n"); writer.write("import android.content.Context;\n"); writer.write("import android.widget.Toast;\n\n"); writer.write("public class " + className + " &#123;\n\n"); writer.write("\tpublic static void show(Context context) &#123;\n"); writer.write("\t\tToast.makeText(context," + " \"HelloWorld\", Toast.LENGTH_SHORT).show();\n"); writer.write("\t&#125;\n"); writer.write("\n&#125;"); writer.flush(); writer.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; return false; &#125; /** * * @return è¿”å›æ³¨è§£å¤„ç†å™¨æ”¯æŒçš„ Java ç‰ˆæœ¬ */ @Override public SourceVersion getSupportedSourceVersion() &#123; return SourceVersion.latestSupported(); &#125; /** * * @return è¿”å›æ³¨è§£å¤„ç†å™¨æ”¯æŒçš„æ³¨è§£é›†åˆ */ @Override public Set&lt;String&gt; getSupportedAnnotationTypes() &#123; Set&lt;String&gt; annotationTypes = new LinkedHashSet&lt;&gt;(); for (Class&lt;? extends Annotation&gt; annotation : getSupportedAnnotations()) &#123; annotationTypes.add(annotation.getCanonicalName()); &#125; return annotationTypes; &#125; /** * * @return è¿”å›æ”¯æŒçš„æ³¨è§£ç±»å‹é›†åˆ */ private Set&lt;Class&lt;? extends Annotation&gt;&gt; getSupportedAnnotations() &#123; Set&lt;Class&lt;? extends Annotation&gt;&gt; annotationSet = new LinkedHashSet&lt;&gt;(); annotationSet.add(HelloWorld.class); return annotationSet; &#125;&#125; æ¥ä¸‹æ¥è¯´ä¸‹å‡ ä¸ªæœ‰åŠ©äºç†è§£æ³¨è§£å¤„ç†å™¨çš„ç‚¹ï¼š Elements æ˜¯ä¸€ä¸ªè·å–ç¨‹åºå…ƒç´ ä¿¡æ¯çš„æ¥å£ï¼Œä¾‹å¦‚è·å–å…ƒç´ çš„åŒ…åã€åˆ¤æ–­æ˜¯å¦æ˜¯é‡å†™æ–¹æ³•ï¼Œä¾‹å¦‚ Filer åˆ™æ˜¯ä¸€ä¸ªæ”¯æŒé€šè¿‡æ³¨è§£å¤„ç†å™¨åˆ›å»ºæ–‡ä»¶çš„æ¥å£ï¼Œå¯ä»¥ç”¨äºåˆ›å»º Classæ–‡ä»¶ã€æºæ–‡ä»¶ã€èµ„æºæ–‡ä»¶ Messager åˆ™æ˜¯ä¸ºæ³¨è§£å¤„ç†å™¨æä¾›çš„è¾“å‡ºé”™è¯¯ä¿¡æ¯çš„æ¥å£ã€‚ Element ä¸ Elements åŒºåˆ«åœ¨äº Element æ˜¯è·å–å•ä¸ªç¨‹åºå…ƒç´ ä¿¡æ¯çš„æ¥å£ï¼Œè€Œ Elements å¯ä»¥è·å–æ•´ä¸ªç¨‹åºçš„å…ƒç´ ä¿¡æ¯ã€‚é™¤äº† Element ä¹‹å¤–ï¼Œä¸Šè¿°ç¨‹åºè¿˜å¯ä»¥çœ‹åˆ° TypeElementï¼Œè€Œ TypeElement æ˜¯ä¸€ä¸ªç»§æ‰¿äº† Element æ¥å£çš„æ¥å£ï¼Œç”¨äºè¡¨ç¤ºç±»å…ƒç´ ã€‚å®é™…ä¸Š JDK è¿˜æä¾›äº†å¾ˆå¤šç»§æ‰¿è‡ª Element çš„æ¥å£ç”¨äºè¡¨ç¤ºç¨‹åºä¸­çš„å„é¡¹å…ƒç´ ï¼Œå…·ä½“çš„ Element ç»§æ‰¿ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨ç¼–å†™å®Œæ³¨è§£å¤„ç†å™¨ä¹‹åï¼Œæœ€ååœ¨ App æ¨¡å—ä¸­ç¼–å†™å¯¹åº”çš„è°ƒç”¨ä»£ç å³å¯ 123456789101112private void show() &#123; try &#123; //è·å¾—ç”Ÿæˆçš„ç±»çš„ Class å¯¹è±¡ Class&lt;?&gt; helloClass = Class.forName(getPackageName() + "." + getClass().getSimpleName() + "_HelloWorld"); //åˆ©ç”¨åå°„å–å¾— show æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•å³å¯ Method showMethod = helloClass.getMethod("show", Context.class); showMethod.invoke(this, this); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125;&#125; å®é™…ä¸Šç¼–è¯‘æ—¶æ³¨è§£çš„æ•´ä¸ªå¤„ç†è¿‡ç¨‹æ˜¯åˆ©ç”¨æ³¨è§£å¤„ç†å™¨å¯¹ç¨‹åºä¸­ä½¿ç”¨äº†æ³¨è§£çš„å…ƒç´ è¿›è¡Œéå†ï¼Œä»å…ƒç´ ä¸­æå–æ‰€éœ€çš„ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆç±»æ–‡ä»¶ï¼Œæœ€ååœ¨ç¨‹åºä¸­åŠ è½½ç”Ÿæˆçš„ç±»å¹¶è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ã€‚ æœ€åç»™å‡ºæœ¬æ¬¡æµ‹è¯•çš„å·¥ç¨‹é“¾æ¥ Annotation æµ‹è¯• æ€»ç»“ æœ€åè®©æˆ‘ä»¬å›ç­”å¼€å§‹çš„å‡ ä¸ªé—®é¢˜ æ³¨è§£æ˜¯ä¸€ç§ç”¨äºæè¿°ç¨‹åºå…ƒç´ ä¿¡æ¯çš„ä¿®é¥°ç¬¦ï¼Œå¯ä»¥ç”¨æ¥ä¿®é¥°åŒ…ã€ç±»ã€æ„é€ å™¨ã€æ–¹æ³•ã€æˆå‘˜å˜é‡ã€å‚æ•°ã€å±€éƒ¨å˜é‡ã€‚ å½“æˆ‘ä»¬éœ€è¦ä¸ºç¨‹åºä¸­çš„å…ƒç´ æä¾›ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™äº›ä¿¡æ¯å¾—åˆ°å¤„ç†çš„æ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨æ³¨è§£ã€‚ æŒ‰ç…§ç³»ç»Ÿå†…ç½®çš„æ³¨è§£ï¼Œå¯ä»¥åˆ†ä¸ºåŸºæœ¬æ³¨è§£ã€å…ƒæ³¨è§£ã€è‡ªå®šä¹‰æ³¨è§£ã€‚æŒ‰ç…§æ˜¯å¦æœ‰æˆå‘˜å˜é‡å¯ä»¥åˆ†ä¸ºæ ‡è®°æ³¨è§£ã€å…ƒæ•°æ®æ³¨è§£ã€‚æŒ‰ç…§å¤„ç†æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸ºè¿è¡Œæ—¶æ³¨è§£ã€ç¼–è¯‘æ—¶æ³¨è§£ã€‚ æ³¨è§£çš„å¤„ç†è¿‡ç¨‹ä¸»è¦ä¸ºè¿è¡Œæ—¶é€šè¿‡åå°„å¤„ç†å’Œç¼–è¯‘æ—¶é€šè¿‡æ³¨è§£å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚ Thanks ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹ ã€Šç–¯ç‹‚ Java è®²ä¹‰ã€‹ Annotation Tutorials è‡ªå·±åŠ¨æ‰‹å®ç°Javaæ³¨è§£ï¼ˆJava Annotation in Actionï¼‰ æ³¨è§£å¤„ç†å™¨ï¼ˆAnnotation Processorï¼‰åŸç†ç®€æ Androidæ³¨è§£ä½¿ç”¨ä¹‹é€šè¿‡annotationProcessoræ³¨è§£ç”Ÿæˆä»£ç å®ç°è‡ªå·±çš„ButterKnifeæ¡†æ¶ Androidæ³¨è§£ä½¿ç”¨ä¹‹æ³¨è§£ç¼–è¯‘android-aptå¦‚ä½•åˆ‡æ¢åˆ°annotationProcessor]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>æ³¨è§£</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2017å¹´å¹´ç»ˆæ€»ç»“]]></title>
    <url>%2F2018%2F01%2F07%2F2018%E8%AE%A1%E5%88%92%2F</url>
    <content type="text"><![CDATA[2017 å¿«ç»“æŸäº†ï¼Œæ­£å¥½è¶è¿™ä¸ªæ—¶é—´å¯¹è¿‡å»ä¸€å¹´åšä¸ªæ€»ç»“ï¼Œè¿‡å»ä¸€å¹´ä¸ŠåŠå¹´çš„è¡¨ç°åº”è¯¥èƒ½æœ‰ 70 åˆ†ï¼Œæ¯•ç«Ÿåœ¨åšæ¯•è®¾æœŸé—´åŠ²å¤´è¶³ï¼Œè€Œä¸”ä¹Ÿå­¦ä¹ åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼Œè€Œå‚åŠ å·¥ä½œçš„ä¸‹åŠå¹´åˆ™ææ€•è¿ 30 åˆ†éƒ½ä¸åˆ°ã€‚å¤§è‡´åˆ†æäº†ä¸€ä¸‹é—®é¢˜æ‰€åœ¨ é—®é¢˜ ç¼ºä¹ä¸€ä¸ªæ˜ç¡®çš„å­¦ä¹ è·¯çº¿å’Œæ‰§è¡ŒåŠ› æ²¡æœ‰æ ¹æ®è‡ªèº«çš„å®é™…éœ€æ±‚åšä¸€ä¸ªè¯¦ç»†çš„è§„åˆ’ï¼Œå¹¶æ ¹æ®è§„åˆ’ä¸€æ­¥ä¸€æ­¥çš„æ‰å®æ¨è¿›å­¦ä¹ è®¡åˆ’ï¼Œåè€Œæ˜¯å„ä¸ªæ–¹é¢éƒ½æƒ³è¦è¿›è¡Œå­¦ä¹ ï¼Œå¼‚å¸¸çš„æ€¥åŠŸè¿‘åˆ©ï¼Œä»è€Œå¯¼è‡´èƒ½å¤Ÿæ·±å…¥çš„éƒ¨åˆ†æ¯”è¾ƒå°‘ å®è·µé—®é¢˜ å¯¹äºå®è·µè€Œè¨€ä¸€ä¸ªé—®é¢˜æ˜¯å¤ªè¿‡äºå°†é‡å¿ƒæ”¾åœ¨ UI æ•ˆæœä¸Šï¼Œå¹¶ä¸”åœ¨ä¸€äº›åŸç†æ€§çš„çŸ¥è¯†ç‚¹æ²¡æœ‰æŒæ¡çš„å¾ˆå¥½çš„æƒ…å†µä¸‹å¯¼è‡´åœ¨ UI æ–¹é¢æµªè´¹äº†å¾ˆå¤šæ—¶é—´ä¹Ÿæ¶ˆç£¨äº†å¤§éƒ¨åˆ†çš„ç²¾åŠ›ï¼Œæ‰€ä»¥å¯¼è‡´è‡ªå·±å®è·µè¿‡å°‘ åšå®¢çš„é—®é¢˜ åšå®¢ç»å¸¸æ–­æ–­ç»­ç»­ï¼Œé—®é¢˜åœ¨äºæ²¡æœ‰è§„åˆ’æ€§ï¼Œä¸è®ºæ˜¯è¦å†™çš„æ–‡ç« è¿˜æ˜¯æ–‡ç« æœ¬èº«çš„ç»“æ„éƒ½æ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„æ€è·¯ï¼Œæ‰€ä»¥ä»ä»¥å‰çš„åšå®¢å¯ä»¥çœ‹åˆ°æ‚ä¹±æ— ç«  æ–°çš„è§„åˆ’ åˆ¶å®šåˆç†å¯è¡Œçš„å­¦ä¹ è®¡åˆ’è¡¨ ç›®å‰å¤§è‡´æ€è·¯å¦‚ä¸‹ åˆ¶å®šå…³äºåŸºç¡€æ–¹é¢çš„è®¡åˆ’ï¼Œç›®å‰å¤§è‡´åˆ†ä¸ºï¼šJava åŸºç¡€ã€Android åŸºç¡€ã€æ•°æ®ç»“æ„å’Œç®—æ³•ã€ç½‘ç»œåè®®ã€è®¾è®¡æ¨¡å¼ã€è¯»ä¹¦ç¬”è®°ã€å¸¸ç”¨æ¡†æ¶ã€‚è®¡åˆ’éœ€è¦åœ¨æŒç»­æ›´æ–°çš„è¿‡ç¨‹ä¸­è¿›è¡Œç»†åŒ– ä»¥å‘¨ä¸ºå•ä½å°½å¯èƒ½è§£å†³ä¸€ä¸ªå¤§çš„çŸ¥è¯†ç‚¹ï¼Œå¹¶æ•´ç†æˆæ–‡ç« å‘è¡¨å‡ºå»ï¼ˆå¤šå¹³å°å¸Œæœ›æ¥å—åˆ«äººçš„æŒ‡æ­£ï¼‰ å…¶ä½™çš„å°çŸ¥è¯†ç‚¹å’Œè¿›é˜¶çŸ¥è¯†ç‚¹ä¼šå°†æ•´ç†åœ¨ Gitbook ä¸Š æœ€åéœ€è¦å¯¹ç¬”è®°å’Œæ–‡ç« è¿›è¡Œè‰¯å¥½çš„åˆ†ç±» å®è·µé—®é¢˜ ä»Šå¹´å¯èƒ½ä¼šå®Œæˆä¸¤ä¸ª APPï¼Œä¸€ä¸ªæ˜¯å…³äºå•è¯è®°å¿†çš„ï¼ˆä¹‹å‰ç•™ä¸‹çš„çƒ‚æ‘Šå­ï¼Œéœ€è¦è¿›è¡Œé‡æ„ï¼‰ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ç½‘ç»œå£çº¸çš„ï¼Œé™¤æ­¤ä¹‹å¤–å¸Œæœ›æ¯ä¸ªæ˜ŸæœŸèƒ½å®‰æ’åŠå¤©ç»™è‡ªå·±å•çº¯çš„ç¼–ç æ—¶é—´ï¼Œä¸»è¦æ˜¯å’Œè‡ªå·±åšçš„ APP ç›¸å…³æˆ–è€…æ¨¡ä»¿åˆ«äººçš„ Demo åšå®¢é—®é¢˜ ç›®å‰ä¸»è¦éœ€è¦è¿›è¡Œæ•´ç†ï¼Œä¹‹å‰çš„åšå®¢å·²ç»ä¿®æ­£äº†åˆ†ç±»ï¼Œåšå®¢çš„åˆ†ç±»å¤§è‡´ä¸æ•´ç†å‡ºæ¥çš„è®¡åˆ’è¡¨ç›¸å¯¹åº”ï¼Œåç»­å†™åšå®¢çš„æ—¶å€™å¸Œæœ›ç²¾ç›Šæ±‚ç²¾ï¼Œå…»æˆä¸€ä¸ªè‰¯å¥½çš„è¡Œæ–‡æ€è·¯ ä¸ç®¡å¦‚ä½•ï¼Œæ–°çš„ä¸€å¹´éœ€è¦ GO FIGHTINGï¼ 2018-3-4 æ›´æ–° å­¦ä¹ è®¡åˆ’]]></content>
      <categories>
        <category>æ–°å¹´è®¡åˆ’</category>
      </categories>
      <tags>
        <tag>æ–°å¹´è®¡åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android å¯åŠ¨è¿‡ç¨‹ç®€æï¼ˆäºŒï¼‰ä¹‹ zygote è¿›ç¨‹]]></title>
    <url>%2F2017%2F11%2F05%2FAndroid%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E7%AE%80%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨ Androidå¯åŠ¨è¿‡ç¨‹ç®€æï¼ˆä¸€ï¼‰ä¸­æˆ‘ä»¬å·²ç»åˆ†æè¿‡äº† init è¿›ç¨‹æ˜¯å¦‚ä½•è¢«å¯åŠ¨çš„ï¼Œæœ¬ç¯‡æ–‡ç« å°†ä¼šç»§ç»­åˆ†æ zygote å¯åŠ¨è¿‡ç¨‹ä»¥åŠä½œç”¨ã€‚ zygote å¯åŠ¨è¿‡ç¨‹ zygote è¿›ç¨‹åˆ›å»ºä¹‹åä¼šé¦–å…ˆè¿›å…¥åˆ° app_main.cpp çš„ main å‡½æ•°å½“ä¸­å»ï¼Œæ‰€ä»¥é¦–å…ˆå¯¹ app_main è¿›è¡Œåˆ†æ app_main åˆ†æ frameworks/base/cmds/app_process/app_main.cpp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192int main(int argc, char* const argv[])&#123; ... //åˆ›å»º AppRuntime å¯¹è±¡ AppRuntime runtime(argv[0], computeArgBlockSize(argc, argv)); ... // è§£æè¿è¡Œæ—¶å‚æ•°ï¼Œå½“é‡åˆ°æ— æ³•è¯†åˆ«çš„é€‰é¡¹æ—¶åœæ­¢ bool zygote = false; bool startSystemServer = false; bool application = false; String8 niceName; String8 className; ++i; // Skip unused "parent dir" argument. while (i &lt; argc) &#123; const char* arg = argv[i++]; //å¦‚æœä¼ å…¥çš„å‚æ•°æœ‰ â€--zygoteâ€œ åˆ™å°† zygote ç½®ä¸º true if (strcmp(arg, "--zygote") == 0) &#123; zygote = true; niceName = ZYGOTE_NICE_NAME; //å¦‚æœä¼ å…¥çš„å‚æ•°æœ‰ "--start-system-server" åˆ™å°† startSystemServer ç½®ä¸º true &#125; else if (strcmp(arg, "--start-system-server") == 0) &#123; startSystemServer = true; &#125; else if (strcmp(arg, "--application") == 0) &#123; application = true; &#125; else if (strncmp(arg, "--nice-name=", 12) == 0) &#123; niceName.setTo(arg + 12); &#125; else if (strncmp(arg, "--", 2) != 0) &#123; className.setTo(arg); break; &#125; else &#123; --i; break; &#125; &#125; Vector&lt;String8&gt; args; //é zygote æ¨¡å¼å¤„ç† if (!className.isEmpty()) &#123; // We're not in zygote mode, the only argument we need to pass // to RuntimeInit is the application argument. // // The Remainder of args get passed to startup class main(). Make // copies of them before we overwrite them with the process name. args.add(application ? String8("application") : String8("tool")); runtime.setClassNameAndArgs(className, argc - i, argv + i); &#125; else &#123; //zygote æ¨¡å¼ä¸‹çš„å¤„ç† maybeCreateDalvikCache(); //å¦‚æœ startSystemServer ä¸º true åˆ™å°† "start-system-server" æ·»åŠ åˆ° args if (startSystemServer) &#123; args.add(String8("start-system-server")); &#125; char prop[PROP_VALUE_MAX]; if (property_get(ABI_LIST_PROPERTY, prop, NULL) == 0) &#123; LOG_ALWAYS_FATAL("app_process: Unable to determine ABI list from property %s.", ABI_LIST_PROPERTY); return 11; &#125; String8 abiFlag("--abi-list="); abiFlag.append(prop); args.add(abiFlag); // In zygote mode, pass all remaining arguments to the zygote // main() method. for (; i &lt; argc; ++i) &#123; args.add(String8(argv[i])); &#125; &#125; if (!niceName.isEmpty()) &#123; runtime.setArgv0(niceName.string()); set_process_name(niceName.string()); &#125; //å¦‚æœ zygote ä¸º true åˆ™å¯åŠ¨ zygote if (zygote) &#123; //é€šè¿‡ runtime å¯¹è±¡å¯åŠ¨ zygote runtime.start("com.android.internal.os.ZygoteInit", args, zygote); &#125; else if (className) &#123; runtime.start("com.android.internal.os.RuntimeInit", args, zygote); &#125; else &#123; fprintf(stderr, "Error: no class name or --zygote supplied.\n"); app_usage(); LOG_ALWAYS_FATAL("app_process: no class name or --zygote supplied."); return 10; &#125;&#125; å¯ä»¥çœ‹åˆ°åœ¨ main å‡½æ•°ä¸­é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª AppRuntime å¯¹è±¡ï¼Œç„¶åå°±ä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°å¯¹ä¸€äº›æ ‡å¿—ä½è¿›è¡Œç›¸åº”çš„ç½®ä½ï¼Œè¿™é‡Œå€¼å¾—æ³¨æ„çš„ä¸€ä¸ªæ ‡å¿—ä½æ˜¯ startSystemServerï¼Œä¸Šæ–‡è¯´è¿‡ Android 5.0 ä¹‹åç³»ç»Ÿå¯èƒ½ä¼šå¯åŠ¨ä¸¤ä¸ª zygote è¿›ç¨‹ï¼Œè€Œ SystemServer åªéœ€è¦å¯åŠ¨ä¸€æ¬¡ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªæ ‡å¿—ä½æ§åˆ¶åªåœ¨å¯åŠ¨ä¸» zygote è¿›ç¨‹çš„æ—¶å€™å°† &quot;start-system-server&quot; å¢åŠ åˆ° argsï¼Œç„¶ååˆ™ä¼šé€šè¿‡ AppRuntime çš„ start å‡½æ•°è°ƒç”¨ Java å±‚çš„ zygote ä»£ç ã€‚ AndroidRuntime åˆ†æ ç”±äº AppRuntime ç»§æ‰¿è‡ª AndroidRuntimeï¼Œæ‰€ä»¥æƒ³è¦äº†è§£ç³»ç»Ÿæ˜¯å¦‚ä½•è°ƒç”¨ Java å±‚çš„ zygote ä»£ç åˆ™éœ€è¦ç»§ç»­äº†è§£ AndroidRuntime çš„ start å‡½æ•° 1class AppRuntime : public AndroidRuntime AndroidRuntime ä½äº frameworks/base/core/jni 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106/* * Start the Android runtime. This involves starting the virtual machine * and calling the "static void main(String[] args)" method in the class * named by "className". * * Passes the main function two arguments, the class name and the specified * options string. */void AndroidRuntime::start(const char* className, const Vector&lt;String8&gt;&amp; options, bool zygote)&#123; ... static const String8 startSystemServer("start-system-server"); /* * 'startSystemServer == true' means runtime is obsolete and not run from * init.rc anymore, so we print out the boot start event here. */ for (size_t i = 0; i &lt; options.size(); ++i) &#123; //åªæœ‰ startSystemServer == trueï¼Œoptions æ‰ä¼šæœ‰ start-system-server if (options[i] == startSystemServer) &#123; /* track our progress through the boot sequence */ const int LOG_BOOT_PROGRESS_START = 3000; LOG_EVENT_LONG(LOG_BOOT_PROGRESS_START, ns2ms(systemTime(SYSTEM_TIME_MONOTONIC))); &#125; &#125; ... //const char* kernelHack = getenv("LD_ASSUME_KERNEL"); //ALOGD("Found LD_ASSUME_KERNEL='%s'\n", kernelHack); /* start the virtual machine */ JniInvocation jni_invocation; jni_invocation.Init(NULL); JNIEnv* env; //åˆ›å»ºå¯åŠ¨ DVM if (startVm(&amp;mJavaVM, &amp;env, zygote) != 0) &#123; return; &#125; onVmCreated(env); /* * Register android functions. */ //æ³¨å†Œ JNI æ–¹æ³• if (startReg(env) &lt; 0) &#123; ALOGE("Unable to register all android natives\n"); return; &#125; /* * We want to call main() with a String array with arguments in it. * At present we have two arguments, the class name and an option string. * Create an array to hold them. */ //å°† options è½¬åŒ–ä¸º java ä¸­çš„ String æ•°ç»„ jclass stringClass; jobjectArray strArray; jstring classNameStr; stringClass = env-&gt;FindClass("java/lang/String"); assert(stringClass != NULL); //åˆ›å»ºå¯¹è±¡æ•°ç»„ï¼Œç±»å‹ä¸º stringClassï¼ˆå³ String ç±»å‹ï¼‰ï¼Œé•¿åº¦ä¸º options.size() + 1 strArray = env-&gt;NewObjectArray(options.size() + 1, stringClass, NULL); assert(strArray != NULL); classNameStr = env-&gt;NewStringUTF(className); assert(classNameStr != NULL); env-&gt;SetObjectArrayElement(strArray, 0, classNameStr); //å°† options é€ä¸ªå¢åŠ åˆ°å¯¹è±¡æ•°ç»„å½“ä¸­ for (size_t i = 0; i &lt; options.size(); ++i) &#123; jstring optionsStr = env-&gt;NewStringUTF(options.itemAt(i).string()); assert(optionsStr != NULL); env-&gt;SetObjectArrayElement(strArray, i + 1, optionsStr); &#125; /* * Start VM. This thread becomes the main thread of the VM, and will * not return until the VM exits. */ char* slashClassName = toSlashClassName(className); //å¯»æ‰¾ç±»åä¸º slashClassName çš„ç±» jclass startClass = env-&gt;FindClass(slashClassName); if (startClass == NULL) &#123; ALOGE("JavaVM unable to locate class '%s'\n", slashClassName); /* keep going */ &#125; else &#123; //æŸ¥æ‰¾ main æ–¹æ³•ï¼Œ([Ljava/lang/String;)V æ˜¯ main æ–¹æ³•çš„ç­¾å jmethodID startMeth = env-&gt;GetStaticMethodID(startClass, "main", "([Ljava/lang/String;)V"); if (startMeth == NULL) &#123; ALOGE("JavaVM unable to find main() in '%s'\n", className); /* keep going */ &#125; else &#123; //è°ƒç”¨ startClass ç±»å½“ä¸­çš„ main æ–¹æ³•ï¼Œä¼ å…¥å‚æ•° strArray env-&gt;CallStaticVoidMethod(startClass, startMeth, strArray);#if 0 if (env-&gt;ExceptionCheck()) threadExitUncaughtException(env);#endif &#125; &#125; ...&#125; é€šè¿‡ start å‡½æ•°çš„æ³¨é‡Šæˆ‘ä»¬å¯ä»¥å¤§è‡´äº†è§£åˆ° start å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯å¯åŠ¨è™šæ‹Ÿæœºå’Œåä¸º classname çš„ main æ–¹æ³•ã€‚ è€Œä¸Šæ–‡å¯ä»¥çŸ¥é“ï¼Œä¼ å…¥çš„ classname æ˜¯ &quot;com.android.internal.os.ZygoteInit&quot; ã€‚é‚£ä¹ˆæ•´ä¸ªçš„æ‰§è¡Œæµç¨‹å°±æ˜¯ï¼š é¦–å…ˆä¼šåˆ¤æ–­ä¼ é€’è¿›æ¥çš„å‚æ•°æ˜¯å¦å­˜åœ¨ &quot;start-system-server&quot; ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¼šè¾“å‡ºå¯åŠ¨æ—¥å¿—ï¼Œç„¶åä¼šé€šè¿‡ startVm å‡½æ•°åˆ›å»ºå¯åŠ¨ DVMï¼Œåœ¨å¯åŠ¨ DVM ä¹‹åä¼šé€šè¿‡ startReg å‡½æ•°æ³¨å†Œ JNI æ–¹æ³•ï¼Œåœ¨æ³¨å†Œå®Œæ¯•ä¹‹åä¼šå°†ä¼ å…¥çš„ options å‚æ•°è½¬æ¢ä¸º Java çš„å¯¹è±¡æ•°ç»„ï¼Œè€Œä¹‹æ‰€ä»¥éœ€è¦è½¬æ¢æˆå¯¹è±¡æ•°ç»„æ˜¯å› ä¸ºåœ¨äº options éœ€è¦ä½œä¸º main æ–¹æ³•çš„å‚æ•°ä¼ å…¥ï¼Œä¹‹åå†é€šè¿‡ä¼ å…¥çš„ className å»è·å¾— jclass å¯¹è±¡ï¼Œå¹¶æ ¹æ® main æ–¹æ³•çš„ JNI ç­¾åå¾—åˆ° jmethodIDï¼Œæœ€ç»ˆé€šè¿‡CallStaticVoidMethod æ–¹æ³•å®Œæˆ main æ–¹æ³•çš„è°ƒç”¨ã€‚ ZygoteInit åˆ†æ frameworks/base/core/java/com/android/internal/os 1234567891011121314151617181920212223242526272829303132public static void main(String argv[]) &#123; ... String socketName = "zygote"; ... try &#123; ... //æ³¨å†Œ socket registerZygoteSocket(socketName); ... //é¢„åŠ è½½ç±»å’Œèµ„æº preload(); ... if (startSystemServer) &#123; //åˆ›å»º SystemServer è¿›ç¨‹ startSystemServer(abiList, socketName); &#125; ... //ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ runSelectLoop(abiList); ... closeServerSocket(); &#125; catch (MethodAndArgsCaller caller) &#123; caller.run(); &#125; catch (RuntimeException ex) &#123; Log.e(TAG, "Zygote died with exception", ex); closeServerSocket(); throw ex; &#125;&#125; æ•´ä¸ª main æ–¹æ³•çš„æ‰§è¡Œæµç¨‹æ˜¯ï¼šé¦–å…ˆé€šè¿‡ registerZygoteSocket æ–¹æ³•å¯¹ socket è¿›è¡Œäº†æ³¨å†Œï¼Œæ³¨å†Œçš„ socket ç”¨äºå’Œ ActivityManagerService è¿›è¡Œé€šä¿¡ï¼Œç„¶åè°ƒç”¨ preload æ–¹æ³•å¯¹ç±»å’Œèµ„æºè¿›è¡ŒåŠ è½½ï¼Œä¹‹ååˆ™ä¼šè°ƒç”¨ startSystemServer åˆ›å»º SystemServer è¿›ç¨‹ï¼Œæœ€åé€šè¿‡ runSelectLoop ç­‰å¾…æ¥è‡ª ActivityManagerService çš„è¯·æ±‚ã€‚ è¿™é‡Œæœ€ä¸ºå…³é”®çš„æ˜¯ socket ä»¥åŠåˆ›å»º SystemServer è¿›ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥äº†è§£è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚ æ³¨å†Œ Socket è¿‡ç¨‹ é¦–å…ˆæ˜¯æ³¨å†Œ Socket éƒ¨åˆ†ï¼Œ registerZygoteSocket ä¸»è¦æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦åˆ›å»ºäº†ä¸€ä¸ª LocalServerSocket å¯¹è±¡ 1234567891011121314151617181920212223private static void registerZygoteSocket(String socketName) &#123; if (sServerSocket == null) &#123; int fileDesc; //socket åä¸º ANDROID_SOCKET_zygote final String fullSocketName = ANDROID_SOCKET_PREFIX + socketName; try &#123; String env = System.getenv(fullSocketName); fileDesc = Integer.parseInt(env); &#125; catch (RuntimeException ex) &#123; throw new RuntimeException(fullSocketName + " unset or invalid", ex); &#125; try &#123; FileDescriptor fd = new FileDescriptor(); fd.setInt$(fileDesc); //åˆ›å»º LocalServerSockt sServerSocket = new LocalServerSocket(fd); &#125; catch (IOException ex) &#123; throw new RuntimeException( "Error binding to local socket '" + fileDesc + "'", ex); &#125; &#125;&#125; å¯åŠ¨ SystemServer startSystemServer ä¸»è¦å·¥ä½œæ˜¯å¯¹è®¾ç½®çš„å‚æ•°è¿›è¡Œè§£æï¼Œç„¶åé€šè¿‡ forkSystemServer åˆ›å»º SystemServer è¿›ç¨‹ï¼Œæœ€ååœ¨ SystemServer è¿›ç¨‹ä¸­è°ƒç”¨ handleSystemServerProcess æ–¹æ³•å¤„ç†å‰©ä½™å·¥ä½œ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152private static boolean startSystemServer(String abiList, String socketName) throws MethodAndArgsCaller, RuntimeException &#123;... /* Hardcoded command line to start the system server */ //è®¾ç½® uid ä¸º 1000,è®¾ç½® gid ä¸º 1000ï¼Œå¯åŠ¨ com.android.server.SystemServer String args[] = &#123; "--setuid=1000", "--setgid=1000", /// M: ANR mechanism for system_server add shell(2000) group to access /// /sys/kernel/debug/tracing/tracing_on "--setgroups=1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1018,1021,1032,2000," + "3001,3002,3003,3006,3007,3009,3010", "--capabilities=" + capabilities + "," + capabilities, "--nice-name=system_server", "--runtime-args", "com.android.server.SystemServer", &#125;; ZygoteConnection.Arguments parsedArgs = null; int pid; try &#123; //å¯¹ args è¿›è¡Œè§£æ parsedArgs = new ZygoteConnection.Arguments(args); ZygoteConnection.applyDebuggerSystemProperty(parsedArgs); ZygoteConnection.applyInvokeWithSystemProperty(parsedArgs); /* Request to fork the system server process */ //åˆ›å»º SystemServer è¿›ç¨‹ pid = Zygote.forkSystemServer( parsedArgs.uid, parsedArgs.gid, parsedArgs.gids, parsedArgs.debugFlags, null, parsedArgs.permittedCapabilities, parsedArgs.effectiveCapabilities); &#125; catch (IllegalArgumentException ex) &#123; throw new RuntimeException(ex); &#125; /* For child process */ if (pid == 0) &#123; if (hasSecondZygote(abiList)) &#123; waitForSecondaryZygote(socketName); &#125; //å¤„ç† SystemServer è¿›ç¨‹å‰©ä½™å·¥ä½œ handleSystemServerProcess(parsedArgs); &#125; return true;&#125; ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ runSelectLoop çš„ä¸»è¦å·¥ä½œæ˜¯é€šè¿‡ ZygoteConnection çš„ acceptCommandPeer æ–¹æ³•ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åè°ƒç”¨ runOnce æ–¹æ³•å¯¹æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839private static void runSelectLoop(String abiList) throws MethodAndArgsCaller &#123; ArrayList&lt;FileDescriptor&gt; fds = new ArrayList&lt;FileDescriptor&gt;(); ArrayList&lt;ZygoteConnection&gt; peers = new ArrayList&lt;ZygoteConnection&gt;(); fds.add(sServerSocket.getFileDescriptor()); peers.add(null); //å¾ªç¯å¤„ç†è¿æ¥è¯·æ±‚ while (true) &#123; StructPollfd[] pollFds = new StructPollfd[fds.size()]; for (int i = 0; i &lt; pollFds.length; ++i) &#123; pollFds[i] = new StructPollfd(); pollFds[i].fd = fds.get(i); pollFds[i].events = (short) POLLIN; &#125; try &#123; Os.poll(pollFds, -1);//æ— é™ç­‰å¾…èƒ½å¤Ÿè¿›è¡Œ I/O æ“ä½œ &#125; catch (ErrnoException ex) &#123; throw new RuntimeException("poll failed", ex); &#125; for (int i = pollFds.length - 1; i &gt;= 0; --i) &#123; //è¯´æ˜æ²¡æœ‰æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚æˆ–æ•°æ®å¤„ç†è¯·æ±‚ if ((pollFds[i].revents &amp; POLLIN) == 0) &#123; continue; &#125; if (i == 0) &#123;//å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ ZygoteConnection newPeer = acceptCommandPeer(abiList); peers.add(newPeer); fds.add(newPeer.getFileDesciptor()); &#125; else &#123; boolean done = peers.get(i).runOnce();//å¤„ç†å®¢æˆ·ç«¯æ•°æ®å¤„ç†è¯·æ±‚ï¼Œåˆ›å»ºå¯¹åº”çš„è¿›ç¨‹ if (done) &#123;//å¤„ç†å®Œæ¯•åˆ™è¿›è¡Œç§»é™¤ peers.remove(i); fds.remove(i); &#125; &#125; &#125; &#125;&#125; å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ å¯¹äº runOnce è€Œè¨€ä¸»è¦åšçš„å·¥ä½œæ˜¯ä»è¿æ¥ä¸­è¯»å–å‚æ•°ï¼Œç„¶åæ ¹æ®å‚æ•°åˆ›å»ºç›¸åº”çš„è¿›ç¨‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263boolean runOnce() throws ZygoteInit.MethodAndArgsCaller &#123; String args[]; Arguments parsedArgs = null; ... try &#123; args = readArgumentList();//è¯»å–å‚æ•° descriptors = mSocket.getAncillaryFileDescriptors(); &#125; catch (IOException ex) &#123; Log.w(TAG, "IOException on command socket " + ex.getMessage()); closeSocket(); return true; &#125; if (args == null) &#123; // EOF reached. closeSocket(); return true; &#125; ... try &#123; parsedArgs = new Arguments(args);//æ„é€  Arguments å¯¹è±¡ ... //åˆ›å»ºè¿›ç¨‹ pid = Zygote.forkAndSpecialize(parsedArgs.uid, parsedArgs.gid, parsedArgs.gids, parsedArgs.debugFlags, rlimits, parsedArgs.mountExternal, parsedArgs.seInfo, parsedArgs.niceName, fdsToClose, parsedArgs.instructionSet, parsedArgs.appDataDir); &#125; catch (ErrnoException ex) &#123; logAndPrintError(newStderr, "Exception creating pipe", ex); &#125; catch (IllegalArgumentException ex) &#123; logAndPrintError(newStderr, "Invalid zygote arguments", ex); &#125; catch (ZygoteSecurityException ex) &#123; logAndPrintError(newStderr, "Zygote security policy prevents request: ", ex); &#125; try &#123; if (pid == 0) &#123; // in child IoUtils.closeQuietly(serverPipeFd); serverPipeFd = null; //è¿›å…¥å­è¿›ç¨‹çš„å¤„ç†æµç¨‹ handleChildProc(parsedArgs, descriptors, childPipeFd, newStderr); // should never get here, the child is expected to either // throw ZygoteInit.MethodAndArgsCaller or exec(). return true; &#125; else &#123; // in parent...pid of &lt; 0 means failure IoUtils.closeQuietly(childPipeFd); childPipeFd = null; return handleParentProc(pid, descriptors, serverPipeFd, parsedArgs); &#125; &#125; finally &#123; IoUtils.closeQuietly(childPipeFd); IoUtils.closeQuietly(serverPipeFd); &#125;&#125; æ€»ç»“ åˆ°è¿™é‡Œæˆ‘ä»¬å¤§è‡´èƒ½å¤ŸçŸ¥æ™“ Zygote è¿›ç¨‹çš„å¯åŠ¨è¿‡ç¨‹å’Œä¸»è¦ä½œç”¨äº†ï¼š ç³»ç»Ÿåœ¨å¯åŠ¨ Zygote çš„è¿‡ç¨‹ä¸­é¦–å…ˆå¯åŠ¨äº†è™šæ‹Ÿæœºï¼Œç„¶åé€šè¿‡ JNI è°ƒç”¨äº† ZygoteInit ä¸­çš„ main æ–¹æ³•ï¼Œç”±æ­¤ç³»ç»Ÿä» C++ çš„ FrameWork å±‚åˆ°äº† Java çš„ FrameWork å±‚ï¼Œä¹‹ååœ¨åˆ™æ³¨å†Œäº†ç”¨äºå’Œ ActvityManagerService é€šä¿¡çš„ Socketï¼Œå®Œæˆæ³¨å†Œä¹‹ååˆ™ä¼šè°ƒç”¨ startSystemServer å¯åŠ¨ SystemServer è¿›ç¨‹ï¼Œæœ€å Zygote è¿›ç¨‹å°†ä¼šé€šè¿‡ runSelectLoop å¯¹æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¿›è¡Œç›‘å¬ã€‚ æ€»çš„æ¥è¯´ Zygote çš„ä¸»è¦ä½œç”¨å¯åŠ¨ SystemServer è¿›ç¨‹ä»¥åŠæ ¹æ®å®¢æˆ·ç«¯çš„è¿æ¥åˆ›å»ºç›¸åº”çš„è¿›ç¨‹ã€‚ Thanks Androidç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼ˆäºŒï¼‰è§£æZygoteè¿›ç¨‹å¯åŠ¨è¿‡ç¨‹ Androidç³»ç»Ÿå¯åŠ¨-zygoteç¯‡]]></content>
      <categories>
        <category>Androidè¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android å¯åŠ¨è¿‡ç¨‹ç®€æï¼ˆä¸€ï¼‰ä¹‹ init è¿›ç¨‹]]></title>
    <url>%2F2017%2F10%2F28%2FAndroid%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E7%AE%80%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[é—®é¢˜ åœ¨è¿›å…¥åˆ° Android å¯åŠ¨è¿‡ç¨‹ä¹‹å‰å…ˆè®©æˆ‘ä»¬æ€è€ƒä»¥ä¸‹å‡ ä¸ªé—®é¢˜ 1. Android ç³»ç»Ÿçš„å¯åŠ¨è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ 2. init ã€zygote è¿›ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ç³»ç»Ÿå¯åŠ¨çš„è¿‡ç¨‹ä¸­å„è‡ªå‘æŒ¥äº†ä»€ä¹ˆä½œç”¨ï¼Ÿ 3. AMSã€PMS ç­‰è¿™äº›æœåŠ¡æ˜¯å¦‚ä½•è¢«å¯åŠ¨çš„ï¼Ÿ 4. Launcher æ˜¯å¦‚ä½•è¢«å¯åŠ¨çš„ï¼Ÿ æ­¤ç¯‡æ–‡ç« å°†é’ˆå¯¹ init éƒ¨åˆ†ç»™å‡ºåˆ†æ å¯åŠ¨æµç¨‹ç®€è¿° åœ¨äº†è§£ init éƒ¨åˆ†ä¹‹å‰ï¼Œé¦–å…ˆç®€å•ä»‹ç»ä¸‹ç³»ç»Ÿçš„å¯åŠ¨æµç¨‹ä»¥ä¾¿æŠ“ä½ä¸»çº¿ï¼Œå½“æˆ‘ä»¬é€šè¿‡ç”µæºé”®å¼€å¯ç³»ç»Ÿçš„æ—¶å€™ï¼Œç³»ç»Ÿé¦–å…ˆä¼šåŠ è½½ bootloader ç¨‹åºåˆ° RAM ä¸­ï¼Œç„¶åé€šè¿‡ bootloader å°†å†…æ ¸ç¨‹åºåŠ è½½åˆ° RAM ä¸­ï¼Œä¹‹åå†…æ ¸ç¨‹åºä¼šåˆ›å»ºinit è¿›ç¨‹ï¼Œåœ¨ init è¿›ç¨‹ä¸­ä¼šåˆ›å»º zygote è¿›ç¨‹ï¼Œè€Œ zygote è¿›ç¨‹åˆ™ä¼šåˆ›å»º DVM å¹¶ä¸”å¯åŠ¨ SystemServer è¿›ç¨‹ï¼Œé€šè¿‡SystemServer ç³»ç»Ÿä¼šå¯åŠ¨ä¸€ç³»åˆ—çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å¸¸è§çš„ AMSã€PMS ç­‰ï¼Œæœ€åå†é€šè¿‡ AMS è¿›å…¥åˆ°æˆ‘ä»¬ç†ŸçŸ¥çš„ Launcher ç¨‹åºã€‚ æ‰€ä»¥æ•´ä¸ªæµç¨‹çš„å…³é”®ç‚¹åœ¨äº init è¿›ç¨‹å¦‚ä½•åˆ›å»º zygoteã€zygote è¿›ç¨‹å¦‚ä½•åˆ›å»º SystemServerã€SystemServer è¿›ç¨‹å¦‚ä½•å¯åŠ¨ AMSã€AMS å¦‚ä½•å¯åŠ¨ Launcherã€‚ init å¯åŠ¨æµç¨‹åˆ†æ ç”±äº bootloader å’Œå†…æ ¸ä¸æ˜¯å…³å¿ƒçš„é‡ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»å®ƒä»¬çš„ä½œç”¨ã€‚ åŠ è½½è¿è¡Œ BootLoader åœ¨ç”µæºä¸Šç”µä¹‹åï¼ŒCPU ä¸­çš„æ“ä½œæ§åˆ¶å™¨å°†å‘å‡ºæ§åˆ¶ä¿¡å·ï¼Œå°†ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰çš„å†…å®¹é€è‡³åœ°å€å¯„å­˜å™¨ï¼ˆARï¼‰ï¼Œä¹‹åå¯åŠ¨å¯¹ä¸»å­˜çš„è¯»æ“ä½œï¼Œæœ€ç»ˆå°† BootLoader åŠ è½½åˆ° RAM å½“ä¸­ã€‚ç„¶å BootLoader å¼€å§‹æ‰§è¡Œï¼Œä¸»è¦è´Ÿè´£ç¡¬ä»¶çš„åˆå§‹åŒ–ï¼Œå°†å†…æ ¸ç¨‹åºåŠ è½½åˆ°å†…å­˜ã€‚ init è¿›ç¨‹çš„å¯åŠ¨ å†…æ ¸å¯åŠ¨ä¹‹åå°†ä¼šåˆå§‹åŒ–è½¯ç¡¬ä»¶ç¯å¢ƒï¼ŒåŠ è½½é©±åŠ¨ç¨‹åºï¼ŒæŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œç„¶ååˆ›å»º init è¿›ç¨‹ï¼Œinit ä½œä¸ºç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ï¼Œå…¶è¿›ç¨‹å·ä¸º 1ï¼Œåœ¨åˆ›å»º init è¿›ç¨‹ä¹‹æ—¶ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œä½äº system/core/init ä¸‹çš„ init.cpp ç¨‹åº 123456789101112131415161718192021222324252627282930313233343536int main(int argc, char** argv) &#123; ... //åˆ›å»ºç”¨æˆ·ç©ºé—´ç›®å½•å¹¶æŒ‚è½½ if (is_first_stage) &#123; mount("tmpfs", "/dev", "tmpfs", MS_NOSUID, "mode=0755"); mkdir("/dev/pts", 0755); mkdir("/dev/socket", 0755); mount("devpts", "/dev/pts", "devpts", 0, NULL); #define MAKE_STR(x) __STRING(x) mount("proc", "/proc", "proc", 0, "hidepid=2,gid=" MAKE_STR(AID_READPROC)); mount("sysfs", "/sys", "sysfs", 0, NULL); &#125; ... signal_handler_init(); property_load_boot_defaults(); export_oem_lock_status(); //å¯åŠ¨å±æ€§æœåŠ¡ start_property_service(); ... const BuiltinFunctionMap function_map; Action::set_function_map(&amp;function_map); Parser&amp; parser = Parser::GetInstance(); parser.AddSectionParser("service",std::make_unique&lt;ServiceParser&gt;()); parser.AddSectionParser("on", std::make_unique&lt;ActionParser&gt;()); parser.AddSectionParser("import", std::make_unique&lt;ImportParser&gt;()); //è§£æ init.rc æ–‡ä»¶ parser.ParseConfig("/init.rc"); ... return 0;&#125; å¯ä»¥çœ‹åˆ° init è¿›ç¨‹ä¸»è¦åšäº†ä¸‰ä»¶äº‹æƒ…ï¼šåˆ›å»ºç”¨æˆ·ç©ºé—´æ–‡ä»¶å¤¹å¹¶æŒ‚è½½ã€å¯åŠ¨å±æ€§æœåŠ¡ã€è§£æä½äº systemæ–‡ä»¶å¤¹ä¸‹çš„ init.rc æ–‡ä»¶ã€‚ è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨è§£æ init.rc æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œå› ä¸º zygote è¿›ç¨‹å°±æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åˆ›å»ºçš„ã€‚ Android Init Language ç”±äº init.rc æ˜¯ä¸€ä¸ªç”¨ Android åˆå§‹åŒ–è¯­è¨€ï¼ˆAILï¼‰ç¼–å†™çš„æ–‡ä»¶ï¼Œä¸ºäº†æ›´å¥½çš„ç†è§£ rc æ–‡ä»¶çš„è§£æè¿‡ç¨‹éœ€è¦äº†è§£ä¸€éƒ¨åˆ† AIL è¯­æ³•ã€‚ AIL ä¸»è¦æœ‰äº”ç§ç±»å‹è¯­å¥ Actionsã€Commandsã€Servicesã€Optionsã€Importsï¼Œåœ¨ AIL ä¸­æ¯ä¸ªéƒ¨åˆ†(è¯­å¥å—)è¡¨ç¤ºä¸ºä¸€ä¸ª Sectionï¼Œæ¯”å¦‚ï¼š 1234on boot ifup lo hostname localhost domainname localdomain äº”ç§è¯­å¥ä¸­åªæœ‰ Actionsã€Servicesã€Import å¯ä»¥ç”¨äºç¡®å®šä¸€ä¸ª Sectionã€‚å…¶ä¸­ Actions ç”±ä¸€ç³»åˆ— command ç»„æˆï¼ŒActions æ‹¥æœ‰ä¸€ä¸ª trigger ç”¨äºç¡®å®šä½•æ—¶æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚ 12345678on &lt;trigger&gt; &lt;command&gt; &lt;command&gt; &lt;command&gt; on early-init //è§¦å‘å™¨ early-init write /proc/1/oom_score_adj -1000 //command write /proc/sys/kernel/sysrq 0 Services ç”±ä¸€äº› option ç»„æˆï¼Œå…¶åœ¨åˆå§‹åŒ–çš„æ—¶å€™å¯åŠ¨ï¼Œå¹¶å¯ä»¥åœ¨é€€å‡ºåé‡å¯ï¼ˆå¯é€‰ï¼‰ã€‚ 12345678service &lt;name&gt; &lt;pathname&gt; [ &lt;argument&gt; ]* //æœåŠ¡åã€æ‰§è¡Œè·¯å¾„ã€å‚æ•° &lt;option&gt; &lt;option&gt; service ueventd /sbin/ueventd class core critical seclabel u:r:ueventd:s0 Services å®šä¹‰äº†è‡ªèº«çš„æœåŠ¡åã€æ‰§è¡Œè·¯å¾„ä»¥åŠæ‰§è¡Œæ—¶ä¼ å…¥çš„å‚æ•°ï¼Œoption ç”¨äºæŒ‡å®šä½•æ—¶å’Œæ€æ ·å¯åŠ¨ serviceï¼Œå…³äºä½•æ—¶å¯åŠ¨è¿™é‡Œè¿›è¡Œä¸€ä¸‹è¯´æ˜ï¼ŒActions ä¸­æœ‰ä¸€æ¡å‘½ä»¤æ˜¯ class_start ç”¨äºå¯åŠ¨æ‰€æœ‰æœªè¿è¡Œçš„ç›¸åŒç±»åˆ«çš„ serviceï¼Œè€Œ option å¯ä»¥é€šè¿‡ class å¯¹ service çš„ç±»åˆ«åè¿›è¡ŒæŒ‡å®šã€‚æ‰€ä»¥ service çš„å¯åŠ¨ä¸€èˆ¬æ˜¯é€šè¿‡ action è§¦å‘ä¹‹åæ‰§è¡Œ class_start å‘½ä»¤è¿›è¡Œå¯åŠ¨çš„ã€‚ AIL çš„ä»‹ç»å°±åˆ°è¿™äº†ï¼Œå¦‚æœæƒ³è¦è¯¦ç»†äº†è§£è¯·é˜…è¯» system/core/init ä¸‹çš„ readme.txt æ–‡ä»¶ init.rc è§£æ system/core/rootdir/init.rc ç°åœ¨æ¥ç€åˆ†æ init.rc æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶çš„é¦–éƒ¨å¯ä»¥çœ‹åˆ° 12345import /init.environ.rcimport /init.usb.rcimport /init.$&#123;ro.hardware&#125;.rcimport /init.usb.configfs.rcimport /init.$&#123;ro.zygote&#125;.rc åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°éœ€è¦å¯åŠ¨çš„ zygoteï¼Œä½†æ˜¯ä¸å…¶å®ƒå¼•å…¥çš„ rc æ–‡ä»¶ç›¸æ¯” zygote éƒ¨åˆ†å¹¶æ²¡æœ‰ä½¿ç”¨ç¡®å®šçš„å€¼ï¼Œè€Œæ˜¯ä½¿ç”¨ ${ro.zygote} å˜é‡å»æ›¿ä»£ï¼Œè¿™æ˜¯å› ä¸ºä» Android åœ¨ 5.0 ä»¥åå¼€å§‹æ”¯æŒ 64 ä½ç¨‹åºï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®ç³»ç»Ÿä¸­ ro.zygote å±æ€§çš„å€¼åŠ¨æ€å¼•å…¥ã€‚ro.zygote çš„å€¼å¯ä»¥é€šè¿‡ adb shell getprop è¿›è¡ŒæŸ¥è¯¢ï¼Œæˆ‘çš„æ‰‹æœºæŸ¥è¯¢ç»“æœæ˜¯ï¼š è¿™è¯´æ˜æ‰‹æœºä¼šå¯åŠ¨ä¸¤ä¸ª zygote è¿›ç¨‹ï¼Œå¯¹åº”çš„æ‰§è¡Œç¨‹åºåˆ†åˆ«æ˜¯ app_process64 (ä¸»æ¨¡å¼)ã€app_process32ï¼Œé€šè¿‡ adb shell ps | grep zygote å¯ä»¥çœ‹åˆ°ç¡®å®å­˜åœ¨ä¸¤ä¸ª zygote è¿›ç¨‹ æ¥ç€æŸ¥çœ‹ä¸ init.rc åŒä¸€ç›®å½•ä¸‹çš„ init.zygote64_32.rc æ–‡ä»¶ system/core/rootdir/init.zygote64_32.rc 12345678910111213141516service zygote /system/bin/app_process64 -Xzygote /system/bin --zygote --start-system-server --socket-name=zygote class main socket zygote stream 660 root system onrestart write /sys/android_power/request_state wake onrestart write /sys/power/state on onrestart restart audioserver onrestart restart cameraserver onrestart restart media onrestart restart netd writepid /dev/cpuset/foreground/tasks /sys/fs/cgroup/stune/foreground/tasksservice zygote_secondary /system/bin/app_process32 -Xzygote /system/bin --zygote --socket-name=zygote_secondary class main socket zygote_secondary stream 660 root system onrestart restart zygote writepid /dev/cpuset/foreground/tasks /dev/stune/foreground/tasks å‰æ–‡è¯´è¿‡ service çš„å¯åŠ¨å’Œç±»åˆ«åç›¸å…³ï¼Œè¿™é‡Œä¸¤ä¸ª zygote service çš„ç±»åˆ«åéƒ½æ˜¯ mainï¼Œæ‰€ä»¥è¦æƒ³çŸ¥é“ zygote æ€ä¹ˆè¢«å¯åŠ¨çš„æˆ‘ä»¬å¯ä»¥åœ¨ init.rc ä¸­æœç´¢ class_start mainï¼Œå¯ä»¥å‘ç° 12345on nonencrypted # A/B update verifier that marks a successful boot. exec - root -- /system/bin/update_verifier nonencrypted class_start main class_start late_start ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å½“ nonencrypted è¿™ä¸ªè§¦å‘å™¨è¢«è§¦å‘çš„æ—¶å€™ zygote å°±ä¼šè¢«å¯åŠ¨ï¼Œæ‰€ä»¥å¯åŠ¨ zygote çš„é—®é¢˜å°±è½¬å˜ä¸ºè¿™ä¸ªè§¦å‘å™¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿclass_start å¯¹åº”çš„å¤„ç†å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿè¦æƒ³çŸ¥é“ç­”æ¡ˆï¼Œå¿…é¡»å›åˆ° init.cpp çš„è§£æè¿‡ç¨‹å½“ä¸­ 12345Parser&amp; parser = Parser::GetInstance();parser.AddSectionParser("service",std::make_unique&lt;ServiceParser&gt;());parser.AddSectionParser("on", std::make_unique&lt;ActionParser&gt;());parser.AddSectionParser("import", std::make_unique&lt;ImportParser&gt;());parser.ParseConfig("/init.rc"); init.rc äº¤ç”±ä¸€ä¸ª Parser å¯¹è±¡è¿›è¡Œè§£æï¼Œè€Œ Parser çš„å®ç°åœ¨ system/core/init/init_parser.cpp æ–‡ä»¶ä¸­ï¼Œè®©æˆ‘ä»¬è¿›å…¥åˆ° init_parser.cpp ä¸­æŸ¥çœ‹ AddSectionParser çš„å®ç° 1234567void Parser::AddSectionParser(const std::string&amp; name, std::unique_ptr&lt;SectionParser&gt; parser) &#123; section_parsers_[name] = std::move(parser);&#125;//init_parser.h ä¸­ section_parsers_ çš„å®šä¹‰std::map&lt;std::string, std::unique_ptr&lt;SectionParser&gt;&gt; section_parsers_; å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ª parser æœ€ç»ˆè¢«ä¿å­˜åœ¨ section_parsers_ ä¸­ï¼Œsection_parsers_ æ˜¯ä»€ä¹ˆï¼ŸæŸ¥çœ‹ init_parser.h ä¸­çš„å®šä¹‰å¯ä»¥çŸ¥é“ï¼Œsection_parsers_ æ˜¯ä¸€ä¸ª map é›†åˆï¼Œæ‰€ä»¥ section_parsers_ çš„ä½œç”¨æ˜¯å°† parser ä¸å¯¹åº”çš„ Section è¿›è¡Œç»‘å®šã€‚ åœ¨æ·»åŠ å®Œæ‰€æœ‰çš„ parser ä¹‹åå°±ä¼šè°ƒç”¨ Parser çš„ ParseConfig æ–¹æ³• 123456bool Parser::ParseConfig(const std::string&amp; path) &#123; if (is_dir(path.c_str())) &#123; return ParseConfigDir(path); &#125; return ParseConfigFile(path);&#125; ParseConfig ä¸­ä¼šå¯¹ path è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯ç›®å½•åˆ™è°ƒç”¨ ParseConfigDir è¿›è¡Œé€’å½’ç„¶åå†é€šè¿‡ ParseConfigFile è¿›è¡Œè§£æã€‚ 1234567891011121314151617181920bool Parser::ParseConfigDir(const std::string&amp; path) &#123; INFO("Parsing directory %s...\n", path.c_str()); std::unique_ptr&lt;DIR, int(*)(DIR*)&gt; config_dir(opendir(path.c_str()), closedir); if (!config_dir) &#123; ERROR("Could not import directory '%s'\n", path.c_str()); return false; &#125; dirent* current_file; while ((current_file = readdir(config_dir.get()))) &#123; std::string current_path = android::base::StringPrintf("%s/%s", path.c_str(), current_file-&gt;d_name); // Ignore directories and only process regular files. if (current_file-&gt;d_type == DT_REG) &#123; if (!ParseConfigFile(current_path)) &#123; //è°ƒç”¨ ParseConfigFile è¿›è¡Œè§£æ ERROR("could not import file '%s'\n", current_path.c_str()); &#125; &#125; &#125; return true;&#125; æœ€ç»ˆåœ¨ ParseConfigFile ä¸­é€šè¿‡ ParseData è¿›è¡Œè§£æ 1234567891011121314bool Parser::ParseConfigFile(const std::string&amp; path) &#123; INFO("Parsing file %s...\n", path.c_str()); Timer t; std::string data; //ä» rc æ–‡ä»¶ä¸­è¯»å–å†…å®¹ä¿å­˜åœ¨ data ä¸­ if (!read_file(path.c_str(), &amp;data)) &#123; return false; &#125; data.push_back('\n'); // TODO: fix parse_config. ParseData(path, data); //è°ƒç”¨ ParseData è¿›è¡Œè§£æ ... return true;&#125; ParseData è§£æè¿‡ç¨‹å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657void Parser::ParseData(const std::string&amp; filename, const std::string&amp; data) &#123; //TODO: Use a parser with const input and remove this copy std::vector&lt;char&gt; data_copy(data.begin(), data.end()); //å°† rc ä¸­çš„å†…å®¹ä¿å­˜åœ¨ vector ä¸­ä¾¿äºé€ä¸ªå­—ç¬¦è¿›è¡Œè§£æ data_copy.push_back('\0'); parse_state state; state.filename = filename.c_str(); state.line = 0; state.ptr = &amp;data_copy[0]; state.nexttoken = 0; SectionParser* section_parser = nullptr; std::vector&lt;std::string&gt; args; //å­˜æ”¾çš„æ˜¯æ¯è¡Œçš„å†…å®¹ for (;;) &#123; switch (next_token(&amp;state)) &#123; case T_EOF: if (section_parser) &#123; section_parser-&gt;EndSection(); &#125; return; case T_NEWLINE: state.line++; //å¦‚æœ args ä¸ºç©ºåˆ™ä¸è¿›è¡Œè§£æï¼ˆrc æ–‡ä»¶ä¸­é—´å­˜åœ¨ç©ºè¡Œï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­ï¼‰ if (args.empty()) &#123; break; &#125; //åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ª section çš„èµ·å§‹ä½ç½®ï¼ˆé€šè¿‡èƒ½ä¸èƒ½è·å¾—è§£æå™¨ï¼Œå¯ä»¥åˆ¤æ–­ args[0] æ˜¯ä¸æ˜¯ serviceã€onã€import å…¶ä¸­ä¸€ä¸ªï¼‰ if (section_parsers_.count(args[0])) &#123; if (section_parser) &#123; //å¦‚æœä¸Šæ¬¡å­˜åœ¨è§£æåˆ™ç»“æŸè§£æ section_parser-&gt;EndSection(); &#125; //å–å‡ºå¯¹åº”çš„è§£æå™¨ section_parser = section_parsers_[args[0]].get(); std::string ret_err; //è¿›è¡Œ Section è§£æ if (!section_parser-&gt;ParseSection(args, &amp;ret_err)) &#123; parse_error(&amp;state, "%s\n", ret_err.c_str()); section_parser = nullptr; &#125; &#125; else if (section_parser) &#123; //ä¸æ˜¯çš„è¯è¯´æ˜ args ä¸­æ˜¯ä¸€ä¸ª section çš„å­å—ï¼Œåˆ™è¿›è¡Œ Line è§£æ std::string ret_err; if (!section_parser-&gt;ParseLineSection(args, state.filename, state.line, &amp;ret_err)) &#123; parse_error(&amp;state, "%s\n", ret_err.c_str()); &#125; &#125; //è§£æå®Œæˆåæ¸…ç©º args.clear(); break; case T_TEXT: args.emplace_back(state.text); break; &#125; &#125;&#125; ParseData ä¸­é€šè¿‡è°ƒç”¨ system/core/init/parser.cpp ä¸­çš„ next_token å‡½æ•°å¯¹ rc å†…å®¹è¿›è¡Œåˆ†æï¼Œå¦‚æœæ˜¯ T_TEXT åˆ™ä¼šä¿å­˜åœ¨ args ä¸­ï¼Œå¦‚æœæ˜¯ T_NEWLINE åˆ™ä¼šäº¤ç”±å¯¹åº”çš„è§£æå™¨è¿›è¡Œè§£æã€‚init.rc çš„å¤§è‡´è§£æè¿‡ç¨‹å¦‚æ­¤ï¼Œä½†æ˜¯åˆ°è¿™é‡Œæˆ‘ä»¬ä¾æ—§æ²¡èƒ½æ‰¾åˆ°æ‰€éœ€è¦çš„ç­”æ¡ˆï¼Œæ‰€ä»¥éœ€è¦ç»§ç»­æŸ¥çœ‹ ActionParser å’Œ ServiceParser çš„è§£æè¿‡ç¨‹ã€‚ ActionParser è§£æè¿‡ç¨‹ ActionParser ä½äº system/core/init/action.cpp ä¸­ï¼Œä»å‰é¢çš„è§£æè¿‡ç¨‹æ¥çœ‹ï¼Œæœ€åçš„è§£ææ€»æ˜¯è°ƒç”¨äº†å¯¹åº” parser çš„ ParseSectionã€ParseLineSection ä»¥åŠ EndSectionï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸»è¦çœ‹ä¸‹è¿™ä¸¤ä¸ªéƒ¨åˆ† ParseSection çš„ä¸»è¦å·¥ä½œæ˜¯åˆ›å»º Action å¯¹è±¡ï¼Œä¸ºå¯¹è±¡æ·»åŠ è§¦å‘å™¨ï¼Œå¹¶å°† action_ ç§»åŠ¨è‡³å½“å‰ Action å¯¹è±¡ 12345678910111213141516171819bool ActionParser::ParseSection(const std::vector&lt;std::string&gt;&amp; args, std::string* err) &#123; std::vector&lt;std::string&gt; triggers(args.begin() + 1, args.end()); ... auto action = std::make_unique&lt;Action&gt;(false); //ä¸º action å¢åŠ è§¦å‘å™¨ if (!action-&gt;InitTriggers(triggers, err)) &#123; return false; &#125; //å°† aciton_ æŒ‡é’ˆç§»åŠ¨åˆ°å½“å‰çš„ action action_ = std::move(action); return true;&#125;//action_ åœ¨ action.h ä¸­çš„å®šä¹‰private: std::unique_ptr&lt;Action&gt; action_; ParseLineSection çš„ä¸»è¦å·¥ä½œä¸ºæŸ¥æ‰¾å¯¹åº” command çš„å¤„ç†å‡½æ•°ï¼Œå°†åˆ›å»ºçš„ Command å¯¹è±¡æ·»åŠ åˆ°åˆ°commands_ï¼Œç”±äº commands_ æ˜¯ Action çš„ä¸€ä¸ªåŸŸï¼Œæ‰€ä»¥å®é™…ä¸Š ParseLineSection åœ¨å¡«å……å½“å‰ Action å¯¹è±¡çš„åŸŸã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546bool ActionParser::ParseLineSection(const std::vector&lt;std::string&gt;&amp; args, const std::string&amp; filename, int line, std::string* err) const &#123; //å°†è§£æçš„ command å¢åŠ åˆ°å½“å‰ action çš„ commands_ ä¸­ return action_ ? action_-&gt;AddCommand(args, filename, line, err) : false;&#125;bool Action::AddCommand(const std::vector&lt;std::string&gt;&amp; args, const std::string&amp; filename, int line, std::string* err) &#123; ... //æŸ¥æ‰¾å¯¹åº”çš„ command çš„å¤„ç†å‡½æ•° auto function = function_map_-&gt;FindFunction(args[0], args.size() - 1, err); if (!function) &#123; return false; &#125; AddCommand(function, args, filename, line); return true;&#125;void Action::AddCommand(BuiltinFunction f, const std::vector&lt;std::string&gt;&amp; args, const std::string&amp; filename, int line) &#123; //commands_ å¢åŠ  command å’Œå¯¹åº”çš„å¤„ç†å‡½æ•° commands_.emplace_back(f, args, filename, line);&#125;//commands_ åœ¨ action.h ä¸­çš„å®šä¹‰std::vector&lt;Command&gt; commands_;//Command åœ¨ action.h ä¸­çš„å®šä¹‰class Command &#123;public: Command(BuiltinFunction f, const std::vector&lt;std::string&gt;&amp; args, const std::string&amp; filename, int line); int InvokeFunc() const; std::string BuildCommandString() const; std::string BuildSourceString() const;private: BuiltinFunction func_; std::vector&lt;std::string&gt; args_; std::string filename_; int line_;&#125;; EndSection çš„ä¸»è¦å·¥ä½œæ˜¯å°†è§£æå®Œæˆçš„ action ï¼ˆåŸŸå¡«å……å®Œæ¯•çš„ Action å¯¹è±¡ï¼‰æ·»åŠ åˆ° ActionManager çš„ acitons_ ä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142void ActionParser::EndSection() &#123; if (action_ &amp;&amp; action_-&gt;NumCommands() &gt; 0) &#123; ActionManager::GetInstance().AddAction(std::move(action_)); &#125;&#125;void ActionManager::AddAction(std::unique_ptr&lt;Action&gt; action) &#123; ... if (old_action_it != actions_.end()) &#123; (*old_action_it)-&gt;CombineAction(*action); &#125; else &#123; //å°†è§£æä¹‹åçš„ action å¯¹è±¡å¢åŠ åˆ° actions_ é“¾è¡¨ä¸­ï¼Œç”¨äºéå†æ‰§è¡Œã€‚ actions_.emplace_back(std::move(action)); &#125;&#125;//ActionManager åœ¨ action.h ä¸­çš„å®šä¹‰class ActionManager &#123;public: static ActionManager&amp; GetInstance(); void AddAction(std::unique_ptr&lt;Action&gt; action); void QueueEventTrigger(const std::string&amp; trigger); void QueuePropertyTrigger(const std::string&amp; name, const std::string&amp; value); void QueueAllPropertyTriggers(); void QueueBuiltinAction(BuiltinFunction func, const std::string&amp; name); void ExecuteOneCommand(); bool HasMoreCommands() const; void DumpState() const;private: ActionManager(); ActionManager(ActionManager const&amp;) = delete; void operator=(ActionManager const&amp;) = delete; std::vector&lt;std::unique_ptr&lt;Action&gt;&gt; actions_; //actions_ çš„å®šä¹‰ std::queue&lt;std::unique_ptr&lt;Trigger&gt;&gt; trigger_queue_; std::queue&lt;const Action*&gt; current_executing_actions_; std::size_t current_command_;&#125;; é€šè¿‡ä»¥ä¸Šåˆ†ææˆ‘ä»¬èƒ½å¤ŸçŸ¥é“ class_start çš„å¤„ç†å‡½æ•°å’Œ function_map_ ç›¸å…³ï¼ŒæŸ¥çœ‹ function_map_ åœ¨ action.h ä¸­çš„å®šä¹‰å¯ä»¥çœ‹åˆ° 12345static const KeywordMap&lt;BuiltinFunction&gt;* function_map_;static void set_function_map(const KeywordMap&lt;BuiltinFunction&gt;* function_map) &#123; function_map_ = function_map;&#125; æ‰€ä»¥è¦æƒ³çŸ¥é“å¤„ç†å‡½æ•°æ˜¯ä»€ä¹ˆåªéœ€è¦çŸ¥é“ set_function_map åœ¨å“ªé‡Œè°ƒç”¨ï¼Ÿè®©æˆ‘ä»¬å†æ¬¡å›åˆ° init.cpp ä¸­ï¼Œå¯ä»¥çœ‹åˆ° 12const BuiltinFunctionMap function_map;Action::set_function_map(&amp;function_map); æ¥ä¸‹æ¥éœ€è¦æ‰¾åˆ° BuiltinFunctionMapï¼ŒBuiltinFunctionMap çš„å®ç°æˆ‘ä»¬å¯ä»¥åœ¨ builtins.cpp ä¸­æ‰¾åˆ°ï¼Œå…¶å…·ä½“çš„å®ç° system/core/init/builtins.cpp 12345678910BuiltinFunctionMap::Map&amp; BuiltinFunctionMap::map() const &#123; constexpr std::size_t kMax = std::numeric_limits&lt;std::size_t&gt;::max(); static const Map builtin_functions = &#123; ... &#123;"class_start", &#123;1, 1, do_class_start&#125;&#125;, &#123;"class_stop", &#123;1, 1, do_class_stop&#125;&#125;, ... &#125;; return builtin_functions;&#125; åˆ°è¿™é‡Œå°±å¯ä»¥ç¡®å®š class_start å¯¹åº”çš„å¤„ç†å‡½æ•°æ˜¯ do_class_startï¼Œdo_class_start ä¹Ÿå¯åœ¨ builtins.cpp ä¸­æ‰¾åˆ°ã€‚ ç®€å•æ€»ç»“ä¸‹è§£æ Action çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ª Action å¯¹è±¡ï¼Œç„¶åä¸º Action å¯¹è±¡æ·»åŠ  Trigger ä»¥åŠå¯¹åº”çš„ Commandï¼Œå…¶ä¸­åœ¨æ·»åŠ  Command çš„è¿‡ç¨‹ä¸­è¿˜ä¸º Command æŒ‡å®šäº†å¤„ç†å‡½æ•°ï¼Œæœ€ååœ¨å°† Action å¯¹è±¡å¢åŠ åˆ° ActionManager vector ç±»å‹çš„ actions_ é“¾è¡¨å½“ä¸­å»ã€‚ ServiceParser è§£æè¿‡ç¨‹ ä¸å‰æ–‡ä¸€è‡´ï¼Œæ¥ç€çœ‹é‚£ä¸‰ä¸ªå‡½æ•° ParseSection çš„ä¸»è¦å·¥ä½œæ˜¯åˆ›å»º Service å¯¹è±¡ï¼Œå°† service_ ç§»åŠ¨è‡³å½“å‰ Service å¯¹è±¡ 123456789101112131415bool ServiceParser::ParseSection(const std::vector&lt;std::string&gt;&amp; args, std::string* err) &#123; ... //è·å–æœåŠ¡å const std::string&amp; name = args[1]; ... //ä¿å­˜æœåŠ¡åå¤–çš„å‚æ•°ï¼ˆå¦‚æ‰§è¡Œè·¯å¾„ç­‰ï¼‰ std::vector&lt;std::string&gt; str_args(args.begin() + 2, args.end()); //å°† service_ æŒ‡é’ˆæŒ‡å‘å½“å‰ Service å¯¹è±¡ service_ = std::make_unique&lt;Service&gt;(name, "default", str_args); return true;&#125;//service_ åœ¨ service.h ä¸­çš„å®šä¹‰std::unique_ptr&lt;Service&gt; service_; ParseLineSection çš„ä¸»è¦å·¥ä½œæ˜¯ä¸º Service ä¸­æ¯ä¸ª option æŒ‡å®šå¤„ç†å‡½æ•° 123456789101112131415161718bool ServiceParser::ParseLineSection(const std::vector&lt;std::string&gt;&amp; args, const std::string&amp; filename, int line, std::string* err) const &#123; //ä¸º Service ä¸­çš„æ¯ä¸€ä¸ª Option æŒ‡å®šå¤„ç†å‡½æ•° return service_ ? service_-&gt;HandleLine(args, err) : false;&#125;bool Service::HandleLine(const std::vector&lt;std::string&gt;&amp; args, std::string* err) &#123; ... static const OptionHandlerMap handler_map; //å¯»æ‰¾å¯¹åº” option çš„å¤„ç†å‡½æ•° auto handler = handler_map.FindFunction(args[0], args.size() - 1, err); ... return (this-&gt;*handler)(args, err);&#125; EndSection çš„ä¸»è¦å·¥ä½œæ˜¯å°†è§£æå®Œæˆçš„ service ï¼ˆåŸŸå¡«å……å®Œæ¯•çš„ Service å¯¹è±¡ï¼‰æ·»åŠ åˆ° ServiceManager çš„ services_ ä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142void ServiceParser::EndSection() &#123; if (service_) &#123; ServiceManager::GetInstance().AddService(std::move(service_)); &#125;&#125;void ServiceManager::AddService(std::unique_ptr&lt;Service&gt; service) &#123; Service* old_service = FindServiceByName(service-&gt;name()); if (old_service) &#123; ERROR("ignored duplicate definition of service '%s'", service-&gt;name().c_str()); return; &#125; //å°†è§£æä¹‹å service å¯¹è±¡å¢åŠ åˆ° services_ é“¾è¡¨ä¸­ services_.emplace_back(std::move(service));&#125;//ServiceManager åœ¨ service.h ä¸­çš„å®šä¹‰class ServiceManager &#123;public: static ServiceManager&amp; GetInstance(); void AddService(std::unique_ptr&lt;Service&gt; service); Service* MakeExecOneshotService(const std::vector&lt;std::string&gt;&amp; args); Service* FindServiceByName(const std::string&amp; name) const; Service* FindServiceByPid(pid_t pid) const; Service* FindServiceByKeychord(int keychord_id) const; void ForEachService(std::function&lt;void(Service*)&gt; callback) const; void ForEachServiceInClass(const std::string&amp; classname, void (*func)(Service* svc)) const; void ForEachServiceWithFlags(unsigned matchflags, void (*func)(Service* svc)) const; void ReapAnyOutstandingChildren(); void RemoveService(const Service&amp; svc); void DumpState() const;private: ServiceManager(); bool ReapOneProcess(); static int exec_count_; // Every service needs a unique name. std::vector&lt;std::unique_ptr&lt;Service&gt;&gt; services_; //services_ çš„å®šä¹‰&#125;; å¯¹åº”çš„å¯ä»¥çœ‹ä¸‹ option çš„å¤„ç†å‡½æ•°ï¼Œè™½ç„¶ OptionHandlerMap ä¸å¯åŠ¨ zygote æ— å…³ï¼Œä½†æ˜¯è¿˜æ˜¯çœ‹ä¸‹ 1234567891011121314151617181920Service::OptionHandlerMap::Map&amp; Service::OptionHandlerMap::map() const &#123; constexpr std::size_t kMax = std::numeric_limits&lt;std::size_t&gt;::max(); static const Map option_handlers = &#123; &#123;"class", &#123;1, 1, &amp;Service::HandleClass&#125;&#125;, &#123;"console", &#123;0, 0, &amp;Service::HandleConsole&#125;&#125;, &#123;"critical", &#123;0, 0, &amp;Service::HandleCritical&#125;&#125;, &#123;"disabled", &#123;0, 0, &amp;Service::HandleDisabled&#125;&#125;, &#123;"group", &#123;1, NR_SVC_SUPP_GIDS + 1, &amp;Service::HandleGroup&#125;&#125;, &#123;"ioprio", &#123;2, 2, &amp;Service::HandleIoprio&#125;&#125;, &#123;"keycodes", &#123;1, kMax, &amp;Service::HandleKeycodes&#125;&#125;, &#123;"oneshot", &#123;0, 0, &amp;Service::HandleOneshot&#125;&#125;, &#123;"onrestart", &#123;1, kMax, &amp;Service::HandleOnrestart&#125;&#125;, &#123;"seclabel", &#123;1, 1, &amp;Service::HandleSeclabel&#125;&#125;, &#123;"setenv", &#123;2, 2, &amp;Service::HandleSetenv&#125;&#125;, &#123;"socket", &#123;3, 6, &amp;Service::HandleSocket&#125;&#125;, &#123;"user", &#123;1, 1, &amp;Service::HandleUser&#125;&#125;, &#123;"writepid", &#123;1, kMax, &amp;Service::HandleWritepid&#125;&#125;, &#125;; return option_handlers;&#125; ä¸è§£æ Action ç±»ä¼¼ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å…ˆåˆ›å»º Service å¯¹è±¡ï¼Œè§£æå‡º Service çš„åå­—å’Œå¯¹åº”çš„å‚æ•°æ·»åŠ åˆ°å¯¹è±¡å½“ä¸­ï¼Œå¹¶ä¸”ç»™æ¯ä¸ª Option æŒ‡å®šäº†ç›¸åº”çš„å¤„ç†å‡½æ•° åˆ°è¿™é‡Œ rc æ–‡ä»¶çš„è§£æå°±ç»“æŸäº†ï¼Œé€šè¿‡ rc æ–‡ä»¶çš„è§£æä½¿å¾—æ¯ä¸ª action éƒ½æœ‰äº†å¯¹åº”çš„æ‰§è¡Œå‡½æ•°ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯è¿™äº› action æ˜¯å¦‚ä½•è¢«è§¦å‘çš„ï¼ˆä¹Ÿå³æ˜¯ command å‘½ä»¤æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„ï¼‰ï¼Ÿ Actions çš„è§¦å‘ è®©æˆ‘ä»¬ç»§ç»­å›åˆ° init.cpp ä¸­ 12345678910ActionManager&amp; am = ActionManager::GetInstance();....while (true) &#123; if (!waiting_for_exec) &#123; am.ExecuteOneCommand(); restart_processes(); &#125;...&#125; å¯ä»¥çœ‹åˆ° action çš„ command çš„æ‰§è¡Œæ˜¯é€šè¿‡ ActionManager çš„ ExecuteOneCommand å‡½æ•°ï¼Œè€ŒActionManager çš„ ExecuteOneCommand æœ€ç»ˆè°ƒç”¨äº† Action çš„ ExecuteOneCommand system/core/init/action.cpp 123456789101112131415161718192021222324252627282930313233343536373839404142void ActionManager::ExecuteOneCommand() &#123; //å¾ªç¯ç­‰å¾…ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­ä¸ä¸ºç©º while (current_executing_actions_.empty() &amp;&amp; !trigger_queue_.empty()) &#123; //éå† actions_ for (const auto&amp; action : actions_) &#123; if (trigger_queue_.front()-&gt;CheckTriggers(*action)) &#123; //å°† action åŠ å…¥åˆ° current_executing_actions_ ä¸­ current_executing_actions_.emplace(action.get()); &#125; &#125; trigger_queue_.pop(); &#125; ... //æ¯æ¬¡åªæ‰§è¡Œä¸€ä¸ª action auto action = current_executing_actions_.front(); if (current_command_ == 0) &#123; std::string trigger_name = action-&gt;BuildTriggersString(); INFO("processing action (%s)\n", trigger_name.c_str()); &#125; //æ‰§è¡Œ action çš„ command action-&gt;ExecuteOneCommand(current_command_); ++current_command_; ...&#125;void Action::ExecuteOneCommand(std::size_t command) const &#123; //æ‰§è¡Œ action å¯¹è±¡ä¸­ä¿å­˜çš„ command ExecuteCommand(commands_[command]);&#125;void Action::ExecuteCommand(const Command&amp; command) const &#123; Timer t; //è°ƒç”¨ command å¯¹åº”çš„å¤„ç†å‡½æ•° int result = command.InvokeFunc(); ...&#125; é€šè¿‡ä¸Šè¿°åˆ†æå¯ä»¥çŸ¥é“ï¼Œinit è¿›ç¨‹æœ€ç»ˆè¿›å…¥åˆ°æ— é™å¾ªç¯ä¸­ï¼Œç„¶åæŒ‰ç…§ ActionManager ä¸­ actions_ ä¿å­˜çš„ action é¡ºåºä¾æ¬¡å¯¹æ¯ä¸ª Action è¿›è¡Œå¤„ç†ï¼Œè€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ system/core/init/builtins.cpp ä¸‹ç”¨äºå¯åŠ¨ zygote çš„ do_class_start å‡½æ•°å°†ä¼šè¢«æ‰§è¡Œ 12345static int do_class_start(const std::vector&lt;std::string&gt;&amp; args) &#123; ServiceManager::GetInstance(). ForEachServiceInClass(args[1], [] (Service* s) &#123; s-&gt;StartIfNotDisabled(); &#125;); return 0;&#125; do_class_start å‡½æ•°ä¸­è°ƒç”¨ Service çš„ StartIfNotDisabledï¼ŒStartIfNotDisabled åœ¨ service.cpp çš„å®ç°å¦‚ä¸‹ 12345678bool Service::StartIfNotDisabled() &#123; if (!(flags_ &amp; SVC_DISABLED)) &#123; return Start(); &#125; else &#123; flags_ |= SVC_DISABLED_START; &#125; return true;&#125; StartIfNotDisabled æœ€ç»ˆè°ƒç”¨äº† Service çš„ Start å‡½æ•°ï¼ŒStart å‡½æ•°åˆ›å»ºäº† zygote çš„è¿›ç¨‹ï¼Œå¹¶ä¸”æ‰§è¡Œäº† init.zygote64_32.rc ä¸­å®šä¹‰çš„æ‰§è¡Œè·¯å¾„ä¸‹çš„æ–‡ä»¶ 1234567891011121314151617bool Service::Start() &#123; .... //åˆ›å»ºå­è¿›ç¨‹ pid_t pid = fork(); if (pid == 0) &#123; ... //æ‰§è¡Œå¯¹åº” service å¯¹åº”çš„æ‰§è¡Œæ–‡ä»¶ï¼Œargs_[0].c_str() å°±æ˜¯æ‰§è¡Œè·¯å¾„ if (execve(args_[0].c_str(), (char**) &amp;strs[0], (char**) ENV) &lt; 0) &#123; ERROR("cannot execve('%s'): %s\n", args_[0].c_str(), strerror(errno)); &#125; _exit(127); &#125; .... return true;&#125; åœ¨å®Œæˆè¿™ä¸€åˆ‡ä¹‹åå°†ä¼šè¿›å…¥ frameworks/base/cmds/app_process/app_main.cpp ä¸­ 12345678910111213141516int main(int argc, char* const argv[])&#123; .... if (zygote) &#123; //å¯åŠ¨ zygote runtime.start("com.android.internal.os.ZygoteInit", args, zygote); &#125; else if (className) &#123; runtime.start("com.android.internal.os.RuntimeInit", args, zygote); &#125; else &#123; fprintf(stderr, "Error: no class name or --zygote supplied.\n"); app_usage(); LOG_ALWAYS_FATAL("app_process: no class name or --zygote supplied."); return 10; &#125;&#125; å¯ä»¥çœ‹åˆ° zygote æœ€ç»ˆåœ¨ app_main çš„ main å‡½æ•°ä¸­è¢«å¯åŠ¨ã€‚ æ€»ç»“ åˆ°è¿™é‡Œæˆ‘ä»¬å°±èƒ½å¤Ÿå›ç­”å¯¹ init éƒ¨åˆ†ç›¸å…³çš„é—®é¢˜äº† 1. init çš„ä½œç”¨ init æ˜¯ç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯åˆ›å»ºç”¨æˆ·ç©ºé—´æ–‡ä»¶å¤¹å¹¶æŒ‚è½½ã€å¯åŠ¨å±æ€§æœåŠ¡ã€è§£æ init.rc æ–‡ä»¶å¹¶å¯åŠ¨ zygote è¿›ç¨‹ã€‚ 2. init å¯åŠ¨ zygote çš„è¿‡ç¨‹ init è¿›ç¨‹é€šè¿‡è§£æ init.rc æ–‡ä»¶å°† action ä¿å­˜åœ¨ ActionManager çš„ actions_ é“¾è¡¨ä¸­ï¼Œç„¶åé€šè¿‡éå† actions_ é“¾è¡¨ï¼Œæ‰§è¡Œ action å‘½ä»¤å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œä»è€Œè½¬è‡³ builtins.cpp çš„ do_class_start å‡½æ•°ï¼Œä¹‹åé€šè¿‡ Service çš„ StartIfNotDisabled è°ƒç”¨ Service çš„ Start å‡½æ•°ï¼Œæœ€ç»ˆé€šè¿‡ Start å‡½æ•°åˆ›å»º zygote è¿›ç¨‹ï¼Œæ‰§è¡Œå¯¹åº”çš„ app_main.cpp æ–‡ä»¶å¯åŠ¨ zygoteã€‚ Thanks Android7.0 initè¿›ç¨‹æºç åˆ†æ Android Init Language(androidåˆå§‹åŒ–è¯­è¨€) Androidç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼ˆä¸€ï¼‰è§£æinitè¿›ç¨‹å¯åŠ¨è¿‡ç¨‹]]></content>
      <categories>
        <category>Androidè¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android åŸºç¡€ä¹‹ Selector çš„ç”¨æ³•]]></title>
    <url>%2F2017%2F09%2F24%2FSelector%E7%9A%84%E7%94%A8%E6%B3%95%2F</url>
    <content type="text"><![CDATA[å‰è¨€ Selectorï¼ˆé€‰æ‹©å™¨ï¼‰å¸¸å¸¸è¢«ç”¨ä½œæ§ä»¶çš„èƒŒæ™¯ï¼Œæ˜¯ä¸€ç§çŠ¶æ€åˆ—è¡¨ï¼Œä¸€èˆ¬åˆ†ä¸º Drawable-selector å’Œ Color-selectorï¼Œæ¥ä¸‹æ¥åˆ†åˆ«è¯´è¯´è¿™ä¸¤è€…çš„ä½¿ç”¨æ–¹æ³•ã€‚ Drawable-selector é¦–å…ˆéœ€è¦åœ¨ res/drawable æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª Drawable Resource File æ–‡ä»¶ï¼Œå¡«å…¥æ–‡ä»¶åå³å¯ï¼Œåˆ›å»ºä¹‹åçš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 123&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;selector xmlns:android="http://schemas.android.com/apk/res/android"&gt;&lt;/selector&gt; åœ¨ selector æ ‡ç­¾ä¸‹æ–°å»ºä¸€ä¸ª item æ ‡ç­¾ï¼Œitem æ ‡ç­¾è¡¨ç¤ºä¸€ç§çŠ¶æ€ï¼Œå¦‚æœä¸æŒ‡æ˜çŠ¶æ€ï¼Œé‚£ä¹ˆæ§ä»¶åœ¨ä»»ä½•çŠ¶æ€ä¸‹éƒ½ä¼šåŠ è½½ item å†…çš„ æ ·å¼ï¼Œå¸¸ç”¨çš„çŠ¶æ€è®¾ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š android:state_pressed è®¾ç½®ä¸º true æ—¶ä»£è¡¨æŒ‰å‹æ§ä»¶çš„æ—¶å€™ä½¿ç”¨ item æ ·å¼ android:state_selected è®¾ç½®ä¸º true æ—¶ä»£è¡¨æ§ä»¶è¢«é€‰ä¸­çš„æ—¶å€™ä½¿ç”¨ item æ ·å¼ android:state_checked è®¾ç½®ä¸º true æ—¶ä»£è¡¨æ§ä»¶å¤„äº checked çŠ¶æ€çš„æ—¶å€™ä½¿ç”¨ item æ ·å¼ æ¥ä¸‹æ¥åœ¨ item å†…éƒ¨åˆ›å»º shape æ ‡ç­¾ç”¨äºæŒ‡å®šç»˜åˆ¶çš„å›¾å½¢ç±»åˆ«ï¼Œæ€»å…±æœ‰å››ç§å›¾å½¢å¯ä»¥é€‰æ‹©åˆ†åˆ«æ˜¯ï¼šrectangleã€ovalã€lineã€ringã€‚åœ¨ç¡®å®šéœ€è¦ç»˜åˆ¶çš„ shape ç±»å‹ä¹‹åï¼Œå°±å¯ä»¥åœ¨ shape æ ‡ç­¾å†…éƒ¨å¯¹ shape çš„å„é¡¹å±æ€§è¿›è¡Œé…ç½®ï¼Œæ€»å…±æœ‰å…­ç§æ ‡ç­¾å±æ€§ã€‚ size ç”¨æ¥è®¾ç½® shape çš„å¤§å° solid ç”¨æ¥è®¾ç½®å¡«å…… shape çš„é¢œè‰² corners ç”¨æ¥è®¾ç½® shape çš„è§’åº¦ stroke ç”¨æ¥ç»™ shape æè¾¹ï¼Œå¯ä»¥ææˆè™šçº¿æˆ–å®çº¿ padding è®¾ç½®å†…è¾¹è· gradient è®¾ç½® shape çš„æ¸å˜é¢œè‰² è®¾ç½®å¥½ç›¸åº”çš„å±æ€§ä¹‹åå°±å¯ä»¥é€šè¿‡è®¾ç½®æ§ä»¶çš„ android:drawble å±æ€§è¿›è¡Œä½¿ç”¨äº†ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªä¾‹å­ 12345678910111213141516171819202122&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;selector xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;item android:state_pressed="true"&gt; &lt;shape android:shape="rectangle"&gt; &lt;corners android:radius="5dp" /&gt; &lt;stroke android:width="1dp" android:color="#00faff" android:dashGap="10dp" android:dashWidth="10dp" /&gt; &lt;size android:width="150dp" android:height="150dp" /&gt; &lt;solid android:color="#bcb7b7" /&gt; &lt;/shape&gt; &lt;/item&gt; &lt;item android:state_pressed="false"&gt; &lt;shape android:shape="oval"&gt; &lt;corners android:radius="360dp" /&gt; &lt;stroke android:width="1dp" android:color="#00fcb5" android:dashGap="10dp" android:dashWidth="10dp" /&gt; &lt;size android:width="300dp" android:height="300dp" /&gt; &lt;solid android:color="#ffff" /&gt; &lt;/shape&gt; &lt;/item&gt;&lt;/selector&gt; ä¸Šè¿°ä»£ç ç»˜åˆ¶äº†ä¸¤ç§çŠ¶æ€ï¼Œä¸€ç§æ˜¯é»˜è®¤çŠ¶æ€ä¸‹çš„åœ†ï¼Œç™½è‰²å¡«å……ã€è™šçº¿æè¾¹ã€åŠå¾„æ˜¯ 300dpã€‚å¦ä¸€ç§æ˜¯è¢«æŒ‰ä¸‹çš„çŠ¶æ€ï¼Œç°è‰²å¡«å……ã€è™šçº¿æè¾¹ã€é•¿å’Œå®½ä¸åœ†ä¸€è‡´ã€‚å…·ä½“æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Color-selector Color-selector å®šä¹‰åœ¨ resæ–‡ä»¶å¤¹ä¸‹ï¼Œä½¿ç”¨è¿‡ç¨‹åŸºæœ¬ä¸ Drawable-selector ä¸€è‡´ï¼Œä¸åŒåœ¨äº Color-selector åªæ˜¯ç”¨äºå®šä¹‰æ§ä»¶çš„é¢œè‰²ï¼Œæ‰€ä»¥åªéœ€è¦é…ç½® item æ ‡ç­¾çš„ color å±æ€§å³å¯ï¼Œå…·ä½“çš„ä¾‹å­å¦‚ä¸‹ï¼š 12345678&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;selector xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;item android:color="#000000" android:state_pressed="false" /&gt; &lt;item android:color="#ffff" android:state_pressed="true" /&gt;&lt;/selector&gt; é€šè¿‡æŒ‡å®š item çš„çŠ¶æ€å’Œé¢œè‰²ï¼Œå³å¯åšåˆ°æŒ‰å‹å’Œæ¾å¼€æ—¶æ§ä»¶çš„é¢œè‰²å˜åŒ–ã€‚]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Drawble</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¢å‘å¯¹è±¡çš„å…­å¤§åŸåˆ™åŠå•ä¾‹æ¨¡å¼]]></title>
    <url>%2F2017%2F09%2F17%2F%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99%E5%8F%8A%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[é¢å‘å¯¹è±¡çš„å…­å¤§åŸåˆ™ å•ä¸€èŒè´£åŸåˆ™ å•ä¸€èŒè´£åŸåˆ™ (SRP) æ˜¯æŒ‡å°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå›  ç®€å•è€Œè¨€å°±æ˜¯ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€é¡¹èŒè´£ï¼Œè€Œä¸æ˜¯å…·æœ‰å¤šé¡¹èŒè´£ï¼Œæ¯”å¦‚ä¸€ä¸ªç±»æ—¢è´Ÿè´£å›¾ç‰‡ç¼“å­˜çš„å¤„ç†åŒæ—¶è¿˜è´Ÿè´£æ˜¾ç¤ºå›¾ç‰‡ï¼Œå®é™…ä¸Šåº”è¯¥æ‹†åˆ†æˆä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªç±»è´Ÿè´£å›¾ç‰‡çš„ç¼“å­˜ï¼Œå¦å¤–ä¸€ä¸ªç±»è´Ÿè´£å›¾ç‰‡æ˜¾ç¤ºã€‚å¦‚æœä¸€ä¸ªç±»å…¼å…·å¤ªå¤šçš„èŒè´£ä¸ä»…å¯¼è‡´äº†è€¦åˆæ€§ï¼Œè€Œä¸”åœ¨ä¸€ä¸ªèŒè´£å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è¿˜å¯èƒ½å‰Šå¼±å…¶å®ƒçš„èŒè´£åŠŸèƒ½ã€‚ å¼€é—­åŸåˆ™ å¼€é—­åŸåˆ™ (OCP) æ˜¯æŒ‡è½¯ä»¶ä¸­çš„å¯¹è±¡å¯¹äºä¿®æ”¹åº”è¯¥æ˜¯å°é—­çš„ï¼Œå¯¹äºæ‰©å±•åº”è¯¥æ˜¯å¼€æ”¾çš„ã€‚ å¦‚æœä¸€ä¸ªç±»ä¸ºäº†å®ç°æ–°çš„åŠŸèƒ½ä¸æ–­çš„å¯¹ç±»ä¸­çš„åŸæœ‰ä»£ç è¿›è¡Œä¿®æ”¹å’Œå¢åŠ ï¼Œä¸ä»…å¯èƒ½å¼•å…¥ Bugï¼Œè¿˜æœ‰å¯èƒ½ä¼šå¯¼è‡´ç±»è¶Šæ¥è¶Šåºå¤§ï¼Œæ¯”å¦‚ä¸€ä¸ªå›¾ç‰‡çš„ç¼“å­˜ç±»éœ€è¦å®ç°å†…å­˜ç¼“å­˜ã€SD å¡ç¼“å­˜ã€ä¸¤ç§æ–¹å¼æ··åˆçš„ç¼“å­˜æ–¹æ³•ï¼Œåœ¨å›¾ç‰‡æ˜¾ç¤ºç±»ä¸­éœ€è¦è‡ªç”±é€‰æ‹©ä½•ç§æ–¹å¼è¿›è¡Œç¼“å­˜æ˜¾ç¤ºã€‚æ¯”è¾ƒå¥½çš„ä¸€ç§æ–¹å¼æ˜¯ï¼šç”±äºä¸‰ç§ç¼“å­˜æ–¹å¼å®é™…ä¸ŠåŸºæœ¬åŠŸèƒ½ä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨å›¾ç‰‡æ˜¾ç¤ºç±»ä¸­ä¹‰ä¸€ä¸ªæ¥å£ç”¨äºæŒ‡å‘ä¸‰ä¸ªç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå½“éœ€è¦é‡‡ç”¨å“ªç§æ–¹å¼å»è¿›è¡Œç¼“å­˜çš„æ—¶å€™ï¼Œåªéœ€è¦ä½¿ç”¨ set æ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥å°†æ¥å£æŒ‡å‘ç›¸åº”æ–¹å¼çš„å¯¹è±¡å³å¯ï¼Œå¹¶ä¸”å¦‚æœè¦å®ç°å…¶å®ƒä¸åŒçš„ç¼“å­˜æ–¹å¼åªéœ€è¦å¯¹æ¥å£è¿›è¡Œå®ç°å³å¯ã€‚è¿™æ ·å®ç°çš„ä»£ç è€¦åˆæ€§å¼±æ‰©å±•æ€§å¼ºã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ é‡Œæ°æ›¿æ¢åŸåˆ™æ˜¯æŒ‡æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ ä¸€ä¸ªåŸºç±»çš„å­ç±»æ‹¥æœ‰åŸºç±»çš„å±æ€§å’Œæ–¹æ³•ï¼ˆç§æœ‰çš„é™¤å¤–ï¼‰ï¼Œæ‰€ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹åŸºç±»èƒ½å¹²çš„å­ç±»éƒ½èƒ½åšï¼Œè¿™æ ·å¯ä»¥ä¿è¯å¾ˆå¥½çš„æ‰©å±•æ€§ï¼Œå› ä¸ºå¯ä»¥åœ¨åŸºç±»çš„åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•å®ç°ä¸åŒåŠŸèƒ½çš„å­ç±»ã€‚å› æ­¤é‡Œæ°æ›¿æ¢åŸåˆ™æœ‰åˆ©äºæé«˜æ‰©å±•æ€§ï¼ŒåŒæ—¶ä¸ºå¼€é—­åŸåˆ™æä¾›äº†ä¿éšœã€‚ ä¾èµ–å€’ç½®åŸåˆ™ ä¾èµ–å€’ç½®åŸåˆ™æ˜¯ç”¨äºè§£è€¦çš„ä¸€ç§æ–¹å¼ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ ç¬¬ä¸€ç‚¹æ˜¯æŒ‡å½“é«˜å±‚çš„æ¨¡å—ä½¿ç”¨åº•å±‚çš„æ¨¡å—æ—¶å€™ï¼Œä¸åº”è¯¥ç›´æ¥ä½¿ç”¨åº•å±‚æ¨¡å—ç±»çš„å…·ä½“å¯¹è±¡ï¼Œè€Œåº”è¯¥ä½¿ç”¨å…¶æ¥å£æˆ–è€…æ˜¯æŠ½è±¡ç±»ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å…¶æ‰©å±•æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´é«˜å±‚æ¨¡å—ä¸åº•å±‚æ¨¡å—ä¹‹é—´åº”è¯¥é€šè¿‡æ¥å£å‘ç”Ÿè”ç³»ï¼Œè€Œä¸åº”è¯¥å­˜åœ¨ç›´æ¥å…³è”ã€‚ æ¥å£éš”ç¦»åŸåˆ™ æ¥å£éš”ç¦»åŸåˆ™æ˜¯æŒ‡ç±»é—´çš„å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š æœ€å°çš„æ¥å£å®é™…ä¸Šå°±æ˜¯æŠ½è±¡çš„ä¸€ç§è¡¨è¾¾ï¼Œä¸€ä¸ªæ¥å£ä¸‹é¢å¯èƒ½å¯èƒ½ä¼šå®ç°å¾ˆå¤šç§æ¥å£ï¼Œæˆ–è€…æ˜¯å¾ˆå¤šå±‚çº§æ¥å£ï¼Œè¦å¯¹è¿™äº›æ¥å£ç›¸åŒçš„åŠŸèƒ½éƒ¨åˆ†è¿›è¡Œæ“ä½œçš„æ—¶å€™åªéœ€è¦å¯¹æœ€é¡¶å±‚çš„æ¥å£æ“ä½œå³å¯ï¼Œè­¬å¦‚å½“å…³é—­è¾“å…¥è¾“å‡ºæµçš„æ—¶å€™ï¼ŒJava ä¸­æœ‰å¾ˆå¤šç§æµï¼Œå­—èŠ‚æµã€å­—ç¬¦æµã€ç¼“å†²æµã€‚è¿™ä¸ªæ—¶å€™ä¸ºäº†å‡å°‘ä¾èµ–ã€è€¦åˆæ€§ä»¥åŠå¢åŠ æ‰©å±•æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ©ç”¨ Cloaseable æ¥å£æŒ‡å‘å„ç§æµçš„å¯¹è±¡è¿›è¡Œå…³é—­æ“ä½œå³å¯ã€‚ è¿ªç±³ç‰¹åŸåˆ™ è¿ªç±³ç‰¹åŸåˆ™æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶å®ƒå¯¹è±¡æœ‰æœ€å°‘çš„äº†è§£ ä¸€ä¸ªç±»åº”è¯¥å°½å¯èƒ½å°‘çš„åˆ©ç”¨åˆ°å…¶å®ƒç±»å®Œæˆç›¸åŒçš„ä»»åŠ¡ï¼Œè¿™æ ·å¯ä»¥é™ä½è€¦åˆæ€§ å•ä¾‹æ¨¡å¼ å®šä¹‰ æ‰€è°“å•ä¾‹ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€ä¸ªç±»åœ¨ç³»ç»Ÿä¸­åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥è‡ªè¡Œå®ä¾‹åŒ–å‘ç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ ä½¿ç”¨åœºæ™¯ é€‚ç”¨äºæŸä¸ªç±»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¯¹è±¡çš„åœºæ™¯ï¼Œé¿å…åˆ›å»ºå¤šä¸ªå¯¹è±¡æ¶ˆè€—è¿‡å¤šçš„èµ„æºã€‚ æ„é€ å‡½æ•°ä¸å¯¹å¤–å¼€æ”¾ï¼Œä¸€èˆ¬ä¸º private é€šè¿‡ä¸€ä¸ªé™æ€æ–¹æ³•æˆ–è€…æšä¸¾è¿”å›å•ä¾‹ç±»å¯¹è±¡ ç¡®ä¿å•ä¾‹ç±»å¯¹è±¡æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œå°¤å…¶æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ ç¡®ä¿å•ä¾‹ç±»å¯¹è±¡åœ¨ååºåˆ—åŒ–æ—¶ä¸ä¼šé‡æ–°æ„å»ºå¯¹è±¡ ä¹Ÿå³æ˜¯è¯´å•ä¾‹æ¨¡å¼çš„å¯¹è±¡å¿…é¡»ç”±è¯¥ç±»çš„é™æ€æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–å’Œæä¾›ï¼Œå¹¶ä¸”ä¸èƒ½å‡ºç°å¤šä¸ªå¯¹è±¡ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ å•ä¾‹æ¨¡å¼åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€æ”¯ã€‚ å‡å°‘äº†ç³»ç»Ÿçš„æ€§èƒ½å¼€é”€ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„äº§ç”Ÿéœ€è¦è¾ƒå¤šçš„èµ„æºçš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡äº§ç”Ÿä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œç„¶åæ°¸é©»å†…å­˜æ¥è§£å†³ã€‚ å•ä¾‹æ¨¡å¼å¯ä»¥é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ã€‚ å•ä¾‹æ¨¡å¼å¯ä»¥åœ¨ç³»ç»Ÿè®¾ç½®å…¨å±€çš„è®¿é—®ç‚¹ï¼Œä¼˜åŒ–å’Œå…±äº«èµ„æºè®¿é—® ç¼ºç‚¹ å•ä¾‹æ¨¡å¼ä¸€èˆ¬æ²¡æœ‰æ¥å£ï¼Œæ‰©å±•å¾ˆå›°éš¾ã€‚ å•ä¾‹å¯¹è±¡å¦‚æœæŒæœ‰ Contextï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å¼•å‘å†…å­˜æ³„æ¼ï¼Œæ­¤æ—¶ä¼ é€’ç»™å•ä¾‹å¯¹è±¡çš„ Context æœ€å¥½æ˜¯ Application Context å¸¸ç”¨çš„å®ç°æ–¹å¼ é¥¿æ±‰æ¨¡å¼ 1234567891011public class CEO &#123; private static CEO sCeo = new CEO(); private CEO() &#123; super(); &#125; public static CEO newInstance() &#123; return sCeo; &#125;&#125; è¯¥ç§æ–¹å¼å®ç°çš„å•ä¾‹æ¨¡å¼å½“ç±»è¢«åŠ è½½çš„æ—¶å€™å°±ä¼šåˆå§‹åŒ–ä¸€ä¸ª CEO å¯¹è±¡ï¼Œç„¶åå¤–éƒ¨å¯ä»¥é€šè¿‡ newInstance é™æ€æ–¹æ³•è¿›è¡Œè·å–ã€‚ ç”±äºå•ä¾‹æ¨¡å¼éœ€è¦ç±»èƒ½å¤Ÿè‡ªè¡Œè¿›è¡Œå®ä¾‹åŒ–ï¼Œæ‰€ä»¥è¿”å›å€¼ä¸€å®šæ˜¯ç±»å˜é‡ä»¥åŠé€šè¿‡é™æ€æ–¹æ³•è¿›è¡Œè¿”å›ã€‚ æ‡’æ±‰æ¨¡å¼ 1234567891011121314public class SingleInstance &#123; private static SingleInstance sSingleInstance; private SingleInstance() &#123; super(); &#125; public static synchronized SingleInstance newInstance() &#123; if (sSingleInstance != null) &#123; sSingleInstance = new SingleInstance(); &#125; return sSingleInstance; &#125;&#125; é‡‡ç”¨æ‡’æ±‰æ¨¡å¼å®ç°çš„å•ä¾‹æ¨¡å¼å¯ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™æ‰å°†å¯¹è±¡å®ä¾‹åŒ–ï¼Œä½†æ˜¯ç”±äºæ¯æ¬¡è°ƒç”¨ newInstance æ–¹æ³•çš„æ—¶å€™éƒ½ä¼šè¿›è¡ŒåŒæ­¥ï¼ˆæ¯”ä¸éœ€è¦åŒæ­¥çš„æ…¢ 100 å€ï¼‰ï¼Œæ‰€ä»¥é€ æˆäº†ä¸å¿…è¦çš„åŒæ­¥å¼€é”€ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ Double Check Lock 123456789101112131415161718public class SingleInstance &#123; private static SingleInstance sSingleInstance = null; private SingleInstance() &#123; super(); &#125; public static SingleInstance newInstance() &#123; if (sSingleInstance != null) &#123; synchronized (SingleInstance.class) &#123; if (sSingleInstance != null) &#123; sSingleInstance = new SingleInstance(); &#125; &#125; &#125; return sSingleInstance; &#125;&#125; ç¬¬ä¸€æ¬¡çš„åˆ¤æ–­é¿å…äº†åœ¨å¯¹è±¡éç©ºæƒ…å†µä¸‹è¿›è¡ŒåŒæ­¥å¯¼è‡´ä¸å¿…è¦å¼€é”€çš„é—®é¢˜ï¼Œç¬¬äºŒæ¬¡åˆ¤æ–­æ˜¯ç”±äºå¯èƒ½å­˜åœ¨çº¿ç¨‹ Aï¼ŒB åŒæ—¶åˆ¤æ–­äº†å¯¹è±¡ä¸ºç©ºï¼Œç„¶åä¾æ¬¡è¿›å…¥åŒæ­¥å—ä¸­ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ä¸è¿›è¡Œåˆ¤æ–­åˆ™å¯èƒ½å¯¼è‡´åˆ›å»ºå‡ºä¸¤ä¸ªå¯¹è±¡å‡ºæ¥ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œç¬¬äºŒæ¬¡åˆ¤æ–­ã€‚ è¿™ä¸ªæ¨¡å¼å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ mSingleInstance = new SingleInstance() ä¸æ˜¯åŸå­æ“ä½œï¼Œå…¶åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šç»™å®ä¾‹å¯¹è±¡åˆ†é…å†…å­˜ï¼›è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æˆå‘˜å­—æ®µï¼›å°†å®ä¾‹å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ã€‚å¹¶ä¸”åä¸¤æ­¥çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥å¯èƒ½å‡ºç° A çº¿ç¨‹æ‰§è¡Œå®Œç¬¬ä¸‰æ­¥ï¼Œæ²¡æœ‰æ‰§è¡Œå®Œç¬¬äºŒæ­¥çš„æƒ…å†µä¸‹ï¼Œç¨‹åºåˆ‡æ¢è‡³ B çº¿ç¨‹ï¼ŒB çº¿ç¨‹åˆ¤æ–­å½“å‰å¯¹è±¡éç©ºå–èµ°å¯¹è±¡ï¼Œä½†ç”±äºå¯¹è±¡çš„æˆå‘˜å­—æ®µæ²¡æœ‰åˆå§‹åŒ–å®Œæˆï¼Œæ‰€ä»¥å¯èƒ½å‡ºç°é”™è¯¯ã€‚ è§£å†³åŠæ³•æ˜¯åœ¨ sInstance å‰åŠ ä¸Š volatile å…³é”®å­—ã€‚ é™æ€å†…éƒ¨ç±» 12345678910111213public class SingleInstance &#123; private SingleInstance() &#123; super(); &#125; public static SingleInstance newInstance() &#123; return SingleHolder.sSingleInstance; &#125; private static class SingleHolder &#123; private static final SingleInstance sSingleInstance = new SingleInstance(); &#125;&#125; é‡‡ç”¨è¿™ç§æ–¹å¼å®ç°çš„å•ä¾‹æ¨¡å¼å¾ˆå¥½çš„é¿å…äº† DCL ä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œç”±äºå†…éƒ¨ç±»åªæœ‰åœ¨ä½¿ç”¨å®ƒçš„æˆå‘˜ä»¥åŠæ–¹æ³•çš„æ—¶å€™æ‰ä¼šè¿›è¡Œè½½å…¥ï¼Œæ‰€ä»¥å¯ä»¥åšåˆ°ä½¿ç”¨çš„æ—¶å€™æ‰å®ä¾‹åŒ–å¯¹è±¡ï¼Œè€Œä¸”èƒ½å¤Ÿç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚ æšä¸¾å•ä¾‹ 1234567public enum SingletonEnum &#123; INSTANCE; public void doSomething() &#123; System.out.println("do sth."); &#125;&#125; åœ¨ä»»ä½•æƒ…å†µä¸‹æšä¸¾å®ä¾‹éƒ½æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œè€Œä¸”åˆ›å»ºè¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å®¹å™¨å®ç°å•ä¾‹ 12345678910111213141516public class SingletonManager &#123; private static Map&lt;String, Object&gt; objectMap = new HashMap&lt;&gt;(); private SingletonManager() &#123; &#125; public static void registerService(String key, Object instance) &#123; if (!objectMap.containsKey(key)) &#123; objectMap.put(key, instance); &#125; &#125; public static Object getService(String key) &#123; return objectMap.get(key); &#125;&#125; é‡‡ç”¨å®¹å™¨å®ç°çš„å•ä¾‹æ¨¡å¼å¯ä»¥å¯¹å¤šç§å¯¹è±¡çš„å•ä¾‹è¿›è¡Œç®¡ç†ï¼Œä¾‹å¦‚ Android å½“ä¸­çš„ getSystemService å°±æ˜¯è¿™æ ·å®ç°çš„å•ä¾‹æ¨¡å¼ã€‚ æ€»ç»“ å‰å››ç§æ–¹å¼å®ç°çš„å•ä¾‹æ¨¡å¼å­˜åœ¨åœ¨ååºåˆ—åŒ–ï¼ˆåå°„æ‰§è¡Œæ— å‚æ„é€ å‡½æ•°ï¼‰çš„æƒ…å†µä¸‹å¯èƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬éœ€è¦é‡å†™ readResolve æ–¹æ³•ï¼Œè¿™æ ·åœ¨è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•è·å–å¯¹è±¡å®ä¾‹ã€‚ 123private Object readResolve()throws ObjectStreamException&#123; return sSingleInstance;&#125; å•ä¾‹æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå°†æ„é€ å‡½æ•°è¿›è¡Œç§æœ‰åŒ–ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ä¸ªé™æ€æ–¹æ³•è¿”å›å”¯ä¸€çš„å¯¹è±¡å®ä¾‹ï¼Œåœ¨è¿™ä¸ªè·å–çš„è¿‡ç¨‹å½“ä¸­éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ã€é˜²æ­¢ååºåˆ—åŒ–å¯¼è‡´ç”Ÿæˆå®ä¾‹å¯¹è±¡ç­‰é—®é¢˜ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Androidæºç è®¾è®¡æ¨¡å¼è§£æä¸å®æˆ˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android è‡ªå®šä¹‰æ§ä»¶ä¹‹ç™¾åˆ†æ¯”åœ†ç¯]]></title>
    <url>%2F2017%2F09%2F10%2FAndroid%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%E4%B9%8B%E7%99%BE%E5%88%86%E6%AF%94%E5%9C%86%E7%8E%AF%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ€è¿‘åšä¸€ä¸ªç®€å•çš„æµ‹è¯• APP çš„æ—¶å€™éœ€è¦å°†æ‰‹æœºçš„å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µæ˜¾ç¤ºå‡ºæ¥ï¼Œåˆšå¥½çœ‹è§ 360 æ¸…ç†å¤§å¸ˆçš„å­˜å‚¨ç©ºé—´æ˜¯ä»¥ç™¾åˆ†æ¯”åœ†ç¯çš„æ–¹å¼å®ç°çš„ï¼Œæ‰€ä»¥å¤§è‡´æ¨¡ä»¿äº†ä¸€ä¸‹å®ƒçš„å®ç°è¿‡ç¨‹ã€‚ æ•ˆæœå›¾ é¦–å…ˆæ”¾ä¸Šæ•ˆæœå›¾ï¼Œç„¶åæˆ‘ä»¬å†æ ¹æ®æ•ˆæœå›¾è¿›è¡Œåˆ†æ å®ç°æ€è·¯ ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»˜åˆ¶ä¸€ä¸ªè¿™æ ·çš„ç™¾åˆ†æ¯”åœ†ç¯ä¸»è¦æœ‰æ¶‰åŠåˆ°ä¸‰ä¸ªå…ƒç´ ï¼š èƒŒæ™¯ç©ºå¿ƒåœ†ï¼šä»£è¡¨ç€æ€»çš„è¿›åº¦ åœ†å¼§ï¼šä»£è¡¨ç€å½“å‰è¿›åº¦ æ–‡å­—ï¼šéœ€è¦å±…ä¸­ï¼Œè¡¨ç¤ºå…·ä½“çš„è¿›åº¦ åœ¨äº†è§£åˆ°æ¶‰åŠåˆ°çš„å…ƒç´ ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ç»˜åˆ¶å„ä¸ªå…ƒç´ éœ€è¦å“ªäº›å‚æ•°ï¼Œç”±äºç»˜åˆ¶éƒ½é€šè¿‡ onDraw æ–¹æ³•ä¸­çš„ canvas å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ canvas å¯¹è±¡çš„æ–¹æ³•å»ç¡®å®šæ‰€éœ€è¦çš„å‚æ•°ã€‚ ç»˜åˆ¶åœ†ï¼šæŸ¥çœ‹ drawCircle å¯ä»¥çŸ¥é“æ€»å…±éœ€è¦å››ä¸ªå‚æ•°ï¼šåœ†å¿ƒ Xã€Y åæ ‡ã€åŠå¾„é•¿åº¦ä»¥åŠç”»ç¬” Paintï¼› ç»˜åˆ¶åœ†å¼§ï¼šæŸ¥çœ‹ drawArc å¯ä»¥çŸ¥é“æ€»å…±éœ€è¦å››ä¸ªå‚æ•°ï¼šRecfã€åœ†å¼§çš„èµ·å§‹è§’åº¦ã€ä»èµ·å§‹è§’åº¦é¡ºæ—¶é’ˆæ‰«è¿‡çš„è§’åº¦ä»¥åŠå¿…é¡»çš„ Paintï¼Œè¿™é‡Œçš„ Recf ç¡®å®šäº†ä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼Œç„¶åç¡®å®šäº†ä¸€ä¸ªå†…æ¥æ¤­åœ†ï¼Œè€Œåœ†å¼§çš„ç»˜åˆ¶å®é™…ä¸Šæ˜¯åœ¨æ¤­åœ†ä¸Šé¢è¿›è¡Œæˆªå–ï¼› ç»˜åˆ¶æ–‡æœ¬ï¼šæŸ¥çœ‹ drawText å¯ä»¥çŸ¥é“ï¼Œéœ€è¦å››ä¸ªå‚æ•°ï¼šæ–‡æœ¬å†…å®¹ã€è¿›è¡Œç»˜åˆ¶çš„ Xã€Y åæ ‡ç‚¹ä»¥åŠPaintã€‚ å®ç°è¿‡ç¨‹ åœ¨äº†è§£äº†ç»˜åˆ¶å…ƒç´ æ‰€éœ€è¦çš„å‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä¸€æ­¥æ­¥è¿›è¡Œç»˜åˆ¶äº†ï¼š é¦–å…ˆæ˜¯ç»˜åˆ¶åœ†ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†å››ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºåœ†å¿ƒ Xï¼ŒY çš„åæ ‡ã€åŠå¾„ä»¥åŠç»˜åˆ¶æ‰€éœ€è¦çš„ç”»ç¬”ï¼Œç„¶åå¯¹è¿™äº›å‚æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆåœ¨ onDraw è¿›è¡Œç»˜åˆ¶ã€‚ 123456789101112131415161718192021222324252627282930public class RingPercentDemo extends View &#123; private int mCircleX; private int mCircleY; private int mRadius; private Paint mCirclePaint; public RingPercentDemo(Context context) &#123; super(context); &#125; public RingPercentDemo(Context context, @Nullable AttributeSet attrs) &#123; super(context, attrs); mCircleX = 300; mCircleY = 300; mRadius = 260; mCirclePaint = new Paint(); mCirclePaint.setColor(Color.BLUE); mCirclePaint.setStrokeWidth(10); mCirclePaint.setStyle(Style.STROKE); //ç»˜åˆ¶ç©ºå¿ƒåœ†æ‰€ä»¥ä¸éœ€è¦å¡«å…… &#125; @Override protected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); canvas.drawCircle(mCircleX, mCircleY, mRadius, mCirclePaint); &#125;&#125; æ¥ä¸‹æ¥æ˜¯ç»˜åˆ¶åœ†ç¯ï¼Œä»æ•ˆæœå›¾ä¸Šå¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ†ç¯å®é™…ä¸Šæ˜¯åœ¨åœ†ä¸Šæˆªå–ä¸€æ®µåœ†å¼§è¡¨ç¤ºï¼Œæ‰€ä»¥ç»˜åˆ¶åœ†ç¯çš„çŸ©å½¢åŒºåŸŸå¯ä»¥ç¡®å®šä¸‹æ¥ï¼Œåœ¨ç¡®å®šäº†çŸ©å½¢åŒºåŸŸä¹‹ååªéœ€è¦è‡ªå·±è®¾å®šèµ·å§‹çš„è§’åº¦å’Œæ‰«è¿‡çš„è§’åº¦å³å¯ä»¥ç»˜åˆ¶å‡ºåœ¨åœ†ä¸Šçš„åœ†å¼§ã€‚ 123456789101112131415161718192021222324252627282930313233343536public class RingPercentDemo extends View &#123; ... private RectF mRecF; private float mStartAngle; private float mSweepAngle; private Paint mRingPaint; public RingPercentDemo(Context context) &#123; super(context); &#125; public RingPercentDemo(Context context, @Nullable AttributeSet attrs) &#123; super(context, attrs); ... mRecF = new RectF(mCircleX - mRadius, mCircleY - mRadius, mCircleX + mRadius, mCircleY + mRadius); mStartAngle = -90f; mSweepAngle = 120f; mRingPaint = new Paint(); mRingPaint.setColor(Color.RED); mRingPaint.setStrokeWidth(20); mRingPaint.setStyle(Style.STROKE); &#125; @Override protected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); ... canvas.drawArc(mRecF, mStartAngle, mSweepAngle, false, mRingPaint); //è®¾ç½®ä¸º false ä¸ä¸ä¸­å¿ƒç‚¹è¿›è¡Œè¿æ¥ &#125;&#125; æœ€åæ˜¯ç»˜åˆ¶æ–‡æœ¬ï¼Œç”±äºè¦ç»˜åˆ¶åœ¨åœ†çš„ä¸­å¿ƒï¼Œæ‰€ä»¥æ–‡æœ¬çš„åæ ‡æˆ‘ä»¬é¦–å…ˆè®¾ç½®ä¸ºåœ†çš„ä¸­å¿ƒï¼Œç„¶åç»˜åˆ¶çš„é£æ ¼é€‰ä¸º Align.CENTERï¼Œè¿™æ ·æ–‡æœ¬å°†ä»¥è®¾å®šçš„åæ ‡ç‚¹å‘ä¸¤è¾¹å»¶ä¼¸ä¿è¯äº† X å¤„äºä¸­å¿ƒä½ç½®ã€‚ 123456789101112131415161718192021222324252627282930313233343536public class RingPercentDemo extends View &#123; ... private int mTextX; private int mTextY; private Paint mTextPaint; private String mTextStr; public RingPercentDemo(Context context) &#123; super(context); &#125; public RingPercentDemo(Context context, @Nullable AttributeSet attrs) &#123; super(context, attrs); ... mTextPaint = new Paint(); mTextPaint.setColor(Color.BLACK); mTextPaint.setStyle(Style.FILL); mTextPaint.setTextSize(40); mTextPaint.setTextAlign(Align.CENTER); mTextPaint.setTextSize(mRadius / 2); mTextX = mCircleX; mTextY = mCircleY; mTextStr = "33%"; &#125; @Override protected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); ... canvas.drawText(mTextStr, mTextX, mTextY, mTextPaint); &#125;&#125; å®é™…æ•ˆæœå›¾ï¼š è¿™ä¸ªæ—¶å€™æˆ‘ä»¬èƒ½å¤Ÿå‘ç°æ–‡æœ¬å®è´¨ä¸Šä¸åœ¨ä¸­å¿ƒä½ç½®ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬åœ¨è®¾å®šçš„åæ ‡æ˜¯ç”¨äºç¡®å®šç»˜åˆ¶çš„åŸºå‡†çº¿è€Œä¸æ˜¯ç»˜åˆ¶çš„ä¸­å¿ƒç‚¹ï¼Œæ‰€ä»¥è‡ªç„¶æ–‡æœ¬ä¸å¯èƒ½ç»˜åˆ¶åœ¨æ­£ä¸­å¿ƒï¼Œå…·ä½“å¯ä»¥å€Ÿç”¨ä¸‹å›¾æ¥è¿›è¡Œæè¿°ï¼š ä»è¿™å°±å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ï¼Œæ–‡æœ¬çš„ä¸­å¿ƒå’Œè®¾å®šçš„åæ ‡ä¹‹é—´æ˜¯å­˜åœ¨ä¸€ä¸ªåç§»é‡çš„ï¼Œæ‰€ä»¥ä¸ºäº†ä½¿æ–‡æœ¬å¤„äºçœŸæ­£çš„ä¸­å¿ƒï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å¾—åˆ°è¿™ä¸ªåç§»é‡ï¼Œç„¶åå°†ä¹‹å‰è®¾å®šçš„åŸºå‡†çº¿ä¸‹ç§»ã€‚åœ¨è®¡ç®—åç§»é‡ä¹‹å‰é¦–å…ˆéœ€è¦äº†è§£å­—ä½“æ˜¯å¦‚ä½•è¿›è¡Œæµ‹é‡çš„ï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å…¶ä¸­ Top è¡¨ç¤ºåŸºå‡†çº¿ä»¥ä¸Šå¯ç»˜åˆ¶çš„æœ€å¤§è·ç¦»ï¼ˆè´Ÿæ•°ï¼‰ï¼ŒBottom è¡¨ç¤ºåŸºå‡†çº¿ä»¥ä¸‹å¯ç»˜åˆ¶çš„æœ€å¤§è·ç¦»ï¼ˆæ­£æ•°ï¼‰ï¼ŒAscent è¡¨ç¤ºåŸºå‡†çº¿ä»¥ä¸Šæ¨èçš„å¯ç»˜åˆ¶çš„è·ç¦»ï¼ŒDescent è¡¨ç¤ºåŸºå‡†çº¿ä»¥ä¸‹æ¨èçš„å¯ç»˜åˆ¶çš„è·ç¦»ã€‚ äº†è§£å®Œè¿™ä¸€åˆ‡ä¹‹åå¦‚ä½•è®¡ç®—åç§»é‡å°±å¾ˆç®€å•äº†ï¼Œé€šè¿‡ FontMetrics è·å– Bottom å’Œ Topï¼Œç„¶åé€šè¿‡ ((Bottom - Top) / 2) - Bottom æœ€ç»ˆå–å¾—åç§»é‡ã€‚ä»£ç åšå¦‚ä¸‹ä¿®æ”¹ï¼š 123456789101112131415161718192021public class RingPercentDemo extends View &#123; ... private int mTextX; private int mTextY; private Paint mTextPaint; private String mTextStr; public RingPercentDemo(Context context) &#123; super(context); &#125; public RingPercentDemo(Context context, @Nullable AttributeSet attrs) &#123; ... FontMetrics fontMetrics = mTextPaint.getFontMetrics(); float offsetY = ((fontMetrics.bottom - fontMetrics.top) / 2) - fontMetrics.bottom; mTextY = (int) (mCircleY + offsetY); ... &#125;&#125; ä¿®æ”¹ä¹‹åçš„æ•ˆæœï¼š æ”¹è¿› è‡ªå®šä¹‰å±æ€§ ç»è¿‡ä¸Šè¿°è¿‡ç¨‹ï¼Œè™½ç„¶åœ†ç¯ç™¾åˆ†æ¯”çš„æ•ˆæœå·²ç»å®ç°ï¼Œä½†æ˜¯è·Ÿæ•ˆæœå›¾ä¸­çš„è¿˜æ˜¯å·®çš„å¾ˆè¿œï¼Œè€Œä¸”ä¹Ÿä¸èƒ½å¤Ÿçµæ´»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ©è‡ªå®šä¹‰å±æ€§å»æ”¹è¿›æˆ‘ä»¬çš„åœ†ç¯ã€‚ é¦–å…ˆéœ€è¦åœ¨ values æ–‡ä»¶å¤¹ä¸‹åˆ›å»º attrs.xml æ–‡ä»¶åœ¨é‡Œé¢å£°æ˜æˆ‘ä»¬éœ€è¦å®šä¹‰çš„å±æ€§ï¼š 1234567891011121314&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;resources&gt; &lt;declare-styleable name="RingPercentDemo"&gt; &lt;attr format="integer" name="radius" /&gt; &lt;attr format="color" name="circleColor" /&gt; &lt;attr format="integer" name="circleStrokeWidth" /&gt; &lt;attr format="integer" name="circleStyle" /&gt; &lt;attr format="color" name="ringColor" /&gt; &lt;attr format="integer" name="ringStrokeWidth" /&gt; &lt;attr format="integer" name="startAngle" /&gt; &lt;attr format="integer" name="sweepAngle" /&gt; &lt;attr format="integer" name="rate" /&gt; &lt;/declare-styleable&gt;&lt;/resources&gt; ç„¶ååœ¨æ„é€ å‡½æ•°è·å–åˆ°è‡ªå®šä¹‰çš„å±æ€§çš„å±æ€§å€¼ 12345678910111213141516171819202122232425262728public RingPercentDemo(Context context, @Nullable AttributeSet attrs) &#123; super(context, attrs); TypedArray typedArray = context.obtainStyledAttributes( attrs, R.styleable.RingPercentDemo); mRadius = typedArray.getInteger(R.styleable.RingPercentDemo_radius, 60); mCircleColor = typedArray.getColor( R.styleable.RingPercentDemo_circleColor, Color.GREEN); mCircleStrokeWidth = typedArray.getInteger( R.styleable.RingPercentDemo_circleStrokeWidth, 5); mCircleStyle = typedArray.getInteger( R.styleable.RingPercentDemo_circleStyle, 0); mRingColor = typedArray.getColor( R.styleable.RingPercentDemo_ringColor, Color.RED); mRingStrokeWidth = typedArray.getColor( R.styleable.RingPercentDemo_ringStrokeWidth, 10); mStartAngle = typedArray.getInteger( R.styleable.RingPercentDemo_startAngle, -90); mSweepAngle = typedArray.getInteger( R.styleable.RingPercentDemo_sweepAngle, 90); mRate = typedArray.getInteger(R.styleable.RingPercentDemo_rate, 100); typedArray.recycle(); init(); &#125; åœ¨è·å–åˆ°è¿™äº›å±æ€§å€¼ä¹‹ååªéœ€è¦ç»™å¯¹åº”çš„ Paint å’Œå˜é‡è®¾ç½®å¯¹åº”çš„å€¼å³å¯ã€‚ å›ºå®šåœ†å¿ƒå’ŒåŠ¨æ€å˜åŒ– åœ†å¿ƒçš„ä½ç½®æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä¸€ç›´å¤„äº View çš„ä¸­å¿ƒï¼Œæ‰€ä»¥éœ€è¦é‡å†™ onMeasure æ–¹æ³•ï¼Œåœ¨ onMeasure æ–¹æ³•é€šè¿‡è·å– View çš„é«˜åº¦å’Œå®½åº¦å¾—åˆ°äº† View çš„ä¸­å¿ƒç‚¹åæ ‡ï¼Œä»è€Œä½¿å¾—åœ†å¿ƒä¸€ç›´åœ¨ View çš„ä¸­å¿ƒã€‚ 123456789101112131415161718192021222324@Overrideprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123; setMeasuredDimension(measuse(widthMeasureSpec), measuse(heightMeasureSpec)); mCircleX = getMeasuredWidth() / 2; mCircleY = getMeasuredHeight() / 2; //åˆ¤æ–­è®¾å®šçš„åœ†æ˜¯å¦è¶…å‡ºæ˜¾ç¤ºèŒƒå›´ï¼Œå¦‚æœè¶…å‡ºéœ€è¦ç¼©å° if (mCircleX &lt; mRadius) &#123; mRadius = mCircleX - mCircleStrokeWidth - mRingStrokeWidth; mTextPaint.setTextSize(mRadius / 2); &#125; else if (mCircleY &lt; mRadius) &#123; mRadius = mCircleY - mCircleStrokeWidth - mRingStrokeWidth; mTextPaint.setTextSize(mRadius / 2); &#125; FontMetrics fontMetrics = mTextPaint.getFontMetrics(); int offsetY = (int) (((fontMetrics.bottom - fontMetrics.top)) / 2 - fontMetrics.bottom); mTextX = mCircleX; mTextY = mCircleY + offsetY; mRecF = new RectF(mCircleX - mRadius, mCircleY - mRadius, mCircleX + mRadius, mCircleY + mRadius);&#125; åœ¨è§£å†³äº†åœ†å¿ƒçš„é—®é¢˜ä¹‹åï¼Œè¿˜éœ€è¦ä¸ºåœ†å¼§æä¾›åŠ¨æ€å˜åŒ–çš„æ•ˆæœï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡ä¸æ–­é‡ç»˜è¾¾æˆç›®æ ‡ã€‚ 1234567891011121314@Overrideprotected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); canvas.drawCircle(mCircleX, mCircleY, mRadius, mCirclePaint); canvas.drawArc(mRecF, mStartAngle, mCurrentAngle, false, mRingPaint); canvas.drawText(mTextStr, mTextX, mTextY, mTextPaint); if (mCurrentAngle &lt; mSweepAngle) &#123; mCurrentAngle += 3.6; mTextStr = mCurrentAngle * 100 / 360 + "%"; postInvalidateDelayed(mRate); &#125;&#125; ç›¸å…³æµ‹è¯•å·¥ç¨‹ æ€»ç»“ æ¶‰åŠåˆ° View çš„ç»˜åˆ¶éœ€è¦å¯¹å…ƒç´ è¿›è¡Œæ‹†åˆ†ï¼Œç„¶åè¿›è¡Œå•ç‹¬å¤„ç†ï¼Œè¿™æ ·æ€è·¯ä¼šæ¯”è¾ƒæ¸…æ™° Thanks android canvas drawText()æ–‡å­—å±…ä¸­ Androidè‡ªå®šä¹‰æ§ä»¶ä¹‹ç™¾åˆ†æ¯”åœ†ç¯è¿›åº¦æ¡]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android è¿›é˜¶ä¹‹ Binder æµ…è§£]]></title>
    <url>%2F2017%2F09%2F03%2FAndroid%E8%BF%9B%E9%98%B6%E4%B9%8BBinder%E6%B5%85%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯ Binder Binder æ˜¯ Android ä¸­ä¸€ç§è·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰æ–¹å¼ã€‚ #### Binder çš„åŸç† Binderé€šä¿¡é‡‡ç”¨C/Sæ¶æ„ï¼Œä»ç»„ä»¶è§†è§’æ¥è¯´ï¼ŒåŒ…å« Clientã€Serverã€ServiceManager ä»¥åŠ binder é©±åŠ¨ï¼Œå…¶ä¸­ ServiceManager ç”¨äºç®¡ç†ç³»ç»Ÿä¸­çš„å„ç§æœåŠ¡ã€‚æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š æ­¤å¤„çš„ Service Manager æ˜¯æŒ‡ Native å±‚çš„ ServiceManagerï¼ˆC++ï¼‰ æ³¨å†ŒæœåŠ¡(addService)ï¼šServer è¿›ç¨‹è¦å…ˆæ³¨å†Œ Service åˆ° ServiceManagerã€‚è¯¥è¿‡ç¨‹ï¼šServer æ˜¯å®¢æˆ·ç«¯ï¼ŒServiceManager æ˜¯æœåŠ¡ç«¯ã€‚ è·å–æœåŠ¡(getService)ï¼šClient è¿›ç¨‹ä½¿ç”¨æŸä¸ª Service å‰ï¼Œé¡»å…ˆå‘ ServiceManager ä¸­è·å–ç›¸åº”çš„ Serviceã€‚è¯¥è¿‡ç¨‹ï¼šClient æ˜¯å®¢æˆ·ç«¯ï¼ŒServiceManager æ˜¯æœåŠ¡ç«¯ã€‚ ä½¿ç”¨æœåŠ¡ï¼šClient æ ¹æ®å¾—åˆ°çš„ Service ä¿¡æ¯å»ºç«‹ä¸ Service æ‰€åœ¨çš„ Server è¿›ç¨‹é€šä¿¡çš„é€šè·¯ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥ä¸ Service äº¤äº’ã€‚è¯¥è¿‡ç¨‹ï¼šClient æ˜¯å®¢æˆ·ç«¯ï¼ŒServer æ˜¯æœåŠ¡ç«¯ã€‚ Binder çš„ç»“æ„ åœ¨å­¦ä¹  Binder çš„ç»“æ„çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨ AIDL å»ç”Ÿæˆ Binderï¼Œè¿™é‡Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªå®ç°äº† Parcelable æ¥å£çš„ Book ç±»ï¼Œç„¶ååœ¨ main æ–‡ä»¶å¤¹ä¸‹åˆ›å»º AIDL æ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«åˆ›å»º Book.aidlã€IBookManager.aidlã€‚ä¸‰ä¸ªæ–‡ä»¶çš„ä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768//Book.javapackage com.rookieyang.aidltest;import android.os.Parcel;import android.os.Parcelable;/** * Created by firstdream on 2017/9/4. */public class Book implements Parcelable &#123; private int mBookId; private String mBookName; public Book(int mBookId, String mBookName) &#123; this.mBookId = mBookId; this.mBookName = mBookName; &#125; @Override public void writeToParcel(Parcel parcel, int i) &#123; parcel.writeInt(mBookId); parcel.writeString(mBookName); &#125; @Override public int describeContents() &#123; return 0; &#125; public static final Parcelable.Creator&lt;Book&gt; CREATOR = new Creator&lt;Book&gt;() &#123; @Override public Book createFromParcel(Parcel parcel) &#123; Book book = new Book(parcel.readInt(), parcel.readString()); return book; &#125; @Override public Book[] newArray(int size) &#123; return new Book[size]; &#125; &#125;;&#125;// Book.aidlpackage com.rookieyang.aidltest;// Declare any non-default types here with import statementsparcelable Book;// IBookManager.aidlpackage com.rookieyang.aidltest;//éœ€è¦å¯¼å…¥ Book ç±»import com.rookieyang.aidltest.Book;// Declare any non-default types here with import statementsinterface IBookManager &#123; /** * Demonstrates some basic types that you can use as parameters * and return values in AIDL. */ List&lt;Book&gt; getBookList(); void addBook(in Book book);&#125; åœ¨ç»è¿‡ä¸Šè¿°çš„è¿‡ç¨‹ä¹‹åï¼Œç‚¹å‡»ç¼–è¯‘å³å¯ç”Ÿæˆ Binder æ–‡ä»¶ï¼Œä»¥ IBookManager.aidl ç”Ÿæˆçš„ IBookManager.java ä¸ºä¾‹ï¼Œ IBookManager.java ä¸­å®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿è‡ª IInterface çš„ IBookManager æ¥å£ï¼Œåœ¨ IBookManager å†…åŒ…å«äº†ç»§æ‰¿è‡ª Binder å®ç°äº† IBookManager æ¥å£çš„å†…éƒ¨ç±» Stub å’Œ å®ç°äº† IBookManager æ¥å£çš„ Stub çš„å†…éƒ¨ç±» Proxyã€‚æ•´ä½“ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‹é¢é’ˆå¯¹ IBookManager.java è¿›è¡Œå…·ä½“çš„åˆ†æï¼š IBookManager æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¸åœ¨ IBookManager.aidl ä¸­ä¸€è‡´ getBookList() addBook(Book book) 12345678910public interface IBookManager extends IInterface &#123; /** * Demonstrates some basic types that you can use as parameters * and return values in AIDL. */ public List&lt;Book&gt; getBookList() throws RemoteException; public void addBook(Book book) throws RemoteException;&#125; Stub ç±» DESCRIPTOR Binder çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€èˆ¬ç”¨å½“å‰ Binder çš„ç±»åè¡¨ç¤º TRANSACTION_getBookList å’Œ TRANSACTION_addBook ä¸¤ä¸ªidç”¨äºæ ‡è¯†åœ¨transactè¿‡ç¨‹ä¸­å®¢æˆ·ç«¯æ‰€è¯·æ±‚çš„åˆ°åº•æ˜¯å“ªä¸ªæ–¹æ³• asInterface(IBinder obj) ç”¨äºå°†æœåŠ¡ç«¯çš„ Binder å¯¹è±¡è½¬æ¢æˆå®¢æˆ·ç«¯æ‰€éœ€çš„ AIDL æ¥å£ç±»å‹çš„å¯¹è±¡ï¼Œè¿™ç§è½¬æ¢è¿‡ç¨‹æ˜¯åŒºåˆ†è¿›ç¨‹çš„ï¼Œå¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½äºåŒä¸€è¿›ç¨‹ï¼Œé‚£ä¹ˆæ­¤æ–¹æ³•è¿”å›çš„å°±æ˜¯æœåŠ¡ç«¯çš„ Stub å¯¹è±¡æœ¬èº«ï¼Œå¦åˆ™è¿”å›çš„æ˜¯ç³»ç»Ÿå°è£…åçš„ Stub.proxy å¯¹è±¡ã€‚ asBinder æ­¤æ–¹æ³•ç”¨äºè¿”å›å½“å‰ Binder å¯¹è±¡ã€‚ onTransact è¿™ä¸ªæ–¹æ³•è¿è¡Œåœ¨æœåŠ¡ç«¯ä¸­çš„ Binder çº¿ç¨‹æ± ä¸­ï¼Œå½“å®¢æˆ·ç«¯å‘èµ·è·¨è¿›ç¨‹è¯·æ±‚æ—¶ï¼Œè¿œç¨‹è¯·æ±‚ä¼šé€šè¿‡ç³»ç»Ÿåº•å±‚å°è£…åäº¤ç”±æ­¤æ–¹æ³•æ¥å¤„ç†ã€‚ æœåŠ¡ç«¯é€šè¿‡ code å¯ä»¥ç¡®å®šå®¢æˆ·ç«¯æ‰€è¯·æ±‚çš„ç›®æ ‡æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Œæ¥ç€ä» data ä¸­å–å‡ºç›®æ ‡æ–¹æ³•æ‰€éœ€çš„å‚æ•°ï¼ˆå¦‚æœç›®æ ‡æ–¹æ³•æœ‰å‚æ•°çš„è¯ï¼‰ï¼Œç„¶åæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚å½“ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå°±å‘ reply ä¸­å†™å…¥è¿”å›å€¼ï¼ˆå¦‚æœç›®æ ‡æ–¹æ³•æœ‰è¿”å›å€¼çš„è¯ï¼‰ï¼ŒonTransact æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566public static abstract class Stub extends Binder implements IBookManager &#123; private static final String DESCRIPTOR = "com.rookieyang.binderdemo.IBookManager"; /** * Construct the stub at attach it to the interface. */ public Stub() &#123; this.attachInterface(this, DESCRIPTOR); &#125; /** * Cast an IBinder object into an IBookManager interface, * generating a proxy if needed. */ public static IBookManager asInterface(IBinder obj) &#123; if ((obj == null)) &#123; return null; &#125; IInterface iin = obj.queryLocalInterface(DESCRIPTOR); if (((iin != null) &amp;&amp; (iin instanceof IBookManager))) &#123; return ((IBookManager) iin); &#125; return new IBookManager.Stub.Proxy(obj); &#125; @Override public IBinder asBinder() &#123; return this; &#125; @Override public boolean onTransact(int code, Parcel data, Parcel reply, int flags) throws RemoteException &#123; switch (code) &#123; case INTERFACE_TRANSACTION: &#123; reply.writeString(DESCRIPTOR); return true; &#125; case TRANSACTION_getBookList: &#123; data.enforceInterface(DESCRIPTOR); List&lt;Book&gt; _result = this.getBookList(); reply.writeNoException(); reply.writeTypedList(_result); return true; &#125; case TRANSACTION_addBook: &#123; data.enforceInterface(DESCRIPTOR); Book _arg0; if ((0 != data.readInt())) &#123; //ååºåˆ—åŒ– _arg0 = Book.CREATOR.createFromParcel(data); &#125; else &#123; _arg0 = null; &#125; this.addBook(_arg0); reply.writeNoException(); return true; &#125; &#125; return super.onTransact(code, data, reply, flags); &#125; static final int TRANSACTION_getBookList = (IBinder.FIRST_CALL_TRANSACTION + 0); static final int TRANSACTION_addBook = (IBinder.FIRST_CALL_TRANSACTION + 1);&#125; Proxy ç±» getBookList è¿™ä¸ªæ–¹æ³•è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯è¿œç¨‹è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œå®ƒçš„å†…éƒ¨å®ç°æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆåˆ›å»ºè¯¥æ–¹æ³•æ‰€éœ€è¦çš„è¾“å…¥å‹ Parcel å¯¹è±¡ _data ã€è¾“å‡ºå‹ Parcel å¯¹è±¡ _reply å’Œè¿”å›å€¼å¯¹è±¡ Listï¼›ç„¶åæŠŠè¯¥æ–¹æ³•çš„å‚æ•°ä¿¡æ¯å†™å…¥ _data ä¸­ï¼ˆå¦‚æœæœ‰å‚æ•°çš„è¯ï¼‰ï¼›æ¥ç€è°ƒç”¨ transact æ–¹æ³•æ¥å‘èµ· RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰è¯·æ±‚ï¼ŒåŒæ—¶å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼›ç„¶åæœåŠ¡ç«¯çš„ onTransact æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç›´åˆ° RPC è¿‡ç¨‹è¿”å›åï¼Œå½“å‰çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œå¹¶ä» _reply ä¸­å–å‡º RPC è¿‡ç¨‹çš„è¿”å›ç»“æœï¼›æœ€åè¿”å› _reply ä¸­çš„æ•°æ®ã€‚ addBook è¿™ä¸ªæ–¹æ³•è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼Œå®ƒçš„æ‰§è¡Œè¿‡ç¨‹å’Œ getBookList æ˜¯ä¸€æ ·çš„ï¼ŒaddBook æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦ä» _reply ä¸­å–å‡ºè¿”å›å€¼ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960private static class Proxy implements IBookManager &#123; private IBinder mRemote; Proxy(IBinder remote) &#123; mRemote = remote; &#125; @Override public IBinder asBinder() &#123; return mRemote; &#125; public String getInterfaceDescriptor() &#123; return DESCRIPTOR; &#125; /** * Demonstrates some basic types that you can use as parameters * and return values in AIDL. */ @Override public List&lt;Book&gt; getBookList() throws RemoteException &#123; Parcel _data = Parcel.obtain(); Parcel _reply = Parcel.obtain(); java.util.List&lt;Book&gt; _result; try &#123; _data.writeInterfaceToken(DESCRIPTOR); mRemote.transact(Stub.TRANSACTION_getBookList, _data, _reply, 0); _reply.readException(); _result = _reply.createTypedArrayList(Book.CREATOR); &#125; finally &#123; _reply.recycle(); _data.recycle(); &#125; return _result; &#125; @Override public void addBook(Book book) throws RemoteException &#123; Parcel _data = Parcel.obtain(); Parcel _reply = Parcel.obtain(); try &#123; _data.writeInterfaceToken(DESCRIPTOR); if ((book != null)) &#123; _data.writeInt(1); book.writeToParcel(_data, 0); &#125; else &#123; _data.writeInt(0); &#125; mRemote.transact(Stub.TRANSACTION_addBook, _data, _reply, 0); _reply.readException(); &#125; finally &#123; _reply.recycle(); _data.recycle(); &#125; &#125;&#125; Binder çš„å·¥ä½œæœºåˆ¶ &gt; ä»¥ä¸Šè¿°ä¸ºä¾‹ï¼Œå®¢æˆ·ç«¯è°ƒç”¨ getBookList æ–¹æ³•æ—¶ï¼Œåœ¨æ–¹æ³•å†…éƒ¨å®šä¹‰äº† Parcel å¯¹è±¡ï¼Œç„¶åé€šè¿‡è°ƒç”¨ transact å‘èµ·è¿œç¨‹è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°åè°ƒç”¨ onTransact æ–¹æ³•ï¼Œæ ¹æ®ä¼ é€’è¿‡æ¥çš„ Code è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå°†ç»“æœå†™å…¥ Parcel å¯¹è±¡å½“ä¸­ï¼Œå¤„ç†å®Œæˆä¹‹ååœ¨ å®¢æˆ·ç«¯çš„ transact å°†ç»“æœå–å‡ºæ¥å¹¶è¿”å›ã€‚ Binder ä½¿ç”¨çš„ä¸€äº›æ³¨æ„ç‚¹ Binder ä¸€èˆ¬å’Œ Service é…åˆä½¿ç”¨ï¼Œä½œä¸º bindService æ‰§è¡Œæ—¶çš„è¿”å›ï¼Œæœ€ååœ¨ ServiceConnect å½“ä¸­è·å–è¿”å›çš„ Binderï¼š 1234567891011private ServiceConnection serviceConnection = new ServiceConnection() &#123; @Override public void onServiceConnected(ComponentName componentName, IBinder iBinder) &#123; mCalcAidl = ICalcAIDL.Stub.asInterface(iBinder); &#125; @Override public void onServiceDisconnected(ComponentName componentName) &#123; mCalcAidl = null; &#125;&#125;; ä¸åŒè¿›ç¨‹æ—¶è¿”å›çš„ iBinder æ˜¯ ICalcAIDL.Stub.Proxyï¼Œè€Œç›¸åŒè¿›ç¨‹ä¸­åˆ™æ˜¯ ICalcAIDL.Stubã€‚æ˜¯è¿”å› Stub è¿˜æ˜¯è¿”å› Proxy åœ¨åº•å±‚å·²ç»åšäº†åˆ¤æ–­ï¼Œä¸æ˜¯åœ¨ onServiceConnected æ–¹æ³•ä¸­è¿›è¡Œçš„åˆ¤æ–­ åœ¨æœåŠ¡ä¸­ä½¿ç”¨æ—¶ï¼Œå®šä¹‰çš„ AIDL æ–‡ä»¶åŒ…åå¿…é¡»ç›¸åŒï¼Œä¸ç„¶å°†æ— æ³•æ‰¾åˆ°å¯¹åº”çš„ AIDLï¼Œä»è€Œå¯¼è‡´æ— æ³•è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”ä½¿ç”¨æ—¶éœ€è¦é€šè¿‡ ICalcAIDL.Stub å®ç°åœ¨ AIDL ä¸­å®šä¹‰çš„æ¥å£ï¼Œä»è€Œä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚ 1234567891011private final ICalcAIDL.Stub mBinder = new Stub() &#123; @Override public int add(int x, int y) throws RemoteException &#123; return x + y; &#125; @Override public int min(int x, int y) throws RemoteException &#123; return x - y; &#125;&#125;; æ€»ç»“ ç²—ç•¥çš„è¯´ï¼ŒClient é€šè¿‡ Binder å½“ä¸­çš„ Proxy è¿›è¡Œäº† IPC çš„è¯·æ±‚ï¼Œè€Œ Server åˆ™é€šè¿‡ Stub å½“ä¸­çš„ onTransact å¯¹è·¨è¿›ç¨‹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä¹‹æ‰€ä»¥èƒ½è¿›è¡Œè·¨è¿›ç¨‹è¯·æ±‚çš„åŸå› åœ¨äºåº•å±‚èƒ½å¤Ÿé€šè¿‡å¯åºåˆ—åŒ–çš„æ•°æ®ï¼Œä¸Šè¿°çš„ Book ç±»å®ç°äº† Parcelable æ¥å£ï¼Œè€ŒåŸºæœ¬ç±»å‹æ˜¯è¢«çœ‹ä½œå¯åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®åœ¨åº•å±‚èƒ½å¤Ÿè¿›è¡Œä¼ è¾“ï¼Œè‡ªç„¶å°±å¯ä»¥é€šè¿‡ Binder å®Œæˆ IPCã€‚ å‚è€ƒ Android å¼€å‘è‰ºæœ¯æ¢ç´¢-IPC æœºåˆ¶ Android aidl Binderæ¡†æ¶æµ…æ Binderå­¦ä¹ æŒ‡å—]]></content>
      <categories>
        <category>Androidè¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>IPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android åŸºç¡€ä¹‹ Service]]></title>
    <url>%2F2017%2F08%2F27%2FAndroid%E5%9F%BA%E7%A1%80%E4%B9%8BService%2F</url>
    <content type="text"><![CDATA[Service çš„å«ä¹‰åŠä½œç”¨ Service æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œè€Œä¸éœ€è¦æä¾›ç”¨æˆ·ç•Œé¢çš„åº”ç”¨ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ Service æ˜¯ä¸ºäº†å»å¤„ç†é‚£äº›ä¸éœ€è¦å’Œç”¨æˆ·äº¤äº’ä½†åˆè€—æ—¶çš„æ“ä½œã€‚ä½†æ˜¯å¦‚æœ Service åªæ˜¯ä¸ºäº†æ‰§è¡Œé‚£äº›è€—æ—¶çš„æ“ä½œçš„è¯ï¼Œå…¶å®åªç”¨çº¿ç¨‹ä¹Ÿå¯ä»¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ï¼Œä¹‹æ‰€ä»¥éœ€è¦å•ç‹¬ç”¨ Service æ¥è¿›è¡Œå®ç°çš„åŸå› åœ¨äº Service ç›¸è¾ƒä¹‹çº¿ç¨‹è€Œè¨€ä¼˜å…ˆçº§æ¯”è¾ƒé«˜ï¼Œå¹¶ä¸” Service é€šè¿‡ç»‘å®šå¯åŠ¨çš„æ—¶å€™æ˜¯å¯æ§çš„ï¼Œå¦‚æœç³»ç»Ÿä¸æ˜¯æç«¯ä¸å¤Ÿç”¨ï¼Œä¸€èˆ¬è€Œè¨€æ˜¯ä¸ä¼šæ€æ­» Serviceï¼Œä½†æ˜¯çº¿ç¨‹å¯èƒ½å­˜åœ¨è¢«ç³»ç»Ÿå›æ”¶çš„å¯èƒ½æ€§ï¼Œæ‰€ä»¥ Service çš„å¯é æ€§è¦æ¯”çº¿ç¨‹é«˜ã€‚ å¦å¤–å…³äº Serviceï¼Œå®˜ç½‘ä¸Šè¿˜æœ‰å¦‚ä¸‹çš„æç¤ºï¼š &gt; æœåŠ¡åœ¨å…¶æ‰˜ç®¡è¿›ç¨‹çš„ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œå®ƒæ—¢ä¸åˆ›å»ºè‡ªå·±çš„çº¿ç¨‹ï¼Œä¹Ÿä¸åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­è¿è¡Œï¼ˆé™¤éå¦è¡ŒæŒ‡å®šï¼‰ã€‚ è¿™æ„å‘³ç€ï¼Œå¦‚æœæœåŠ¡å°†æ‰§è¡Œä»»ä½• CPU å¯†é›†å‹å·¥ä½œæˆ–é˜»æ­¢æ€§æ“ä½œï¼ˆä¾‹å¦‚ MP3 æ’­æ”¾æˆ–è”ç½‘ï¼‰ï¼Œåˆ™åº”åœ¨æœåŠ¡å†…åˆ›å»ºæ–°çº¿ç¨‹æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚é€šè¿‡ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹ï¼Œå¯ä»¥é™ä½å‘ç”Ÿâ€œåº”ç”¨æ— å“åº”â€(ANR) é”™è¯¯çš„é£é™©ï¼Œè€Œåº”ç”¨çš„ä¸»çº¿ç¨‹ä»å¯ç»§ç»­ä¸“æ³¨äºè¿è¡Œç”¨æˆ·ä¸ Activity ä¹‹é—´çš„äº¤äº’ Service çš„ç”Ÿå‘½å‘¨æœŸ Service çš„ç”Ÿå‘½å‘¨æœŸä¸»è¦å’ŒæœåŠ¡çš„ä½¿ç”¨æ–¹å¼æœ‰å…³ï¼Œä½¿ç”¨æœåŠ¡ä¸»è¦åˆ†ä¸ºå¯åŠ¨å’Œç»‘å®šä¸¤ç§æ–¹å¼ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Service çš„åŸºæœ¬ä½¿ç”¨ åˆ›å»ºæœåŠ¡ ç³»ç»Ÿæä¾›äº†ä¸€ä¸ª Service æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå·±å®ç°ä¸€ä¸ªç»§æ‰¿è‡ª Service çš„ç±»ï¼Œç„¶ååœ¨ AndroidManifest.xml æ³¨å†Œå³å¯ã€‚ è¿è¡ŒæœåŠ¡ è¿è¡ŒæœåŠ¡ä¸»è¦æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯è°ƒç”¨ startService()ï¼Œç¬¬äºŒç§åˆ™æ˜¯ bindService()ã€‚å®é™…ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥åŒæ—¶è°ƒç”¨ã€‚ æœåŠ¡ä¸­å¤„ç†äº‹ä»¶ startService å¯åŠ¨æœåŠ¡ï¼Œäº‹ä»¶çš„å¤„ç†ä¸€èˆ¬åœ¨æœåŠ¡çš„ onStartCommand æ–¹æ³•è¿›è¡Œçš„ï¼ŒbindService ç»‘å®šæœåŠ¡ä¹‹åï¼Œå°†ä¼šåœ¨ ServiceConnection çš„ onServiceConnected ä¸­è¿”å›ä¸€ä¸ª Binder å¯¹è±¡ï¼Œåˆ©ç”¨è¿”å›çš„ Binder å¯¹è±¡å¯ä»¥è°ƒç”¨ç›¸å…³çš„äº‹ä»¶å¤„ç†æ–¹æ³•ã€‚ åœæ­¢æœåŠ¡ æœåŠ¡çš„è¿è¡Œæ¡ä»¶æ˜¯æœåŠ¡è¢«ç»‘å®šæˆ–è€…è¢«å¯åŠ¨ï¼Œæ‰€ä»¥æƒ³è®©æœåŠ¡ä¸è¿è¡Œåˆ™éœ€è¦ç ´åè¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ stopService å’Œ unbindService å®ç°ã€‚]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Service</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android åŸºç¡€ä¹‹ BroastCasts]]></title>
    <url>%2F2017%2F08%2F26%2FAndroid%E4%B9%8BBroastCastReceiver%2F</url>
    <content type="text"><![CDATA[BroadCasts å®šä¹‰åŠå…¶ä½œç”¨ BroadCasts æ˜¯ä¸€ç§å¹¿æ’­æœºåˆ¶ï¼Œç±»ä¼¼äºå‘å¸ƒ-è®¢é˜…è¿™ç§æœºåˆ¶ï¼Œå½“å‘ç”Ÿä¸€äº›äº‹ä»¶çš„æ—¶å€™ï¼Œç³»ç»Ÿæˆ–ç¨‹åºå°±ä¼šå‘é€ï¼ˆå‘å¸ƒï¼‰ä¸€äº›ç›¸å…³çš„å¹¿æ’­ï¼Œè€Œæ³¨å†Œï¼ˆè®¢é˜…ï¼‰äº†è¿™äº›å¹¿æ’­çš„ç¨‹åºå°±ä¼šé€šè¿‡å¹¿æ’­æ¥æ”¶å™¨å»å“åº”è¿™äº›å¹¿æ’­ã€‚ #### BroadCasts çš„åˆ†ç±» 1. æŒ‰ä½œç”¨èŒƒå›´æ¥åˆ†ï¼š * å…¨å±€å¹¿æ’­ * æœ¬åœ°å¹¿æ’­ æœ¬åœ°ä¸»è¦ä¸ºäº†è§£å†³å…¨å±€å¹¿æ’­çš„å®‰å…¨æ€§é—®é¢˜ï¼Œç”±äºå…¨å±€å¹¿æ’­æ˜¯é¢å‘ç³»ç»Ÿä¸­æ‰€æœ‰åº”ç”¨çš„ï¼Œæ‰€ä»¥å½“æºå¸¦ä¸€äº›å…³é”®æ•°æ®æ—¶å¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„æ³„æ¼ã€‚ 2. æŒ‰æ¥æ”¶é¡ºåºæ¥åˆ†ï¼š * æ ‡å‡†å¹¿æ’­ æ ‡å‡†å¹¿æ’­åœ¨å‘å‡ºä¹‹åï¼Œæ‰€æœ‰ç›¸å…³çš„å¹¿æ’­æ¥æ”¶å™¨å‡ ä¹èƒ½å¤Ÿä¸€æ¬¡æ€§æ¥æ”¶åˆ°è¯¥æ¡å¹¿æ’­ã€‚ * æœ‰åºå¹¿æ’­ æœ‰åºå¹¿æ’­å‘å‡ºåï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨èƒ½å¤Ÿæ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­æ¶ˆæ¯ï¼Œåªæœ‰å½“è¯¥å¹¿æ’­æ¥æ”¶å™¨å½“ä¸­çš„å¤„ç†é€»è¾‘å¤„ç†å®Œæˆä¹‹åï¼Œå¹¿æ’­æ‰èƒ½å‘ä¸‹ä¼ é€’ï¼Œå¹¶ä¸”ä¼˜å…ˆçº§é«˜çš„å¹¿æ’­èƒ½å¤Ÿæˆªæ–­æ­£åœ¨ä¼ é€’çš„å¹¿æ’­ã€‚å¦‚æœå¤šä¸ªåº”ç”¨ç¨‹åºè®¾ç½®çš„ä¼˜å…ˆçº§åˆ«ç›¸åŒï¼Œåˆ™è°å…ˆæ³¨å†Œçš„å¹¿æ’­ï¼Œè°å°±å¯ä»¥ä¼˜å…ˆæ¥æ”¶åˆ°å¹¿æ’­ã€‚ BroadCasts çš„ä½¿ç”¨ å¹¿æ’­æœºåˆ¶çš„ä½¿ç”¨æ–¹æ³•å¤§ä½“æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤ï¼š åˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨ Android ç³»ç»Ÿæä¾›äº†ä¸€ä¸ª BroadCastReciver çš„æŠ½è±¡ç±»ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºè‡ªå·±çš„å¹¿æ’­æ¥æ”¶å™¨ï¼Œç„¶åé‡å†™å½“ä¸­çš„ onReceive æ–¹æ³•ï¼Œåœ¨å½“ä¸­ç¼–å†™äº‹ä»¶çš„å¤„ç†é€»è¾‘ã€‚ 123456789101112131415161718class ForceReceiver extends BroadcastReceiver &#123; @Override public void onReceive(final Context context, Intent intent) &#123; AlertDialog.Builder builder = new AlertDialog.Builder(context); builder.setTitle("æç¤º"); builder.setMessage("å·²ç»è¢«é€€å‡º"); builder.setCancelable(false); builder.setPositiveButton("OK", new DialogInterface.OnClickListener() &#123; @Override public void onClick(DialogInterface dialogInterface, int i) &#123; ActivityCollector.finishActivities(); Intent intent = new Intent(context, LoginActivity.class); context.startActivity(intent); &#125; &#125;).show(); &#125;&#125; æ³¨å†Œå¹¿æ’­ ä¸ºäº†è¿›è¡Œå¹¿æ’­çš„æ¥æ”¶è¿˜éœ€è¦å¯¹éœ€è¦æ¥æ”¶çš„å¹¿æ’­è¿›è¡Œæ³¨å†Œï¼Œæ³¨å†Œæ–¹å¼å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š ç¬¬ä¸€ç§æ˜¯åŠ¨æ€æ³¨å†Œï¼Œå¦‚æœæ˜¯å…¨å±€å¹¿æ’­åˆ™åœ¨ Activity ä¸­ç›´æ¥è°ƒç”¨ registerReceiver æ–¹æ³•å³å¯ï¼Œè¯¥æ–¹æ³•ä¸»è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ BroadCastReceiverï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯ IntentFilterã€‚å¦‚æœæ˜¯æœ¬åœ°å¹¿æ’­åˆ™éœ€è¦å€ŸåŠ©ç³»ç»Ÿæä¾›çš„ LocalBroadCastManager å»è¿›è¡Œæ³¨å†Œï¼Œæ–¹æ³•åä¸æ³¨å†Œå…¨å±€å¹¿æ’­çš„æ–¹æ³•åä¸€è‡´ã€‚ å…¨å±€å¹¿æ’­ï¼š 123IntentFilter intentFilter = new IntentFilter("com.rookieyang.forcelogin");forceReceiver = new ForceReceiver();registerReceiver(forceReceiver, intentFilter); æœ¬åœ°å¹¿æ’­ï¼š 1234IntentFilter intentFilter = new IntentFilter("com.rookieyang.forcelogin");forceReceiver = new ForceReceiver();LocalBroadcastManager localBroadcastManager = LocalBroadcastManager.getInstance(this);localBroadcastManager.registerReceiver(forceReceiver, intentFilter); ç¬¬äºŒç§æ˜¯é™æ€æ³¨å†Œï¼Œé™æ€æ³¨å†Œå¯ä»¥å®ç°åœ¨ç¨‹åºæœªå¯åŠ¨çš„æƒ…å†µä¸‹æ¥æ”¶åˆ°å¹¿æ’­ï¼Œé™æ€æ³¨å†Œçš„å¹¿æ’­æ˜¯å…¨å±€å¹¿æ’­ã€‚ 123456789&lt;uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/&gt;&lt;receiver android:name=".BootCompleteReceiver" android:enabled="true" android:exported="true"&gt; &lt;intent-filter&gt; &lt;action android:name="android.intent.action.BOOT_COMPLETED" /&gt; &lt;/intent-filter&gt;&lt;/receiver&gt; ç›‘å¬ç³»ç»Ÿçš„å¼€æœºå¹¿æ’­æ˜¯éœ€è¦æ·»åŠ æƒé™çš„ï¼ŒåŠ¨æ€æ³¨å†Œç›¸æ¯”è¾ƒäºé™æ€æ³¨å†Œè€Œè¨€æ›´ä¸ºçµæ´»ï¼Œä½†æ˜¯é™æ€æ³¨å†Œèƒ½å¤Ÿå®ç°åœ¨åº”ç”¨æœªå¯åŠ¨çš„æƒ…å†µä¸‹æ¥æ”¶å¹¿æ’­ã€‚è€Œä¸”åŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æœ€åå¿…é¡»è¦å–æ¶ˆæ³¨å†Œã€‚ å‘é€å¹¿æ’­ å‘é€å¹¿æ’­éœ€è¦ä¸»è¦é€šè¿‡ Intent ä¼ é€’ä¿¡æ¯ï¼Œå¦‚æœæ˜¯æ˜¯ç³»ç»Ÿå¹¿æ’­åˆ™ä¸éœ€è¦æˆ‘ä»¬å»ç¼–ç å»å‘é€å¹¿æ’­ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰çš„å¹¿æ’­ï¼Œå‘é€æ ‡å‡†å¹¿æ’­åˆ™è°ƒç”¨ sendBroadCast æ–¹æ³•ï¼Œå‘é€æœ‰åºå¹¿æ’­åˆ™è°ƒç”¨ sendOrderedBroadcast æ–¹æ³•ã€‚å¦‚æœæ˜¯æœ¬åœ°å¹¿æ’­åˆ™å’Œä¸Šæ–‡ä¸€è‡´éœ€è¦å€ŸåŠ© LocalBroadCastManager è¿›è¡Œå‘é€ï¼Œæœ¬åœ°å¹¿æ’­æ²¡æœ‰æœ‰åºå¹¿æ’­ã€‚ 1234Intent intent = new Intent("com.rookieyang.forcelogin");sendBroadcast(intent);//sendOrderedBroadcast(intent);localBroadcastManager.sendBroadcast(); æ¥æ”¶å¤„ç† æ¥æ”¶å¤„ç†åœ¨å¹¿æ’­æ¥æ”¶å™¨çš„ onReceive æ–¹æ³•ä¸­è¿›è¡Œï¼Œåˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨ä¸­å·²ç»è¯´æ˜ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚ å–æ¶ˆæ³¨å†Œ é™æ€æ³¨å†Œçš„ä¸éœ€è¦æˆ‘ä»¬ç¼–ç å»å–æ¶ˆæ³¨å†Œï¼Œå¯¹äºåŠ¨æ€æ³¨å†Œçš„åˆ™éœ€è¦ç¼–ç å»å–æ¶ˆæ³¨å†Œï¼Œå¦‚æœæ˜¯å…¨å±€å¹¿æ’­åˆ™è°ƒç”¨ unregisterReceiver æ–¹æ³•å³å¯ï¼Œå¦‚æœæ˜¯æœ¬åœ°å¹¿æ’­åˆ™è°ƒç”¨ LocalBroadCastManager å¯¹è±¡çš„è¯¥æ–¹æ³•å³å¯ã€‚ 12unregisterReceiver(forceReceiver);localBroadcastManager.unregisterReceiver(forceReceiver);]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>BroatCasts</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ubuntu 14.04ä¸‹AVDçš„åˆ›å»ºä»¥åŠé—ªé€€é—®é¢˜]]></title>
    <url>%2F2017%2F08%2F24%2FAndroid%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%E4%B9%8BAVD%E7%9A%84%E5%88%9B%E5%BB%BA%E4%BB%A5%E5%8F%8A%E9%97%AA%E9%80%80%2F</url>
    <content type="text"><![CDATA[åœ¨ Ubuntu 14.04 ä¸‹åˆ›å»º Android è™šæ‹Ÿæœºæ—¶å¯èƒ½ä¼šå‡ºç°ä¸‹åˆ—é”™è¯¯ï¼š An error occurred while creating the AVD. See idea.log for details åœ¨ç½‘ä¸ŠæŸ¥æ‰¾ä¹‹åå¾ˆå¤šäººå»ºè®®ä½¿ç”¨ sudo apt-get install lib32stdc++6 è¿™æ¡å‘½ä»¤ï¼Œä½†æ˜¯å®é™…ä¸Šé‡‡ç”¨è¿™æ¡å‘½ä»¤å»å®‰è£…ä¼šå‡ºç°ä¾èµ–å†²çªçš„é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ© sudo aptitude -f install lib32stdc++6 å»è§£å†³ä¾èµ–é—®é¢˜ï¼Œè¿™æ¡è¯­å¥ä½¿ç”¨ä¸€æ¬¡å¯èƒ½å¹¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå®é™…å½“ä¸­æˆ‘è¿è¡Œäº†ä¸‰æ¬¡æ‰è§£å†³äº†ä¾èµ–çš„å†²çªçš„é—®é¢˜ï¼Œæ¯ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ä¾æ¬¡é€‰æ‹© no-&gt;yes-&gt;yesã€‚å…·ä½“è¦è¿è¡Œå‡ æ¬¡ï¼Œå¿…é¡»çœ‹ lib32stdc++6 åº“æ˜¯å¦å®‰è£…æˆåŠŸã€‚ åœ¨ç»è¿‡ä¸Šè¿°çš„æ“ä½œä¹‹åï¼Œè™½ç„¶ AVD å¯èƒ½èƒ½æˆåŠŸåˆ›å»ºï¼Œä½†å®é™…å¯èƒ½è¿˜æ˜¯æ— æ³•å¯åŠ¨ï¼Œæ— æ³•å¯åŠ¨çš„åŸå› å¯èƒ½æ˜¯éœ€è¦å®‰è£… Intel's KVMï¼Œå…·ä½“æ­¥éª¤å¯ä»¥å‚è€ƒSetting Up Android Studio on Ubuntuå½“ä¸­çš„ Install Intel's KVM for Better AVD Performance éƒ¨åˆ†ï¼Œåœ¨è¿™éƒ¨åˆ†å½“ä¸­åªéœ€åšåˆ°ç¬¬ä¸ƒæ­¥å³å¯ï¼Œç”±äºæˆ‘ä½¿ç”¨çš„ AndroidStudio 2.3ï¼Œæ— æ³•æ‰¾åˆ°ç¬¬å…«æ­¥æ‰€è¯´çš„é€‰é¡¹ã€‚ åœ¨å®‰è£…å¥½æ‰€éœ€è¦çš„ä¸€åˆ‡åº“ä¹‹åï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤å¦‚ä¸‹ï¼š 1. åˆ›å»ºè™šæ‹Ÿæœºï¼Œè®°ä¸‹è™šæ‹Ÿæœºåç§° 2. è¿›å…¥åˆ° Sdk è·¯å¾„ä¸‹çš„ tools ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ &gt; sudo chmod +x emulator &gt; ./emulator -avd è™šæ‹Ÿæœºåç§° -qemu -m 2047 -enable-kvm åœ¨ç»è¿‡ä¸Šè¿°çš„ä¸¤ä¸ªæ­¥éª¤ä¹‹ååŸºæœ¬ä¸Šæ˜¯èƒ½å¤ŸæˆåŠŸå¯åŠ¨äº†çš„ã€‚]]></content>
      <categories>
        <category>Androidé—®é¢˜è®°å½•</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>å·¥å…·é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java çº¿ç¨‹ç®€è¿°]]></title>
    <url>%2F2017%2F08%2F22%2FJava%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AE%80%E8%BF%B0%2F</url>
    <content type="text"><![CDATA[çº¿ç¨‹çš„ä½œç”¨ çº¿ç¨‹ï¼ˆè‹±è¯­ï¼šThreadï¼‰æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œçº¿ç¨‹çš„å­˜åœ¨æ˜¯ä¸ºäº†å®ç°ç¨‹åºçš„å¹¶å‘æ“ä½œï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚ çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ çº¿ç¨‹çš„ä¸»è¦ç”Ÿå‘½å‘¨æœŸå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸»è¦åˆ†ä¸ºäº”ä¸ªçŠ¶æ€ï¼š æ–°å»ºæ€ï¼ˆNewï¼‰ï¼šJava ä¸­ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºçº¿ç¨‹ä¹‹åï¼Œè¿™æ—¶çº¿ç¨‹å³å¤„äºæ–°å»ºæ€ã€‚ å°±ç»ªæ€ï¼ˆRunnableï¼‰ï¼šåœ¨çº¿ç¨‹è°ƒç”¨ start() æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹å³å¤„äºå°±ç»ªæ€ã€‚ è¿è¡Œæ€ï¼ˆRunningï¼‰ï¼šå½“å°±ç»ªæ€çš„çº¿ç¨‹è·å¾— CPU å¹¶ä¸”å¼€å§‹æ‰§è¡Œ run() æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹å°±ä¼šå¤„äºè¿è¡ŒçŠ¶æ€ã€‚ é˜»å¡æ€ï¼ˆBlockedï¼‰ï¼šåœ¨å¤„äºè¿è¡Œæ€çš„çº¿ç¨‹è°ƒç”¨äº† sleep() æˆ– wait() åˆæˆ–è€…æ˜¯è°ƒç”¨äº†ä¸€ä¸ªé˜»å¡å¼çš„ IO æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹å°†ä¼šå¤„äºé˜»å¡çŠ¶æ€ã€‚ æ­»äº¡æ€ï¼ˆDeadï¼‰ï¼šåœ¨çº¿ç¨‹ä¸­çš„ run() æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸ã€è°ƒç”¨çº¿ç¨‹çš„ stop() è¿™å‡ ç§æƒ…å½¢ä¸‹çº¿ç¨‹å°†ä¼šè¿›å…¥æ­»äº¡æ€ã€‚ çº¿ç¨‹çš„å®ç°æ–¹æ³• Java ä¸­çº¿ç¨‹çš„å®ç°ä¸»è¦æ˜¯é€šè¿‡ Thread ç±»å’Œ Runnable æ¥å£ã€‚ é€šè¿‡ Thread ç±»å®ç°ï¼š 123456Thread thread = new Thread(new Runnable() &#123; @Override public void run() &#123; /** do some things **/ &#125;&#125;); é€šè¿‡ Runnable æ¥å£å®ç°ï¼š 12345678public class MyThread implements Runnable &#123; @Override public void run() &#123; /** do some things **/ &#125;&#125;MyThread myThread = new MyThread();Thread thread = new Thread(myThread); ç›¸å¯¹è€Œè¨€ç¬¬äºŒç§æ–¹å¼æ›´ä¸ºåˆç†ä¸€äº›ï¼Œç¬¬äºŒç§æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹ç±»åªå®ç°äº† Runnable æ¥å£ï¼Œè¿˜å¯ä»¥å†ç»§æ‰¿å…¶å®ƒçš„çˆ¶ç±»ã€‚ å‚è€ƒèµ„æ–™ ã€Javaå¹¶å‘ç¼–ç¨‹ã€‘ä¹‹å…­ï¼šRunnableå’ŒThreadå®ç°å¤šçº¿ç¨‹çš„åŒºåˆ«ï¼ˆå«ä»£ç ï¼‰]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android åŸºç¡€ä¹‹ LayoutInflater æ€»ç»“]]></title>
    <url>%2F2017%2F07%2F22%2FAndroid%E5%9F%BA%E7%A1%80%E4%B9%8BLayoutInflater%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[LayoutInflater çš„è·å– è·å– LayoutInflater çš„æ–¹å¼ä¸€èˆ¬æœ‰ä¸‰ç§ï¼š getLayoutInflater() LayoutInflater.from(Context context) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE) è¿™ä¸‰ç§è·å–æ–¹å¼æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ getLayoutInflater() é€šè¿‡ getWindow().getLayoutInflater() è¿›è¡Œè·å–ï¼ŒgetWindow() è·å–çš„æ˜¯ PhoneWindowï¼Œç„¶å PhoneWindow é€šè¿‡ mLayoutInflater = LayoutInflater.from(context) è·å– LayoutInflaterã€‚ LayoutInflater.from(Context context) å†…éƒ¨é€šè¿‡ä»¥ä¸‹ä»£ç è·å– LayoutInflaterã€‚ 12345678public static LayoutInflater from(Context context) &#123; LayoutInflater LayoutInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); if (LayoutInflater == null) &#123; throw new AssertionError("LayoutInflater not found."); &#125; return LayoutInflater;&#125; ç»“è®ºï¼šæ‰€ä»¥è¿™ä¸‰ç§æ–¹å¼æœ€ç»ˆéƒ½è°ƒç”¨äº† Context.getSystemService() LayoutInflater çš„ inflater æ–¹æ³• inflater ä½œä¸º LayoutInflater ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œç”¨äºä» xml çš„å¸ƒå±€æ–‡ä»¶å¾—åˆ°ä¸€ä¸ª View å¯¹è±¡ï¼ŒåŠ è½½åˆ° Activity ç”¨äºåŠ¨æ€åˆ›å»ºå¸ƒå±€ã€‚inflater æ€»å…±é‡è½½äº† 4 ç§è°ƒç”¨æ–¹å¼ï¼š 1. public View inflate(@LayoutRes int resource, @Nullable ViewGroup root) 2. public View inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot) 3. public View inflate(XmlPullParser parser, @Nullable ViewGroup root) 4. public View inflate(XmlPullParser parser, @Nullable ViewGroup root, boolean attachToRoot) å¯¹äºæ„é€ å‡½æ•°çš„ä½¿ç”¨è€Œè¨€ï¼Œæœ‰å¦‚ä¸‹æ³¨æ„äº‹é¡¹ï¼š root å¡«å……çš„æ ¹è§†å›¾ attachToRoot å†³å®šæ˜¯å¦å°†è½½å…¥çš„è§†å›¾é™„åŠ åˆ°æ ¹è§†å›¾ä¸Šï¼Œå¦‚æœä¸º false åˆ™ä»…ç”¨äºä¸º XML ä¸­çš„æ ¹è§†å›¾åˆ›å»ºæ­£ç¡®çš„ LayoutParams çš„å­ç±» å‰ä¸‰ä¸ª inflater æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ç¬¬å››ä¸ª inflater æ–¹æ³•ï¼Œé‡‡ç”¨äº† pull è§£æ é¿å…å°† null ä½œä¸º ViewGroup ä¼ å…¥ å½“ä¸éœ€è¦å°†è¿”å›çš„ View æ·»åŠ å…¥ ViewGroup æ—¶åº”è¯¥è®¾ç½®attachToRoot ä¸º false é¿å…åœ¨ View å·²ç»è¢«æ·»åŠ å…¥ ViewGroup æ—¶å°† attachToRoot è®¾ç½®ä¸º True è‡ªå®šä¹‰ View æ—¶éå¸¸é€‚åˆå°† attachToRoot è®¾ç½®ä¸º True LayoutInflater åŸºæœ¬ä½¿ç”¨ ç”±äº LayoutInflater ä¸»è¦ç”¨äºå¸ƒå±€å¡«å……ï¼Œæ‰€ä»¥ä¸»è¦æ¶‰åŠåˆ°çš„æ˜¯ inflater æ–¹æ³•ï¼Œinflater è¿”å›äº†ä¸€ä¸ª Viewï¼Œå…¶è°ƒç”¨æ–¹å¼æ˜¯ï¼š 12LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);View view = inflater.inflate(R.layout.first_fragment, container, false); å‚è€ƒèµ„æ–™ æ·±å…¥ç†è§£ LayoutInflater.inflate() Android LayoutInflater åŸç†åˆ†æï¼Œå¸¦ä½ ä¸€æ­¥æ­¥æ·±å…¥äº†è§£ View (ä¸€) LayoutInflaterâ€”â€”80%çš„Androidç¨‹åºå‘˜å¯¹å®ƒå¹¶ä¸äº†è§£ç”šè‡³é”™è¯¯ä½¿ç”¨]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>LayoutInflater</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AsyncTask æ€»ç»“]]></title>
    <url>%2F2017%2F07%2F11%2FAndroid%E5%9F%BA%E7%A1%80%E4%B9%8BAsyncTask%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[AsyncTask çš„ä½œç”¨ AsyncTask å…è®¸å¯¹ç”¨æˆ·ç•Œé¢æ‰§è¡Œå¼‚æ­¥æ“ä½œã€‚ å®ƒä¼šå…ˆé˜»å¡å·¥ä½œçº¿ç¨‹ä¸­çš„æ“ä½œï¼Œç„¶ååœ¨ UI çº¿ç¨‹ä¸­å‘å¸ƒç»“æœï¼Œè€Œæ— éœ€æ‚¨äº²è‡ªå¤„ç†çº¿ç¨‹å’Œ/æˆ–å¤„ç†ç¨‹åºã€‚ AsyncTask åŸºäºå¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶è¿›è¡Œå®ç°ï¼Œé€šè¿‡ AsyncTask èƒ½å¤Ÿå¾ˆç®€å•çš„ä»å­çº¿ç¨‹åˆ‡æ¢è‡³ä¸»çº¿ç¨‹ã€‚ AsyncTask çš„åŸºæœ¬ä½¿ç”¨ ç”±äº AsyncTask æ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªç»§æ‰¿å®ƒçš„å­ç±»ã€‚ 1public class MyAsyncTask extends AsyncTask&lt;Void, Integer, Boolean&gt; å…¶ä¸­å¯ä»¥ä¸º AsyncTask æŒ‡å®šä¸‰ä¸ªæ³›å‹å‚æ•° Paramsï¼šæ‰§è¡Œ Task æ—¶ä¼ é€’çš„å‚æ•°ï¼Œåœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨ï¼Œè¿™é‡ŒæŒ‡å®šä¸º Void Progressï¼šæŒ‡å®šè¿›åº¦å•ä½ï¼Œè¿™é‡ŒæŒ‡å®šä¸º Integer Resultï¼šæ‰§è¡Œå®Œä»»åŠ¡åè¿”å›çš„ç±»å‹ï¼Œè¿™é‡ŒæŒ‡å®šä¸º Boolean é‡å†™ AsyncTask çš„ä¸€äº›æ–¹æ³•ï¼Œä¸»è¦æ˜¯ä¸‹é¢å››ä¸ªï¼š 12345678910111213141516171819202122232425262728293031323334353637383940@Overrideprotected void onPreExecute() &#123; progressDialog.show();&#125;@Overrideprotected Boolean doInBackground(Void... voids) &#123; while (true) &#123; int percent = doDownload(); publishProgress(percent); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; return false; &#125; if (percent &gt;= 100) &#123; break; &#125; &#125; return true;&#125;@Overrideprotected void onProgressUpdate(Integer... values) &#123; progressDialog.setMessage("Downloaded " + values[0] + "%");&#125;@Overrideprotected void onPostExecute(Boolean result) &#123; progressDialog.dismiss(); if (result) &#123; Toast.makeText(MainActivity.getCurrentContext(), "Download Succeeded", Toast.LENGTH_LONG).show(); &#125; else &#123; Toast.makeText(MainActivity.getCurrentContext(), "Download Failed", Toast.LENGTH_LONG).show(); &#125;&#125; onPreExecute()ï¼šä»»åŠ¡æ‰§è¡Œä¹‹å‰åœ¨ UI çº¿ç¨‹å½“ä¸­è¿›è¡Œè°ƒç”¨ï¼Œé€šå¸¸ç”¨äºè¿›è¡Œä¸€äº›ç•Œé¢çš„åˆå§‹åŒ–å·¥ä½œï¼Œè­¬å¦‚æ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ã€‚ doInBackground(Params...)ï¼šå¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œåœ¨ onPreExecute() æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åè¿è¡Œåœ¨å­çº¿ç¨‹ä¸Šï¼Œé€šå¸¸ç”¨äºæ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼ŒParams å‚æ•°å°†ä¼šä¼ é€’è‡³è¯¥æ–¹æ³•ã€‚æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åå°†ä¼šé€šè¿‡ return è¯­å¥è¿”å›æ‰§è¡Œç»“æœï¼Œå¦‚æœ Result è®¾å®šä¸º Void åˆ™å¯ä»¥ä¸è¿›è¡Œè¿”å›ã€‚åŒæ—¶åœ¨è¯¥æ–¹æ³•ä¸­å¯ä»¥é€šè¿‡ publishProgress(Progress...) æ–¹æ³•å¯¹ä»»åŠ¡æ‰§è¡Œè¿›åº¦è¿›è¡Œåé¦ˆã€‚ onProgressUpdate(Progress...)ï¼špublishProgress(Progress...) è¢«è°ƒç”¨ä¹‹åæ‰§è¡Œåœ¨ UI çº¿ç¨‹å½“ä¸­ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å¯ä»¥å±•ç¤ºä»»åŠ¡æ‰§è¡Œçš„è¿›åº¦åŠå¯¹è¿›åº¦è¿›è¡Œæ›´æ–°ï¼Œè­¬å¦‚å¯ä»¥å¯¹è¿›åº¦æ¡è¿›è¡ŒåŠ¨ç”»å¤„ç†ã€‚ onPostExecute(Result)ï¼šä»»åŠ¡æ‰§è¡Œå®Œä¹‹åçš„è¿”å›ç»“æœå°†ä¼šä¼ é€’è‡³è¯¥æ–¹æ³•ï¼Œå¯ä»¥åˆ©ç”¨è¿”å›çš„ç»“æœè¿›è¡Œä¸€äº› UI æ“ä½œï¼Œè­¬å¦‚æé†’ä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼Œè¯¥æ–¹æ³•è¿è¡Œåœ¨ UI çº¿ç¨‹ä¸­ã€‚ AsyncTask æºç æµ…è§£ æ‰§è¡Œè¿‡ç¨‹å›¾ æ‰§è¡Œè¿‡ç¨‹ é¦–å…ˆé€šè¿‡è°ƒç”¨ execute(Params... params) æ–¹æ³•æ‰§è¡Œä»»åŠ¡ å†…éƒ¨æ‰§è¡Œäº† executeOnExecutor(sDefaultExecutor, params)ï¼ŒsDefaultExecutor æ˜¯å†…éƒ¨å®šä¹‰çš„ SerialExecutor ç±»çš„å¯¹è±¡ï¼Œä¸»è¦çš„æ–¹æ³•æ˜¯ execute(final Runnable r) ç”¨äºå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ã€‚ executeOnExecutor(Executor exec, Params... params) ä½œä¸ºç¬¬ä¸€æ­¥ä¸­æ‰§è¡Œçš„æ–¹æ³•ï¼Œé¦–å…ˆä¼šåˆ¤æ–­ä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæ˜¯ PENDING åˆ™è¡¨æ˜æ²¡æœ‰è¿è¡Œï¼Œç„¶åä¾¿ä¼šæ‰§è¡Œ onPreExecute() æ–¹æ³•ï¼Œä¹‹åå°† params ä¼ é€’ç»™ mWorker å¯¹è±¡ï¼ŒmWorker æ˜¯ä¸€ä¸ªå®ç°äº† Callable æ¥å£çš„ WorkerRunnable å¯¹è±¡ï¼Œæœ€åè°ƒç”¨ exec.execute(mFuture) å»å¯åŠ¨çº¿ç¨‹ã€‚å…¶ä¸­ mWorker å’Œ mFuture å¯¹è±¡åœ¨æ„é€ å‡½æ•°ä¸­å®Œæˆäº†åˆå§‹åŒ–è¿‡ç¨‹ã€‚mFuture æ˜¯ä¸€ä¸ªå®ç°äº† RunnableFuture æ¥å£çš„ FutureTask å¯¹è±¡ï¼ŒFutureTask çš„ run() æ–¹æ³•å°†ä¼šè°ƒç”¨ Callable æ¥å£çš„ call() æ–¹æ³•ã€‚ä¹Ÿå³æ˜¯è¯´ exec.execute(mFuture) è°ƒç”¨äº† mFuture çš„ run() æ–¹æ³•ä»è€Œè°ƒç”¨äº† mWorker çš„ call() æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071//execute çš„æ‰§è¡Œè¿‡ç¨‹exec.execute(mFuture);private static class SerialExecutor implements Executor &#123; final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;(); Runnable mActive; public synchronized void execute(final Runnable r) &#123; mTasks.offer(new Runnable() &#123; public void run() &#123; try &#123; r.run(); &#125; finally &#123; scheduleNext(); &#125; &#125; &#125;); if (mActive == null) &#123; scheduleNext(); &#125; &#125; protected synchronized void scheduleNext() &#123; if ((mActive = mTasks.poll()) != null) &#123; THREAD_POOL_EXECUTOR.execute(mActive); &#125; &#125;&#125;//mFuture è°ƒç”¨ mWorker.call() çš„è¿‡ç¨‹mFuture = new FutureTask&lt;Result&gt;(mWorker)//å°† mWorker ä¿å­˜è‡³ mFuture çš„ callablepublic FutureTask(Callable&lt;V&gt; callable) &#123; if (callable == null) throw new NullPointerException(); this.callable = callable; this.state = NEW; // ensure visibility of callable&#125;public void run() &#123; if (state != NEW || !U.compareAndSwapObject(this, RUNNER, null, Thread.currentThread())) return; try &#123; //callable èµ‹å€¼ç»™ c Callable&lt;V&gt; c = callable; if (c != null &amp;&amp; state == NEW) &#123; V result; boolean ran; try &#123; //ç›¸å½“äºè°ƒç”¨ mWorker çš„ call æ–¹æ³• result = c.call(); ran = true; &#125; catch (Throwable ex) &#123; result = null; ran = false; setException(ex); &#125; if (ran) set(result); &#125; &#125; finally &#123; // runner must be non-null until state is settled to // prevent concurrent calls to run() runner = null; // state must be re-read after nulling runner to prevent // leaked interrupts int s = state; if (s &gt;= INTERRUPTING) handlePossibleCancellationInterrupt(s); &#125;&#125; æ‰§è¡Œå®Œä¸Šè¿°ä¸¤æ­¥ä¹‹å mWorker.call() å¾—åˆ°äº†è°ƒç”¨ï¼Œä»»åŠ¡å¼€å§‹å¯åŠ¨ã€‚ åœ¨ call() æ–¹æ³•ä¸­è°ƒç”¨äº† doInBackground(mParams) å¹¶å°†ç»“æœä¿å­˜åœ¨ result å˜é‡å½“ä¸­ï¼Œç„¶ååœ¨ postResult(result) ä¸­é€šè¿‡ getHandler() è·å–åˆ° InternalHandler å¯¹è±¡ï¼Œé€šè¿‡ obtainMessage() æ–¹æ³•å°†ç»“æœå‘é€å‡ºå»ï¼Œä¹‹ååœ¨ handleMessage(Message msg) ä¸­è°ƒç”¨äº† finish() æ–¹æ³•ã€‚finish() æ–¹æ³•ä¸­æœ€ç»ˆè°ƒç”¨äº† onPostExecute(result) æ–¹æ³•ã€‚ å¦‚æœåœ¨ doInBackground(mParams) è°ƒç”¨äº† publishProgress(Progress... values)ï¼Œåˆ™åœ¨ publishProgress(Progress... values) ä¸­ä¹Ÿä¼šé€šè¿‡ getHandler() å‘é€ Messageï¼Œç„¶ååœ¨ handleMessage(Message msg) ä¸­è°ƒç”¨ onProgressUpdate(Progress... values) æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637private Result postResult(Result result) &#123; @SuppressWarnings("unchecked") Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT, new AsyncTaskResult&lt;Result&gt;(this, result)); message.sendToTarget(); return result;&#125;@WorkerThreadprotected final void publishProgress(Progress... values) &#123; if (!isCancelled()) &#123; getHandler().obtainMessage(MESSAGE_POST_PROGRESS, new AsyncTaskResult&lt;Progress&gt;(this, values)).sendToTarget(); &#125;&#125;public void handleMessage(Message msg) &#123; AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj; switch (msg.what) &#123; case MESSAGE_POST_RESULT: // There is only one result result.mTask.finish(result.mData[0]); break; case MESSAGE_POST_PROGRESS: result.mTask.onProgressUpdate(result.mData); break; &#125;&#125;private void finish(Result result) &#123; if (isCancelled()) &#123; onCancelled(result); &#125; else &#123; onPostExecute(result); &#125; mStatus = Status.FINISHED;&#125; â€‹]]></content>
      <categories>
        <category>Androidè¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gallery çš„ä¸‰ç§å®ç°æ–¹å¼]]></title>
    <url>%2F2017%2F05%2F08%2FAndroid%E4%B9%8BGallery%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[Gallery ä¸»è¦å†…å®¹ï¼š ç›®æ ‡æ•ˆæœï¼š éœ€æ±‚åˆ†æ ä»ç›®æ ‡æ•ˆæœä¸Šæ¥çœ‹ä¸»è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š å›¾ç‰‡å¦‚ä½•åˆ‡æ¢å’Œåˆ‡æ¢åŠ¨ç”» ImageSwitcher æä¾›äº† setImageResource (int resid) æ–¹æ³•å¯¹ä¸‹ä¸€ä¸ª ImageView è¿›è¡Œå›¾ç‰‡åŠ è½½å’Œåˆ‡æ¢ï¼Œåˆ‡æ¢çš„åŠ¨ç”»æ•ˆæœéœ€è¦è‡ªå®šä¹‰ ViewPager çš„åˆ‡æ¢å’Œåˆ‡æ¢åŠ¨ç”»å†…éƒ¨å¤„ç† HorizontalScrollView å¯ä»¥é€šè¿‡ smoothScrollBy (int dx, int dy) æ–¹æ³•è¿›è¡Œå¹³æ»‘åˆ‡æ¢ å›¾ç‰‡çš„åˆ‡æ¢æ–¹å‘ ImageSwitcher çš„åˆ‡æ¢æ–¹å‘éœ€è¦è‡ªå·±åˆ¤æ–­ HorizontalScrollView çš„åˆ‡æ¢æ–¹å‘è™½ç„¶ä¸ç”¨åˆ¤æ–­ï¼Œä½†æ˜¯æ»‘åŠ¨è·ç¦»éœ€è¦è‡ªå·±æ§åˆ¶ ViewPager çš„åˆ‡æ¢æ–¹å‘æ— éœ€å¤„ç† ç¡®å®šåˆ‡æ¢æ—¶åº”è¯¥åŠ è½½çš„å›¾ç‰‡ ImageSwitcher å’Œ HorizontalScrollView åŠ è½½å›¾ç‰‡éœ€è¦è‡ªå·±åˆ¤æ–­ ViewPager çš„åŠ è½½å›¾ç‰‡æ— éœ€å¤„ç† å›¾ç‰‡ä¸‹æ–¹çš„åœ†ç‚¹æ•ˆæœï¼Œä¸å›¾ç‰‡æ•°é‡ä¸€è‡´ åœ†ç‚¹å’Œå›¾ç‰‡çš„åŒæ­¥åˆ‡æ¢ ImageSwitcher å®ç° ImageSwitcher çš„ç‰¹ç‚¹ é¦–å…ˆæŸ¥çœ‹ ImageSwitcher å’Œ ViewSwitcher çš„å®˜æ–¹ APIï¼š ViewSwitcher that switches between two ImageViews when a new image is set on it. The views added to an ImageSwitcher must all be ImageViews. ViewAnimator that switches between two views, and has a factory from which these views are created. You can either use the factory to create the views, or add them yourself. A ViewSwitcher can only have two child views, of which only one is shown at a time. å®˜æ–¹ç»™å‡ºçš„ API è¯´æ˜äº†ï¼ŒImageSwitcher é‡Œæœ€å¤šåªèƒ½ç”±ä¸¤ä¸ª ImageViewï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ˜¾ç¤ºä¸€ä¸ªï¼Œåœ¨ä¸¤ä¸ª ImageView ä¹‹é—´èƒ½å¤Ÿè®¾ç½®è§†å›¾åˆ‡æ¢åŠ¨ç”»ï¼Œå¹¶ä¸”æä¾›äº† factory ç”¨äºåˆ›å»ºä¸¤ä¸ª ImageViewï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©è‡ªè¡Œæ·»åŠ ï¼‰ã€‚ å®ç°è¿‡ç¨‹ é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ  ImageSwitcher æ§ä»¶ï¼š 1234567891011121314151617181920212223242526&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="com.rookieyang.gallerytest.ImageSwitcherTest"&gt; &lt;ImageSwitcher android:id="@+id/imageSwitcher" android:layout_width="match_parent" android:layout_height="match_parent" /&gt; &lt;RelativeLayout android:layout_width="match_parent" android:layout_height="match_parent" android:layout_marginBottom="30dp"&gt; &lt;LinearLayout android:id="@+id/tipsLayout" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_alignParentBottom="true" android:gravity="center_horizontal" android:orientation="horizontal"/&gt; &lt;/RelativeLayout&gt;&lt;/FrameLayout&gt; é‡‡ç”¨ FrameLayout å°†åœ†ç‚¹éƒ¨åˆ†ç½®äºå›¾ç‰‡çš„ä¸Šæ–¹ï¼ŒRelativeLayout ç”¨äºæ§åˆ¶åŸç‚¹éƒ¨åˆ†åœ¨åº•éƒ¨ï¼ŒLinearLayout ä¸­çš„å±æ€§è®¾ç½®ç”¨äºå°†åœ†ç‚¹æ°´å¹³å±…ä¸­æ”¾ç½®ã€‚ åœ¨æ·»åŠ å®Œ ImageSwiter ä¹‹åï¼Œé€šè¿‡ setFactory(ViewFactory factory) å‡½æ•°ä¸º ImageSwiter æ·»åŠ  ImageViewï¼š 1234567891011mImageSwitcher.setFactory(new ViewFactory() &#123; @Override public View makeView() &#123; ImageView imageView = new ImageView(ImageSwitcherTest.this); ImageSwitcher.LayoutParams layoutParams = new ImageSwitcher.LayoutParams( ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT); imageView.setScaleType(ScaleType.CENTER_CROP); imageView.setLayoutParams(layoutParams); return imageView; &#125;&#125;); è¿™é‡Œä¸º ImageSwitcher è®¾ç½®äº†ä¸€ä¸ª factoryï¼Œåœ¨ setFactory(ViewFactory factory) å†…éƒ¨ä¼šæ‰§è¡Œä¸¤æ¬¡ obtainView() å®Œæˆ View çš„å¢åŠ ã€‚ ä¸Šè¿°è¿‡ç¨‹åªæ˜¯å®Œæˆäº† ImageView çš„æ·»åŠ ï¼Œå®é™…çš„å›¾ç‰‡è¿˜æ²¡æœ‰è¢«åŠ è½½ï¼Œç”±äº ImageSwitcher çš„é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥å°† ImageView ä¸€æ¬¡æ€§æ·»åŠ è¿›å»ï¼ˆè¿™æ ·æ€§èƒ½ä¹Ÿä¸é«˜ï¼‰ï¼Œå¯ä»¥é€‰æ‹©ç”¨ä¸€ä¸ªæ•°ç»„å¯¹å›¾ç‰‡èµ„æºè¿›è¡Œä¿å­˜ï¼Œåœ¨è°ƒç”¨ setImageResource() æ—¶è¿›è¡ŒåŠ è½½ï¼š 12private int[] mImageId = new int[]&#123;R.drawable.pic1, R.drawable.pic2, R.drawable.pic3&#125;;mImageSwitcher.setImageResource(mImageId[0]); åœ¨è§£å†³äº†å¦‚ä½•åŠ è½½å›¾ç‰‡ä¹‹åï¼Œè¿˜éœ€è¦ä¸ºå›¾ç‰‡ä¸‹æ–¹æ·»åŠ åœ†ç‚¹æ•ˆæœï¼Œåœ†ç‚¹çš„ä¸ªæ•°ç”±å›¾ç‰‡çš„ä¸ªæ•°å†³å®šï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425private ImageView[] mTips;mTips = new ImageView[mImageId.length];LinearLayout tipsLinearLayout = (LinearLayout) findViewById(R.id.tipsLayout);for (int i = 0; i &lt; mImageId.length; i++) &#123; mTips[i] = new ImageView(this); LinearLayout.LayoutParams layoutParams = new LayoutParams( new ViewGroup.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT)); layoutParams.leftMargin = 5; layoutParams.rightMargin = 5; tipsLinearLayout.addView(mTips[i], layoutParams);&#125;setTipsImage(0);private void setTipsImage(int position) &#123; for (int i = 0; i &lt; mImageId.length; i++) &#123; if (i == position) &#123; mTips[i].setImageResource(R.drawable.page_indicator_focused); &#125; else &#123; mTips[i].setImageResource(R.drawable.page_indicator_unfocused); &#125; &#125;&#125; åœ¨å®Œæˆä¸Šè¿°æ­¥éª¤ä¹‹åæˆ‘ä»¬è¿˜éœ€è¦å®Œæˆçš„æ˜¯è®©å›¾ç‰‡å’Œåœ†ç‚¹åŒæ—¶è¿›è¡Œåˆ‡æ¢ã€ç¡®å®šåˆ‡æ¢æ–¹å‘å’Œåº”è¯¥åŠ è½½çš„å›¾ç‰‡ä»¥åŠåˆ‡æ¢çš„åŠ¨ç”»ï¼Œå¯¹äºå›¾ç‰‡çš„åˆ‡æ¢æ–¹å‘å¯ä»¥ä¾æ®ç¬¬ä¸€æ¬¡æŒ‰ä½å±å¹•å’Œç¦»å¼€å±å¹•è¿™ä¸¤ç‚¹çš„ä½ç½®è¿›è¡Œåˆ¤æ–­ï¼Œè€Œåˆ‡æ¢æ—¶åŠ è½½çš„å›¾ç‰‡åˆ™å¯ä»¥ç”¨ä¸€ä¸ªå˜é‡å¯¹å½“å‰å›¾ç‰‡åºå·è¿›è¡Œä¿å­˜ï¼ŒåŠ¨ç”»æ•ˆæœåˆ™å¯ä»¥å®šä¹‰å››ä¸ªåŠ¨ç”»ï¼ˆå·¦è¿›ï¼Œå·¦å‡ºï¼Œå³è¿›ã€å³å‡ºï¼‰æ–‡ä»¶ï¼š 1234567891011121314151617181920212223242526272829303132&lt;!--left_in--&gt;&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;set xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;translate android:fromXDelta="-100%p" android:toXDelta="0" android:duration="500"/&gt;&lt;/set&gt;&lt;!--left_out--&gt;&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;set xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;translate android:fromXDelta="0" android:toXDelta="-100%p" android:duration="500"/&gt;&lt;/set&gt;&lt;!--right_in--&gt;&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;set xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;translate android:fromXDelta="100%p" android:toXDelta="0" android:duration="500"/&gt;&lt;/set&gt;&lt;!--right_out--&gt;&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;set xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;translate android:fromXDelta="0" android:toXDelta="100%p" android:duration="500"/&gt;&lt;/set&gt; 123456789101112131415161718192021222324252627282930313233343536373839private int mDownX;private int mCurrentPosition = 0;mImageSwitcher.setOnTouchListener(new OnTouchListener() &#123; @Override public boolean onTouch(View v, MotionEvent event) &#123; switch (event.getAction()) &#123; case MotionEvent.ACTION_DOWN: mDownX = (int) event.getX(); break; case MotionEvent.ACTION_UP: int upX = (int) event.getX(); if (upX &gt; mDownX) &#123; if (mCurrentPosition &gt; 0) &#123; mImageSwitcher.setInAnimation(ImageSwitcherTest.this, R.anim.left_in); mImageSwitcher.setOutAnimation(ImageSwitcherTest.this, R.anim.right_out); mCurrentPosition--; mImageSwitcher.setImageResource(mImageId[mCurrentPosition]); setTipsImage(mCurrentPosition); &#125; &#125; else if (upX &lt; mDownX) &#123; if (mCurrentPosition &lt; mImageId.length - 1) &#123; mImageSwitcher.setInAnimation(ImageSwitcherTest.this, R.anim.right_in); mImageSwitcher.setOutAnimation(ImageSwitcherTest.this, R.anim.left_out); mCurrentPosition++; mImageSwitcher.setImageResource(mImageId[mCurrentPosition]); setTipsImage(mCurrentPosition); &#125; &#125; break; &#125; return true; &#125;&#125;);â€‹ ViewPager å®ç° ViewPager çš„ç‰¹ç‚¹ ViewPager is most often used in conjunction with Fragment, which is a convenient way to supply and manage the lifecycle of each page. There are standard adapters implemented for using fragments with the ViewPager, which cover the most common use cases. These are FragmentPagerAdapter and FragmentStatePagerAdapter; each of these classes have simple code showing how to build a full user interface with them. ViewPager ä¸€èˆ¬ç»“åˆ Fragment ä½¿ç”¨ï¼Œæ¯ä¸ªé¡µé¢å°±æ˜¯ä¸€ä¸ª Fragmentï¼Œç³»ç»Ÿæä¾›äº† FragmentPagerAdapter å’Œ FragmentStatePagerAdapter ç”¨äºå¡«å…… ViewPagerã€‚ å®ç°è¿‡ç¨‹ é¦–å…ˆå‘å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ  ViewPager æ§ä»¶ï¼š 1234567891011121314151617181920212223242526&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="com.rookieyang.gallerytest.ViewPagerTest"&gt; &lt;android.support.v4.view.ViewPager android:id="@+id/viewPager" android:layout_width="match_parent" android:layout_height="match_parent" /&gt; &lt;RelativeLayout android:layout_width="match_parent" android:layout_height="match_parent" android:layout_marginBottom="30dp"&gt; &lt;LinearLayout android:id="@+id/tipsFragmentLayout" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_alignParentBottom="true" android:gravity="center_horizontal" android:orientation="horizontal"/&gt; &lt;/RelativeLayout&gt;&lt;/FrameLayout&gt; å¸ƒå±€åŸºæœ¬ä¸ ImageSwitcher ä¸€è‡´ï¼Œåªæ˜¯å°† ImageSwitcher æ§ä»¶æ›¿æ¢ä¸º ViewPagerã€‚ æ¥ä¸‹æ¥éœ€è¦å°†å›¾ç‰‡åŠ è½½åˆ° ViewPager ä¸­å»ï¼Œå¯ä»¥åˆ©ç”¨ FragmentPagerAdapter è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œç”±äº FragmentPagerAdapter è¿”å›çš„æ˜¯ Fragmentï¼Œæ‰€ä»¥åˆ›å»ºäº† ImageFragment ç±»ï¼Œç”¨äºå°† Image æ”¾ç½®åˆ° Fragmentä¸­ï¼Œä»£ç å¸ƒå±€å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425public class ImageFragment extends Fragment &#123;private View view;private int imageViewRes;@Overridepublic View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) &#123; // Inflate the layout for this fragment view = inflater.inflate(R.layout.fragment_image, container, false); return view;&#125;@Overridepublic void onActivityCreated(@Nullable Bundle savedInstanceState) &#123; super.onActivityCreated(savedInstanceState); ImageView imageView = (ImageView) view.findViewById(R.id.viewPageImage); imageView.setScaleType(ScaleType.CENTER_CROP); imageView.setImageResource(imageViewRes);&#125;public void setImageView(int imageViewRes) &#123; this.imageViewRes = imageViewRes;&#125;&#125; 12345678910&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="com.rookieyang.gallerytest.ImageFragment"&gt; &lt;ImageView android:id="@+id/viewPageImage" android:layout_width="match_parent" android:layout_height="match_parent" /&gt;&lt;/FrameLayout&gt; æ¥ä¸‹æ¥å®ç°ç»§æ‰¿è‡ª FragmentPagerAdapter çš„ ImagePagerAdapter ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920public class ImagePagerAdapter extends FragmentPagerAdapter &#123; private List&lt;ImageFragment&gt; mFragments; public ImagePagerAdapter(FragmentManager fm, List&lt;ImageFragment&gt; fragments) &#123; super(fm); mFragments = fragments; &#125; @Override public ImageFragment getItem(int position) &#123; Log.i("getItem", "getItem: " + mFragments.get(position).getId()); return mFragments.get(position); &#125; @Override public int getCount() &#123; return mFragments.size(); &#125;&#125; åœ¨å®Œæˆä¸Šè¿°çš„æ­¥éª¤ä¹‹åï¼Œåˆ©ç”¨ä¿å­˜å›¾ç‰‡èµ„æºçš„æ•°ç»„åˆ›å»ºå¯¹åº”ä¸ªæ•°çš„ ImageFragment å¹¶ä¿å­˜åˆ° List ä¸­ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª ImagePagerAdapter å¯¹è±¡ï¼Œæ›¿ ViewPager è®¾ç½®é€‚é…å™¨å³å¯å®ç°å›¾ç‰‡çš„åŠ è½½å’Œæ»‘åŠ¨ã€‚ç”±äº ViewPager å†…éƒ¨å¤„ç†äº†æ»‘åŠ¨æ–¹å‘å’Œä¸‹ä¸€å¼ å›¾ç‰‡åŠ è½½åˆ¤æ–­çš„é—®é¢˜ï¼Œæ‰€ä»¥åªå‰©ä¸‹å›¾ç‰‡ä¸åœ†ç‚¹çš„åŒæ­¥åˆ‡æ¢éœ€è¦è¿›è¡Œå¤„ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748mImageIds = new int[]&#123;R.drawable.pic1, R.drawable.pic2, R.drawable.pic3&#125;;mTips = new ImageView[mImageIds.length];mViewPager = (ViewPager) findViewById(R.id.viewPager);ViewGroup viewGroup = (ViewGroup) findViewById(R.id.tipsFragmentLayout);LinearLayout.LayoutParams layoutParams = new LinearLayout.LayoutParams( new ViewGroup.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT));layoutParams.rightMargin = 5;layoutParams.leftMargin = 5;for (int i = 0; i &lt; mImageIds.length; i++) &#123; ImageFragment imageFragment = new ImageFragment(); imageFragment.setImageView(mImageIds[i]); mImageFragments.add(imageFragment); if (mImageIds.length &gt; 1) &#123; mTips[i] = new ImageView(this); mTips[i].setImageResource(R.drawable.page_indicator_unfocused); viewGroup.addView(mTips[i], layoutParams); mTips[mCurrentPosition].setImageResource(R.drawable.page_indicator_focused); &#125;&#125;ImagePagerAdapter imagePagerAdapter = new ImagePagerAdapter( getSupportFragmentManager(), mImageFragments);mViewPager.setAdapter(imagePagerAdapter);mViewPager.addOnPageChangeListener(new OnPageChangeListener() &#123; @Override public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) &#123; &#125; @Override public void onPageSelected(int position) &#123; if (mImageIds.length &gt; 1) &#123; for (int i = 0; i &lt; mImageIds.length; i++) &#123; if (i == position) &#123; mTips[i].setImageResource(R.drawable.page_indicator_focused); &#125; else &#123; mTips[i].setImageResource(R.drawable.page_indicator_unfocused); &#125; &#125; &#125; &#125; @Override public void onPageScrollStateChanged(int state) &#123; &#125;&#125;); HorizontalScrollView å®ç° HorizontalScrollView ç‰¹ç‚¹ A HorizontalScrollView is a FrameLayout, meaning you should place one child in it containing the entire contents to scroll; this child may itself be a layout manager with a complex hierarchy of objects. A child that is often used is a LinearLayout in a horizontal orientation, presenting a horizontal array of top-level items that the user can scroll through. ä»è¿™é‡Œå¯ä»¥äº†è§£åˆ°å¦‚æœè¦å®ç°ä¸Šé¢çš„æ•ˆæœï¼Œé‚£ä¹ˆåº”è¯¥åœ¨ HorizontalScrollView æ”¾ç½®ä¸€ä¸ª LinearLayoutï¼Œç„¶å LinearLayout å†…åŠ è½½çš„æ˜¯è¦æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œç”±äºæ˜¯æ°´å¹³æ»‘åŠ¨ï¼Œæ‰€ä»¥ LinearLayout çš„æ–¹å‘ä¹Ÿè¦æ˜¯æ°´å¹³çš„ã€‚ å®ç°è¿‡ç¨‹ ä¾æ—§æ˜¯æ·»åŠ äº† HorizontalScrollView æ§ä»¶ï¼ŒæŠŠæ”¾ç½® ImageSwwitcher çš„éƒ¨åˆ†æ›¿æ¢ä¸ºï¼š 1234567891011&lt;HorizontalScrollView android:id="@+id/horizontalScrollView" android:layout_width="match_parent" android:layout_height="match_parent" android:scrollbars="none"&gt; &lt;LinearLayout android:id="@+id/imageLayout" android:layout_width="wrap_content" android:layout_height="match_parent" android:orientation="horizontal" /&gt; &lt;/HorizontalScrollView&gt; ä¸ºäº†æ•ˆæœä¸€è‡´å»æ‰äº†æ»šåŠ¨æ¡ã€‚ æ·»åŠ å®Œæ§ä»¶ä¹‹åï¼Œå°±éœ€è¦å¡«å…… HorizontalScrollView ï¼Œä¸ºäº†æ‰©å±•æ€§ï¼Œæ‰€ä»¥åˆ›å»ºäº†ä¸€ä¸ª HorizontalViewAdapter ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435public class HorizontalViewAdapter&#123; private int[] mImageResIdList; private Context mContext; public HorizontalViewAdapter(Context context, int[] imageResIdList) &#123; mContext = context; mImageResIdList = imageResIdList; &#125; public int getCount() &#123; return mImageResIdList.length; &#125; public ImageView getItem(int position) &#123; ImageView imageView = new ImageView(mContext); WindowManager wm = (WindowManager) mContext. getSystemService(Context.WINDOW_SERVICE); DisplayMetrics displayMetrics = new DisplayMetrics(); wm.getDefaultDisplay().getMetrics(displayMetrics); int width = displayMetrics.widthPixels; int height = displayMetrics.heightPixels; Log.i("Adpter: ", String.valueOf(width)); LinearLayout.LayoutParams layoutParams = new LayoutParams( new ViewGroup.LayoutParams(LayoutParams.MATCH_PARENT,LayoutParams.MATCH_PARENT)); layoutParams.width = width; layoutParams.height = height; imageView.setLayoutParams(layoutParams); imageView.setScaleType(ScaleType.CENTER_CROP); imageView.setImageResource(mImageResIdList[position]); return imageView; &#125;&#125; è¿™é‡Œå›¾ç‰‡çš„é•¿å’Œå®½ä¼šæ ¹æ®è®¾å¤‡çš„åˆ†è¾¨ç‡è¿›è¡ŒæŒ‡å®šï¼Œä¹‹æ‰€ä»¥ä¸ç”¨ match_parent çš„åŸå› æ˜¯è¿™æ ·ä¼šå¯¼è‡´æ˜¾ç¤ºæ•ˆæœå‡ºé—®é¢˜ã€‚ åœ¨åˆ›å»ºå®Œé€‚é…å™¨ä¹‹åï¼Œç”±äº HorizontalScrollView æ²¡æœ‰è®¾ç½®é€‚é…å™¨çš„æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦å®ç° setAdapter() æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718public void setAdapter(HorizontalViewAdapter horizontalViewAdapter) &#123; mTips = new ImageView[mImageId.length]; LinearLayout imageLayout = (LinearLayout) findViewById(R.id.imageLayout); LinearLayout tipsLinearLayout = (LinearLayout) findViewById(R.id.horizontalTipsLayout); int size = horizontalViewAdapter.getCount(); for (int i = 0; i &lt; size; i++) &#123; ImageView imageView = horizontalViewAdapter.getItem(i); imageLayout.addView(imageView); mTips[i] = new ImageView(this); LinearLayout.LayoutParams layoutParams = new LayoutParams( new ViewGroup.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT)); layoutParams.leftMargin = 5; layoutParams.rightMargin = 5; tipsLinearLayout.addView(mTips[i], layoutParams); &#125;&#125; å®ç° setAdapter() æ–¹æ³•ä¹‹åï¼Œå°±å¯ä»¥åœ¨ onCreate() æ–¹æ³•ä¸­è°ƒç”¨äº†ï¼Œè°ƒç”¨ä¹‹åå›¾ç‰‡ä¼šè¢«åŠ è½½åˆ°å¸ƒå±€ä¸­ï¼Œè¿™æ—¶å€™ä¹Ÿå¯ä»¥æ»‘åŠ¨ï¼Œä½†æ˜¯ç”±äºæ»‘åŠ¨è·ç¦»æ²¡æœ‰æ§åˆ¶ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰è¾¾åˆ°æƒ³è¦çš„æ•ˆæœï¼Œç”±äºå›¾ç‰‡çš„é•¿åº¦å–å†³äºè®¾å¤‡çš„åˆ†è¾¨ç‡ï¼Œæ‰€ä»¥å¯ä»¥è·å–è®¾å¤‡çš„é•¿åº¦ä½œä¸ºæ»‘åŠ¨è·ç¦»ï¼Œä¸º HorizontalScrollView è®¾ç½®ç›‘å¬äº‹ä»¶ï¼Œå½“è§¦æ‘¸å±å¹•ä¹‹åè¿›è¡Œåˆ¤æ–­ï¼Œç¡®å®šå®é™…æ»‘åŠ¨çš„æ–¹å‘ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637//è·å–å›¾ç‰‡æ»‘åŠ¨è·ç¦»WindowManager wm = (WindowManager) getApplicationContext(). getSystemService(Context.WINDOW_SERVICE);DisplayMetrics displayMetrics = new DisplayMetrics();wm.getDefaultDisplay().getMetrics(displayMetrics);mScrollX = displayMetrics.widthPixels;//ç¡®å®šçš„æ»‘åŠ¨æ–¹å‘final HorizontalScrollView horizontalScrollView = (HorizontalScrollView) findViewById( R.id.horizontalScrollView);horizontalScrollView.setOnTouchListener(new OnTouchListener() &#123; @Override public boolean onTouch(View v, MotionEvent event) &#123; switch (event.getAction()) &#123; case MotionEvent.ACTION_DOWN: mDownX = (int) event.getX(); break; case MotionEvent.ACTION_UP: int upX = (int) event.getX(); if (upX &gt; mDownX) &#123; if (mCurrentPosition &gt; 0) &#123; mCurrentPosition--; horizontalScrollView.smoothScrollBy(-mScrollX, 0); setTipsImage(mCurrentPosition); &#125; &#125; else if (upX &lt; mDownX) &#123; if (mCurrentPosition &lt; mImageId.length - 1) &#123; mCurrentPosition++; Log.i("onTouch: ", "onTouch: " + mCurrentPosition); horizontalScrollView.smoothScrollBy(mScrollX, 0); setTipsImage(mCurrentPosition); &#125; &#125; break; &#125; return true; &#125;&#125;); æ€»ç»“ HorizontalScrollView çš„å®ç°å®é™…ä¸Šå¹¶ä¸å®Œå–„ï¼Œå› ä¸º ImageView æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨æ·»åŠ è¿›å»çš„ï¼Œå¹¶æ²¡æœ‰åšä¼˜åŒ–å¤„ç†ï¼Œåœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œæ—¶ï¼Œç”±äºè¶…è¿‡äº†å †å†…å­˜ä¼šå¯¼è‡´æŠ¥é”™ã€‚]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[onOptionsItemSelected() è¿”å›å€¼çš„ç†è§£]]></title>
    <url>%2F2017%2F05%2F03%2FAndroid%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95onOptionsItemSelected%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E7%90%86%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[é¦–å…ˆæŸ¥çœ‹å®˜æ–¹ API çš„è§£é‡Šï¼š This hook is called whenever an item in your options menu is selected. The default implementation simply returns false to have the normal processing happen (calling the item's Runnable or sending a message to its Handler as appropriate). You can use this method for any items for which you would like to do processing without those other facilities. ä¹Ÿå°±æ˜¯è¯´å½“ç‚¹å‡» OptionsMenu ä¸­çš„ Item æ—¶ï¼Œé»˜è®¤ä¼šè¿”å› falseï¼Œè¿™ä¸ªæ—¶å€™å°†ä¼šå¤„ç† item å…³è”çš„ Runnable æˆ–å‘é€ä¸€æ¡ message ç»™å®ƒçš„ Handlerã€‚ ä¸ºäº†å¼„æ¸…æ¥šè¿”å› false æ—¶å¯èƒ½ä¼šå‘ç”Ÿä»€ä¹ˆåšäº†å¦‚ä¸‹æµ‹è¯•ï¼š æµ‹è¯•ä¸€ 123456789101112131415161718@Overridepublic boolean onOptionsItemSelected(MenuItem item) &#123; switch (item.getItemId()) &#123; case R.id.add_item: Toast.makeText(MainActivity.this, "Add", Toast.LENGTH_LONG).show(); break; case R.id.remove_item: Toast.makeText(MainActivity.this, "Remove", Toast.LENGTH_LONG).show(); item.setActionView(R.layout.progress); Intent intent = new Intent(MainActivity.this, SecondActivity.class); item.setIntent(intent); Log.i(TAG, "onOptionsItemSelected: Remove"); break; default: Toast.makeText(MainActivity.this, "re", Toast.LENGTH_LONG).show(); &#125; return true;&#125; ä¸Šè¿°ä»£ç ä¸­ç»™ item å…³è”äº†ä¸€ä¸ª Intent ç”¨äºè·³è½¬åˆ° SecondActivityï¼Œå¦‚æœè¿”å›ä¸º true åˆ™ç‚¹å‡» item æ—¶ä¸ä¼šè·³è½¬åˆ° SecondActivityï¼Œå¦‚æœè¿”å› false åˆ™ä¼šè·³è½¬åˆ° SecondActivityã€‚ æµ‹è¯•äºŒ åˆ›å»ºä¸€ä¸ª Fragment 12345678910111213141516171819202122232425262728public class MyFragment extends Fragment &#123; @Override public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) &#123; inflater.inflate(R.menu.main, menu); super.onCreateOptionsMenu(menu, inflater); &#125; @Override public boolean onOptionsItemSelected(MenuItem item) &#123; switch (item.getItemId()) &#123; case R.id.remove_item: Toast.makeText(getContext(), "Fragment Remove", Toast.LENGTH_LONG).show(); break; default: Toast.makeText(getContext(), "Fragment", Toast.LENGTH_LONG).show(); &#125; return false; &#125; @Nullable @Override public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, Bundle savedInstanceState) &#123; setHasOptionsMenu(true); return inflater.inflate(fragment_layout, container, false); &#125;&#125; ä¸Šè¿°åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ Fragment ç±»ï¼Œå¹¶æ·»åŠ äº† OptionMenu çš„ç‚¹å‡»äº‹ä»¶ã€‚ åœ¨ä¹‹å‰çš„ Activity çš„å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ  Fragment 1234567891011121314&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical"&gt; &lt;fragment android:id="@+id/fragment" android:layout_width="match_parent" android:layout_height="match_parent" android:name="com.rookieyang.demo.MyFragment" tools:layout="@layout/fragment_layout" /&gt;&lt;/LinearLayout&gt; åœ¨å®Œæˆä¸Šè¿°æ­¥éª¤ä¹‹åç‚¹å‡» remove çš„ itemï¼Œç”±äº Activity ä¸­çš„ onOptionsItemSelected() è¿”å›äº†falseï¼Œå¯¼è‡´äº‹ä»¶æ²¡æœ‰è¢«æ¶ˆè´¹å°±ä¼šå‘ä¸‹ä¼ é€’ç»™ Fragmentï¼Œè¿›è€Œæ‰§è¡Œ Fragment ä¸­çš„ item çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ‰€ä»¥èƒ½å¤Ÿçœ‹åˆ°å±å¹•ä¸Šå°†ä¼šæ˜¾ç¤º Fragment Remove è€Œä¸æ˜¯ Removeã€‚ è¡¥ï¼šOptionMenu çš„ Item è‡ªå®šä¹‰çš„ç‚¹å‡»äº‹ä»¶ä¼˜å…ˆçº§è¦é«˜äº onOptionsItemSelected()ã€‚]]></content>
      <categories>
        <category>Androidé—®é¢˜è®°å½•</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AndroidåŸºç¡€ä¹‹Activity]]></title>
    <url>%2F2017%2F05%2F02%2FAndroid%E5%9F%BA%E7%A1%80%E4%B9%8BActivity%2F</url>
    <content type="text"><![CDATA[Activityå¯¼å›¾ ä¸»è¦å†…å®¹ï¼š Activity åŸºæœ¬ä½¿ç”¨ åˆ›å»ºæ´»åŠ¨ AndroidManifest.xml çš„ application æ ‡ç­¾å†…è¿›è¡Œå£°æ˜ è½½å…¥å¸ƒå±€ setContentView(R.layout.second_layout) Activity è·³è½¬ æ˜¾å¼ Intent 123//Intent(Context packageContext, Class&lt;?&gt; cls)Intent intent = new Intent(MainActivity.this, SecondActivity.class);startActivity(intent); è¿™ç§æŒ‡å®šä¸Šä¸‹æ–‡å’Œç›®æ ‡æ´»åŠ¨ç±»åçš„ Intent ç§°ä¹‹ä¸ºæ˜¾å¼ Intentã€‚ éšå¼ Intent 12345678&lt;activity android:name=".SecondActivity"&gt; &lt;intent-filter&gt; &lt;action android:name="com.rookieyang.demo.ACTION_START" /&gt; &lt;category android:name="android.intent.category.DEFAULT" /&gt; &lt;category android:name="com.rookieyang.demo.MY_CATEGORY" /&gt; &lt;/intent-filter&gt;&lt;/activity&gt; 123Intent implieIntent = new Intent("com.rookieyang.demo.ACTION_START");implieIntent.addCategory("com.rookieyang.demo.MY_CATEGORY");startActivity(implieIntent); éšå¼ Intent é€šè¿‡æŒ‡å®šä¸€ç³»åˆ—æ›´ä¸ºæŠ½è±¡çš„ action å’Œ category ç­‰ä¿¡æ¯ï¼Œç„¶åäº¤ç”±ç³»ç»Ÿå»åˆ†æè¿™ä¸ª Intentï¼Œå¹¶å¸®æˆ‘ä»¬æ‰¾å‡ºåˆé€‚çš„æ´»åŠ¨å»å¯åŠ¨ã€‚åªæœ‰æ´»åŠ¨ä¸­çš„ &lt;action&gt; å’Œ &lt;category&gt; æ ‡ç­¾å®Œå…¨åŒ¹é… Intent ä¸­çš„ action å’Œ category æ—¶ï¼Œæ´»åŠ¨æ‰èƒ½å“åº” Intentã€‚ åœ¨è°ƒç”¨ startActivity() æ–¹æ³•æ—¶ä¼šè‡ªåŠ¨å°† android.intent.category.DEFAULT åŠ å…¥åˆ° Intent ä¸­ï¼Œæ‰€ä»¥åœ¨ç»™ Activity æŒ‡å®š category çš„æ—¶å€™ä¸èƒ½å¤Ÿå»æ‰é»˜è®¤çš„ android.intent.category.DEFAULTï¼Œå»æ‰ä¹‹åé€šè¿‡éšå¼ Intent å°†æ— æ³•åŒ¹é…åˆ°è¯¥ Activityã€‚ éšå¼ Intent é™¤äº†å¯ä»¥å¯åŠ¨è‡ªå·±ç¨‹åºå†…çš„æ´»åŠ¨ï¼Œè¿˜å¯ä»¥å¯åŠ¨å…¶ä»–ç¨‹åºçš„æ´»åŠ¨ï¼š 12345678btn.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; Intent intent = new Intent(Intent.ACTION_VIEW); intent.setData(Uri.parse("http://www.baidu.com")); startActivity(intent); &#125;&#125;); éšå¼ Intent æŒ‡å®šäº†ä¸€ä¸ªç³»ç»Ÿå†…ç½®çš„ actionï¼Œé€šè¿‡ setData() è®¾ç½® Intent æ“ä½œçš„æ•°æ®ç”¨ä»¥è°ƒç”¨ç³»ç»Ÿæµè§ˆå™¨ï¼Œå…¶ä¸­ setData() å¯¹åº” &lt;intent-filter&gt; æ ‡ç­¾å†…çš„ &lt;data&gt; æ ‡ç­¾ï¼Œç”¨äºæŒ‡å®šå½“å‰æ´»åŠ¨èƒ½å¤Ÿå“åº”ä»€ä¹ˆç±»å‹çš„æ•°æ®ã€‚&lt;data&gt; æ ‡ç­¾ä¸­ä¸»è¦å¯ä»¥é…ç½®ä»¥ä¸‹å†…å®¹ï¼š android:schemeï¼šç”¨äºæŒ‡å®šæ•°æ®çš„åè®®éƒ¨åˆ†ï¼Œå¦‚ä¸Šä¾‹çš„ http éƒ¨åˆ†ã€‚ android:hostï¼šç”¨äºæŒ‡å®šæ•°æ®çš„ä¸»æœºåéƒ¨åˆ†ï¼Œå¦‚ä¸Šä¾‹çš„ www.baidu.com éƒ¨åˆ†ã€‚ android:portï¼šç”¨äºæŒ‡å®šæ•°æ®çš„ç«¯å£éƒ¨åˆ†ï¼Œä¸€èˆ¬ç´§éšä¸»æœºåä¹‹åã€‚ android:pathï¼šç”¨äºæŒ‡å®šä¸»æœºåå’Œç«¯å£ä¹‹åçš„éƒ¨åˆ†ï¼Œå¦‚ä¸€æ®µç½‘å€ä¸­è·Ÿåœ¨åŸŸåä¹‹åçš„å†…å®¹ã€‚ android:mimeTypeï¼šç”¨äºæŒ‡å®šå¯ä»¥å¤„ç†çš„æ•°æ®ç±»å‹ï¼Œå…è®¸ä½¿ç”¨é€šé…ç¬¦æ–¹å¼è¿›è¡ŒæŒ‡å®šã€‚ Activity é—´æ•°æ®ä¼ é€’ å‘ä¸‹ä¸€ä¸ªæ´»åŠ¨ä¼ é€’æ•°æ® 1234567//MainActivityIntent intent = new Intent(MainActivity.this, SecondActivity.class);intent.putExtra("data", "data");startActivity(intent);//SecondActivityIntent intent = getIntent();Toast.makeText(this, intent.getStringExtra("data"), Toast.LENGTH_LONG).show(); MainActivity ä¸­é€šè¿‡ Intent çš„ putExtra() æ–¹æ³•å°†æ•°æ®æš‚å­˜åœ¨ Intent ä¸­ï¼Œç„¶ååœ¨ SecondActivity ä¸­é€šè¿‡getIntent() è·å–åˆ°å¯åŠ¨ SecondActivity çš„ Intentï¼Œä¹‹åé€šè¿‡ getStringExtra() æ–¹æ³•è·å–åˆ°ä¼ é€’çš„æ•°æ®ã€‚å¦‚æœä¼ é€’çš„æ˜¯æ•´å‹æ•°æ®åˆ™ä½¿ç”¨ getIntExtra() æ–¹æ³•ã€‚ è¿”å›æ•°æ®ç»™ä¸Šä¸€ä¸ªæ´»åŠ¨ 123456789101112131415161718192021222324252627282930//MainActivitybtn.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; Intent intent = new Intent(MainActivity.this, SecondActivity.class); startActivityForResult(intent, 1); &#125;&#125;);@Overrideprotected void onActivityResult(int requestCode, int resultCode, Intent data) &#123; switch (requestCode) &#123; case 1: if (resultCode == RESULT_OK) &#123; Log.i("onActivityResult", data.getStringExtra("data")); &#125; break; default: &#125;&#125;//SecondActivitybtn.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; Intent intent = new Intent(); intent.putExtra("data", "data"); setResult(RESULT_OK, intent); finish(); &#125;&#125;); startActivityForResult(Intent intent, int requestCode)ï¼šæœŸæœ›åœ¨æ´»åŠ¨é”€æ¯çš„æ—¶å€™èƒ½å¤Ÿè¿”å›ä¸€ä¸ªç»“æœç»™ä¸Šä¸€ä¸ªæ´»åŠ¨ã€‚ setResult(int resultCode, Intent data)ï¼šä¸“é—¨ç”¨äºå‘ä¸Šä¸€ä¸ªæ´»åŠ¨è¿”å›æ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºå‘ä¸Šä¸€ä¸ªæ´»åŠ¨è¿”å›å¤„ç†ç»“æœï¼Œä¸€èˆ¬åªä½¿ç”¨ RESULT_OK å’Œ RESULT_CANCELEDã€‚ç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯æŠŠå¸¦æœ‰æ•°æ®çš„ Intent ä¼ é€’å›å»ï¼Œç„¶åè°ƒç”¨ finish() æ–¹æ³•æ¥é”€æ¯å½“å‰æ´»åŠ¨ã€‚ onActivityResult(int requestCode, int resultCode, Intent data)ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬å¯åŠ¨æ´»åŠ¨ä¼ å…¥çš„è¯·æ±‚ç ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿”å›æ•°æ®ä¼ å…¥çš„è¿”å›ç»“æœï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¿”å›çš„æºå¸¦æ•°æ®çš„ Intentï¼Œç”±äºä¸€ä¸ªæ´»åŠ¨å¯èƒ½è°ƒç”¨ startActivityForResult() å¯åŠ¨å¤šä¸ªæ´»åŠ¨ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦æ£€æŸ¥ requestCode æ¥åˆ¤æ–­æ•°æ®æ¥æºï¼Œç„¶ååœ¨é€šè¿‡ resultCode æ¥åˆ¤æ–­å¤„ç†ç»“æœæ˜¯å¦æˆåŠŸã€‚ Activity çš„ç”Ÿå‘½å‘¨æœŸ onCreate()ï¼šæ´»åŠ¨ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ï¼Œä¸€èˆ¬åœ¨è¯¥æ–¹æ³•ä¸­å®Œæˆæ´»åŠ¨çš„åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚åŠ è½½å¸ƒå±€ã€ç»‘å®šäº‹ä»¶ç­‰ã€‚ onStart()ï¼šåœ¨æ´»åŠ¨ç”±ä¸å¯è§å˜ä¸ºå¯è§çš„æ—¶å€™è°ƒç”¨ã€‚ onResume()ï¼šåœ¨æ´»åŠ¨å‡†å¤‡å¥½å’Œç”¨æˆ·è¿›è¡Œäº¤äº’çš„æ—¶å€™è°ƒç”¨ã€‚æ­¤æ—¶æ´»åŠ¨ä¸€å®šä½äºæ ˆé¡¶ï¼Œå¹¶ä¸”å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ onPause()ï¼šåœ¨ç³»ç»Ÿå‡†å¤‡å»å¯åŠ¨æˆ–è€…æ¢å¤å¦ä¸€ä¸ªæ´»åŠ¨çš„æ—¶å€™è°ƒç”¨ã€‚æˆ‘ä»¬é€šå¸¸ä¼šåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°†ä¸€äº›æ¶ˆè€— CPU çš„èµ„æºé‡Šæ”¾æ‰ï¼Œä»¥åŠä¿å­˜ä¸€äº›å…³é”®æ•°æ®ï¼Œä½†è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œé€Ÿåº¦ä¸€å®šè¦å¿«ï¼Œä¸ç„¶ä¼šå½±å“åˆ°æ–°çš„æ ˆé¡¶æ´»åŠ¨çš„ä½¿ç”¨ã€‚ onStop()ï¼šåœ¨æ´»åŠ¨å®Œå…¨ä¸å¯è§çš„æ—¶å€™è°ƒç”¨ã€‚å¦‚æœå¯åŠ¨çš„æ–°æ´»åŠ¨æ˜¯ä¸€ä¸ªå¯¹è¯æ¡†å¼çš„æ´»åŠ¨ï¼Œåˆ™ onPause() ä¼šæ‰§è¡Œï¼Œè€Œ onStop() ä¸ä¼šæ‰§è¡Œã€‚ onDestroy()ï¼šåœ¨æ´»åŠ¨è¢«é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚ onRestart()ï¼šåœ¨æ´»åŠ¨ç”±åœæ­¢çŠ¶æ€å˜ä¸ºæ´»åŠ¨çŠ¶æ€ä¹‹å‰è°ƒç”¨ã€‚ &gt; ä»¥ä¸Šä¸ƒç§æ–¹æ³•ä¸­é™¤äº† onRestart( ) æ–¹æ³•ï¼Œå…¶ä»–éƒ½æ˜¯ä¸¤ä¸¤ç›¸å¯¹çš„ï¼Œä»è€Œå¯ä»¥åˆ†ä¸ºä¸‰ç§ç”Ÿå­˜æœŸï¼šonCreate( ) å’Œ onDestory( ) ä¸ºå®Œæ•´ç”Ÿå­˜æœŸã€onStart( ) å’Œ onStop( ) ä¸ºå¯è§ç”Ÿå­˜æœŸã€onResume( ) å’Œ onPause( ) ä¸ºå‰å°ç”Ÿå­˜æœŸã€‚ &gt; Activity æœ€å¤šå¯èƒ½æœ‰å››ç§çŠ¶æ€ï¼Œåˆ†åˆ«ä¸ºï¼šè¿è¡ŒçŠ¶æ€ã€æš‚åœçŠ¶æ€ã€åœæ­¢çŠ¶æ€ã€é”€æ¯çŠ¶æ€ã€‚ç³»ç»Ÿä¸€èˆ¬å€¾å‘äºå›æ”¶å¤„äºåä¸¤ç§çŠ¶æ€çš„ Activityã€‚ Activity çš„æ•°æ®ä¿å­˜ ç”±äº Activity å¤„äºåœæ­¢çŠ¶æ€çš„æ—¶å€™å¯èƒ½è¢«ç³»ç»Ÿå›æ”¶ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·è¿”å›è¢«å›æ”¶çš„ Activity ä¹‹æ—¶ä¼šé¢å¯¹ä¸€ä¸ªç©ºæ•°æ®çš„ Activityã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ onSaveInstanceState() è¿›è¡Œæ•°æ®çš„ä¿å­˜å·¥ä½œï¼š 123456789101112131415 //ä¿å­˜ @Override protected void onSaveInstanceState(Bundle outState) &#123; outState.putString("data", "outState"); Log.i(TAG, "onSaveInstanceState: "); super.onSaveInstanceState(outState); &#125; //æ¢å¤ protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_first); if (savedInstanceState != null) &#123; Log.i(TAG, "onCreate: " + savedInstanceState.getString("data")); &#125;&#125; ä¸»åŠ¨é”€æ¯ Acitivity ä¸ä¼šè§¦å‘ onSaveInstanceState()ï¼ŒBundle ä¹Ÿå¯ä»¥å’Œ Intent ç»“åˆèµ·æ¥ä¼ é€’æ•°æ®ã€‚ Activity å¯åŠ¨æ¨¡å¼ Activity æœ‰ä¸‹åˆ—å››ç§å¯åŠ¨æ¨¡å¼ï¼š å¯åŠ¨æ¨¡å¼ ä½œç”¨ standard æ¯æ¬¡å¯åŠ¨æ´»åŠ¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ´»åŠ¨çš„å®ä¾‹ singleTop åœ¨å¯åŠ¨æ´»åŠ¨çš„æ—¶å€™å¦‚æœå‘ç°è¿”å›æ ˆçš„æ ˆé¡¶å·²ç»æ˜¯è¯¥æ´»åŠ¨ï¼Œåˆ™ä¼šç›´æ¥ä½¿ç”¨å®ƒï¼Œä¸ä¼šå†åˆ›å»ºæ–°çš„æ´»åŠ¨å®ä¾‹ singleTask åœ¨å¯åŠ¨æ´»åŠ¨çš„æ—¶å€™å¦‚æœå‘ç°è¿”å›æ ˆä¸­å·²ç»å­˜åœ¨è¯¥æ´»åŠ¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨å®ƒï¼Œå¹¶æŠŠè¯¥æ´»åŠ¨ä¹‹ä¸Šçš„æ‰€æœ‰æ´»åŠ¨ç»Ÿç»Ÿå‡ºæ ˆ singleInstance åœ¨å¯åŠ¨æ´»åŠ¨çš„æ—¶å€™ï¼Œå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„è¿”å›æ ˆæ¥ç®¡ç†è¯¥æ´»åŠ¨ singleInstance çš„æ„ä¹‰ï¼šå‡è®¾ç¨‹åºä¸­æœ‰ä¸€ä¸ªæ´»åŠ¨å…è®¸å…¶ä»–ç¨‹åºè°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å®ç°å…¶ä»–ç¨‹åºå’Œæˆ‘ä»¬çš„ç¨‹åºå¯ä»¥å…±äº«è¿™ä¸ªæ´»åŠ¨çš„å®ä¾‹ï¼Œå°±éœ€è¦ä½¿ç”¨ singleInstance æ¨¡å¼ï¼Œå› ä¸ºåœ¨è¿™ç§æ¨¡å¼ä¸‹ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„è¿”å›æ ˆæ¥ç®¡ç†è¿™ä¸ªæ´»åŠ¨ï¼Œä¸ç®¡æ˜¯å“ªä¸ªåº”ç”¨ç¨‹åºæ¥è®¿é—®è¿™ä¸ªæ´»åŠ¨ï¼Œéƒ½å…±ç”¨åŒä¸€ä¸ªè¿”å›æ ˆã€‚ Intent çš„ Flags å±æ€§ Flags çš„ä½œç”¨æœ‰å¾ˆå¤šï¼Œæœ‰çš„ Flags ä¸ºå¯ä»¥è®¾å®š Activity çš„å¯åŠ¨æ¨¡å¼ï¼Œè¿˜æœ‰çš„ Flags å¯ä»¥å½±å“ Activity çš„è¿è¡ŒçŠ¶æ€ï¼Œæ¯”å¦‚ FLAG_ACTIVITY_SINGLE_TOP å’Œ FLAG_ACTIVITY_CLEAR_TOPã€‚ å¸¸ç”¨çš„ Flags å¦‚ä¸‹ï¼š Flags ä½œç”¨ FLAG_ACTIVITY_NEW_TASK When using this flag, if a task is already running for the activity you are now starting, then a new activity will not be started; instead, the current task will simply be brought to the front of the screen with the state it was last in. FLAG_ACTIVITY_CLEAR_TOP è®¾ç½®è¯¥æ ‡å¿—ä¹‹åçš„ Activityï¼Œå½“å¯åŠ¨ Activity æ—¶ï¼Œå¦‚æœè¯¥ Activity å·²ç»å­˜åœ¨ä»»åŠ¡æ ˆä¸­ï¼Œåˆ™ä¸åœ¨åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œå¹¶ä¸”ä½äºè¯¥ Activity ä¹‹ä¸Šçš„ Activityéƒ½éœ€è¦å‡ºæ ˆä¸€èˆ¬é…åˆ FLAG_ACTIVITY_NEW_TASK è¿›è¡Œä½¿ç”¨ FLAG_ACTIVITY_SINGLE_TOP è®¾ç½® Activity çš„å¯åŠ¨æ¨¡å¼ä¸º singleTop FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS å…·æœ‰è¯¥æ ‡å¿—çš„ Activity ä¸ä¼šå‡ºç°åœ¨å†å² Activity çš„åˆ—è¡¨ä¸­ FLAG_ACTIVITY_LAUNCH_ADJACENT æ­¤æ ‡å¿—ä»…ç”¨äºåˆ†å±å¤šçª—å£æ¨¡å¼ï¼Œæ–°çš„æ´»åŠ¨å°†æ˜¾ç¤ºåœ¨ä¸Šä¸€ä¸ª Activity çš„é™„è¿‘éœ€è¦ä¸ FLAG_ACTIVITY_NEW_TASK ç»“åˆä½¿ç”¨ã€‚ å¦å¤–ï¼Œå¦‚æœè¦åˆ›å»ºç°æœ‰æ´»åŠ¨çš„æ–°å®ä¾‹ï¼Œåˆ™åº”åŒæ—¶è®¾ç½® FLAG_ACTIVITY_MULTIPLE_TASK FLAG_ACTIVITY_NEW_DOCUMENT è¯¥æ ‡å¿—ç”¨äºåœ¨ä¸€ä¸ªä»¥ç›®æ ‡ Activity ä¸ºæ ˆé¡¶çš„æ–°ä»»åŠ¡æ ˆä¸­æ‰“å¼€æ–‡æ¡£ FLAG_ACTIVITY_NEW_TASKï¼šè®¾ç½®æ­¤çŠ¶æ€ï¼Œè®°ä½ä»¥ä¸‹åŸåˆ™ï¼Œé¦–å…ˆä¼šæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å’Œè¢«å¯åŠ¨çš„ Activity å…·æœ‰ç›¸åŒçš„äº²å’Œæ€§çš„ä»»åŠ¡æ ˆï¼ˆå³ taskAffinityï¼Œæ³¨æ„åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­çš„ activity çš„äº²å’Œæ€§åœ¨æ²¡æœ‰ä¿®æ”¹çš„æƒ…å†µä¸‹æ˜¯ä¸€æ ·çš„ï¼‰ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥æŠŠè¿™ä¸ªæ ˆæ•´ä½“ç§»åŠ¨åˆ°å‰å°ï¼Œå¹¶ä¿æŒæ ˆä¸­çš„çŠ¶æ€ä¸å˜ï¼Œå³æ ˆä¸­çš„ activity é¡ºåºä¸å˜ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ–°å»ºä¸€ä¸ªæ ˆæ¥å­˜æ”¾è¢«å¯åŠ¨çš„ activityã€‚ FLAG_ACTIVITY_LAUNCH_ADJACENTï¼šæµ‹è¯•å‘ç°åœ¨åˆ†å±æ¨¡å¼ä¸‹åœ¨å¯åŠ¨ç›®æ ‡ Activity æ—¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® FLAG_ACTIVITY_MULTIPLE_TASK ï¼Œé‚£ä¹ˆå½“ç›®æ ‡ Activity å·²ç»å­˜åœ¨äºä»»åŠ¡æ ˆä¸­ï¼Œå°†ä¸ä¼šè¿›å…¥åˆ†å±æ¨¡å¼ã€‚ FLAG_ACTIVITY_NEW_DOCUMENTï¼š å½“å•ç‹¬ä½¿ç”¨æ—¶ï¼Œå®ƒç›¸å½“äºæŒ‡å®š documentLaunchMode =â€œintoExistingâ€ã€‚å½“ä¸ FLAG_ACTIVITY_MULTIPLE_TASK ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒç­‰åŒäºæŒ‡å®š documentLaunchMode =â€œalwaysâ€ã€‚ åºåˆ—åŒ– ç›®çš„ Intent çš„ putExtra() æ–¹æ³•ä¸­æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå½“éœ€è¦ä¼ é€’ä¸€äº›è‡ªå®šä¹‰å¯¹è±¡çš„æ—¶å€™ï¼Œå°±éœ€è¦ç”¨åˆ°åºåˆ—åŒ–äº†ã€‚ æ–¹æ³• ä½¿ç”¨ Intent æ¥ä¼ é€’å¯¹è±¡é€šå¸¸æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š Parcelable 123456789101112131415161718192021222324252627282930public class Person implements Parcelable &#123; ... @Override public int describeContents() &#123; return 0; &#125; @Override public void writeToParcel(Parcel dest, int flags) &#123; dest.writeString(name); dest.writeInt(age); &#125; public static final Parcelable.Creator&lt;Person&gt; CREATOR = new Creator&lt;Person&gt;() &#123; @Override public Person createFromParcel(Parcel source) &#123; Person person = new Person(); person.name = source.readString(); person.age = source.readInt(); return person; &#125; @Override public Person[] newArray(int size) &#123; return new Person[size]; &#125; &#125;;&#125; Person ç±»å®ç°äº† Parcelable æ¥å£ç”¨äºåºåˆ—åŒ–ï¼Œæä¾›äº†ä¸€ä¸ªåä¸º CREATOR çš„å¸¸é‡ç”¨äºååºåˆ—åŒ–ã€‚createFromParcel() å’Œ writeToParcel() çš„é¡ºåºéœ€è¦ä¸€è‡´ã€‚é‡‡ç”¨ Parcelable æ–¹å¼è¿›è¡Œåºåˆ—åŒ–ï¼Œè·å–å¯¹è±¡çš„æ–¹æ³•å˜ä¸º getParcelableExtra()ã€‚ Serializable 12345678910111213141516171819202122232425262728293031public class Person implements Serializable &#123; private String name; private int age; public String getName() &#123; return name; &#125; public int getAge() &#123; return age; &#125; public void setName(String name) &#123; this.name = name; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125;//MainActivity ä¸­Person person = new Person();person.setAge(13);person.setName("data");Intent intent = new Intent(MainActivity.this, SecondActivity.class);intent.putExtra("data_person", person);startActivity(intent);//SecondActivity ä¸­Person person = (Person) getIntent().getParcelableExtra("data_person");Log.i("SecondActivity", "onCreate: " + person.getName()); é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª Person ç±»å»å®ç° Serializable æ¥å£ï¼Œè¿™æ ·æ‰€æœ‰çš„ Person å¯¹è±¡å°±éƒ½æ˜¯å¯åºåˆ—åŒ–çš„äº†ï¼Œç„¶ååœ¨ MainActivity ä¸­åˆ›å»ºäº†ä¸€ä¸ª Person å¯¹è±¡ï¼Œç„¶åå°†å¯¹è±¡ä¼ å…¥ SecondActivity ä¸­å»ï¼Œåœ¨ SecondActivity ä¸­ç”¨ getParcelableExtra() æ¥è·å–å¯¹è±¡ã€‚ å®ç”¨æŠ€å·§ çŸ¥æ™“å½“å‰æ˜¯åœ¨å“ªä¸€ä¸ªæ´»åŠ¨ 12345678public class BaseActivity extends AppCompatActivity &#123; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); Log.d("onCreate: ", getClass().getSimpleName()); &#125;&#125; åˆ›å»ºä¸€ä¸ª BaseActivityï¼Œç„¶åè®©å…¶ä»– Activity ç»§æ‰¿ BaseAcitivtyï¼Œé‚£ä¹ˆå½“å¯åŠ¨æ´»åŠ¨æ—¶å°±ä¼š logcat ä¸­æ‰“å°å‡ºç›¸åº”çš„ä¿¡æ¯ã€‚ éšæ—¶éšåœ°é€€å‡ºç¨‹åº 1234567891011121314151617181920public class ActivityCollector &#123; private static List&lt;Activity&gt; activities = new ArrayList&lt;&gt;(); public static void addActivity(Activity activity) &#123; activities.add(activity); &#125; public static void removeActivity(Activity activity) &#123; activities.remove(activity); &#125; public static void finishAll() &#123; for (Activity activity : activities) &#123; if (!activity.isFinishing()) &#123; activity.finish(); &#125; &#125; &#125;&#125; åˆ›å»ºä¸€ä¸ªæ´»åŠ¨çš„ç®¡ç†ç±»ï¼Œåœ¨æ´»åŠ¨çš„ onCreate() ä¸­è°ƒç”¨ addActivity() æ–¹æ³•ä¿å­˜åˆ›å»ºçš„æ´»åŠ¨ï¼Œåœ¨ onDestroy() ä¸­è°ƒç”¨ removeActivity() æ–¹æ³•ç§»é™¤é©¬ä¸Šè¦é”€æ¯çš„æ´»åŠ¨ã€‚å¦‚æœéœ€è¦éšæ—¶éšåœ°é€€å‡ºç¨‹åºåˆ™åªéœ€è¦è°ƒç”¨ finishAll()ã€‚ å¯åŠ¨æ´»åŠ¨çš„æœ€ä½³å†™æ³• 123456public static void actionStart(Context context, String param1, String param2) &#123; Intent intent = new Intent(context, SecondActivity.class); intent.putExtra("param1", param1); intent.putExtra("param2", param2); context.startActivity(intent);&#125; å½“æ´»åŠ¨ä¸­éœ€è¦ç”¨åˆ°ä¸€äº›å‚æ•°ä¹‹æ—¶ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸Šæ–¹å¼å»å¯åŠ¨æ´»åŠ¨ã€‚é‚£ä¹ˆå½“å…¶ä»–äººæ¥å¯åŠ¨æ´»åŠ¨çš„æ—¶å€™å°†ä¼šéå¸¸æ–¹ä¾¿ã€‚]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Activity</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ json æ¨¡å—]]></title>
    <url>%2F2017%2F04%2F20%2FPython%E4%B8%8BJson%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[Python ä¸‹çš„ json æ¨¡å—ä¸»è¦æœ‰ 4 ä¸ªå‡½æ•°ï¼š 12345678#dict è½¬æˆ str json.dump()#å°† json æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶json.dumps()#str è½¬æˆ dict json.load()#ä»æ–‡ä»¶ä¸­è¯»å– json æ•°æ®json.loads() å°† Json æ•°æ®å†™å…¥æ–‡ä»¶ï¼š 1234567try: data_result_file = "data_result.json" with open(data_result_file, 'w') as f: data_json = json.loads(results.data) json.dump(data_json, f, indent=4)except IOError: print("æ–‡ä»¶ä¸å­˜åœ¨") ç”±äº json.dump() äº§ç”Ÿçš„æ˜¯ str å¯¹è±¡ï¼Œä¸æ˜¯ bytes å¯¹è±¡ï¼Œæ‰€ä»¥å†™å…¥æ—¶æ–‡ä»¶æƒé™ä¸èƒ½è®¾ç½®ä¸º wbï¼Œå¦åˆ™ä¼šå‡ºç° TypeError: a bytes-like object is required, not â€˜str'ã€‚]]></content>
      <categories>
        <category>PythonåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Json</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[BootStrap-FileInput çš„åŸºæœ¬ä½¿ç”¨]]></title>
    <url>%2F2017%2F04%2F20%2Fbootstrap-fileinput%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[å®‰è£…ä¸å¼•å…¥ åœ¨å¼•å…¥ File Input ä¹‹å‰é¦–å…ˆéœ€è¦ä¸‹è½½ä¸‹åˆ—æ–‡ä»¶ï¼š 123bootstrap-fileinput/css/fileinput.min.cssbootstrap-fileinput/js/fileinput_locale_zh.jsbootstrap-fileinput/js/fileinput.min.js ä¸Šè¿°æ–‡ä»¶å¯ä»¥åœ¨ File Input çš„é¡¹ç›®åœ°å€æ‰¾åˆ°ã€‚ åœ¨ä¸‹è½½å¥½ä¹‹åå°±éœ€è¦æ·»åŠ å¦‚ä¸‹ä»£ç è¿›è¡Œå¼•å…¥ï¼š 123&lt;link href="/static/css/fileinput.min.css" rel="stylesheet"&gt;&lt;script src="/static/js/fileinput.min.js" type="text/javascript"&gt;&lt;/script&gt;&lt;script src="/static/js/fileinput-zh.js" type="text/javascript"&gt;&lt;/script&gt; File Input çš„ä½¿ç”¨ é¦–å…ˆéœ€è¦åœ¨é¡µé¢æ·»åŠ ä¸€ä¸ª File Input æ§ä»¶ï¼š 1234&lt;div class="form-group"&gt; &lt;input id="import_file" type="file" multiple class="file" name="userfile" data-overwrite-initial="false" data-min-file-count="1"&gt;&lt;/div&gt; data-min-file-count å¯ä»¥è®¾å®šæœ€å°‘ä¸Šä¼ çš„æ–‡ä»¶æ•° åœ¨æ·»åŠ å®Œä¹‹åå°±éœ€è¦å¯¹æ§ä»¶è¿›è¡Œåˆå§‹åŒ–ï¼š 12345678910111213141516171819202122$("#import_file").fileinput(&#123; uploadUrl: "/upload_file", //è®¾ç½®ä¸Šä¼ çš„åœ°å€ allowedFileExtensions: ['xls', 'xlsx'], //è®¾ç½®å…è®¸ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼ overwriteInitial: false, language: 'zh', //è®¾ç½®è¯­è¨€ maxFileSize: 6000, maxFilesNum: 10, //å…è®¸ä¸Šä¼ çš„æœ€å¤§æ–‡ä»¶æ•° uploadAsync: true, //é»˜è®¤å¼‚æ­¥ä¸Šä¼  //allowedFileTypes: ['image', 'video', 'flash'], allowedPreviewTypes: null, previewFileIconSettings: &#123; 'xls': '&lt;i class="fa fa-file-excel-o text-success"&gt;&lt;/i&gt;' &#125;, //é¢„è§ˆæ–‡ä»¶çš„å›¾æ ‡è®¾ç½® previewFileExtSettings: &#123; 'xls': function (ext) &#123; return ext.match(/(xls|xlsx)$/i); &#125; &#125;, //xls å’Œ xlsx ä½¿ç”¨åŒä¸€é¢„è§ˆ slugCallback: function (filename) &#123; return filename.replace('(', '_').replace(']', '_'); &#125; //ä½¿ç”¨å›è°ƒåŠŸèƒ½å°†æ–‡ä»¶åè½¬æ¢æˆå¤„ç†ä¹‹åçš„æ–‡ä»¶åã€‚&#125;); åå°å¤„ç†ï¼š 12345678910@app.route('/upload_file', methods=['POST'])def upload_file(): try: file = request.files.get('userfile') save_file_name = file.filename file.save(save_file_name) except KeyError: return [] else: return jsonify(&#123;'info': "ä¸Šä¼ æˆåŠŸ"&#125;) è¿™é‡Œå¯¹ä¸Šä¼ çš„ Excel æ–‡ä»¶è¿›è¡Œäº†ä¿å­˜ï¼Œè¿”å›ä¸Šä¼ æˆåŠŸçš„ä¿¡æ¯ã€‚ é—®é¢˜ åœ¨å¯¹ Excel æ–‡ä»¶è¿›è¡Œé¢„è§ˆå›¾æ ‡è®¾ç½®ä¹‹å‰ï¼Œå¦‚æœé€šè¿‡æŒ‰é’®é€‰æ‹©æ–‡ä»¶è€Œä¸æ˜¯æ‹–æ‹½ï¼Œåˆ™ä¼šå‡ºç°ç”±é¢„è§ˆæ–‡ä»¶æ‰€å¯¼è‡´å¡é¡¿ï¼Œåœ¨å°† Excel æ–‡ä»¶çš„é¢„è§ˆè®¾ç½®ä¸ºå›¾æ ‡ä¹‹åè§£å†³ã€‚ ä»åç«¯ç›´æ¥è¿”å›å­—ç¬¦ä¸²å‡ºç°é”™è¯¯ï¼Œæ”¹ä¸ºè¿”å› Json æ ¼å¼æ•°æ®åè§£å†³ã€‚ å‚è€ƒèµ„æ–™ File Input å¼€å‘æ–‡æ¡£ File Input Demo]]></content>
      <categories>
        <category>æ‚è®°</category>
      </categories>
      <tags>
        <tag>BootStrap</tag>
        <tag>Web</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android è‡ªå®šä¹‰ View å’Œ ViewGroup ç®€è¦æ€»ç»“]]></title>
    <url>%2F2017%2F04%2F17%2FAndroid%E8%87%AA%E5%AE%9A%E4%B9%89View%E5%92%8CViewGroup%E7%AE%80%E8%A6%81%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[ä¸»è¦æ–¹æ³•åŠä½œç”¨ è‡ªå®šä¹‰ ViewGroup ä¸»è¦æ¶‰åŠçš„æ–¹æ³•å¦‚ä¸‹ï¼š onMeasure() è®¡ç®— childView çš„æµ‹é‡å€¼ä»¥åŠæ¨¡å¼ï¼Œä»¥åŠè®¾ç½®è‡ªå·±çš„å®½å’Œé«˜ã€‚ onLayout() å¯¹æ‰€æœ‰ childView è¿›è¡Œå®šä½ã€‚ è‡ªå®šä¹‰ View ä¸»è¦æ¶‰åŠçš„æ–¹æ³•å¦‚ä¸‹ï¼š onMeasure() æµ‹é‡ View çš„å®½å’Œé«˜ã€‚ onDraw() å°† View ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚ æµ‹é‡æ¨¡å¼ onMeasure() è¿‡ç¨‹å’Œæµ‹é‡æ¨¡å¼ç›¸å…³ï¼Œè€Œæµ‹é‡æ¨¡å¼åˆ†ä¸ºä¸‰ç§ï¼š UNSPECIFIEDï¼šçˆ¶å®¹å™¨ä¸å¯¹ View æœ‰ä»»ä½•é™åˆ¶ï¼Œè¦å¤šå¤§ç»™å¤šå¤§ã€‚è¿™ç§æƒ…å†µä¸€èˆ¬ç”¨äºç³»ç»Ÿå†…éƒ¨ã€‚ EXACTLYï¼šçˆ¶å®¹å™¨å·²ç»æ£€æµ‹å‡º View æ‰€éœ€è¦çš„ç²¾ç¡®å¤§å°ï¼Œè¿™ä¸ªæ—¶å€™ View çš„æœ€ç»ˆå¤§å°å°±æ˜¯ SpecSize æ‰€æŒ‡å®šçš„å€¼ã€‚å®ƒå¯¹åº” LayoutParams ä¸­çš„ mactch_parent å’Œå…·ä½“æ•°å€¼è¿™ä¸¤ç§æ¨¡å¼ã€‚ AT_MOST çˆ¶å®¹å™¨æŒ‡å®šäº†ä¸€ä¸ªå¯ç”¨å¤§å°å³ SpecSizeï¼ŒView çš„å¤§å°ä¸èƒ½å¤§äºè¿™ä¸ªå€¼ï¼Œå…·ä½“å€¼çœ‹ä¸åŒ View çš„å…·ä½“å®ç°ã€‚å®ƒå¯¹åº”äº LayoutParams ä¸­çš„ wrap_contentã€‚ LayoutParams å’Œ generateLayoutParams LayoutParamsçš„å®˜æ–¹æ–‡æ¡£è§£é‡Šå¦‚ä¸‹ï¼š 1.LayoutParams are used by views to tell their parents how they want to be laid out. -- LayoutParams æ˜¯ View ç”¨æ¥å‘Šè¯‰å®ƒçš„çˆ¶æ§ä»¶å¦‚ä½•æ”¾ç½®è‡ªå·±çš„ã€‚ 2.The base LayoutParams class just describes how big the view wants to be for both width and height. -- åŸºç±» LayoutParamsï¼ˆä¹Ÿå°±æ˜¯ ViewGroup.LayoutParamsï¼‰ä»…ä»…æè¿°äº†è¿™ä¸ª View æƒ³è¦çš„å®½åº¦å’Œé«˜åº¦ã€‚ 3.There are subclasses of LayoutParams for different subclasses of ViewGroup. -- ä¸åŒ ViewGroup çš„ç»§æ‰¿ç±»å¯¹åº”ç€ä¸åŒçš„ ViewGroup.LayoutParams çš„å­ç±»ã€‚ generateLayoutParamså®˜æ–¹æ–‡æ¡£è§£é‡Šå¦‚ä¸‹ï¼š Returns a new set of layout parameters based on the supplied attributes set. -- æ ¹æ®æä¾›çš„å±æ€§é›†è¿”å›ä¸€ç»„æ–°çš„å¸ƒå±€å‚æ•°ã€‚ åœ¨ addView() çš„æ‰§è¡Œè¿‡ç¨‹å½“ä¸­ï¼Œå¦‚æœ checkLayoutParams() æ£€æµ‹åˆ°ä¼ é€’è¿‡æ¥çš„ LayoutParams ä¸æ˜¯å¯¹åº”å¸ƒå±€çš„ LayoutParamï¼Œåˆ™ä¼šé€šè¿‡ generateLayoutParams() æ ¹æ®ä½ ä¼ é€’çš„ LayoutParams çš„å±æ€§æ„é€ ä¸€ä¸ªå¯¹åº”å¸ƒå±€çš„ LayoutParamsã€‚ å‚è€ƒèµ„æ–™ Android æ‰‹æŠŠæ‰‹æ•™æ‚¨è‡ªå®šä¹‰ViewGroupï¼ˆä¸€ï¼‰ è‡ªå®šä¹‰æ§ä»¶çŸ¥è¯†å‚¨å¤‡-LayoutParamsçš„é‚£äº›äº‹]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android ä¸­ View çš„æ„é€ å‡½æ•°æµ…è§£]]></title>
    <url>%2F2017%2F04%2F17%2FAndroid%E4%B8%ADView%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%B5%85%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[æ„é€ å‡½æ•°çš„è°ƒç”¨æ—¶æœº åœ¨è‡ªå®šä¹‰ View çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸å¯é¿å…çš„éœ€è¦æ¥è§¦åˆ° View çš„æ„é€ å‡½æ•°ï¼Œç›®å‰ View å…·æœ‰å››ä¸ªæ„é€ å‡½æ•°ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š 12345678910111213141516public View(Context context) &#123; /...../&#125; public View(Context context, @Nullable AttributeSet attrs) &#123; this(context, attrs, 0);&#125; public View(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123; this(context, attrs, defStyleAttr, 0);&#125; public View(Context context, @Nullable AttributeSet attrs, int defStyleAttr, int defStyleRes) &#123; this(context); /...../&#125; defStyleAttr å½“å‰ä¸»é¢˜ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå…¶ä¸­åŒ…å«å¯¹ä¸ºè§†å›¾æä¾›é»˜è®¤å€¼çš„æ ·å¼èµ„æºçš„å¼•ç”¨ã€‚ å¯ä»¥ä¸º0ï¼Œä¸å¯»æ‰¾é»˜è®¤å€¼ã€‚ defStyleRes ä¸ºè§†å›¾æä¾›é»˜è®¤å€¼çš„æ ·å¼èµ„æºçš„èµ„æºæ ‡è¯†ç¬¦ï¼Œä»…åœ¨ defStyleAttr ä¸º0æˆ–åœ¨ä¸»é¢˜ä¸­æ‰¾ä¸åˆ°æ—¶ä½¿ç”¨ã€‚å¯ä»¥ä¸º0ï¼Œä¸å¯»æ‰¾é»˜è®¤å€¼ã€‚ ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°æºç çš„è§£é‡Šå¦‚ä¸‹ï¼š &gt; Simple constructor to use when creating a view from code. ä¹Ÿå°±æ˜¯è¯´å½“åœ¨ä»£ç ä¸­åˆ›å»º View çš„æ—¶å€™ä¼šè°ƒç”¨ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚ ç¬¬äºŒä¸ªæ„é€ å‡½æ•°çš„æºç è§£é‡Šå¦‚ä¸‹ï¼š &gt; Constructor that is called when inflating a view from XML. This is called when a view is being constructed from an XML file, supplying attributes that were specified in the XML file. This version uses a default style of 0, so the only attribute values applied are those in the Context's Theme and the given AttributeSet. ä¹Ÿå°±æ˜¯è¯´å½“åœ¨ XML æ–‡ä»¶ä¸­æ’å…¥ View çš„æ—¶å€™ä¼šè°ƒç”¨ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶ä¸”ä¼šåº”ç”¨ Context çš„ä¸»é¢˜ä»¥åŠåœ¨ XML ä¸­ç»™å®šçš„å±æ€§å€¼ã€‚ ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªæ„é€ å‡½æ•°çš„æºç è§£é‡Šåˆ†åˆ«å¦‚ä¸‹ï¼š &gt; Perform inflation from XML and apply a class-specific base style from a theme attribute. &gt; &gt;This constructor of View allows subclasses to use their own base style when they are inflating. For example, a Button class's constructor would call this version of the super class constructor and supply R.attr.buttonStyle for defStyleAttr; this (in particular its background) as well as the Button class's attributes. Perform inflation from XML and apply a class-specific base style from a theme attribute or style resource. &gt; This constructor of View allows subclasses to use their own base style when they are inflating. ä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªæ„é€ å‡½æ•°å…±åŒçš„ä½œç”¨æ˜¯å…è®¸ View åº”ç”¨è‡ªå·±çš„åŸºç¡€ styleï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬éœ€è¦ä¸º View è®¾ç½® style çš„æ—¶å€™å°±å¯ä»¥é€‰æ‹©å»è°ƒç”¨è¿™ä¸¤ä¸ªæ„é€ å‡½æ•°å½“ä¸­çš„ä¸€ä¸ªï¼Œè°ƒç”¨æ–¹å¼ä¸€èˆ¬å¦‚ä¸‹ï¼š 1234567public Button(Context context, AttributeSet attrs) &#123; this(context, attrs, com.android.internal.R.attr.buttonStyle);&#125;public Button(Context context, AttributeSet attrs, int defStyleAttr) &#123; this(context, attrs, defStyleAttr, 0);&#125; defStyleAttr å’Œ defStyleRes çš„è”ç³» æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿç”±äºè¿™ä¸¤è€…éƒ½ç”¨äºè®¾ç½® styleï¼Œè€Œ style é‡Œé¢æ˜¯å±æ€§çš„é›†åˆï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆäº†è§£ View è®¾ç½®å±æ€§çš„æ–¹å¼ï¼Œä¸€èˆ¬æ¥è¯´æœ‰å¦‚ä¸‹äº”ç§æ–¹å¼ï¼š 1. XML ä¸­ç›´æ¥å£°æ˜ç›¸å…³å±æ€§å€¼ 2. XML ä¸­ å¼•å…¥ style 3. defStyleAttr 4. defStyleRes 5. themeä¸­ç›´æ¥æŒ‡å®š æ—¢ç„¶æœ‰äº”ç§æ–¹å¼ï¼Œé‚£ä¹ˆå½“åŒæ—¶åº”ç”¨çš„æ—¶å€™å°±æ¶‰åŠåˆ°äº†ä¼˜å…ˆçº§çš„é—®é¢˜ã€‚ä¸ºäº†äº†è§£ä¼˜å…ˆçº§çš„é—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ attrs.xml æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š 1234567891011&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;resources&gt; &lt;declare-styleable name="DefAttrs"&gt; &lt;attr name="attr_1" format="string" /&gt; &lt;attr name="attr_2" format="string" /&gt; &lt;attr name="attr_3" format="string" /&gt; &lt;attr name="attr_4" format="string" /&gt; &lt;/declare-styleable&gt; &lt;attr name="defStyleAttr" format="reference" /&gt;&lt;/resources&gt; è¿™é‡Œå®šä¹‰äº†å››ä¸ªæ ¼å¼ä¸º string çš„å±æ€§ç”¨äºæµ‹è¯•ï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º defStyleAttr å¼•ç”¨ã€‚ é€šè¿‡ declare-styleable å¯ä»¥ä¸ºæ¯ä¸ªå±æ€§åœ¨ R æ–‡ä»¶é‡Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª int[]ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”¨ R.styleable.* æ¥è¿›è¡Œä½¿ç”¨ï¼Œå½“ç„¶å®šä¹‰çš„å±æ€§ä¹Ÿå¯ä»¥ä¸æ”¾åœ¨ declare-styleable ä¸­ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™å°±éœ€è¦é€šè¿‡å¦‚ä¸‹ä»£ç ï¼š 12int[] attrs = &#123;R.attr.attr_1,R.attr_2&#125;;TypedArray typedArray = context.obtainStyledAttributes(set,attrs); åœ¨åˆ›å»ºäº†è‡ªå®šä¹‰çš„å±æ€§ä¹‹åï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€äº› styleï¼Œåœ¨ style.xml æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839&lt;resources&gt; &lt;!-- Base application theme. --&gt; &lt;style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar"&gt; &lt;!-- Customize your theme here. --&gt; &lt;item name="colorPrimary"&gt;@color/colorPrimary&lt;/item&gt; &lt;item name="colorPrimaryDark"&gt;@color/colorPrimaryDark&lt;/item&gt; &lt;item name="colorAccent"&gt;@color/colorAccent&lt;/item&gt; &lt;!--Theme ç›´æ¥æŒ‡å®š--&gt; &lt;item name="attr_1"&gt;theme_one&lt;/item&gt; &lt;item name="attr_2"&gt;theme_two&lt;/item&gt; &lt;item name="attr_3"&gt;theme_three&lt;/item&gt; &lt;item name="attr_4"&gt;theme_four&lt;/item&gt; &lt;!--defStyleAttr--&gt; &lt;item name="defStyleAttr"&gt;@style/def_style_attr&lt;/item&gt; &lt;/style&gt; &lt;!--xml ä¸­å¼•å…¥çš„ style --&gt; &lt;style name="xml_style"&gt; &lt;item name="attr_1"&gt;xml_style_one&lt;/item&gt; &lt;item name="attr_2"&gt;xml_style_two&lt;/item&gt; &lt;/style&gt; &lt;!--defStyleAttr å¼•ç”¨çš„ style--&gt; &lt;style name="def_style_attr"&gt; &lt;item name="attr_1"&gt;def_style_one&lt;/item&gt; &lt;item name="attr_2"&gt;def_style_two&lt;/item&gt; &lt;item name="attr_3"&gt;def_style_three&lt;/item&gt; &lt;/style&gt; &lt;!--defStyleRes--&gt; &lt;style name="def_style_res"&gt; &lt;item name="attr_1"&gt;def_style_res_one&lt;/item&gt; &lt;item name="attr_2"&gt;def_style_res_two&lt;/item&gt; &lt;item name="attr_3"&gt;def_style_res_three&lt;/item&gt; &lt;item name="attr_4"&gt;def_style_res_four&lt;/item&gt; &lt;/style&gt;&lt;/resources&gt; ä¸Šè¿°ä»£ç æ·»åŠ äº†å››ç§ styleï¼Œå¯¹åº”ä¸º View è®¾ç½®å±æ€§çš„æ–¹å¼ä¸­çš„åå››ç§ï¼Œåœ¨æ·»åŠ äº† style ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åº”ç”¨ styleï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªå¦‚ä¸‹çš„è‡ªå®šä¹‰ Viewï¼š 123456789101112131415161718192021222324252627282930313233343536373839public class MyView extends TextView&#123; public MyView(Context context) &#123; super(context); &#125; public MyView(Context context, @Nullable AttributeSet attrs) &#123; this(context, attrs, R.attr.defStyleAttr); &#125; public MyView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123; this(context, attrs, defStyleAttr,R.attr.defStyleAttr); parse(context, attrs, defStyleAttr); &#125; @TargetApi(VERSION_CODES.LOLLIPOP) public MyView(Context context, @Nullable AttributeSet attrs, int defStyleAttr, int defStyleRes) &#123; super(context, attrs, defStyleAttr, defStyleRes); &#125; private void parse(Context context, AttributeSet attrs, int defStyleAttr) &#123; TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.DefAttrs, defStyleAttr, R.style.def_style_res); String one = typedArray.getString(R.styleable.DefAttrs_attr_1); String two = typedArray.getString(R.styleable.DefAttrs_attr_2); String three = typedArray.getString(R.styleable.DefAttrs_attr_3); String four = typedArray.getString(R.styleable.DefAttrs_attr_4); log("one = " + one); log("two = " + two); log("three = " + three); log("four = " + four); typedArray.recycle(); &#125; private void log(String msg) &#123; Log.i("MyView", msg); &#125;&#125; ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ä¸­æ˜¾å¼è°ƒç”¨äº†ç¬¬ä¸‰ä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶è®¾ç½® defStyleAttr å‚æ•°å€¼ä¸º R.attr.defStyleAttrã€‚ parse() è·å–å››ä¸ªå±æ€§å€¼å¹¶è¿›è¡Œæ‰“å°ã€‚ åˆ›å»ºå®Œè‡ªå®šä¹‰ View ä¹‹åï¼Œç°åœ¨éœ€è¦åœ¨ XML æ–‡ä»¶ä¸­æ·»åŠ è‡ªå®šä¹‰çš„Viewï¼š 12345678910111213141516&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;android.support.constraint.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" xmlns:test="http://schemas.android.com/apk/res-auto" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="com.rookieyang.test.MainActivity"&gt; &lt;com.rookieyang.test.MyView test:attr_1="xml_attr_attr1" style="@style/xml_style" android:layout_width="wrap_content" android:layout_height="wrap_content" /&gt;&lt;/android.support.constraint.ConstraintLayout&gt; test:attr_1=&quot;xml_attr_attr1&quot; XML ä¸­ç›´æ¥æŒ‡å®š attr_1 å±æ€§å€¼ã€‚ style=&quot;@style/xml_style&quot; XML ä¸­å¼•å…¥ styleã€‚ è¿è¡Œç»“æœ åœ¨å®Œæˆä¸Šè¿°æ­¥éª¤ä¹‹åå°±å¯ä»¥è¿è¡Œï¼Œè¿è¡Œä¹‹åçš„è¾“å‡ºå¦‚ä¸‹ï¼š ä¸Šè¿°ä»£ç ä¸­ï¼ŒXML ä¸­ç›´æ¥å£°æ˜ attr_1 å±æ€§å€¼ä¸º xml_attr_attr1ï¼ŒXML ä¸­ å¼•å…¥çš„ style ä¸­ç»™ attr_1ï¼Œattr_2 èµ‹å€¼ä¸º xml_style_oneï¼Œxml_style_twoï¼ŒdefStyleAttr ç»™ attr_1ï¼Œattr_2ï¼Œattr_3 èµ‹å€¼ä¸º def_style_oneï¼Œdef_style_twoï¼Œdef_style_threeï¼ŒdefStyleRes å’Œ Theme ä¹Ÿåˆ†åˆ«ä¸ºå››ä¸ªå±æ€§è¿›è¡Œäº†èµ‹å€¼ï¼Œè€Œæ ¹æ®è¾“å‡ºçš„ç»“æœåœ¨ä¼˜å…ˆçº§ä¸Šæˆ‘ä»¬å¾ˆå®¹æ˜“å¾—åˆ°ä»¥ä¸‹ç»“è®ºï¼š &gt; XML ä¸­ç›´æ¥å£°æ˜ç›¸å…³å±æ€§å€¼ &gt; XML ä¸­ å¼•å…¥ style &gt; defStyleAttr &gt; themeä¸­ç›´æ¥æŒ‡å®š &gt; &gt; defStyleAttr &gt; defStyleRes ä»ç¬¬ä¸€éƒ¨åˆ†å¯ä»¥çŸ¥é“ç”±äº defStyleAttr çš„å­˜åœ¨ï¼ŒdefStyleRes æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ‰€ä»¥ defStyleRes å’Œ themeä¸­ç›´æ¥æŒ‡å®šçš„ä¼˜å…ˆçº§è¿˜ä¸èƒ½è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å°† style.xml æ–‡ä»¶ä¸­çš„ä¸‹åˆ—ä»£ç è¿›è¡Œæ³¨é‡Šï¼š 1&lt;item name="defStyleAttr"&gt;@style/def_style_attr&lt;/item&gt; æˆ–è€…å°†è‡ªå®šä¹‰ View ä¸­è°ƒç”¨ç¬¬ä¸‰ä¸ªæ„é€ å‡½æ•°çš„ä»£ç åšå¦‚ä¸‹ä¿®æ”¹ï¼š 12//å°†ç¬¬ä¸‰ä¸ªå‚æ•°æ›´æ”¹ä¸º 0this(context, attrs, defStyleAttr,0); ä¿®æ”¹ä¹‹åè¿è¡Œèƒ½å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š å¯ä»¥çœ‹åˆ°å½“ defStyleAttr ä¸å­˜åœ¨å defStyleRes å¼€å§‹ç”Ÿæ•ˆï¼Œå¹¶ä¸”ä¼˜å…ˆçº§è¦é«˜äºthemeä¸­ç›´æ¥æŒ‡å®šã€‚ æ‰€ä»¥æœ€ç»ˆç»“è®ºå¦‚ä¸‹ï¼š &gt; XML ä¸­ç›´æ¥å£°æ˜ç›¸å…³å±æ€§å€¼ &gt; XML ä¸­ å¼•å…¥ style &gt; defStyleAttr &gt; defStyleRes &gt; themeä¸­ç›´æ¥æŒ‡å®š &gt; ä»…åœ¨ defStyleAttr ä¸º0æˆ–åœ¨ä¸»é¢˜ä¸­æ‰¾ä¸åˆ°æ—¶ï¼ŒdefStyleRes ç”Ÿæ•ˆã€‚ å‚è€ƒèµ„æ–™ æ·±åº¦è§£æViewæ„é€ å‡½æ•°ä¸­çš„å‚æ•°defStyleAttr Android View å››ä¸ªæ„é€ å‡½æ•°è¯¦è§£ æ·±å…¥ç†è§£Android è‡ªå®šä¹‰attr Style styleableä»¥åŠå…¶åº”ç”¨]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>View</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[getWidth() æ–¹æ³•å’Œ getMeasureWidth() æ–¹æ³•çš„åŒºåˆ«]]></title>
    <url>%2F2017%2F04%2F16%2FgetWidth()%E6%96%B9%E6%B3%95%E5%92%8CgetMeasureWidth()%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[é¦–å…ˆ getMeasureWidth() æ–¹æ³•åœ¨ measure() è¿‡ç¨‹ç»“æŸåå°±å¯ä»¥è·å–åˆ°äº†ï¼Œè€Œ getWidth() æ–¹æ³•è¦åœ¨ layout() è¿‡ç¨‹ç»“æŸåæ‰èƒ½è·å–åˆ°ã€‚å¦å¤– getMeasureWidth() æ–¹æ³•ä¸­çš„å€¼æ˜¯é€šè¿‡ setMeasuredDimension() æ–¹æ³•æ¥è¿›è¡Œè®¾ç½®çš„ï¼Œè€Œ getWidth() æ–¹æ³•ä¸­çš„å€¼åˆ™æ˜¯é€šè¿‡è§†å›¾å³è¾¹çš„åæ ‡å‡å»å·¦è¾¹çš„åæ ‡è®¡ç®—å‡ºæ¥çš„ã€‚ è§‚å¯Ÿ SimpleLayout ä¸­ onLayout() æ–¹æ³•çš„ä»£ç ï¼Œè¿™é‡Œç»™å­è§†å›¾çš„ layout() æ–¹æ³•ä¼ å…¥çš„å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ 0ï¼Œ0ï¼ŒchildView.getMeasuredWidth() å’Œ childView.getMeasuredHeight() ï¼Œå› æ­¤ getWidth() æ–¹æ³•å¾—åˆ°çš„å€¼å°±æ˜¯ childView.getMeasuredWidth() - 0 = childView.getMeasuredWidth()ï¼Œæ‰€ä»¥æ­¤æ—¶ getWidth() æ–¹æ³•å’Œ getMeasuredWidth() å¾—åˆ°çš„å€¼å°±æ˜¯ç›¸åŒçš„ã€‚ 1234567@Override protected void onLayout(boolean changed, int l, int t, int r, int b) &#123; if (getChildCount() &gt; 0) &#123; View childView = getChildAt(0); childView.layout(0, 0, childView.getMeasuredWidth(), childView.getMeasuredHeight()); &#125; &#125; ä½†å¦‚æœä½ å°† onLayout() æ–¹æ³•ä¸­çš„ä»£ç è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š 1234567@Override protected void onLayout(boolean changed, int l, int t, int r, int b) &#123; if (getChildCount() &gt; 0) &#123; View childView = getChildAt(0); childView.layout(0, 0, 200, 200); &#125; &#125; è¿™æ · getWidth() æ–¹æ³•å¾—åˆ°çš„å€¼å°±æ˜¯ 200 - 0 = 200ï¼Œä¸ä¼šå†å’Œ getMeasuredWidth() çš„å€¼ç›¸åŒäº†ã€‚å½“ç„¶è¿™ç§åšæ³•å……åˆ†ä¸å°Šé‡ measure() è¿‡ç¨‹è®¡ç®—å‡ºçš„ç»“æœï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸æ¨èè¿™ä¹ˆå†™çš„ã€‚ getHeight() ä¸ getMeasureHeight() æ–¹æ³•ä¹‹é—´çš„å…³ç³»åŒä¸Šï¼Œå°±ä¸å†é‡å¤åˆ†æäº†ã€‚ å‚è€ƒèµ„æ–™ Androidè§†å›¾ç»˜åˆ¶æµç¨‹å®Œå…¨è§£æï¼Œå¸¦ä½ ä¸€æ­¥æ­¥æ·±å…¥äº†è§£View(äºŒ)]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[d3.js ç»˜åˆ¶æŸ±å½¢å›¾]]></title>
    <url>%2F2017%2F04%2F14%2Fd3-js%E7%BB%98%E5%88%B6%E6%9F%B1%E5%BD%A2%E5%9B%BE%2F</url>
    <content type="text"><![CDATA[åœ¨d3.js ç»˜åˆ¶åŠ›å¯¼å‘å›¾ä¸­å·²ç»è¯´æ˜äº†å¦‚ä½•ç»˜åˆ¶åŠ›å¯¼å‘å›¾ä»¥åŠæ•°æ®æ›´æ–°ã€‚æœ¬æ¬¡å°†è¯´æ˜å¦‚ä½•ç»˜åˆ¶å¸¦åæ ‡è½´çš„æŸ±å½¢å›¾ã€‚ ç¡®å®šåˆå§‹æ•°æ® åˆå§‹æ•°æ®å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334var nodes = [&#123;'label': 'Sort', 'title': 'lslamic'&#125;, &#123; 'label': 'GOODS', 'title': 'VINTAGE OLD HAND MADE BEAUTY SILVER BROOCH PIN RED ENAMEL LEAF SIAM STERLING' &#125;, &#123;'label': 'Website', 'title': 'ebay'&#125;, &#123;'label': 'Sort', 'title': 'Antiques'&#125;, &#123; 'label': 'Sort', 'title': 'Baby' &#125;, &#123;'label': 'Sort', 'title': 'Books'&#125;, &#123;'label': 'Sort', 'title': 'Business &amp; Industrial'&#125;, &#123; 'label': 'Sort', 'title': 'Cameras &amp; Photo' &#125;, &#123;'label': 'Sort', 'title': 'Cell Phones &amp; Accessories'&#125;, &#123; 'label': 'Sort', 'title': 'Clothing, Shoes &amp; Accessories' &#125;, &#123;'label': 'Sort', 'title': 'Coins &amp; Paper Money'&#125;, &#123;'label': 'Sort', 'title': 'Collectibles'&#125;, &#123; 'label': 'Sort', 'title': 'Computers Tablets &amp; Networking' &#125;, &#123;'label': 'Sort', 'title': 'Consumer Electronics'&#125;, &#123;'label': 'Sort', 'title': 'Crafts'&#125;, &#123; 'label': 'Sort', 'title': 'eBay Motors' &#125;, &#123;'label': 'Sort', 'title': 'Everything Else'&#125;, &#123;'label': 'Sort', 'title': 'Health &amp; Beauty'&#125;, &#123; 'label': 'Sort', 'title': 'Home &amp; Garden' &#125;, &#123;'label': 'Sort', 'title': 'Jewelry &amp; Watches'&#125;, &#123; 'label': 'Sort', 'title': 'Musical Instruments &amp; Gear' &#125;, &#123;'label': 'Sort', 'title': 'Sporting Goods'&#125;, &#123;'label': 'Sort', 'title': 'Antiquities'&#125;, &#123; 'label': 'Sort', 'title': 'Architectural &amp; Garden' &#125;, &#123;'label': 'Sort', 'title': 'Asian Antiques'&#125;, &#123;'label': 'Sort', 'title': 'Decorative Arts'&#125;, &#123; 'label': 'Sort', 'title': 'Linens &amp; Textiles (Pre-1930)' &#125;, &#123;'label': 'Sort', 'title': 'Maritime'&#125;, &#123;'label': 'Sort', 'title': 'Periods &amp; Styles'&#125;, &#123; 'label': 'Sort', 'title': 'Primitives' &#125;, &#123;'label': 'Sort', 'title': 'Science &amp; Medicine (Pre-1930)'&#125;, &#123;'label': 'Sort', 'title': 'Silver'&#125;]; åˆå§‹æ•°æ®ä¸­æ¯ä¸ªæ•°æ®å…·æœ‰ä¸åŒçš„ç±»åˆ«ï¼Œæœ¬æ¬¡çš„ç›®çš„æ˜¯ç»Ÿè®¡ä¸åŒç±»åˆ«çš„æ•°æ®å‡ºç°æ¬¡æ•°å¹¶è¿›è¡Œç»˜åˆ¶ï¼Œæ•°æ®å¤„ç†ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415var dataset = &#123;&#125;;for (var i = 0; i &lt; nodes.length; i++) &#123; var node = nodes[i]; dataset[node['label']] = 0; for (var j = 0; j &lt; nodes.length; j++) &#123; if (nodes[j]['label'] == node['label']) dataset[node['label']] += 1; &#125;&#125;var data = [];var labels = [];for (var key in dataset) &#123; data.push(dataset[key]); labels.push(key);&#125; dataset ç”¨äºå°†æ•°æ®è¿›è¡Œåˆ†ç±»ç»Ÿè®¡ã€‚ data ä¿å­˜æ¯ä¸ªåˆ†ç±»å‡ºç°æ¬¡æ•°ã€‚ labels ä¿å­˜åˆ†ç±»åç§°ï¼Œä½œä¸º x è½´çš„åˆ»åº¦ã€‚ åˆ›å»º SVG 1234var width = 420, height = 420;var svg = d3.select("#graph").append("svg") .attr("width", width) .attr("height", height); ç»˜åˆ¶åæ ‡è½´ 123456789101112131415161718192021222324252627282930313233var padding = &#123;top: 20, right: 20, bottom: 20, left: 30&#125;;var xAxisWidth = width - 2 * padding.left;var yAxiWidth = height - 2 * padding.bottom;var xAxisScale = d3.scale.ordinal() .domain(d3.range(labels.length)) .rangeRoundBands([0, xAxisWidth]);var yAxisScale = d3.scale.linear() .domain([0, d3.max(data)]) .range([yAxiWidth, 0]);var xAxis = d3.svg.axis() .scale(xAxisScale) .orient("bottom") .tickFormat(function (d) &#123; return labels[d]; &#125;);var yAxis = d3.svg.axis() .scale(yAxisScale) .orient("left");svg.append("g") .attr("class", "axis") .attr("transform", "translate(" + padding.left + "," + (height - padding.bottom) + ")") .call(xAxis);svg.append("g") .attr("class", "axis") .attr("transform", "translate(" + padding.left + "," + (height - yAxiWidth - padding.bottom) + ")") .call(yAxis); xAxisWidthï¼ŒyAxiWidth ä»£è¡¨ x è½´å’Œ y è½´çš„é•¿åº¦ã€‚ padding x è½´å’Œ y è½´çš„å¤–è¾¹è·ã€‚ xAxisScaleï¼ŒyAxisScale x è½´å’Œ y è½´çš„æ¯”ä¾‹å°ºã€‚ ordinal().domain() è®¾å®šæˆ–è·å–å®šä¹‰åŸŸã€‚ ordinal.rangeRoundBands(interval[, padding[, outerPadding]]) æ¥æ”¶ä¸€ä¸ªè¿ç»­çš„åŒºé—´ï¼Œç„¶åæ ¹æ®å®šä¹‰åŸŸä¸­ç¦»æ•£å€¼çš„æ•°é‡å°†å…¶åˆ†æ®µï¼Œåˆ†æ®µç»“æœä¼šå–æ•´ã€‚ tickFormat() ç”¨äºè®¾å®šæ–‡å­—æ ¼å¼çš„åˆ»åº¦ã€‚ è¿™æ ·æ·»åŠ ä¹‹åçš„åæ ‡è½´ï¼Œæ ·å¼ä¼šæ¯”è¾ƒä¸‘ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç»™åæ ‡è½´å¢åŠ å¦‚ä¸‹æ ·å¼ï¼š 12345678910111213&lt;style&gt; .axis path, .axis line &#123; fill: none; stroke: black; shape-rendering: crispEdges; &#125; .axis text &#123; font-family: sans-serif; font-size: 11px; &#125;&lt;/style&gt; ç»˜åˆ¶çŸ©å½¢ 123456789101112131415161718192021222324252627//0.05 ç”¨äºè®¾ç½®çŸ©å½¢ä¹‹é—´çš„é—´éš”ï¼Œç”±äº rangeRoundBands é€‰å–çš„èŒƒå›´è¿œå°äº xAxisWidthï¼Œæ‰€ä»¥çŸ©å½¢ä¹‹é—´çš„é—´éš”è¿œå¤§äº 0.05ï¼Œè¯¥å‚æ•°æœªèµ·ä½œç”¨ã€‚var xScale = d3.scale.ordinal() .domain(d3.range(labels.length)) .rangeRoundBands([0, 100], 0.05);var yScale = d3.scale.linear() .domain([0, d3.max(data)]) .range([0, yAxiWidth]);var rect = svg.selectAll("rect") .data(data);rect.enter() .append("rect") .attr("x", function (d, i) &#123; x = xAxisWidth / (2 * labels.length) * (2 * i + 1) - xScale.rangeBand() / 2 + padding.left; return x; &#125;) .attr("y", function (d, i) &#123; return height - padding.bottom - yScale(d); &#125;) .attr("width", function (d, i) &#123; return xScale.rangeBand(); &#125;) .attr("height", yScale) .attr("fill", "steelblue"); xScale ç”¨äºæ§åˆ¶çŸ©å½¢å®½åº¦ï¼Œ yScale ç”¨äºæ§åˆ¶çŸ©å½¢é«˜åº¦ã€‚è¿™æ ·åšå¯ä»¥ä½¿å¾—çŸ©å½¢çš„å®½åº¦å’Œé«˜åº¦è‡ªç”±ä¼¸ç¼©ã€‚ ç»™çŸ©å½¢å¢åŠ æ–‡å­—æè¿° 123456789101112131415161718192021var text = svg.selectAll("text") .data(data);text.enter().append("text") .attr("x", function (d, i) &#123; x = xAxisWidth / (2 * labels.length) * (2 * i + 1) - xScale.rangeBand() / 2 + padding.left; return x; &#125;) .attr("y", function (d, i) &#123; return height - padding.bottom - yScale(d); &#125;) .attr("dx", function (d, i) &#123; return xScale.rangeBand() / 4; &#125;) .attr("dy", -2) .attr("text-anchor", "begin") .attr("font-size", 14) .attr("fill", "#000000") .text(function (d, i) &#123; return d; &#125;); text å…ƒç´ çš„åæ ‡æ˜¯çŸ©å½¢çš„åæ ‡ï¼Œdxï¼Œdy è®¾å®šäº†æ–¹å‘ä¸Šçš„åç§»é‡ã€‚æ‰€ä»¥æœ€ç»ˆæ–‡å­—ä½äºçŸ©å½¢æ­£ä¸Šæ–¹ã€‚ æŸ±å½¢å›¾åŠ¨ç”» ç»™æŸ±å½¢å›¾å¢åŠ åŠ¨ç”»ï¼Œéœ€è¦å°†ä»£ç ä¿®æ”¹ä¸ºï¼š 12345678910111213141516171819202122232425262728var rect = svg.selectAll("rect") .data(data);rect.enter() .append("rect") .attr("y", function (d, i) &#123; return height - padding.bottom; &#125;) .attr("height", 0) .attr("fill", "red") .transition() .duration(3000) .ease("bounce") .delay(function (d, i) &#123; return 200 * i; &#125;) .attr("x", function (d, i) &#123; x = xAxisWidth / (2 * labels.length) * (2 * i + 1) - xScale.rangeBand() / 2 + padding.left; return x; &#125;) .attr("y", function (d, i) &#123; return height - padding.bottom - yScale(d); &#125;) .attr("width", function (d, i) &#123; return xScale.rangeBand(); &#125;) .attr("height", yScale) .attr("fill", "steelblue"); ä¸Šè¿°ä»£ç è®¾ç½®äº†ä¸¤ä¸ª fill å±æ€§ï¼Œåœ¨æ·»åŠ äº† transition() ä¹‹åï¼ŒD3 ä¼šè‡ªåŠ¨å¯¹é¢œè‰²ä¹‹é—´çš„å€¼è¿›è¡Œçº¿æ€§æ’å€¼ï¼Œæœ€ç»ˆåœ¨åŠ¨ç”»ä¸­ä¼šçœ‹åˆ°å¹³æ»‘çš„é¢œè‰²å˜åŒ–ã€‚ duration() åŠ¨ç”»æŒç»­æ—¶é—´ã€‚ ease() æŒ‡å®šè½¬å˜æ–¹å¼ï¼Œå¸¸ç”¨çš„è½¬å˜æ–¹å¼æœ‰ï¼š linear æ™®é€šçš„çº¿æ€§å˜åŒ–ã€‚ circle æ…¢æ…¢åœ°åˆ°è¾¾å˜æ¢çš„æœ€ç»ˆçŠ¶æ€ã€‚ elastic å¸¦æœ‰å¼¹è·³çš„åˆ°è¾¾æœ€ç»ˆçŠ¶æ€ã€‚ bounce åœ¨æœ€ç»ˆçŠ¶æ€å¤„å¼¹è·³å‡ æ¬¡ã€‚ delay() æŒ‡å®šå»¶æ—¶ã€‚ æœ€ç»ˆæ•ˆæœ å‚è€ƒèµ„æ–™ å¦‚ä½•è®©å›¾è¡¨åŠ¨èµ·æ¥ d3-3.x-api-reference]]></content>
      <categories>
        <category>æ‚è®°</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>d3.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[d3.js ç»˜åˆ¶åŠ›å¯¼å‘å›¾]]></title>
    <url>%2F2017%2F04%2F13%2Fd3-js%E7%BB%98%E5%88%B6%E5%8A%9B%E5%AF%BC%E5%90%91%E5%9B%BE%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹ D3.jsæ˜¯ä¸€ä¸ªJavaScriptåº“ï¼Œå®ƒå¯ä»¥é€šè¿‡æ•°æ®æ¥æ“ä½œæ–‡æ¡£ã€‚D3å¯ä»¥é€šè¿‡ä½¿ç”¨HTMLã€SVGå’ŒCSSæŠŠæ•°æ®é²œæ´»å½¢è±¡åœ°å±•ç°å‡ºæ¥ã€‚D3ä¸¥æ ¼éµå¾ªWebæ ‡å‡†ï¼Œå› è€Œå¯ä»¥è®©ä½ çš„ç¨‹åºè½»æ¾å…¼å®¹ç°ä»£ä¸»æµæµè§ˆå™¨å¹¶é¿å…å¯¹ç‰¹å®šæ¡†æ¶çš„ä¾èµ–ã€‚åŒæ—¶ï¼Œå®ƒæä¾›äº†å¼ºå¤§çš„å¯è§†åŒ–ç»„ä»¶ï¼Œå¯ä»¥è®©ä½¿ç”¨è€…ä»¥æ•°æ®é©±åŠ¨çš„æ–¹å¼å»æ“ä½œDOMã€‚ ä½¿ç”¨ åœ¨ HTML æ–‡ä»¶ä¸­å¼•å…¥ï¼š &lt;script src=&quot;http://d3js.org/d3.v3.min.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; ç¡®å®šåˆå§‹æ•°æ® åˆå§‹æ•°æ®ä¸ºèŠ‚ç‚¹æ•°æ® nodes å’Œ è¿çº¿æ•°ç»„ linksï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435var nodes = [&#123;'label': 'Website', 'title': 'ebay'&#125;, &#123;'label': 'Sort', 'title': 'Antiques'&#125;, &#123; 'label': 'Sort', 'title': 'Baby' &#125;, &#123;'label': 'Sort', 'title': 'Books'&#125;, &#123;'label': 'Sort', 'title': 'Business &amp; Industrial'&#125;, &#123; 'label': 'Sort', 'title': 'Cameras &amp; Photo' &#125;, &#123;'label': 'Sort', 'title': 'Cell Phones &amp; Accessories'&#125;, &#123; 'label': 'Sort', 'title': 'Clothing, Shoes &amp; Accessories' &#125;, &#123;'label': 'Sort', 'title': 'Coins &amp; Paper Money'&#125;, &#123;'label': 'Sort', 'title': 'Collectibles'&#125;, &#123; 'label': 'Sort', 'title': 'Computers Tablets &amp; Networking' &#125;, &#123;'label': 'Sort', 'title': 'Consumer Electronics'&#125;, &#123;'label': 'Sort', 'title': 'Crafts'&#125;, &#123; 'label': 'Sort', 'title': 'eBay Motors' &#125;, &#123;'label': 'Sort', 'title': 'Everything Else'&#125;, &#123;'label': 'Sort', 'title': 'Health &amp; Beauty'&#125;, &#123; 'label': 'Sort', 'title': 'Home &amp; Garden' &#125;, &#123;'label': 'Sort', 'title': 'Jewelry &amp; Watches'&#125;, &#123; 'label': 'Sort', 'title': 'Musical Instruments &amp; Gear' &#125;, &#123;'label': 'Sort', 'title': 'Sporting Goods'&#125;]; var links = [&#123;'source': 1, 'target': 0&#125;, &#123;'source': 2, 'target': 0&#125;, &#123;'source': 3, 'target': 0&#125;, &#123; 'source': 4, 'target': 0 &#125;, &#123;'source': 5, 'target': 0&#125;, &#123;'source': 6, 'target': 0&#125;, &#123;'source': 7, 'target': 0&#125;, &#123; 'source': 8, 'target': 0 &#125;, &#123;'source': 9, 'target': 0&#125;, &#123;'source': 10, 'target': 0&#125;, &#123;'source': 11, 'target': 0&#125;, &#123; 'source': 12, 'target': 0 &#125;, &#123;'source': 13, 'target': 0&#125;, &#123;'source': 14, 'target': 0&#125;, &#123;'source': 15, 'target': 0&#125;, &#123; 'source': 16, 'target': 0 &#125;, &#123;'source': 17, 'target': 0&#125;, &#123;'source': 18, 'target': 0&#125;, &#123;'source': 19, 'target': 0&#125;]; åˆ›å»ºå¸ƒå±€ 12var force = d3.layout.force() .charge(-300).linkDistance(130).size([width, height]); d3.layout.force() åˆ›å»ºä¸€ä¸ªåŠ›å¯¼å‘å›¾å¸ƒå±€ã€‚ charge() è®¾å®šèŠ‚ç‚¹çš„ç”µè·æ•°ï¼Œè´Ÿæ•°åˆ™æ’æ–¥ï¼Œæ­£æ•°åˆ™å¸å¼•ã€‚ linkDistance() è®¾ç½®è¿çº¿çš„è·ç¦»ã€‚ size([x, y]) è®¾ç½®åŠ›å¯¼å‘å›¾çš„ä½œç”¨èŒƒå›´ï¼Œç”¨äºæŒ‡å®šé‡åŠ›ä¸­å¿ƒä¸ºï¼ˆx/2ï¼Œy/2ï¼‰ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹ä½ç½®é™å®šä¸º [0,x] å’Œ [0,y] ä¹‹é—´ã€‚ åˆ›å»º SVG 12var svg = d3.select("#graph").append("svg") .attr("width", "100%").attr("height", "380px"); append() ç”¨äºæ·»åŠ å…ƒç´  è®¾ç½® svg çš„é•¿å®½ è½¬æ¢æ•°æ®å’Œç»˜åˆ¶ è®¾å®šèŠ‚ç‚¹æ•°ç»„å’Œè¿çº¿æ•°ç»„ä¹‹åå¼€å¯å¸ƒå±€è®¡ç®— 1force.nodes(nodes).links(links).start(); ç»˜åˆ¶ ç»‘å®šæ•°ç»„ nodes å’Œ linksï¼Œåˆ†åˆ«æ·»åŠ èŠ‚ç‚¹çš„å…ƒç´  &lt;circle&gt; å’Œè¿çº¿çš„å…ƒç´ &lt;line&gt;ã€‚å¦å¤–ï¼Œè¿˜è¦æ·»åŠ æ–‡å­—å…ƒç´  &lt;text&gt;ã€‚å„å…ƒç´ çš„ CSS æ ·å¼åˆ†åˆ«ä¸ºï¼šnodeï¼Œlinkï¼ŒnodeTextã€‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637var link = svg.selectAll(".link") .data(links);link.enter() .insert("line", ".link") .attr("class", "link");var node = svg.selectAll(".node") .data(nodes);node.enter() .append("circle") .attr("class", function (d) &#123; return "node " + d.label &#125;) .attr("r", 25) .call(force.drag);var text = svg.selectAll(".nodeText").data(nodes);text.enter() .append("text") .attr("class", "nodeText") .attr("x", function (d) &#123; return d.x; &#125;) .attr("font-size", "10px") .attr("text-anchor", "middle") .attr("dy", ".3em") .attr("y", function (d) &#123; return d.y; &#125;).text(function (d) &#123; var act_title; if (d.title.length &gt; 8) &#123; act_title = d.title.substring(0, 8) + "..."; return act_title; &#125; else &#123; return d.title; &#125;&#125;); èŠ‚ç‚¹çš„é€‰æ‹©é›†è°ƒç”¨äº† call(force.drag)ï¼Œå¯ä»¥è®©èŠ‚ç‚¹æ”¯æŒé¼ æ ‡æ‹–æ‹½ã€‚ è¿çº¿çš„é€‰æ‹©é›†è°ƒç”¨äº† insert(&quot;line&quot;, &quot;.link&quot;)ï¼Œå¯ä»¥ç¡®ä¿åŠ›å¯¼å‘å›¾è¿›è¡Œæ›´æ–°ï¼ˆç§»é™¤èŠ‚ç‚¹åå¢åŠ èŠ‚ç‚¹ï¼‰ä¹‹åè¿çº¿ä¸ä¼šè¦†ç›–åœ¨èŠ‚ç‚¹ä¸Šã€‚ åœ¨æ‹–åŠ¨èŠ‚ç‚¹ä¹‹åï¼Œå›¾å½¢å…ƒç´ çš„åæ ‡ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨è¿›è¡Œæ›´æ–°ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324force.on("tick", function () &#123; link.attr("x1", function (d) &#123; return d.source.x; &#125;) .attr("y1", function (d) &#123; return d.source.y; &#125;) .attr("x2", function (d) &#123; return d.target.x; &#125;) .attr("y2", function (d) &#123; return d.target.y; &#125;); node.attr("transform", function (d) &#123; return "translate(" + d.x + "," + d.y + ")"; &#125;); text.attr("x", function (d) &#123; return d.x; &#125;) .attr("y", function (d) &#123; return d.y; &#125;);&#125;); * `force.on()` å¯ä¸ºä¸‰ç§äº‹ä»¶è®¾å®šç›‘å¬å™¨ï¼Œstartï¼Œtickï¼Œendã€‚å…¶ä¸­ï¼Œstart æ˜¯åˆšå¼€å§‹è¿åŠ¨ï¼Œend æ˜¯è¿åŠ¨åœæ­¢ï¼Œtick æ˜¯è¡¨ç¤ºè¿åŠ¨çš„æ¯ä¸€æ­¥ã€‚ * é€‰æ‹©é›† nodeï¼Œlinkï¼Œtext ä¸Šéƒ½ç»‘å®šäº†æ•°æ®ï¼Œå½“æ¯ä¸€æ¬¡ tick äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¢«ç»‘å®šçš„æ•°æ®è¢«æ›´æ–°ï¼Œ`function(d)` ä¸­çš„ d ä¹Ÿéƒ½æ›´æ–°äº†ã€‚ å¢åŠ æ ·å¼ï¼š 123456789101112131415161718192021222324 &lt;style type="text/css"&gt; .node &#123; stroke: #222; stroke-width: 1.5px; &#125; .link &#123; stroke: #707071; stroke-opacity: .6; stroke-width: 1px; &#125; .node.Website &#123; fill: #ff756e; &#125; .node.Sort &#123; fill: #de9bf9; &#125; .nodeText &#123; fill: #ffffff &#125;&lt;/style&gt; æ•ˆæœ ç»˜åˆ¶ç®­å¤´å’Œæ·»åŠ æ–‡å­— ç»˜åˆ¶ç®­å¤´éœ€è¦ç”¨åˆ° SVG ä¸­çš„æ ‡è®°ï¼ˆmarkerï¼‰ã€‚æ ‡è®° å†™åœ¨ ä¸­ï¼Œdefs ç”¨äºå®šä¹‰å¯é‡å¤åˆ©ç”¨çš„å…ƒç´ ã€‚å®šä¹‰ç®­å¤´ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516var defs = svg.append("defs");var arrowMarker = defs.append("marker") .attr("id", "arrow") .attr("markerUnits", "strokeWidth") .attr("markerWidth", "10") .attr("markerHeight", "10") .attr("viewBox", "-0 -5 10 10") .attr("refX", "35") .attr("refY", "0") .attr("orient", "auto");var arrow_path = 'M 0,-5 L 10 ,0 L 0,5 L5,0 L0,-5';arrowMarker.append("path") .attr("d", arrow_path) .attr("fill", "#a6a6a6"); refX, refY æŒ‡çš„æ˜¯å›¾å½¢å…ƒç´ å’Œ marker è¿æ¥çš„ä½ç½®åæ ‡ï¼Œè¿™é‡Œåœ†çš„åŠå¾„è®¾ç½®ä¸º 25ï¼Œç®­å¤´çš„é¡¶ç‚¹åˆ°åº•éƒ¨å‚ç›´è·ç¦»ä¸º 10ï¼Œæ‰€ä»¥è®¾ç½®ä¸ºï¼ˆ35ï¼Œ0ï¼‰åˆ™ç®­å¤´çš„é¡¶ç«¯åˆšå¥½åœ¨åœ†ä¸Šã€‚ markerUnits æ ‡è®°å¤§å°çš„åŸºå‡†ï¼Œæœ‰ä¸¤ä¸ªå€¼ï¼Œå³ strokeWidthï¼ˆçº¿çš„å®½åº¦ï¼‰å’Œ userSpaceOnUseï¼ˆçº¿å‰ç«¯çš„å¤§å°ï¼‰ã€‚ markerWidthï¼ŒmarkerHeight æ ‡è¯†çš„å¤§å°ã€‚ orient ç»˜åˆ¶æ–¹å‘ï¼Œå¯è®¾å®šä¸º autoï¼ˆè‡ªåŠ¨ç¡®è®¤æ–¹å‘å’Œè§’åº¦å€¼ï¼‰ã€‚ id æ ‡è¯†çš„ id å·ã€‚ ç²‰çº¢è‰²æ¡†æ˜¯ viewBox èŒƒå›´ï¼Œé»‘è‰²ä¸º arrow_path çš„è½¨è¿¹ï¼š link.attr('marker-end', 'url(#arrow)');å¯ä»¥ä¸ºè¿æ¥çº¿æ·»åŠ ç®­å¤´ã€‚ ä¸ºè¿æ¥çº¿å¢åŠ æ–‡å­—ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰ &lt;path&gt; ç¡®å®šæ–‡å­—æ”¾åœ¨è¿æ¥çº¿è·¯å¾„ä¸Šï¼Œå†å®šä¹‰ &lt;text&gt;ï¼Œä¹‹ååœ¨ &lt;text&gt; æ·»åŠ  &lt;textPath&gt; å¼•ç”¨è·¯å¾„ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041//å®šä¹‰æ–‡å­—è·¯å¾„var linkpaths = svg.selectAll(".linkpath") .data(links_data);linkpaths.enter() .append('path') .attr('d', function (d) &#123; return 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y &#125;) .attr('class', 'linkpath') .attr('fill-opacity', 0) .attr('stroke-opacity', 0) .attr('fill', '#ffffff') .attr('stroke', 'red') .attr('id', function (d, i) &#123; return 'linkpath' + i; &#125;) .style("pointer-events", "none");//å®šä¹‰ &lt;text&gt; var linklabels = svg.selectAll(".linklabel") .data(links_data);linklabels.enter() .append('text') .style("pointer-events", "none") .attr('class', 'linklabel') .attr('id', function (d, i) &#123; return 'linklabel' + i; &#125;) .attr('dx', 50) .attr('dy', 0) .attr('font-size', 5) .attr('fill', '#aaa');//å¢åŠ  &lt;textPath&gt; å¼•ç”¨ pathlinklabels.append('textPath') .attr('xlink:href', function (d, i) &#123; return '#linkpath' + i &#125;) .style("pointer-events", "none") .text(function (d, i) &#123; return 'BELONG'; &#125;); pointer-events è®¾ç½®ä¸º none åˆ™ä¸åœ¨æ¥æ”¶é¼ æ ‡äº‹ä»¶ï¼Œè®¾ç½®ä¸º all åˆ™åœ¨æŒ‡é’ˆåœ¨å…ƒç´ ä¸­æˆ–è¾¹ç¼˜æ—¶æ¥æ”¶é¼ æ ‡äº‹ä»¶ã€‚ ä¸Šè¿°ä»£ç åªæ˜¯ç¡®ä¿äº†åˆå§‹æ—¶æ–‡å­—åœ¨è¿æ¥çº¿è·¯å¾„ä¸Šï¼Œæ‰€ä»¥è¿˜éœ€è¦è®¾ç½®å¯¹ä¸Šè¿°å…ƒç´ çš„åæ ‡æ›´æ–°ã€‚åœ¨ force.on() ä¸­å¢åŠ å¦‚ä¸‹ä»£ç ï¼š 1234567891011121314151617linkpaths.attr('d', function (d) &#123; var path = 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y; return path&#125;); linklabels.attr('transform', function (d, i) &#123; if (d.target.x &lt; d.source.x) &#123; bbox = this.getBBox(); //ç¡®ä¿æ–‡å­—ä¸ä¼šå€’ç½® rx = bbox.x + bbox.width / 2; ry = bbox.y + bbox.height / 2; return 'rotate(180 ' + rx + ' ' + ry + ')'; &#125; else &#123; return 'rotate(0)'; &#125;&#125;); ç¼©æ”¾å’Œæ‹–åŠ¨ è¦åŒæ—¶æ”¯æŒé¼ æ ‡ç¼©æ”¾ä»¥åŠæ‹–åŠ¨ï¼Œå¿…é¡»å¤„ç†è¿™ä¸¤è€…çš„äº‹ä»¶å†²çªï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021var zoom = d3.behavior.zoom() .scaleExtent([1, 10]) .on("zoom", function zoomed() &#123; d3.select(this).attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")"); &#125;);svg.call(d3.behavior.zoom().on("zoom", redraw)) .append('g');force.drag() .on("dragstart", function (d) &#123; //åœ¨æ‹–åŠ¨èŠ‚ç‚¹çš„æ—¶å€™é˜»æ­¢äº‹ä»¶å†’æ³¡ d3.event.sourceEvent.stopPropagation(); &#125;);// ç¼©æ”¾ä¹‹åé‡ç»˜function redraw() &#123; svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")");&#125;function dragstart(d) &#123; d3.select(this).classed("fixed", d.fixed = true);&#125; g å…ƒç´  æ˜¯ç”¨æ¥åˆ†ç»„ç”¨çš„ï¼Œå®ƒèƒ½æŠŠå¤šä¸ªå…ƒç´ æ”¾åœ¨ä¸€ç»„é‡Œï¼Œå¯¹ æ ‡è®°å®æ–½çš„æ ·å¼å’Œæ¸²æŸ“ä¼šä½œç”¨åˆ°è¿™ä¸ªåˆ†ç»„å†…çš„æ‰€æœ‰å…ƒç´ ä¸Šã€‚ç»„å†…çš„æ‰€æœ‰å…ƒç´ éƒ½ä¼šç»§æ‰¿ æ ‡è®°ä¸Šçš„æ‰€æœ‰å±æ€§ã€‚ fixed è®¾ç½®ä¸º true æ—¶ï¼Œé¡¶ç‚¹å›ºå®šä¸åŠ¨ã€‚ æ›´æ–°æ•°æ® æœ‰æ—¶å€™éœ€è¦æ›´æ–°æ•°æ®ï¼Œæ›´æ–°ååŠ›å¯¼å‘å›¾ä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚ç”±äºä¸Šè¿°çš„é€‰æ‹©é›†é€šè¿‡ data() å°†æ•°æ®ä¸å…ƒç´ è¿›è¡Œç»‘å®šï¼Œè€Œç»‘å®šçš„æƒ…å†µåˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š * updateï¼šæ•°ç»„é•¿åº¦ = å…ƒç´ æ•°é‡ * enterï¼šæ•°ç»„é•¿åº¦ &gt; å…ƒç´ æ•°é‡ * exitï¼šæ•°ç»„é•¿åº¦ &lt; å…ƒç´ æ•°é‡ æ‰€ä»¥åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™éœ€è¦åˆ†åˆ«å¯¹è¿™ä¸‰ç§æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œå¯¹äº enter è¿™ç§æ²¡æœ‰è¶³å¤Ÿçš„å…ƒç´ çš„å¤„ç†åŠæ³•æ˜¯æ·»åŠ å…ƒç´ ï¼Œå¯¹äº exit è¿™ç§å­˜åœ¨å¤šä½™å…ƒç´ çš„å¤„ç†åŠæ³•æ˜¯åˆ é™¤å…ƒç´ ï¼Œè€Œå¯¹äº update åˆ™æ˜¯è¿›è¡Œå†…å®¹ä¿®æ”¹ã€‚ ä»¥èŠ‚ç‚¹çš„æ›´æ–°æ•°æ®ä¸ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344var node = svg.selectAll(".node") .data(nodes_data);//èŠ‚ç‚¹æ•°æ®å†…å®¹ä¿®æ”¹node.attr("class", function (d) &#123; return "node " + d.label&#125;) .on("dblclick", dblclick) .attr("r", 25) .call(force.drag) .on("click", function (d) &#123; keys = d3.keys(d); delete_key = ["x", "y", "index", "weight", "px", "py", "fixed"]; info = []; for (var i = 0; i &lt; delete_key.length; i++) &#123; keys.removeByValue(delete_key[i]); &#125; for (var j = 0; j &lt; keys.length; j++) &#123; info.push(d[keys[j]]) &#125; showinfo(d.label, keys, info); &#125;);//å¢åŠ ä¸è¶³çš„å…ƒç´ node.enter() .append("circle") .attr("class", function (d) &#123; return "node " + d.label &#125;) .on("dblclick", dblclick) .attr("r", 25) .call(force.drag) .on("click", function (d) &#123; keys = d3.keys(d); delete_key = ["x", "y", "index", "weight", "px", "py", "fixed"]; info = []; for (var i = 0; i &lt; delete_key.length; i++) &#123; keys.removeByValue(delete_key[i]); &#125; for (var j = 0; j &lt; keys.length; j++) &#123; info.push(d[keys[j]]) &#125; showinfo(d.label, keys, info); &#125;);//åˆ é™¤å¤šä½™å…ƒç´ node.exit().remove(); å‚è€ƒèµ„æ–™ ç†è§£ update, enter, exit çš„ä½¿ç”¨]]></content>
      <categories>
        <category>æ‚è®°</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>d3.js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ Flask ç»“åˆ Neo4j æ„å»ºç®¡ç†ç³»ç»Ÿï¼ˆå››ï¼‰]]></title>
    <url>%2F2017%2F04%2F13%2FPython%E4%B8%8BFlask%E7%BB%93%E5%90%88Neo4j%E6%9E%84%E5%BB%BA%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%88%E5%9B%9B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[æ•°æ®çš„å¢åˆ æ”¹åŠŸèƒ½å¼•å…¥äº† bootstrap table æ’ä»¶è¿›è¡Œæ“ä½œã€‚ #### bootstrap table ä½¿ç”¨ å¼•å…¥ Bootstrap åº“ï¼ˆå‡å¦‚ä½ çš„é¡¹ç›®è¿˜æ²¡æœ‰ä½¿ç”¨ï¼‰å’Œ bootstrap-table.css åˆ° head æ ‡ç­¾ä¸‹ã€‚ 12&lt;link rel="stylesheet" href="bootstrap.min.css"&gt;&lt;link rel="stylesheet" href="bootstrap-table.css"&gt; å¼•å…¥ jQuery åº“ï¼Œbootstrap åº“ï¼ˆå‡å¦‚ä½ çš„é¡¹ç›®è¿˜æ²¡æœ‰ä½¿ç”¨ï¼‰å’Œ bootstrap-table.js åˆ° head æ ‡ç­¾ä¸‹æˆ–è€…åœ¨ body æ ‡ç­¾å…³é—­ä¹‹å‰ï¼ˆä¸€èˆ¬å»ºè®®è¿™ä¹ˆåšï¼‰ã€‚ 12345&lt;script src="jquery.min.js"&gt;&lt;/script&gt;&lt;script src="bootstrap.min.js"&gt;&lt;/script&gt;&lt;script src="bootstrap-table.js"&gt;&lt;/script&gt;&lt;-- put your locale files after bootstrap-table.js --&gt;&lt;script src="bootstrap-table-zh-CN.js"&gt;&lt;/script&gt; è¡¨æ ¼åˆå§‹åŒ– ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354var TableInit = function () &#123; var oTableInit = new Object(); //åˆå§‹åŒ–Table oTableInit.Init = function () &#123; $('#ta_info').bootstrapTable(&#123; url: $SCRIPT_ROOT + "/search_table", //è¯·æ±‚åå°çš„URLï¼ˆ*ï¼‰ method: 'get', //è¯·æ±‚æ–¹å¼ï¼ˆ*ï¼‰ toolbar: '#toolbar', //å·¥å…·æŒ‰é’®ç”¨å“ªä¸ªå®¹å™¨ striped: true, //æ˜¯å¦æ˜¾ç¤ºè¡Œé—´éš”è‰² cache: false, //æ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œé»˜è®¤ä¸ºtrueï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦è®¾ç½®ä¸€ä¸‹è¿™ä¸ªå±æ€§ï¼ˆ*ï¼‰ pagination: true, //æ˜¯å¦æ˜¾ç¤ºåˆ†é¡µï¼ˆ*ï¼‰ sortable: false, //æ˜¯å¦å¯ç”¨æ’åº sortOrder: "asc", //æ’åºæ–¹å¼ queryParams: oTableInit.queryParams,//ä¼ é€’å‚æ•°ï¼ˆ*ï¼‰ sidePagination: "server", //åˆ†é¡µæ–¹å¼ï¼šclientå®¢æˆ·ç«¯åˆ†é¡µï¼ŒserveræœåŠ¡ç«¯åˆ†é¡µï¼ˆ*ï¼‰ pageNumber: 1, //åˆå§‹åŒ–åŠ è½½ç¬¬ä¸€é¡µï¼Œé»˜è®¤ç¬¬ä¸€é¡µ pageSize: 10, //æ¯é¡µçš„è®°å½•è¡Œæ•°ï¼ˆ*ï¼‰ pageList: [10, 25, 50, 100], //å¯ä¾›é€‰æ‹©çš„æ¯é¡µçš„è¡Œæ•°ï¼ˆ*ï¼‰ search: false, //æ˜¯å¦æ˜¾ç¤ºè¡¨æ ¼æœç´¢ï¼Œæ­¤æœç´¢æ˜¯å®¢æˆ·ç«¯æœç´¢ï¼Œä¸ä¼šè¿›æœåŠ¡ç«¯ï¼Œæ‰€ä»¥ï¼Œä¸ªäººæ„Ÿè§‰æ„ä¹‰ä¸å¤§ strictSearch: false, showColumns: true, //æ˜¯å¦æ˜¾ç¤ºæ‰€æœ‰çš„åˆ— showRefresh: true, //æ˜¯å¦æ˜¾ç¤ºåˆ·æ–°æŒ‰é’® minimumCountColumns: 2, //æœ€å°‘å…è®¸çš„åˆ—æ•° clickToSelect: true, //æ˜¯å¦å¯ç”¨ç‚¹å‡»é€‰ä¸­è¡Œ height: 500, //è¡Œé«˜ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®heightå±æ€§ï¼Œè¡¨æ ¼è‡ªåŠ¨æ ¹æ®è®°å½•æ¡æ•°è§‰å¾—è¡¨æ ¼é«˜åº¦ uniqueId: "ID", //æ¯ä¸€è¡Œçš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€èˆ¬ä¸ºä¸»é”®åˆ— showToggle: true, //æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†è§†å›¾å’Œåˆ—è¡¨è§†å›¾çš„åˆ‡æ¢æŒ‰é’® cardView: false, //æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†è§†å›¾ detailView: false, //æ˜¯å¦æ˜¾ç¤ºçˆ¶å­è¡¨ columns: [&#123; checkbox: true &#125;, &#123; field: 'name', title: 'ä¿¡æ¯å' &#125;, &#123; field: 'label', title: 'ç±»åˆ«' &#125;] &#125;); &#125;; //å¾—åˆ°æŸ¥è¯¢çš„å‚æ•° oTableInit.queryParams = function (params) &#123; var temp = &#123; //è¿™é‡Œçš„é”®çš„åå­—å’Œæ§åˆ¶å™¨çš„å˜é‡åå¿…é¡»ä¸€ç›´ï¼Œè¿™è¾¹æ”¹åŠ¨ï¼Œæ§åˆ¶å™¨ä¹Ÿéœ€è¦æ”¹æˆä¸€æ ·çš„ limit: params.limit, //é¡µé¢å¤§å° offset: params.offset, //é¡µç  q: $("#search_table").find("input[name=condition]").val() &#125;; return temp; &#125;; return oTableInit;&#125;; æœåŠ¡å™¨åˆ†é¡µ åç«¯ä»£ç ï¼š 123456789101112@app.route('/search_table')def search_table(): try: q = request.args.get('q', 0) limit = request.args.get('limit', 1) offset = request.args.get('offset', 2) except KeyError: return [] else: user = User(session.get("username")) results = user.search_table(q, limit, offset) return results 1234567891011121314151617def search_table(self, condition, limit, offset): nodes = [] act_nodes = [] query = "MATCH (m) WHERE m.name CONTAINS \'" + condition + \ "\' and (labels(m)='Sort' or labels(m)='GOODS' or labels(m)='Website') RETURN m, labels(m)" results = graph.run(query) for result, label in results: node = &#123;&#125; node["name"] = result.get("name") node["label"] = label[0] nodes.append(node) total = len(nodes) for i in range(int(offset), int(offset) + int(limit)): if i &gt;= len(nodes): break act_nodes.append(nodes[i]) return jsonify(&#123;'total': total, 'rows': act_nodes&#125;) æœåŠ¡å™¨åˆ†é¡µå¿…é¡»è¿”å› total å’Œ rows ä¸¤ä¸ªå‚æ•°ï¼Œå‰è€…ä»£è¡¨æŸ¥è¯¢æ•°æ®çš„æ€»é•¿åº¦ï¼Œåè€…è¿”å›è¯¥é¡µåº”è¯¥æ˜¾ç¤ºçš„æ•°æ®ã€‚ å¢åˆ æ”¹ ä»¥å¢åŠ æ•°æ®ä¸ºä¾‹ï¼š ç”±äº Neo4j ä¸­çš„æ•°æ®ä¸æ˜¯ç»“æ„æ€§æ•°æ®ï¼Œæ‰€ä»¥å¢åŠ æ•°æ®çš„åŸºæœ¬æ€è·¯æ˜¯ç”±ç”¨æˆ·é€‰æ‹©çˆ¶èŠ‚ç‚¹ï¼Œç„¶åå‘çˆ¶èŠ‚ç‚¹å¢åŠ å­èŠ‚ç‚¹ï¼Œå¢åŠ å­èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­å¿…é¡»å¡«å…¥å­èŠ‚ç‚¹çš„ åå­—ï¼Œç±»åˆ«ä»¥åŠå’Œçˆ¶èŠ‚ç‚¹çš„å…³ç³»å±æ€§ï¼Œå¦‚æœå­èŠ‚ç‚¹è¿˜æœ‰å…¶å®ƒå±æ€§ï¼Œåˆ™å¯ä»¥ç‚¹å‡»å¢åŠ è¡Œè¿›è¡Œé¢å¤–å±æ€§çš„å¢åŠ ã€‚ å‰ç«¯ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980$('#btn_add').click(function () &#123; var father_node = $("#ta_info").bootstrapTable('getSelections'); if (father_node == "") &#123; alert("è¯·é€‰æ‹©æ’å…¥å…ƒç´ çš„çˆ¶èŠ‚ç‚¹") &#125; else if (father_node.length &gt; 1) &#123; alert("çˆ¶èŠ‚ç‚¹åªå…è®¸ä¸€ä¸ª") &#125; else &#123; if ($('.added-row').length &gt; 0) $('.added-row').remove(); $('#insertModal_body').find("input[name=name]").val(""); $('#insertModal_body').find("input[name=label]").val(""); $('#insertModal_body').find("input[name=relation]").val(""); $('#insertModal').modal() &#125; return false&#125;);$('#add_row').click(function () &#123; var modal_body = document.getElementById("insertModal_body"); var row_div = document.createElement("div"); var row_label = document.createElement("input"); var row_text = document.createElement("input"); row_div.setAttribute("class", "input-data form-inline added-row"); row_label.setAttribute("class", "extra-label form-control"); row_label.setAttribute("type", "text"); row_label.setAttribute("placeholder", "å±æ€§å"); row_label.setAttribute("name", "attr"); row_text.setAttribute("class", "extra-text form-control"); row_text.setAttribute("placeholder", "å±æ€§"); row_text.setAttribute("type", "text"); row_div.appendChild(row_label); row_div.appendChild(row_text); modal_body.appendChild(row_div);&#125;);$('#insert_btn').click(function () &#123; var data = &#123;&#125;; var father_node = $("#ta_info").bootstrapTable('getSelections'); var insertModal = $('#insertModal_body'); var fa_name = father_node[0]["name"]; var fa_label = father_node[0]['label']; var child_name = insertModal.find("input[name=name]").val(); var child_label = insertModal.find("input[name=label]").val(); var relation = insertModal.find("input[name=relation]").val(); var child_attrs_label = $('.extra-label'); var child_attrs = $('.extra-text'); data['fa_name'] = fa_name; data['fa_label'] = fa_label; data['name'] = child_name; data['label'] = child_label; data['relation'] = relation; if (child_name == "" || child_label == "" || relation == "") &#123; alert("è¯·å¡«å†™å¿…è¦ä¿¡æ¯"); return false; &#125; else if (fa_name == child_name) &#123; alert("ä¸å¯ä¸çˆ¶èŠ‚ç‚¹åç§°ç›¸åŒ"); return false; &#125; if (child_attrs.length &gt; 0) &#123; console.log(1); for (var i = 0; i &lt; child_attrs.length; i++) &#123; data[child_attrs_label[i].value] = child_attrs[i].value; &#125; &#125; data = JSON.stringify(data); $.ajax(&#123; url: "/insert", type: 'POST', data: data, contentType: 'application/json; charset=UTF-8', success: function (msg) &#123; if (msg == "æ’å…¥æˆåŠŸ") &#123; $('#insertModal').modal('hide'); $("#ta_info").bootstrapTable('refresh'); &#125; alert(msg); &#125; &#125;)&#125;); åç«¯ä»£ç ï¼š 1234567891011121314151617181920@app.route('/insert', methods=['POST'])def get_insert(): try: data = request.get_json() except KeyError: return [] else: user = User(session.get("username")) start_node = &#123;&#125; end_node = &#123;&#125; start_node['name'] = data['fa_name'] start_node['label'] = data['fa_label'] relation = data['relation'] data.pop('fa_name') data.pop('fa_label') data.pop('relation') for key in data.keys(): end_node[key] = data[key] results = user.insert_table(start_node, relation, end_node) return results 123456789101112131415161718192021def insert_table(self, start_node, relation, end_node): end_node_label = end_node['label'] end_node.pop("label") data = "" for key in end_node.keys(): data += key + ":" + "\'" + end_node[key] + "\'" + "," data = data.strip(",") check_query = "MATCH (m) WHERE m.username=\'" + end_node['name'] \ + "\' and labels(m)=\'" + end_node_label + "\' RETURN m" insert_query = "MATCH (m) WHERE m.name=\'" + start_node['name'] \ + "\' and labels(m)=\'" + start_node['label'] + \ "\' CREATE (n:" + end_node_label + "" + "&#123;" + data + "&#125;)&lt;-" + \ "[:" + relation + "]-(m) RETURN n" check_result = graph.run(check_query) if check_result.forward(): return "å·²ç»å­˜åœ¨æ­¤èŠ‚ç‚¹" print(insert_query) insert_result = graph.run(insert_query) if insert_result.forward(): return "æ’å…¥æˆåŠŸ" return "æ’å…¥å¤±è´¥" æ€»ç»“ åˆ©ç”¨ Neo4j ç»“åˆ Flask æ„å»º Web åº”ç”¨çš„å…³é”®åœ¨äºå¦‚ä½•å‰ç«¯å’Œåç«¯å¦‚ä½•è¿›è¡Œæ•°æ®äº¤äº’ï¼ŒFlask å¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡ jsonify() æ–¹æ³•è¿”å› Json æ•°æ®ï¼Œæ‰€ä»¥åœ¨æ„å»ºåº”ç”¨çš„è¿‡ç¨‹ä¸­å¯ä»¥å°½å¯èƒ½ä½¿ç”¨ ajax å‘åç«¯å‘é€ Jsonæ ¼å¼æ•°æ®ã€‚ å‚è€ƒèµ„æ–™ Bootstrap Table]]></content>
      <categories>
        <category>Pythonå®æˆ˜</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Flask</tag>
        <tag>Neo4j</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ Flask ç»“åˆ Neo4j æ„å»ºç®¡ç†ç³»ç»Ÿï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2017%2F04%2F13%2FPython%E4%B8%8BFlask%E7%BB%93%E5%90%88Neo4j%E6%9E%84%E5%BB%BA%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[éœ€æ±‚ æ ¸å¿ƒéœ€æ±‚å¦‚ä¸‹ï¼š * ç®¡ç†ç³»ç»Ÿç™»å½• * ä» Neo4j ä¸­è·å–æ•°æ®ä¿¡æ¯å›¾å½¢åŒ–æ˜¾ç¤ºå‡ºæ¥ * èŠ‚ç‚¹çš„å…³ç³»æŸ¥è¯¢åŠæº¯æºæŸ¥è¯¢ * å¯¹ Neo4j è¿›è¡ŒèŠ‚ç‚¹çš„å¢åˆ æ”¹ ç®¡ç†ç³»ç»Ÿç™»å½• é¦–å…ˆéœ€è¦åœ¨å·¥ç¨‹ç›®å½•ä¸‹åˆ›å»º login.html å’Œ models.pyï¼Œå‰è€…ä¸ºç™»å½•ç•Œé¢ç”¨äºæµ‹è¯•ä¸ Neo4j çš„è¿æ¥ï¼Œåè€…æ˜¯ä¸€ä¸ªç”¨æˆ·ç±»ç”¨äºå¤„ç†ç”¨æˆ·çš„å„é¡¹æ“ä½œã€‚ æœ¬æ¬¡è¿æ¥é‡‡ç”¨äº† Py2neo v3 åº“ï¼Œå®‰è£…å¯ä»¥é€šè¿‡ pip å®‰è£…ï¼špip install py2neo å®‰è£…æˆåŠŸä¹‹ååœ¨ models.py æ–‡ä»¶è¾“å…¥å¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152from passlib.handlers import bcryptfrom py2neo import authenticate, Graph, Nodeauthenticate("localhost:7474", "neo4j", "yy0758jyl")graph = Graph()class User: def __init__(self, username): self.username = username user_data = self.find() #è·å–ç™»å½•ç”¨æˆ·æ ‡ç­¾ if user_data: self.label = user_data['label'] else: self.label = "User" def find(self): user = &#123;&#125; data_user = graph.find_one("User", "username", self.username) if not data_user: data_admin = graph.find_one("Admin", "username", self.username) if not data_admin: return False else: print(user) user['username'] = data_admin['username'] user['password'] = data_admin['password'] user['label'] = 'Admin' else: user['username'] = data_user['username'] user['password'] = data_user['password'] user['label'] = 'User' return user def register(self, password): if not self.find(): user = Node("User", username=self.username, password=bcrypt.encrypt(password)) graph.create(user) cypher = 'MATCH (admin:Admin) MATCH(user:User &#123;username:\'' + self.username + '\'&#125;) CREATE (admin)-[manage:Manage]-&gt;(user)' graph.run( 'MATCH (admin:Admin) MATCH(user:User &#123;username:\'' + self.username + '\'&#125;) CREATE (admin)-[manage:Manage]-&gt;(user)') return True else: return False def verify_pass(self, password): user = self.find() if not user: return False else: return bcrypt.verify(password, user["password"]) authenticate() ç”¨äºè¿æ¥ Neo4j æ•°æ®åº“ï¼Œä¸‰ä¸ªå‚æ•°ä¾æ¬¡æ˜¯åœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç ã€‚ find(self) ç”¨æˆ·æŸ¥æ‰¾ç”¨æˆ·ã€‚ register(self, password) æ³¨å†Œç”¨æˆ·ã€‚ verify_pass(self, password) ç™»å½•éªŒè¯ã€‚ app.py ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132app = Flask(__name__)app.secret_key = 'sugarsugar'@app.route('/', methods=["GET", "POST"])def index(): if request.method == "POST": if "registeruser" in request.form: username = request.form['registeruser'] password = request.form['password'] if not username or not password: flash('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ') else: user = User(username) print(user) if not user.register(password): flash('ä¸€ä¸ªç”¨æˆ·å·²ç»å­˜åœ¨') else: flash('æ³¨å†ŒæˆåŠŸ') else: username = request.form['username'] password = request.form['password'] user = User(username) if not username or not password: flash('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ') elif not user.verify_pass(password): flash('æ— æ•ˆç™»å½•') else: session["username"] = user.username session['label'] = user.label return redirect(url_for("main_view")) return render_template('login.html') app.secret_key ç”±äºä½¿ç”¨äº† Session æ‰€ä»¥å¿…é¡»è¦è®¾ç½®è¯¥é¡¹å€¼ã€‚ flash() ç”¨äºå‘ç½‘é¡µå‘é€ä¿¡æ¯ã€‚ æ•°æ®æŸ¥è¯¢ åœ¨æµ‹è¯•å®Œç™»å½•åŠŸèƒ½ä¹‹åï¼Œé¦–å…ˆåœ¨ templates æ–‡ä»¶å¤¹ä¸‹åˆ›å»º view.html æ–‡ä»¶ï¼Œä½œä¸ºç™»å½•åè·³è½¬çš„é¡µé¢ï¼š æ‰§è¡ŒæŸ¥è¯¢åç›¸åº”çš„å‰ç«¯ä»£ç ï¼š 1234567891011121314151617181920212223$(document).ready(function () &#123; function search() &#123; var query = $("#search").find("input[name=condition]").val(); var flag = $("#search").find("input[name=trace]").prop('checked'); if(flag == true &amp;&amp; query == "ebay") &#123; alert("ä¸å¯ä¸ºæ ¹èŠ‚ç‚¹"); return false; &#125; $.get("/search" , &#123;q: query, f : flag&#125;, function (data) &#123; if(data.nodes.length &gt; 0)&#123; update(data.nodes, data.links); update_static(data.nodes); &#125; else alert("æŸ¥è¯¢ç»“æœä¸ºç©º"); &#125;, "json"); return false; &#125; $("#search").submit(search); search();&#125;); åå°å¤„ç†ä»£ç ï¼š app.py ä»£ç ï¼š 1234567891011@app.route('/search')def get_search(): try: q = request.args.get('q', 0) f = request.args.get('f', 1) except KeyError: return [] else: user = User(session.get("username")) results = user.search_graph(q, f) return results models.py ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667def search_graph(self, condition, flag=False): nodes = [] rels = [] i = 0 #å…³ç³»æŸ¥è¯¢ query = "MATCH (m)&lt;-[:BELONG]-(a) WHERE m.name CONTAINS \'" + condition + "\' or a.name CONTAINS \'" + condition + \ "\' RETURN properties(m) as start_node, labels(m) as labels, " \ "collect(properties(a)) as cast,collect(labels(a)) as cast_labels" #æº¯æºæŸ¥è¯¢ query_trace = "Match (n) WHERE n.name contains \'" + condition + \ "\' MATCH path = shortestPath( (m:Website)-[:BELONG*..5]-(n) )" \ " where labels(n)='Sort' or labels(n)='GOODS'" \ " RETURN nodes(path) AS nodes, EXTRACT(node IN nodes(path) | ID(node)) AS ids " \ ",EXTRACT(node IN nodes(path) | labels(node)) AS labels" results = graph.run(query) if flag == "true" and condition: nodes_act = [] rels_act = [] for node_trace, id_trace, label_trace in graph.run(query_trace): j = 0 for node_ori in node_trace: node_act = &#123;&#125; node_keys = list(node_ori.keys()) for key in node_keys: node_act[key] = node_ori.get(key) node_act['label'] = label_trace[j][0] try: target_act = nodes_act.index(node_act) j += 1 except ValueError: target_act = len(nodes_act) nodes_act.append(node_act) j += 1 if j &lt; len(node_trace): try: source_act = nodes_act.index(self.get_node(node_trace[j], label_trace[j])) except ValueError: source_act = len(nodes_act) rels_act.append(&#123;"source": source_act, "target": target_act&#125;) return jsonify(&#123;"nodes": nodes_act, "links": rels_act&#125;) for start_nodes, start_labels, end_nodes, end_labels in results: keys = list(start_nodes.keys()) node = &#123;&#125; for key in keys: node[key] = start_nodes.get(key) node['label'] = start_labels[0] try: target = nodes.index(node) except ValueError: nodes.append(node) target = i i += 1 for end_node, label in zip(end_nodes, end_labels): end_keys = list(end_node.keys()) end = &#123;&#125; for key in end_keys: end[key] = end_node.get(key) end['label'] = label[0] try: source = nodes.index(end) except ValueError: nodes.append(end) source = i i += 1 rels.append(&#123;"source": source, "target": target&#125;) return jsonify(&#123;"nodes": nodes, "links": rels&#125;) æ•°æ®çš„å¯è§†åŒ–é‡‡ç”¨ d3.jsï¼Œå…·ä½“è¿‡ç¨‹å‚è€ƒd3.js ç»˜åˆ¶åŠ›å¯¼å‘å›¾ï¼Œè¿”å›çš„æ•°æ®æ ¼å¼é™å®šä¸º Json æ ¼å¼ï¼Œnodes ä¿å­˜èŠ‚ç‚¹ä¿¡æ¯ï¼Œlinks ä¿å­˜èŠ‚ç‚¹å…³ç³»ï¼š 12&#123;&quot;nodes&quot;: [&#123;&apos;label&apos;: &apos;Website&apos;, &apos;name&apos;: &apos;ebay&apos;&#125;, &#123;&apos;label&apos;: &apos;Sort&apos;, &apos;name&apos;: &apos;Health &amp; Beauty&apos;&#125;, &#123;&apos;label&apos;: &apos;Sort&apos;, &apos;name&apos;: &apos;Musical Instruments &amp; Gear&apos;&#125;], &quot;links&quot;:[&#123;&apos;target&apos;: 0, &apos;source&apos;: 1&#125;, &#123;&apos;target&apos;: 0, &apos;source&apos;: 2&#125;]&#125; æŸ¥è¯¢æ•ˆæœï¼š å‚è€ƒèµ„æ–™ Py2neo v3 Handbook]]></content>
      <categories>
        <category>Pythonå®æˆ˜</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Flask</tag>
        <tag>Neo4j</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ Flask ç»“åˆ Neo4j æ„å»ºç®¡ç†ç³»ç»Ÿï¼ˆäºŒï¼‰]]></title>
    <url>%2F2017%2F04%2F12%2FPython%E4%B8%8BFlask%E7%BB%93%E5%90%88Neo4j%E6%9E%84%E5%BB%BA%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Neo4j ç®€ä»‹ Neo4j æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ï¼ŒNOSQL å›¾å½¢æ•°æ®åº“ï¼Œå®ƒå°†ç»“æ„åŒ–æ•°æ®å­˜å‚¨åœ¨ç½‘ç»œä¸Šè€Œä¸æ˜¯è¡¨ä¸­ã€‚å®ƒæ˜¯ä¸€ä¸ªåµŒå…¥å¼çš„ã€åŸºäºç£ç›˜çš„ã€å…·å¤‡å®Œå…¨çš„äº‹åŠ¡ç‰¹æ€§çš„ Java æŒä¹…åŒ–å¼•æ“ï¼Œä½†æ˜¯å®ƒå°†ç»“æ„åŒ–æ•°æ®å­˜å‚¨åœ¨ç½‘ç»œ(ä»æ•°å­¦è§’åº¦å«åšå›¾)ä¸Šè€Œä¸æ˜¯è¡¨ä¸­ã€‚ å®‰è£… è¿›å…¥Neo4j ä¸‹è½½åœ°å€é€‰æ‹©ç¤¾åŒºç‰ˆè¿›è¡Œä¸‹è½½å®‰è£…ã€‚ ä½¿ç”¨ Neo4j æä¾›äº† Cypher æŸ¥è¯¢è¯­è¨€å¯¹æ•°æ®åº“æ•°æ®è¿›è¡Œæ“ä½œï¼Œåœ¨ä½¿ç”¨ Neo4j ä¹‹å‰å¿…é¡»å…ˆäº†è§£ Cypherï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æä¾›äº†ä¸€äº›ä¾‹ç¨‹å’Œå¼€å‘æ–‡æ¡£ï¼š Intro to Cypher The Neo4j Developer Manual v3.1 ç¬¬ä¸€ä¸ªä»‹ç»äº† Cypher çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µæ–¹ä¾¿å»ç†è§£ Cypher è¯­è¨€ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯ä¸€ä»½å¼€å‘è€…æ–‡æ¡£ï¼Œè¯¦ç»†ä»‹ç»äº†å„æ“ä½œçš„å«ä¹‰ä»¥åŠä¸€äº›ç¤ºä¾‹è¯­å¥ã€‚ åœ¨äº†è§£ Cypher åï¼Œå°±å¯ä»¥åˆ©ç”¨ Neo4j æ§åˆ¶å°åšä¸€äº›åŸºæœ¬çš„æŸ¥è¯¢æµ‹è¯•ï¼š * é¦–å…ˆéœ€è¦å¼€å¯æœåŠ¡å™¨ï¼š * åœ¨å¼€å¯æœåŠ¡å™¨åè¿›å…¥ http://localhost:7474 ç¬¬ä¸€æ¬¡è¿›å…¥éœ€è¦è®¾ç½®å¯†ç  * åœ¨ä¸»ç•Œé¢ä¸­é€‰æ‹© Jump into codeï¼Œä¹‹åé€‰æ‹© Movie Graph ä¸­çš„ Create a graphï¼Œåˆ™å¯ä»¥çœ‹åˆ°ä¸€ä¸ª Neo4j å®˜æ–¹æä¾›çš„æ„é€ æ•°æ®å›¾çš„ä»£ç ï¼Œç‚¹å‡»ä¹‹åè¿è¡Œå³å¯ã€‚ åœ¨åˆ›å»ºäº†æ•°æ®å›¾ä¹‹åï¼Œç‚¹å‡»å·¦ä¾§çš„ç¬¬ä¸€ä¸ªå¯¼èˆªæ ï¼Œå¯ä»¥çœ‹è§æ•°æ®å›¾çš„å„é¡¹ä¿¡æ¯ã€‚ æŸ¥è¯¢ è¿™é‡Œä»¥æŸ¥è¯¢èŠ‚ç‚¹ name å±æ€§ä¸º Audrey Tautou åˆ°èŠ‚ç‚¹ title å±æ€§ä¸º As Good as It Gets ä¸”èŠ‚ç‚¹å…³ç³»ä¸º ACTED_IN é—´éš”ä¸è¶…è¿‡ 5 çš„æœ€çŸ­è·¯å¾„ä¸ºä¾‹ï¼Œåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å¦‚ä¸‹ä»£ç ï¼š 1234MATCH (you &#123;name:&quot;Audrey Tautou&quot;&#125;)MATCH (expert &#123;title:&quot;As Good as It Gets&quot;&#125;)MATCH path = shortestPath( (you)-[:ACTED_IN*..5]-(expert) )RETURN path è¿è¡Œä¹‹åç»“æœå¦‚ä¸‹ï¼š]]></content>
      <categories>
        <category>Pythonå®æˆ˜</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Neo4j</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ Flask ç»“åˆ Neo4j æ„å»ºç®¡ç†ç³»ç»Ÿï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2017%2F04%2F09%2FPython%E4%B8%8BFlask%E7%BB%93%E5%90%88Neo4j%E6%9E%84%E5%BB%BA%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹ Flask æ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç¼–å†™çš„è½»é‡çº§ Web åº”ç”¨æ¡†æ¶ã€‚å…¶ WSGI å·¥å…·ç®±é‡‡ç”¨ Werkzeug ï¼Œæ¨¡æ¿å¼•æ“åˆ™ä½¿ç”¨ Jinja2 ã€‚ å®‰è£… åœ¨ç»ˆç«¯ä¸­è¾“å…¥ sudo pip install Flask å³å¯è¿›è¡Œå®‰è£…ï¼ˆå¦‚æœä¸æƒ³è¿›è¡Œå…¨å±€å®‰è£…ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰ã€‚ åˆ›å»ºæ–‡ä»¶å¤¹ é¦–å…ˆéœ€è¦åˆ›å»ºå¦‚ä¸‹ç»“æ„çš„æ–‡ä»¶å¤¹ï¼š 123/flaskr /static /templates flaskr æ˜¯å·¥ç¨‹æ–‡ä»¶å¤¹å static æ˜¯ç”¨äºæ”¾ç½® css å’Œ javascript æ–‡ä»¶çš„æ–‡ä»¶å¤¹ templates æ˜¯æ”¾ç½®ç½‘é¡µæ¨¡æ¿çš„æ–‡ä»¶å¤¹ å¦‚æœç”¨ PyCharm å¼€å‘ï¼Œåœ¨åˆ›å»º templates æ–‡ä»¶å¤¹åéœ€è¦æŒ‰ä½å¿«æ·é”® Command + , åœ¨ Projectâ†’Project Structureï¼Œé€‰æ‹© templates æ–‡ä»¶å¤¹åç‚¹å‡» Mark as ä¸­çš„ Templates æµ‹è¯• åœ¨ flaskr ç›®å½•ä¸‹åˆ›å»º app.py çš„æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹ä»£ç ï¼š 123456789from flask import Flaskapp = Flask(__name__)@app.route('/')def hello_world(): return 'Hello World!'if __name__ == '__main__': app.run() app = Flask(__name__) åˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åº”ç”¨æ¨¡å—æˆ–è€…åŒ…çš„åç§°ã€‚ å¦‚æœä½ ä½¿ç”¨å•ä¸€çš„æ¨¡å—ï¼ˆå¦‚æœ¬ä¾‹ï¼‰ï¼Œä½ åº”è¯¥ä½¿ç”¨ name ï¼Œå› ä¸ºæ¨¡å—çš„åç§°å°†ä¼šå› å…¶ä½œä¸ºå•ç‹¬åº”ç”¨å¯åŠ¨è¿˜æ˜¯ä½œä¸ºæ¨¡å—å¯¼å…¥è€Œæœ‰ä¸åŒï¼ˆ ä¹Ÿå³æ˜¯ 'main' æˆ–å®é™…çš„å¯¼å…¥åï¼‰ã€‚è¿™æ˜¯å¿…é¡»çš„ï¼Œè¿™æ · Flask æ‰çŸ¥é“åˆ°å“ªå»æ‰¾æ¨¡æ¿ã€é™æ€æ–‡ä»¶ç­‰ç­‰ã€‚ __name__ æŒ‡å½“å‰çš„æ¨¡å—åï¼Œå½“æ¨¡å—ç›´æ¥è¿è¡Œæ—¶ï¼Œ__name__ ä¸º __main__ï¼Œå½“æ¨¡å—è¢«å¯¼å…¥è¿è¡Œæ—¶ï¼Œ__name__ ä¸ºæ¨¡å—åå­—ã€‚ route() è£…é¥°å™¨å‘Šè¯‰ Flask ä»€ä¹ˆæ ·çš„URL èƒ½è§¦å‘æˆ‘ä»¬çš„å‡½æ•°ï¼Œå‡½æ•°çš„åå­—ä¹Ÿåœ¨ç”Ÿæˆ URL æ—¶è¢«ç‰¹å®šçš„å‡½æ•°é‡‡ç”¨ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„ä¿¡æ¯ã€‚ è¿è¡Œç»“æœ è¿è¡Œä¹‹åè¿›å…¥ http://localhost:5000 å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š å‚è€ƒèµ„æ–™ Flask æ–‡æ¡£]]></content>
      <categories>
        <category>Pythonå®æˆ˜</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ç”¨ Scrapy é‡‡é›†çŸ¥ç½‘æœŸåˆŠæ•°æ®ï¼ˆå››ï¼‰]]></title>
    <url>%2F2017%2F04%2F08%2FPython%E4%B8%8B%E7%94%A8Scrapy%E9%87%87%E9%9B%86%E7%9F%A5%E7%BD%91%E6%9C%9F%E5%88%8A%E6%95%B0%E6%8D%AE%EF%BC%88%E5%9B%9B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[åœ¨Python ä¸‹ç”¨ Scrapy é‡‡é›†çŸ¥ç½‘æœŸåˆŠæ•°æ®ï¼ˆä¸‰ï¼‰ä¸­é‡‡é›†äº†æ‰€éœ€æ•°æ®ï¼Œæ¥ä¸‹æ¥è¯¥è¿›è¡Œçš„å°±æ˜¯æ•°æ®çš„å­˜å‚¨å’Œå¯¼å‡ºã€‚ æ•°æ®å­˜å‚¨ åˆ›å»º MySql è¡¨ å¯¼å…¥ pymysql åº“ import pymysql é…ç½® MySql åœ¨ setting.py æ–‡ä»¶ä¸­å†™å…¥ä¸‹åˆ—é…ç½®ä»£ç ï¼š 123456# start MySQL database configure settingMYSQL_HOST = &apos;localhost&apos;MYSQL_DBNAME = &apos;æ•°æ®åº“å&apos;MYSQL_USER = &apos;ç™»å½•å&apos;MYSQL_PASSWD = &apos;å¯†ç &apos;# end of MySQL database configure setting ç¼–å†™ item pipeline æ¯ä¸ª item pipeline ç»„ä»¶(æœ‰æ—¶ç§°ä¹‹ä¸º â€œItem Pipelineâ€ )æ˜¯å®ç°äº†ç®€å•æ–¹æ³•çš„Pythonç±»ã€‚ä»–ä»¬æ¥æ”¶åˆ°Itemå¹¶é€šè¿‡å®ƒæ‰§è¡Œä¸€äº›è¡Œä¸ºï¼ŒåŒæ—¶ä¹Ÿå†³å®šæ­¤Itemæ˜¯å¦ç»§ç»­é€šè¿‡pipelineï¼Œæˆ–æ˜¯è¢«ä¸¢å¼ƒè€Œä¸å†è¿›è¡Œå¤„ç†ã€‚ ä»¥é‡‡é›†å¼•è¯æ–‡çŒ®çš„ item pipeline ä¸ºä¾‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546class CnkiPipeline(object): def __init__(self): self.connect = pymysql.connect( host=settings.MYSQL_HOST, db=settings.MYSQL_DBNAME, user=settings.MYSQL_USER, passwd=settings.MYSQL_PASSWD, charset='utf8', use_unicode=True) self.cursor = self.connect.cursor() def process_item(self, item, spider): if item.__class__ == Quote: try: self.cursor.execute("""select * from reference where literature_title = %s and quote_title = %s AND literature_author = %s AND literature_journalName = %s AND literature_time = %s""", (item["paper_title"], str(item['quote_title']), item['paper_author'], item['paper_journalName'], item['paper_time'])) ret = self.cursor.fetchone() if ret: self.cursor.execute( """update reference set literature_title = %s,literature_author = %s, literature_journalName = %s, literature_time = %s,quote_title = %s where literature_title = %s and quote_title = %s AND literature_author = %s""", (str(item['paper_title']), str(item['paper_author']), str(item['paper_journalName']), str(item['paper_time']), str(item['quote_title']), str(item['paper_title']), str(item['quote_title']), str(item['paper_author']))) else: self.cursor.execute( """insert into reference(literature_title,literature_author,literature_journalName, literature_time,quote_title) value (%s,%s,%s,%s,%s)""", (str(item['paper_title']), str(item['paper_author']), str(item['paper_journalName']), str(item['paper_time']), str(item['quote_title']))) self.connect.commit() except Exception as error: log(error) return item item pipeline ä¸­éœ€è¦åˆ¤æ–­ item çš„ç±»å‹æ˜¯å¦æ˜¯éœ€è¦è¢«å¤„ç†çš„ç±»å‹ï¼Œè¿›è€Œè¿›è¡ŒæŸ¥è¯¢åˆ¤æ–­è¯¥æ¡è®°å½•æ˜¯å¦åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿›è¡Œæ›´æ–°ï¼Œå¦åˆ™è¿›è¡Œæ’å…¥ã€‚ çˆ¬å–ç»“æœ æ•°æ®å¯¼å‡º ä¸ºäº†å°†æ•°æ®å¯¼å‡ºä¸º Excel æ ¼å¼ï¼Œåˆ©ç”¨åˆ°äº†xlrdï¼Œxlsxwriterï¼Œxlutils åº“ï¼Œå¯¼å‡ºä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293try: with connect.cursor() as cursor: # Create a new record sql_quote = "select * from periodical_data where journalName = %s and publicationDate = %s ORDER BY referenceNum DESC" sql_reference = "select * from reference where quote_title = %s" cursor.execute(sql_quote, (title, publicationDate)) results = cursor.fetchall() #oneup ç”¨äºè®°å½•å¼•ç”¨æ•°åœ¨æ¯å¹´ä¸€æ¬¡ä»¥ä¸Šçš„æ–‡çŒ®æ•°ï¼Œonelow ç”¨äºè®°å½•å¼•ç”¨æ•°åœ¨æ¯å¹´ä¸€æ¬¡ä»¥ä¸‹çš„æ–‡çŒ®æ•°ï¼Œnoone ç”¨äºè®°å½•æ²¡æœ‰è¢«å¼•ç”¨çš„æ–‡çŒ®æ•° oneup=0 onelow=0 noone=0 endrows=0 for result in results: reference="" years=[] resultwork = xlrd.open_workbook(year + title + ".xls") sheet1 = resultwork.sheet_by_index(0) old_excel = copy.copy(resultwork) sheet_write = old_excel.get_sheet(0) rows = sheet1.nrows cols = sheet1.ncols quote_title = result['title'] if result['referenceNum'] != "0": cursor.execute(sql_reference, quote_title) reference = cursor.fetchall() if result['referenceNum']: if result['referenceNum'] &gt; (2016-int(year)): if oneup == 0: sheet_write.write(rows, 0, "å¼•ç”¨æ¯å¹´ä¸€æ¬¡ä»¥ä¸Š") rows = rows + 1 oneup = oneup + 1 sheet_write.write(rows, 0, "1") sheet_write.write(rows, 1, result['title']) sheet_write.write(rows, 2, result['author']) sheet_write.write(rows, 3, result['journalName']) sheet_write.write(rows, 4, result['publicationDate']) sheet_write.write(rows, 5, result['referenceNum']) sheet_write.write(rows, 6, result['downloadNum']) else: if onelow == 0: sheet_write.write(rows, 0, "å¼•ç”¨æ¯å¹´ä¸€æ¬¡ä»¥ä¸‹") rows = rows + 1 onelow = onelow + 1 sheet_write.write(rows, 0, "1") sheet_write.write(rows, 1, result['title']) sheet_write.write(rows, 2, result['author']) sheet_write.write(rows, 3, result['journalName']) sheet_write.write(rows, 4, result['publicationDate']) sheet_write.write(rows, 5, result['referenceNum']) sheet_write.write(rows, 6, result['downloadNum']) else: if noone == 0: sheet_write.write(rows, 0, "æ²¡æœ‰å¼•ç”¨") rows = rows + 1 noone = noone + 1 sheet_write.write(rows, 0, "1") sheet_write.write(rows, 1, result['title']) sheet_write.write(rows, 2, result['author']) sheet_write.write(rows, 3, result['journalName']) sheet_write.write(rows, 4, result['publicationDate']) sheet_write.write(rows, 5, result['referenceNum']) sheet_write.write(rows, 6, result['downloadNum']) for row in range(len(reference)): sheet_write.write(rows + row + 1, 0, "0") sheet_write.write(rows+row+1, 1, reference[row]['literature_title']) sheet_write.write(rows+row+1, 2, reference[row]['literature_author']) sheet_write.write(rows+row+1, 3, reference[row]['literature_journalName']) sheet_write.write(rows+row+1, 4, reference[row]['literature_time']) years.append(reference[row]['literature_time']) c = Counter(years) print(c.most_common(1)) print(result['title']) if result['referenceNum']: if result['referenceNum'] &gt; (2016-int(year)): if c.most_common(1): for most in c.most_common(1): most_year = str(most).split(",")[0].split("(")[1] most_time = str(most).split(",")[1].split(")")[0] sheet_write.write(rows, 7, most_year) sheet_write.write(rows, 8, most_time) old_excel.save(year + title + ".xls") endrows = rows + len(reference) + 2 resultwork = xlrd.open_workbook(year + title + ".xls") sheet1 = resultwork.sheet_by_index(0) old_excel = copy.copy(resultwork) sheet_write = old_excel.get_sheet(0) sheet_write.write(endrows, 0, "æ¯å¹´å¼•ç”¨æ¬¡æ•°ä¸€æ¬¡ä»¥ä¸Šç™¾åˆ†æ¯”ï¼š" + str(float(oneup)/len(results))) sheet_write.write(endrows+1, 0, "æ¯å¹´å¼•ç”¨æ¬¡æ•°ä¸€æ¬¡ä»¥ä¸‹ç™¾åˆ†æ¯”ï¼š" + str(float(onelow) / len(results))) sheet_write.write(endrows+2, 0, "æ¯å¹´æ²¡æœ‰å¼•ç”¨ç™¾åˆ†æ¯”ï¼š" + str(float(noone) / len(results))) old_excel.save(year + title + ".xls")finally: connect.close() å¯¼å‡ºæ•ˆæœï¼š å‚è€ƒèµ„æ–™ Scrapy æ–‡æ¡£]]></content>
      <categories>
        <category>Pythonå®æˆ˜</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>æ•°æ®å¤„ç†</tag>
        <tag>Scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ç”¨ Scrapy é‡‡é›†çŸ¥ç½‘æœŸåˆŠæ•°æ®ï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2017%2F04%2F08%2FPython%E4%B8%8B%E7%94%A8Scrapy%E9%87%87%E9%9B%86%E7%9F%A5%E7%BD%91%E6%9C%9F%E5%88%8A%E6%95%B0%E6%8D%AE%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[åœ¨Python ä¸‹ç”¨ Scrapy é‡‡é›†çŸ¥ç½‘æœŸåˆŠæ•°æ®ï¼ˆäºŒï¼‰ä¸­å·²ç»è·å–äº†æœŸåˆŠçš„æœç´¢ç»“æœï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹é‡‡é›†æ–‡çŒ®æ•°æ®äº†ã€‚ é‡‡é›†æœŸåˆŠæ–‡çŒ®æ•°æ® å®šä¹‰ Items ä¸ºäº†å®šä¹‰å¸¸ç”¨çš„è¾“å‡ºæ•°æ®ï¼ŒScrapyæä¾›äº† Item ç±»ã€‚ Item å¯¹è±¡æ˜¯ç§ç®€å•çš„å®¹å™¨ï¼Œä¿å­˜äº†çˆ¬å–åˆ°å¾—æ•°æ®ã€‚ å…¶æä¾›äº† ç±»ä¼¼äºè¯å…¸(dictionary-like) çš„APIä»¥åŠç”¨äºå£°æ˜å¯ç”¨å­—æ®µçš„ç®€å•è¯­æ³•ã€‚ åœ¨ items.py æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹ä»£ç ï¼š 1234567class PaperItem(scrapy.Item): title = scrapy.Field() author = scrapy.Field() journalName = scrapy.Field() publicationDate = scrapy.Field() referenceNum = scrapy.Field() downloadNum = scrapy.Field() æå–æ•°æ® 12345678910111213141516171819def parse(self, response): if "rurl" in str(requests_url): iden_code_url = str(requests_url).split("GET")[1].split("&gt;")[0].strip() yield scrapy.Request(iden_code_url, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.handleCode, dont_filter=True) items = PaperItem() for result in response.css('tr[bgcolor]'): items['title'] = result.css("td &gt; a[class=fz14]").xpath("string(.)").extract_first() items['author'] = result.css("td[class=author_flag] &gt; a[class=KnowledgeNetLink]::text").extract() items['journalName'] = result.css("td[class=cjfdyxyz]").xpath("string(a)").extract_first() items['publicationDate'] = result.css("td[align] &gt; a[target=_blank]::text").extract_first().split("/")[0] items['referenceNum'] = result.css("span[class=KnowledgeNetcont] &gt; a::text").extract_first() items['downloadNum'] = result.css("span[class=downloadCount] &gt; a::text").extract_first() yield items next_page = response.xpath("//div/a[text()='ä¸‹ä¸€é¡µ']/@href").extract() if next_page: next_page = response.urljoin(next_page[0]) yield scrapy.Request(next_page, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.parse, dont_filter=True) if &quot;rurl&quot; in str(requests_url) ç”¨äºåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦æ˜¯è¯·æ±‚éªŒè¯ç çš„è¯·æ±‚ï¼Œå¦‚æœæ˜¯åˆ™å›è°ƒ handleCode(self, response) è¿›è¡ŒéªŒè¯ç çš„å¤„ç†ï¼Œç”±äºéªŒè¯ç çš„è¯·æ±‚é“¾æ¥å¤§å¤šç›¸åŒæ‰€ä»¥å¿…é¡»è®¾ç½® dont_filter=Trueã€‚ for å¾ªç¯ç”¨äºæå–æ–‡çŒ®çš„å„é¡¹æ•°æ®ï¼Œnext_page æ˜¯ä¸‹ä¸€é¡µçš„é“¾æ¥ï¼Œresponse.urljoin() æ–¹æ³•æ„é€ ä¸€ä¸ªç»å¯¹è·¯å¾„çš„ URL (é¡µé¢ä¸Šçš„é“¾æ¥éƒ½æ˜¯ç›¸å¯¹è·¯å¾„çš„)ï¼Œå‘é€ä¸‹ä¸€é¡µçš„è¯·æ±‚ä¹Ÿéœ€è¦è®¾ç½® dont_filter=Trueã€‚ éªŒè¯ç å¤„ç† éªŒè¯ç çš„å¤„ç†ä¸»è¦å’Œè¿™ä¸¤ä¸ªè¯·æ±‚ç›¸å…³ï¼š ç¬¬ä¸€ä¸ªè¯·æ±‚ç”¨äºæ˜¾ç¤ºè¾“å…¥éªŒè¯ç é¡µé¢å’Œæäº¤éªŒè¯ç ï¼Œä¸»è¦å’Œä¸¤ä¸ªå‚æ•°ç›¸å…³ï¼š ç¬¬äºŒä¸ªè¯·æ±‚åˆ™ä¸»è¦ç”¨äºè·å–éªŒè¯ç ï¼š http://kns.cnki.net/kns/checkcode.aspx?t=%27+Math.random() å¤„ç†éªŒè¯ç çš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334def handleCode(self, response): sid_kns = "" sessionId = "" ori_cookie = response.request.headers.getlist('Cookie') response_url = str(response.request.headers.getlist('Referer')).split("'")[1].split("rurl=")[1] if "vericode=" in response_url: response_url = re.sub(r"&amp;vericode.*", "", response_url) for cookie_parameter in str(ori_cookie).split(";"): if "SID_kns" in cookie_parameter: sid_kns = cookie_parameter.split("=")[1] if "ASP.NET_SessionId" in cookie_parameter: sessionId = cookie_parameter.split("=")[1] act_cookie = &#123;"ASP.NET_SessionId": sessionId, "SID_kns": sid_kns&#125; url = "http://kns.cnki.net/kns/checkcode.aspx?t='+Math.random()" result_file = self.downloadCodeImg(url, act_cookie) code_img = Image.open(result_file) code_img.show() ver_code = input("è¾“å…¥éªŒè¯ç :") print("å·²è¾“å…¥éªŒè¯ç :", ver_code) return_url = "http://kns.cnki.net/kns/brief/vericode.aspx?rurl=" + response_url + "&amp;vericode=" + ver_code yield scrapy.Request(return_url, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.parse, dont_filter=True)def downloadCodeImg(self, getCodeUrl, cookie): iden_code_img = "ver_code" + time.strftime('%Y-%m-%d', time.localtime(time.time())) + ".jpg" response = requests.get(getCodeUrl, stream=True, cookies=cookie) # here we need to set stream = True parameter requests.utils.add_dict_to_cookiejar(response.cookies, cookie) print(response.cookies) with open(iden_code_img, 'wb') as f: for chunk in response.iter_content(chunk_size=1024): if chunk: f.write(chunk) f.flush() f.close() return iden_code_img response_url ä¸º rurl çš„å‚æ•°å€¼ act_cookie ä¸ºè¯·æ±‚çš„ cookies å€¼ downloadCodeImg ç”¨äºä¸‹è½½éªŒè¯ç  é‡‡é›†å¼•è¯æ–‡çŒ® å®šä¹‰ Items 123456class Quote(scrapy.Item): paper_title = scrapy.Field() paper_author = scrapy.Field() paper_journalName = scrapy.Field() paper_time = scrapy.Field() quote_title = scrapy.Field() æå–æ•°æ® å¼•è¯æ–‡çŒ®çš„æ•°æ®æå–æ˜¯åŠ¨æ€ç½‘é¡µï¼Œæ‰€ä»¥ä¸èƒ½å¤Ÿç›´æ¥é‡‡é›†ï¼Œé€šè¿‡æŠ“åŒ…åˆ†æï¼Œæ•°æ®ä¸»è¦ä¸‹å›¾çš„è¯·æ±‚ç›¸å…³ï¼š ä¸ºäº†å¯¹å¼•è¯æ–‡çŒ®çš„æ‰€æœ‰ç±»åˆ«è¿›è¡Œç¿»é¡µï¼Œå‚æ•° CurDBCode å¿…é¡»å»é™¤ï¼Œå‘é€è¯·æ±‚ä¹‹åçš„é¡µé¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç”±äºæ˜¯çº¯æ–‡æœ¬é¡µé¢ï¼Œé™¤äº†çŸ¥é“ä¸Šå›¾æ‰€ç¤ºçš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜éœ€è¦çŸ¥é“å¼•è¯æ–‡çŒ®çš„æœ€å¤§é¡µæ•°è¿›è¡Œç¿»è¯‘ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š å‘é€å¼•è¯æ–‡çŒ®è¯·æ±‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546def parse(self, response): requests_url = response.request #True ä»£è¡¨æ–‡çŒ®å¼•è¯æ–‡çŒ®æ•°å¤§äº 0ï¼Œå¦åˆ™ä»£è¡¨æ–‡çŒ®æ²¡æœ‰å¼•è¯æ–‡çŒ® flag = True if "rurl" in str(requests_url): iden_code_url = str(requests_url).split("GET")[1].split("&gt;")[0].strip() yield scrapy.Request(iden_code_url, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.handleCode , dont_filter=True) #quote_urls ç”¨äºä¿å­˜å¼•è¯æ–‡çŒ®æ•°å¤§äº 10 çš„é“¾æ¥ï¼Œä»£è¡¨ç€å¼•è¯æ–‡çŒ®é¡µæ•°å¯èƒ½ä¸¤é¡µä»¥ä¸Šéœ€è¦è®¡ç®—é¡µæ•° quote_urls = [] #quote_direct ç”¨äºä¿å­˜å¼•è¯æ–‡çŒ®æ•°å°äºç­‰äº 10 çš„é“¾æ¥ï¼Œä»£è¡¨ç€å¼•è¯æ–‡çŒ®é¡µæ•°åªæœ‰ä¸€é¡µåªç”¨ç›´æ¥é‡‡é›† quote_direct = [] for result in response.css('tr[bgcolor]'): quote_url = result.css("span[class=KnowledgeNetcont] &gt; a").xpath("@onclick").extract_first() num = result.css("span[class=KnowledgeNetcont] &gt; a::text").extract_first() if quote_url is not None: if int(num) &lt;= 10: pages = 1 else: pages = 1000 title = result.css("td &gt; a[class=fz14]").xpath("string(.)").extract_first() quote_code = self.get_quote_code(quote_url) origin_quote_url = "http://kns.cnki.net/kcms/detail/frame/asynlist.aspx" quote_parameters = &#123;'dbcode': 'CJFQ', 'search': title, 'code': quote_code, 'ds': 'frame/list.aspx', 'reftype': '18', 'page': pages, &#125; url = self.get_url(origin_quote_url, quote_parameters) if int(num) &lt;= 10: quote_direct.append(url) else: quote_urls.append(url) else: flag = False next_page = response.xpath("//div/a[text()='ä¸‹ä¸€é¡µ']/@href").extract() if next_page and flag: next_page = response.urljoin(next_page[0]) yield scrapy.Request(next_page, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.parse , dont_filter=True, priority=100) for get_quote_url in quote_urls: yield scrapy.Request(get_quote_url, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.parse_first_quote) for get_quote_url in quote_direct: yield scrapy.Request(get_quote_url, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.parse_quote) title æ–‡çŒ®çš„ç¯‡å quote_code æ–‡çŒ®çš„ç¼–ç  pages é¡µæ•°ï¼Œè®¾ç½®ä¸º 1000ï¼Œä¸ºäº†æ–¹ä¾¿è®¡ç®—é¡µæ•°ï¼Œå¦‚æœè®¾ç½®ä¸º 1 è¿›è¡Œé¡µæ•°è®¡ç®—ï¼Œé‚£ä¹ˆè¿›è¡Œæ•°æ®é‡‡é›†çš„æ—¶é“¾æ¥å°†è¢«è¿‡æ»¤æ‰ã€‚ priority=100 ä¼˜å…ˆå¤„ç†ç¿»é¡µçš„è¯·æ±‚ï¼Œç¿»é¡µæ—¶é—´è¿‡é•¿å°†å¯¼è‡´é¡µé¢ä¸ä¼šæŒ‰ç…§è¢«å¼•é‡é™åºæ’åˆ—ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ è®¡ç®—é¡µæ•° 1234567891011121314151617181920212223242526def parse_first_quote(self, response): result_html = Selector(response, type="html") regex = r"\Wcode=" quote_code = re.split(regex, response.url)[1] quote_code = quote_code.split("&amp;")[0] title = response.url.split("search=")[1] title = title.split("&amp;")[0] title = urllib.parse.unquote(title) origin_res = result_html.css("b[class=titleTotle] &gt; span[id]::text").extract() act_res = [] for result in origin_res: if result is not '\xa0': act_res.append(int(re.sub("\D", "", result.strip()))) if act_res: max_page = max(act_res) max_page = math.ceil(float(max_page)/10) else: max_page = 1 origin_url = 'http://kns.cnki.net/kcms/detail/frame/asynlist.aspx' for page_num in range(max_page): quote_parameters = &#123;'dbcode': 'CJFQ', 'search': title, 'code': quote_code, 'ds': 'frame/list.aspx', 'reftype': '18', 'page': str(page_num + 1), &#125; act_url = self.get_url(origin_url, quote_parameters) yield scrapy.Request(act_url, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.parse_quote) origin_res ç”¨äºè·å–é¡µé¢ä¸Šè®°å½•çš„æ¡æ•° max_page æœ€å¤§çš„é¡µæ•° for å¾ªç¯ç”¨äºå¼•è¯æ–‡çŒ®çš„ç¿»é¡µ é‡‡é›† å¼•è¯æ–‡çŒ®çš„æ ¼å¼å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œæ‰€ä»¥è¿™ä¸‰ç±»éœ€è¦å•ç‹¬è¿›è¡Œå¤„ç†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859def parse_quote(self, response): quote_item = Quote() ori_title = response.url.split("search=")[1] ori_title = ori_title.split("&amp;")[0] quote_title = urllib.parse.unquote(ori_title) for result in response.css("div[class=essayBox]"): dbTitle = result.xpath(".//div[@class='dbTitle']/text()").extract_first() if "ä¸­å›½å­¦æœ¯æœŸåˆŠç½‘ç»œå‡ºç‰ˆæ€»åº“" in dbTitle: for result_cjfq in result.css("ul &gt; li"): paper_title = result_cjfq.xpath(".//em/text()").extract_first() +\ result_cjfq.xpath(".//a[@target='kcmstarget']").xpath('string(.)').extract_first() paper_author = result_cjfq.xpath("./text()").extract_first().replace("&amp;nbsp", '') paper_title = paper_title + paper_author.split(".")[0] paper_author = paper_author.split(".")[1].strip() paper_journalName = result_cjfq.xpath(".//a[@onclick]/text()").extract()[0] time_len = len(result_cjfq.xpath(".//a[@onclick]/text()")) paper_time = result_cjfq.xpath(".//a[@onclick]/text()").extract()[time_len - 1] paper_time = paper_time.split("(")[0] quote_item['paper_title'] = paper_title quote_item['paper_author'] = paper_author quote_item['paper_journalName'] = paper_journalName quote_item['paper_time'] = paper_time quote_item['quote_title'] = quote_title.replace("++", " ") yield quote_item if "ä¸­å›½åšå£«å­¦ä½è®ºæ–‡å…¨æ–‡æ•°æ®åº“" in dbTitle or "ä¸­å›½ä¼˜ç§€ç¡•å£«å­¦ä½è®ºæ–‡å…¨æ–‡æ•°æ®åº“" in dbTitle: for result_cjfq in result.css("ul &gt; li"): paper_title = result_cjfq.xpath(".//em/text()").extract_first() + \ result_cjfq.xpath(".//a[@target='kcmstarget']/text()").extract_first() paper_author = result_cjfq.xpath("./text()").extract_first() paper_title = paper_title + paper_author.split(".")[0] paper_author = paper_author.split(".")[1].strip() paper_journalName = result_cjfq.xpath(".//a[@onclick]/text()").extract()[0] paper_time = result_cjfq.xpath("./text()").extract()[1].strip() quote_item['paper_title'] = paper_title quote_item['paper_author'] = paper_author quote_item['paper_journalName'] = paper_journalName quote_item['paper_time'] = paper_time quote_item['quote_title'] = quote_title.replace("++", " ") yield quote_item if "ä¸­å›½é‡è¦ä¼šè®®è®ºæ–‡å…¨æ–‡æ•°æ®åº“" in dbTitle or "å›½é™…ä¼šè®®è®ºæ–‡å…¨æ–‡æ•°æ®åº“" in dbTitle: for result_cjfq in result.css("ul &gt; li"): paper_title = result_cjfq.xpath(".//em/text()").extract_first() + \ result_cjfq.xpath(".//a[@target='kcmstarget']/text()").extract_first() other_data = result_cjfq.xpath("./text()").extract_first() paper_title = paper_title + other_data.split(".")[0] if len(other_data.split(".")) == 4: paper_author = other_data.split(".")[1].strip() paper_journalName = other_data.split(".")[2].strip() paper_time = other_data.split(".")[3].strip() elif len(other_data.split(".")) == 3: paper_author = "" paper_journalName = other_data.split(".")[1].strip() paper_time = other_data.split(".")[2].strip() quote_item['paper_title'] = paper_title quote_item['paper_author'] = paper_author quote_item['paper_journalName'] = paper_journalName quote_item['paper_time'] = paper_time quote_item['quote_title'] = quote_title.replace("++", " ") yield quote_item å‚è€ƒèµ„æ–™ Scrapy æ–‡æ¡£]]></content>
      <categories>
        <category>Pythonå®æˆ˜</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>æ•°æ®å¤„ç†</tag>
        <tag>Scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ç”¨ Scrapy é‡‡é›†çŸ¥ç½‘æœŸåˆŠæ•°æ®ï¼ˆäºŒï¼‰]]></title>
    <url>%2F2017%2F04%2F06%2FPython%E4%B8%8B%E7%94%A8Scrapy%E9%87%87%E9%9B%86%E7%9F%A5%E7%BD%91%E6%9C%9F%E5%88%8A%E6%95%B0%E6%8D%AE%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[éœ€æ±‚ æœ¬æ¬¡é‡‡é›†éœ€è¦é‡‡é›†æœŸåˆŠ 2000ï½2010 å¹´é—´çš„æ•°æ®ï¼Œç›¸å…³çš„æ•°æ®é¦–å…ˆæ˜¯æœŸåˆŠä¸­å„æ–‡çŒ®çš„æ•°æ®ï¼š æ–‡çŒ®æ•°æ® ä¸»è¦åŒ…æ‹¬ titleï¼ˆç¯‡åï¼‰ï¼Œauthorï¼ˆä½œè€…ï¼‰ï¼ŒjournalNameï¼ˆåˆŠåï¼‰ï¼ŒpublicationDateï¼ˆå‘è¡¨æ—¶é—´ï¼‰ï¼ŒreferenceNumï¼ˆè¢«å¼•æ•°ï¼‰ ä»¥åŠ downloadNumä¸‹è½½æ•° å…¶æ¬¡æ˜¯æ¯ç¯‡æ–‡çŒ®çš„å¼•è¯æ–‡çŒ®æ•°æ®ï¼š å¼•ç”¨æ–‡çŒ®æ•°æ® ä¸»è¦åŒ…æ‹¬ paper_titleï¼ˆç¯‡åï¼‰ï¼Œpaper_authorï¼ˆä½œè€…ï¼‰ï¼Œpaper_journalNameï¼ˆåˆŠåï¼‰ï¼Œpaper_timeï¼ˆå‘è¡¨æ—¶é—´ï¼‰ä»¥åŠquote_titleï¼ˆå¼•ç”¨çš„æ–‡çŒ®ç¯‡åï¼‰ã€‚ æœç´¢æœŸåˆŠ æŠ“åŒ…åˆ†æ åœ¨é‡‡é›†æ•°æ®ä¹‹å‰é¦–å…ˆéœ€è¦è·å–åˆ°æœŸåˆŠçš„æœç´¢ç»“æœï¼Œè€Œæœ¬æ¬¡é‡‡é›†ä¸»è¦å’Œä¸‹åˆ—çš„æœç´¢å‚æ•°ç›¸å…³ï¼š èµ·å§‹å¹´ä»½ æ¨¡ç³Šæˆ–ç²¾ç¡®æœç´¢ æœŸåˆŠåç§° æŠ“åŒ…ä¹‹åå‘ç°æœç´¢è¿‡ç¨‹ä¸»è¦å’Œä¸‹å›¾æ ‡æœ‰çº¢çº¿çš„ä¸¤ä¸ªè¯·æ±‚ç›¸å…³ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚ç”¨äºå¾—åˆ°æœç´¢ç»“æœï¼Œç¬¬äºŒä¸ªè¯·æ±‚åˆ™æ˜¯å°†æœç´¢çš„ç»“æœæ˜¾ç¤ºå‡ºæ¥ã€‚ å¯¹ç¬¬ä¸€ä¸ªè¯·æ±‚è¿›è¡Œåˆ†æä¹‹åå‘ç°äº†ä¸æœç´¢æ¡ä»¶ç›¸å¯¹åº”çš„æœç´¢å‚æ•°ã€‚ ç¬¬äºŒä¸ªè¯·æ±‚å¤§éƒ¨åˆ†æ˜¯å›ºå®šå‚æ•°å€¼ å‘é€è¯·æ±‚ ä» Excel è¯»å–å‚æ•°ï¼š ç”±äºéœ€è¦é‡‡é›†æ¯æœ¬æœŸåˆŠ 11 å¹´çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸ºäº†å‡å°‘æœç´¢ç»“æœä»è€Œå°½å¯èƒ½é¿å…éœ€è¦è¾“å…¥éªŒè¯ç ï¼Œæ‰€ä»¥å°†æ‰€æœ‰çš„æœç´¢æ¡ä»¶ä¿å­˜åœ¨ä¸€ä¸ª Excel æ–‡ä»¶é‡Œé¢ï¼š è¯»å–å‚æ•°è¿‡ç¨‹å¦‚ä¸‹ï¼š 1234567891011121314151617def read_excel(self): # æ‰“å¼€æ–‡ä»¶ workbook = xlrd.open_workbook(r'/Users/firstdream/PycharmProjects/cnkiSprider/æŸ¥è¯¢æ¡ä»¶.xlsx') # è·å–æ‰€æœ‰sheet # æ ¹æ®sheetç´¢å¼•æˆ–è€…åç§°è·å–sheetå†…å®¹ sheet1 = workbook.sheet_by_index(0) # sheetç´¢å¼•ä»0å¼€å§‹ search_setting = [] for row in range(sheet1.nrows): setting = "" for col in range(sheet1.ncols): if isinstance(sheet1.row(row)[col].value, float): setting = setting + str(int(sheet1.row(row)[col].value)) + "," else: setting = setting + str(sheet1.row(row)[col].value) search_setting.append(setting) return search_setting å°†æ¯è¡Œçš„æœç´¢æ¡ä»¶æ‹¼æ¥èµ·æ¥å¹¶ä¿å­˜åœ¨ä¸€ä¸ª list å½“ä¸­ã€‚ ç”Ÿæˆè¯·æ±‚ ç”±äºè¯·æ±‚çš„å‚æ•°è¾ƒå¤šï¼Œæ‰€ä»¥é‡‡ç”¨è¯å…¸è¿›è¡Œè¯·æ±‚çš„å‚æ•°é…ç½®ï¼Œå†ç”¨ get_url() è·å–æœ€ç»ˆçš„é“¾æ¥ï¼š ç”Ÿæˆç¬¬ä¸€ä¸ªè¯·æ±‚ï¼š 12345678910111213141516171819def createUrls(self): search_setting = self.read_excel() urls = [] for setting in search_setting: year_from = setting.split(",")[0] year_to = setting.split(",")[1] magazine_setting = setting.split(",")[2] search_parameters = &#123;'action': '', 'ua': '1.21', 'PageName': 'ASP.brief_result_aspx', 'DbPreFix': 'CJFQ', 'DbCatalog': 'ä¸­å›½å­¦æœ¯æœŸåˆŠç½‘ç»œå‡ºç‰ˆæ€»åº“', 'ConfigFile': 'CJFQ.xml', 'db_opt': 'CJFQ', 'db_value': 'ä¸­å›½å­¦æœ¯æœŸåˆŠç½‘ç»œå‡ºç‰ˆæ€»åº“', 'magazine_value1': magazine_setting, 'year_type': 'echar', 'year_from': year_from, 'year_to': year_to, 'magazine_special1': '=' &#125; origin_url = "http://kns.cnki.net/kns/request/SearchHandler.ashx" url = self.get_url(origin_url, search_parameters) urls.append(url) return urls å°† Excel æ–‡ä»¶ä¸­è¯»å–çš„æœç´¢æ¡ä»¶é€šè¿‡ createUrls() æ–¹æ³•ç”Ÿæˆå¯è¿­ä»£çš„è¯·æ±‚åˆ—è¡¨ã€‚ ç”Ÿæˆç¬¬äºŒä¸ªè¯·æ±‚ï¼š 12345result_parameters = &#123;'pagename': 'ASP.brief_result_aspx', 'DbPreFix': 'CJFQ', 'Research': 'off', 'KeyValue': '', 'S': '1', 'recordsperpage': '50' , "sorttype": "(è¢«å¼•é¢‘æ¬¡,'INTEGER') desc"&#125;origin_url = "http://kns.cnki.net/kns/brief/brief.aspx"act_url = self.get_url(origin_url, result_parameters) ç¬¬äºŒä¸ªè¯·æ±‚ä¸­å¢åŠ äº† recordsperpage å’Œ sorttype ä¸¤ä¸ªå‚æ•°ï¼Œå‰è€…ä»£è¡¨æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ¡æ•°ï¼ˆSprider æ¯é‡‡é›† 13 é¡µå·¦å³ï¼ŒçŸ¥ç½‘ä¼šæç¤ºè¾“å…¥éªŒè¯ç ï¼Œæ‰€ä»¥è®¾ç½®ä¸ºæœ€å¤§å€¼ 50 å‡å°‘ç»“æœçš„æ€»é¡µæ•°ï¼‰ï¼Œåè€…ä»£è¡¨ç»“æœçš„æ’åºæ–¹å¼ï¼ˆé‡‡é›†å¼•è¯æ–‡çŒ®æ—¶ï¼Œç”±äºä¸€äº›æ–‡çŒ®æ˜¯æ²¡æœ‰è¢«å¼•ç”¨çš„ï¼Œæ‰€ä»¥é‡‡ç”¨æŒ‰è¢«å¼•é‡é€’å‡çš„æ–¹å¼æ’åºå»è¿‡æ»¤æ‰æ— ç”¨çš„è¯·æ±‚ï¼Œä»è€Œç¼©çŸ­é‡‡é›†æ—¶é—´ï¼‰ã€‚ get_url() æ–¹æ³•ï¼š 123456def get_url(self, origin_url, parameters): act_url = origin_url + "?" for key in parameters.keys(): act_url = act_url + key + "=" + urllib.request.quote(str(parameters[key])) + "&amp;" act_url = act_url.strip("&amp;") return act_url urllib.request.quote() ä¸­æ–‡å­—ç¬¦è¿›è¡Œç¼–ç å¤„ç†ã€‚ å‘é€ 12345678910111213141516171819def start_requests(self):headers_parameters = &#123; 'Host': 'kns.cnki.net', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36', 'Referer': 'http://kns.cnki.net/kns/brief/result.aspx?dbPrefix=CJFQ'&#125;urls = self.createUrls()for i, url in enumerate(urls): yield scrapy.Request(url, meta=&#123;'cookiejar': i&#125;, callback=self.result_page, headers=headers_parameters) def result_page(self, response): result_parameters = &#123;'pagename': 'ASP.brief_result_aspx', 'DbPreFix': 'CJFQ', 'Research': 'off', 'KeyValue': '', 'S': '1', 'recordsperpage': '50' , "sorttype": "(è¢«å¼•é¢‘æ¬¡,'INTEGER') desc"&#125;origin_url = "http://kns.cnki.net/kns/brief/brief.aspx"act_url = self.get_url(origin_url, result_parameters)return scrapy.Request(act_url, meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.parse, dont_filter=True) meta={'cookiejar': i} ä¿å­˜çš„æ˜¯ cookie ç”¨äºä¿æŒæŒä¹…æ€§è¿æ¥ã€‚ There is support for keeping multiple cookie sessions per spider by using the cookiejar Request meta key. By default it uses a single cookie jar (session), but you can pass an identifier to use different ones. For example: 123for i, url in enumerate(urls): yield scrapy.Request(url, meta=&#123;'cookiejar': i&#125;, callback=self.parse_page) start_requests(self) åœ¨è·å–åˆ°æœç´¢ç»“æœä¹‹åå›è°ƒ result_page(self, response) è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚ meta={'cookiejar': response.meta['cookiejar']} å–å‡º cookie å€¼å‘ä¸‹ä¼ é€’ã€‚ Keep in mind that the cookiejar meta key is not â€œstickyâ€. You need to keep passing it along on subsequent requests. For example: 12345def parse_page(self, response): # do some processing return scrapy.Request("http://www.example.com/otherpage", meta=&#123;'cookiejar': response.meta['cookiejar']&#125;, callback=self.parse_other_page) dont_filter=True ç”±äºç¬¬äºŒæ¬¡è¯·æ±‚çš„é“¾æ¥ç›¸åŒï¼ŒScrapy é»˜è®¤ä¼šè¿‡æ»¤åˆ°è¿™äº›è¯·æ±‚ï¼Œæ‰€ä»¥å¿…é¡»è®¾ç½®ä¸º Trueã€‚ é…ç½®è®¿é—®å¼‚å¸¸é‡è¯• ä¸ºäº†å°½å¯èƒ½ä¿è¯é‡‡é›†æ•°æ®çš„å®Œæ•´æ€§ï¼Œéœ€è¦é…ç½® setting.py æ–‡ä»¶åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š 123456# å½“è®¿é—®å¼‚å¸¸æ—¶æ˜¯å¦è¿›è¡Œé‡è¯•RETRY_ENABLED = True# å½“é‡åˆ°ä»¥ä¸‹ http çŠ¶æ€ç æ—¶è¿›è¡Œé‡è¯•RETRY_HTTP_CODES = [500, 502, 503, 504, 400, 403, 404, 408]# é‡è¯•æ¬¡æ•°RETRY_TIMES = 5 å‚è€ƒèµ„æ–™ Scrapy æ–‡æ¡£]]></content>
      <categories>
        <category>Pythonå®æˆ˜</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>æ•°æ®å¤„ç†</tag>
        <tag>Scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ç”¨ Scrapy é‡‡é›†çŸ¥ç½‘æœŸåˆŠæ•°æ®ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2017%2F04%2F06%2FPython%E4%B8%8B%E7%94%A8Scrapy%E9%87%87%E9%9B%86%E7%9F%A5%E7%BD%91%E6%9C%9F%E5%88%8A%E6%95%B0%E6%8D%AE%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹ Scrapy æ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ã€‚ å¯ä»¥åº”ç”¨åœ¨åŒ…æ‹¬æ•°æ®æŒ–æ˜ï¼Œä¿¡æ¯å¤„ç†æˆ–å­˜å‚¨å†å²æ•°æ®ç­‰ä¸€ç³»åˆ—çš„ç¨‹åºä¸­ã€‚ å®‰è£… Pycharm å®‰è£… Mac ä¸‹æŒ‰ä½å¿«æ·é”® Command + , é€‰æ‹© Projectâ†’Project Interpreter ç‚¹å‡» + å·åæœç´¢ Scrapy è¿›è¡Œå®‰è£…å³å¯ï¼š pipå®‰è£… pip install Scrapy åˆ›å»ºå·¥ç¨‹ åœ¨ç»ˆç«¯ä¸­è¿›å…¥éœ€è¦åˆ›å»ºå·¥ç¨‹çš„ç›®å½•ï¼Œè¾“å…¥å‘½ä»¤ï¼š scrapy startproject tutorial å°†ä¼šåˆ›å»ºä¸€ä¸ª tutorial çš„ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234567891011121314tutorial/ scrapy.cfg # éƒ¨ç½²é…ç½®æ–‡ä»¶ tutorial/ # é¡¹ç›®çš„ Python æ¨¡å—ï¼Œåœ¨è¿™é‡ŒåŠ å…¥ä»£ç  __init__.py items.py # é¡¹ç›®çš„ items å®šä¹‰æ–‡ä»¶ pipelines.py # é¡¹ç›®çš„ pipelines æ–‡ä»¶ï¼Œç”¨äºå¤„ç† items settings.py # é¡¹ç›®çš„è®¾ç½®æ–‡ä»¶ spiders/ # Spider ç›®å½•æ‰€åœ¨åœ° __init__.py åˆ›å»º Spider åœ¨ tutorial/spiders ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸º quotes_spider.py çš„æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹ä»£ç ï¼š 1234567891011121314151617181920import scrapyclass QuotesSpider(scrapy.Spider): name = "quotes" def start_requests(self): urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] for url in urls: yield scrapy.Request(url=url, callback=self.parse) def parse(self, response): page = response.url.split("/")[-2] filename = 'quotes-%s.html' % page with open(filename, 'wb') as f: f.write(response.body) self.log('Saved file %s' % filename) QuotesSpider ç»§æ‰¿ scrapy.Spiderï¼ŒåŒæ—¶å®šä¹‰äº†ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼š * nameï¼šä½œä¸ºçˆ¬è™«çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯¹äºåœ¨åŒä¸€å·¥ç¨‹ä¸­çš„çˆ¬è™«ï¼Œä¸èƒ½å¤Ÿè®¾ç½®ç›¸åŒçš„åç§°ã€‚ * start_requests()ï¼šè¿”å›ä¸€ä¸ªå¯è¿­ä»£çš„è¯·æ±‚ï¼Œç„¶å Spider å°†çˆ¬å–è¿™äº›è¯·æ±‚ * parse()ï¼šç”¨äºå¤„ç†è¯·æ±‚çš„ç»“æœã€‚ è¿è¡Œ Sprider ç»ˆç«¯å‘½ä»¤è¿è¡Œ åœ¨åˆ›å»ºçš„é¡¹ç›®ç›®å½•ä¸‹ï¼Œè¾“å…¥ï¼š scrapy crawl quotes quotes ä¸º Sprider çš„æ ‡è¯†ã€‚ Pycharm ä¸‹è¿è¡Œ åœ¨ tutorial ç›®å½•ä¸‹åˆ›å»ºåä¸º entrypoint.py çš„æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹ä»£ç ï¼š 1234#!/usr/bin/env pythonfrom scrapy.cmdline import execute# quotes ä¸ºåˆšåˆšåˆ›å»ºçš„ Spider çš„ nameï¼Œå¯ä»¥åœ¨è¿™é‡Œåˆ‡æ¢ä¸åŒçš„ Spiderexecute(['scrapy', 'crawl', 'quotes']) ä¿®æ”¹é…ç½® åœ¨ Run ä¸­é€‰æ‹© Edit Configurationsï¼Œåšå¦‚ä¸‹ä¿®æ”¹ï¼š å‚è€ƒèµ„æ–™ Scrapy æ–‡æ¡£]]></content>
      <categories>
        <category>Pythonå®æˆ˜</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>æ•°æ®å¤„ç†</tag>
        <tag>Scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ pymsql åº“çš„åŸºæœ¬ä½¿ç”¨]]></title>
    <url>%2F2017%2F04%2F06%2FPython%E4%B8%8Bpymsql%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[åº“çš„å¯¼å…¥ import pymysql è¿æ¥ MySql è¿æ¥é…ç½® 1234MYSQL_HOST = &apos;localhost&apos;MYSQL_DBNAME = &apos;cnkiQuote&apos;MYSQL_USER = &apos;root&apos;MYSQL_PASSWD = &apos;123456&apos; ä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ˜¯ä¸»æœº ipï¼Œæ•°æ®åº“åï¼Œç”¨æˆ·ååŠå¯†ç ã€‚ è¿æ¥ æŒ‡å®šç¼–ç ä¸º utf8 1234567connection=pymysql.connect( host=MYSQL_HOST, db=MYSQL_DBNAME, user=MYSQL_USER, passwd=MYSQL_PASSWD, charset='utf8', use_unicode=True) Sql æ“ä½œ æŸ¥è¯¢ 1234connection.cursor.execute("""select * from periodical_data where title = %s and publicationDate = %s and author = %s""",(item["title"],item['publicationDate'],str(item['author']))) æ’å…¥ 1234567connection.cursor.execute("""insert into periodical_data(title,author,journalName,publicationDate,referenceNum, downloadNum) value (%s,%s,%s,%s,%s,%s)""",(item['title'],str(item['author']),item['journalName'],item['publicationDate'],item['referenceNum'],item['downloadNum'])) æ›´æ–° 12345678910connection.cursor.execute("""update periodical_data set title = %s,author = %s,journalName = %s, publicationDate = %s,referenceNum = %s,downloadNum = %s where title = %s and publicationDate = %s and author = %s""",(str(item['title']),str(item['author']),str(item['journalName']),item['publicationDate'],item['referenceNum'],item['downloadNum'],str(item['title']),item['publicationDate'],str(item['author']))) æäº¤æ›´æ”¹ connection.commit()]]></content>
      <categories>
        <category>PythonåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>MySql æ“ä½œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ Excel çš„è¯»å–ä¸å†™å…¥]]></title>
    <url>%2F2017%2F04%2F05%2FPython-%E4%B8%8BExcel-%E7%9A%84%E8%AF%BB%E5%8F%96%E4%B8%8E%E5%86%99%E5%85%A5%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å‰æ®µæ—¶é—´éœ€è¦å°† MySql çš„æ•°æ®å¯¼å‡ºåˆ°æŒ‡å®šæ ¼å¼çš„ Excel è¡¨æ ¼ä¸­å»ï¼Œç”±äºæ˜¯åŸºäº Python3.5 çš„ç¨‹åºï¼Œæ‰€ä»¥æœ€åé€‰å®šäº† xlrd åº“æ¥è¿›è¡Œ Excel çš„è¯»å–æ“ä½œï¼Œå†™å…¥æ“ä½œåˆ™ç”± xlsxwriter å’Œ xlutils åº“æ¥è¿›è¡Œï¼Œå…¶ä¸­ xlutils ç”¨äºå¯¹ Excel æ–‡ä»¶çš„è¿½åŠ ã€‚ Excel æ–‡ä»¶çš„è¯»å– æ‰“å¼€ Excel æ–‡ä»¶ workbook = xlrd.open_workbook(r'æŸ¥è¯¢æ¡ä»¶.xlsx') è·å–æ‰€æœ‰ sheet workbook.sheet_names() æ ¹æ®sheetç´¢å¼•æˆ–è€…åç§°è·å– sheet å†…å®¹ sheet1 = workbook.sheet_by_index(0) # sheetç´¢å¼•ä»0å¼€å§‹ sheet1 = data.sheet_by_name(u'Sheet1')#é€šè¿‡åç§°è·å– è·å– sheet1 çš„è¡Œæ•° sheet1.nrows è·å– sheet1 çš„åˆ—æ•° sheet1.ncols è·å–æŒ‡å®šè¡Œåˆ—çš„å€¼ sheet1.row(row)[col].value Excel æ–‡ä»¶çš„å†™å…¥è¿½åŠ  åˆ›å»º Excel æ–‡ä»¶ workbook = xlsxwriter.Workbook(year + title + &quot;.xls&quot;) å¢åŠ  Sheet worksheet = workbook.add_worksheet() å†™å…¥æ•°æ® 1234worksheet.write('A1', 'tag')worksheet.write('B1', 'æ–‡ç« åå­—')sheet_write.write(rows, 0, "1")workbook.close() è¿½åŠ æ•°æ® è¿½åŠ ä¹‹å‰éœ€è¦å°† xlutils.copy å¯¼å…¥åˆ°å·¥ç¨‹ä¸­ï¼Œé¦–å…ˆç”¨ xlrd æ‰“å¼€æ—§çš„ Excel æ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨ xlutils.copy ä¸­çš„ copy() æ–¹æ³•å¤åˆ¶å·²ç»å­˜åœ¨çš„æ•°æ®ï¼Œæœ€ç»ˆåœ¨åŸæœ‰æ•°æ®çš„åŸºç¡€ä¸Šè¿›è¡Œå†™å…¥ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 123456789101112#å¯¼å…¥æ¨¡å—from xlutils.copy import copy#æ‰“å¼€æ–‡ä»¶resultwork = xlrd.open_workbook(year + title + ".xls")#è·å–è¡Œæ•°sheet1 = resultwork.sheet_by_index(0)rows = sheet1.nrows#è¿½åŠ æ•°æ®ï¼Œä¿å­˜old_excel = copy.copy(resultwork)sheet_write = old_excel.get_sheet(0)sheet_write.write(rows, 0, "1")old_excel.save(year + title + ".xls") å‚è€ƒèµ„æ–™ xlsxwriter æ–‡æ¡£ Pythonä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“xlutilsæ¥è¿½åŠ å†™å…¥Excelæ–‡ä»¶ç¤ºä¾‹]]></content>
      <categories>
        <category>PythonåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>æ•°æ®å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­£åˆ™è¡¨è¾¾å¼å’Œ CSS é€‰æ‹©å™¨ä»¥åŠ XPath]]></title>
    <url>%2F2017%2F04%2F05%2F%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8Ccss%E9%80%89%E6%8B%A9%E5%99%A8%E4%BB%A5%E5%8F%8Axpath%2F</url>
    <content type="text"><![CDATA[æ­£åˆ™è¡¨è¾¾å¼ æ­£åˆ™è¡¨è¾¾å¼ä¸»è¦ç”¨äºå­—ç¬¦ä¸²åŒ¹é…ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¹‹å‰éœ€è¦äº†è§£å„ä¸ªç¬¦å·çš„å«ä¹‰ï¼Œè¿™é‡Œæ¨è èœé¸Ÿæ•™ç¨‹ï¼Œåœ¨äº†è§£è¯­æ³•ä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡ regex101 è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼çš„æµ‹è¯•ã€‚ CSS é€‰æ‹©å™¨ CSS é€‰æ‹©å™¨ç”¨äºç­›é€‰ HTML æ–‡æ¡£ä¸­çš„å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ çš„æ ‡ç­¾åŠå…ƒç´ çš„å±æ€§è¿›è¡Œç­›é€‰ï¼Œè¿™é‡Œä»‹ç»ä½¿ç”¨è¿‡çš„ä¸€äº›å°ä¾‹å­ï¼š span[class=KnowledgeNetcont] &gt; a::text ç­›é€‰å‡º class å±æ€§ä¸º KnowledgeNetcont çš„ span æ ‡ç­¾ä¸‹çš„ a æ ‡ç­¾çš„æ–‡æœ¬å†…å®¹ã€‚ a[href*=image]::attr(href) ç­›é€‰å‡º a æ ‡ç­¾çš„ href å±æ€§å€¼åŒ…å« image çš„å±æ€§å€¼ã€‚ XPath XPath ä¹Ÿç”¨äºç­›é€‰ HTML æ–‡æ¡£ä¸­çš„å…ƒç´ ï¼Œä¸»è¦åŸºäºæ–‡æ¡£çš„ç»“æ„è¿›è¡Œç­›é€‰ï¼Œè¿™é‡Œä¾æ—§ä»‹ç»ä½¿ç”¨è¿‡çš„ä¸€äº›å°ä¾‹å­ï¼š xpath(&quot;.//a[@target='kcmstarget']&quot;).xpath('string(.)') @ ç”¨äºé€‰å–å±æ€§ï¼Œstring(.) å–çš„å½“å‰èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰æ–‡æœ¬ï¼ˆåŒ…å«å­æ ‡ç­¾çš„æ–‡æœ¬ï¼‰ï¼Œæ•´ä¸ªçš„å«ä¹‰æ˜¯é€‰å–å½“å‰èŠ‚ç‚¹ä¸‹æ‰€æœ‰ target å±æ€§å€¼ä¸º kcmstarget çš„ a æ ‡ç­¾ä¸‹çš„æ‰€æœ‰æ–‡æœ¬ã€‚ xpath(&quot;.//em/text()&quot;) å¦‚æœåªæƒ³å–çš„å½“å‰èŠ‚ç‚¹çš„æ–‡æœ¬è€Œä¸éœ€è¦å­æ ‡ç­¾çš„æ–‡æœ¬åˆ™å¯ä»¥ç”¨ text() å»è·å–ã€‚ xpath(&quot;//div/a[text()='ä¸‹ä¸€é¡µ']/@href&quot;) è·å–æ–‡æœ¬å†…å®¹ä¸ºä¸‹ä¸€é¡µçš„ a æ ‡ç­¾çš„ href å±æ€§å€¼ã€‚ å‚è€ƒèµ„æ–™ æ­£åˆ™è¡¨è¾¾å¼ â€“ æ•™ç¨‹ XPath æ•™ç¨‹ CSS é€‰æ‹©å™¨å‚è€ƒæ‰‹å†Œ]]></content>
      <categories>
        <category>æ‚è®°</category>
      </categories>
      <tags>
        <tag>HTML</tag>
        <tag>å­—ç¬¦åŒ¹é…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python ä¸‹ BeautifulSoup çš„åŸºæœ¬ä½¿ç”¨]]></title>
    <url>%2F2017%2F04%2F05%2FPython%E4%B8%8BBeautifulSoup%E7%9A%84%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[BeautifulSoup ç®€ä»‹ BeautifulSoup æ˜¯ä¸€ä¸ªå¯ä»¥ä» HTML æˆ– XML æ–‡ä»¶ä¸­æå–æ•°æ®çš„ Python åº“. åº“çš„å®‰è£… åº“çš„å®‰è£…å‚è€ƒæ­¤ç¯‡æ–‡ç«  requests åº“çš„ä½¿ç”¨ åŸºæœ¬ä½¿ç”¨ å¯¼å…¥ BeautifulSoup from bs4 import BeautifulSoup åˆ›å»ºæ–‡æ¡£å¯¹è±¡ soup = BeautifulSoup(htmlæ–‡æ¡£, 'html.parser') é…åˆ Python å†…ç½®çš„ html è§£æå™¨ï¼Œå°† html æ–‡æ¡£ä¼ å…¥ BeautifulSoup æ„é€ æ–¹æ³•ã€‚ è·å–æ•°æ®BeautifulSoupæä¾›äº†å¦‚ä¸‹å‡ ç§æ–¹å¼æœç´¢æ–‡æ¡£è·å–æ•°æ®ï¼š find_all() å…¨æ–‡æœç´¢ è¿”å›æ–‡æ¡£ä¸­æ‰€æœ‰ç¬¦åˆè¦æ±‚çš„æ•°æ®ã€‚ find() å•æ¬¡æœç´¢ è¿”å›æ–‡æ¡£ä¸­ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„æ•°æ®ã€‚ select() CSSé€‰æ‹©å™¨æŸ¥æ‰¾ soup.select(&quot;td[align] &gt; a[target=_blank]&quot;) find_all() ä¸­å¯ä»¥é€šè¿‡ limit å‚æ•°é™åˆ¶ç»“æœæ•°é‡ï¼Œå¦‚ï¼š soup.find_all(&quot;a&quot;, limit=2) åŒæ—¶ä¸Šè¿°çš„ find_all() å’Œ find() ä¹Ÿå¯é…åˆ CSS é€‰æ‹©å™¨è¿›è¡Œä½¿ç”¨ï¼Œå¦‚ï¼š titleList = soup.find_all(&quot;a&quot;, {&quot;class&quot;: &quot;fz14&quot;}) å‚è€ƒèµ„æ–™ BeautifulSoup æ–‡æ¡£ â€‹]]></content>
      <categories>
        <category>PythonåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>æ•°æ®å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ requests è·å– Discuz è®ºå›éªŒè¯ç ]]></title>
    <url>%2F2017%2F04%2F04%2Frequests%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[requests åº“çš„å®‰è£… Mac ä¸‹ä½¿ç”¨ Pycharm æ—¶åªéœ€æŒ‰ä½å¿«æ·é”® Command + , é€‰æ‹© Projectâ†’Project Interpreter ç‚¹å‡» + å·åæœç´¢ requests è¿›è¡Œå®‰è£…å³å¯ï¼š è·å–è¿‡ç¨‹ä½¿ç”¨çš„æ–¹æ³• requests.get(url, params=None, **kwargs) url æ˜¯è¯·æ±‚çš„é“¾æ¥ï¼Œparams æ˜¯å‘é€è¯·æ±‚æ—¶å‚æ•°ï¼Œkwargs æ˜¯å¯é€‰å‚æ•°ã€‚ è·å–è¿‡ç¨‹ ä¸ºäº†ä¿æŒè¿æ¥çš„æŒä¹…æ€§ä¸èƒ½ç›´æ¥ä½¿ç”¨ requests å‘é€è¯·æ±‚ï¼Œè€Œéœ€è¦åˆ©ç”¨ Session å¯¹è±¡ã€‚å…·ä½“è·å–ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425session = requests.session()ss = session.get("http://www.zhuixinfan.com/member.php?mod=register")result = ss.text#è·å–å‚æ•°params = re.findall("&lt;input.*(?:name=\"formhash\"|name=\"sechash\").*\&gt;", result)params = list(set(params))sechash = re.sub(".*value=\"", "", params[1])sechash = re.sub("\".*", "", sechash)#æ›´æ–°éªŒè¯ç actually_url = "http://www.zhuixinfan.com/misc.php?mod=seccode&amp;action=update&amp;idhash=" + sechashhtm = session.get(actually_url)#è·å–å›¾ç‰‡é“¾æ¥update_url = re.findall(r"\bsrc=\S*", htm.text)update = re.sub("src=\"", "", update_url[0])update = re.sub("\"", "", update)#ä¸‹è½½å›¾ç‰‡headers = &#123; 'Host': 'www.zhuixinfan.com', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36', 'Referer': 'http://www.zhuixinfan.com/member.php?mod=register' &#125;url = "http://www.zhuixinfan.com/" + updateresult = session.get(url, headers=headers)im = Image.open(BytesIO(result.content))im.show() è·å–è¿‡ç¨‹ä¸­é¦–å…ˆå‘ç«™ç‚¹å‘é€è¯·æ±‚ï¼Œä»è¿”å›çš„ç½‘é¡µä¿¡æ¯ä¸­åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼è·å– sechash å‚æ•°ï¼Œä¹‹ååˆ©ç”¨æ‰€å¾—åˆ°çš„ sechash å‘ç«™ç‚¹å‘é€æ›´æ–°éªŒè¯ç çš„è¯·æ±‚å¹¶ä»è¿”å›çš„ä¿¡æ¯ä¸­è·å–éªŒè¯ç å›¾ç‰‡çš„ urlï¼Œæœ€åä»ç«™ç‚¹ä¸‹è½½å›¾ç‰‡åˆ©ç”¨ Image.open() æ˜¾ç¤ºå›¾ç‰‡ã€‚ å‚è€ƒèµ„æ–™ Requests: è®© HTTP æœåŠ¡äººç±»]]></content>
      <categories>
        <category>PythonåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>requests åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HorizontalScrollView å’Œ ViewPager è§¦æ§å†²çªè§£å†³]]></title>
    <url>%2F2016%2F09%2F27%2FAndroid%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95HorizontalScrollView%E5%92%8CViewPager%E8%A7%A6%E6%8E%A7%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å½“ HorizontalScrollView å’Œ ViewPager ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¼šå‡ºç°æ»‘åŠ¨å†²çªçš„é—®é¢˜ è§£å†³è¿‡ç¨‹ è¦äº†è§£ HorizontalScrollView å’Œ ViewPager è§¦æ§å†²çªçš„åŸå› ï¼Œé¦–å…ˆéœ€è¦äº†è§£Android è§¦æ‘¸äº‹ä»¶å¤„ç†çš„çš„æœºåˆ¶ï¼Œåœ¨äº†è§£åå¯ä»¥çŸ¥é“ï¼Œå½“ HorizontalScrollView å†…å±‚åµŒå¥—ä½¿ç”¨ ViewPager æ—¶ï¼Œç”±äºè§¦æ‘¸äº‹ä»¶è¢« HorizontalScrollView çš„ onInterceptTouchEvent() æ‹¦æˆªå¯¼è‡´äº‹ä»¶ä¸èƒ½å‘ä¸‹å±‚ä¼ é€’ï¼Œæ‰€ä»¥å½“æ»‘åŠ¨å±å¹•æ—¶ï¼ŒHorizontalScrollView å¯ä»¥æ­£å¸¸æ»‘åŠ¨ï¼Œä½†æ˜¯ ViewPager å´ä¸èƒ½æ­£å¸¸æ»‘åŠ¨ï¼Œè€Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æœŸæœ›çš„æ˜¯è¾¹ç¼˜æ»‘åŠ¨æ—¶ï¼ŒHorizontalScrollView å“åº”äº‹ä»¶ï¼Œéè¾¹ç¼˜æ»‘åŠ¨æ—¶ï¼ŒViewPager å“åº”äº‹ä»¶ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„æˆ‘ä»¬éœ€è¦é‡å†™ HorizontalScrollView çš„ onInterceptTouchEvent() å‡½æ•°ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567public boolean onInterceptTouchEvent(MotionEvent ev) &#123; mXPoint = ev.getRawX(); if (mXPoint &gt; 100 &amp;&amp; mXPoint &lt; mMenuWidth) &#123; return false; &#125; return super.onInterceptTouchEvent(ev);&#125; é€šè¿‡é™å®šæ»‘åŠ¨çš„å±å¹•èŒƒå›´å†³å®šæ˜¯å¦äº‹ä»¶åœ¨è¿™ä¸€å±‚è¢«å¤„ç†ï¼Œåœ¨è¿™æ ·å¤„ç†ä¹‹å HorizontalScrollView å’Œ ViewPager éƒ½èƒ½æ­£ç¡®å“åº”äº†ï¼Œä½†æ˜¯å½“ HorizontalScrollView æ»‘åŠ¨è‡³ç»ˆç‚¹æ—¶ï¼Œå±å¹•ä¸­é—´çš„éƒ¨åˆ†å´ä¸èƒ½å¤Ÿæ­£ç¡®å“åº” HorizontalScrollView çš„æ»‘åŠ¨äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšè¿›ä¸€æ­¥å¤„ç†ï¼Œåˆ¤æ–­ HorizontalScrollView æ˜¯å¦æ»‘åŠ¨è‡³ç»ˆç‚¹ï¼Œæ‰€ä»¥åœ¨ onTouchEvent äº‹ä»¶ä¸­åˆ©ç”¨ä¸€ä¸ª flag çš„æ ‡å¿—ä½å»åˆ¤æ–­æ˜¯å¦æ»‘åŠ¨è‡³ç»ˆç‚¹ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516public boolean onTouchEvent(MotionEvent ev) &#123; int action = ev.getAction(); switch (action) &#123; case MotionEvent.ACTION_UP: int scollX = getScrollX(); if (scollX &gt; mMenuHaltWidth) &#123; this.scrollTo(mMenuWidth, 0); sMenuFlag = false; &#125; else &#123; this.scrollTo(0, 0); sMenuFlag = true; &#125; return true; &#125; return super.onTouchEvent(ev);&#125; onInterceptTouchEvent() å‡½æ•°åˆ¤æ–­æ¡ä»¶å˜ä¸ºï¼š if (mXPoint &gt; 100 &amp;&amp; mXPoint &lt; mMenuWidth &amp;&amp; sMenuFlag == false) æœ€ç»ˆæ•ˆæœ å‚è€ƒèµ„æ–™ Android æ§ä»¶çš„è§¦æ‘¸äº‹ä»¶ä¼ é€’ä¸å¤„ç† Android è§¦æ‘¸äº‹ä»¶å¤„ç†æœºåˆ¶]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python è¯­æ³•åŸºç¡€]]></title>
    <url>%2F2016%2F09%2F26%2FPython%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[è¿‘æ®µæ—¶é—´å­¦ä¹ äº†ä¸‹Pythonï¼Œäºæ˜¯å¤§ç•¥æ€»ç»“äº†ä¸‹æ‰€å­¦çš„è¯­æ³•çŸ¥è¯†ï¼š åˆ—è¡¨çš„åˆ›å»º: 1movies = ["The Holy Grail", 1975, "Terry Jones &amp; Terry Gilliam", 91,["Graham Chapman", ["Michael Palin", "John Cleese", "Terry Gilliam", "Eric Idle", "Terry Jones"]]] è¿™é‡Œæ˜¯ä¸€ä¸ªåµŒå¥—åˆ—è¡¨çš„åˆ›å»ºï¼Œå…¶ä¸­çš„ä¸­æ‹¬å·ä¹Ÿå¯ä»¥æ¢æˆå¤§æ‹¬å·ï¼ŒåŒå¼•å·å¯ä»¥ç”¨å•å¼•å·ä»£æ›¿ï¼Œåˆ—è¡¨é‡Œé¢å¯ä»¥æ˜¯æ··åˆçš„æ•°æ®ã€‚å¸¸ç”¨çš„æ–¹æ³•æœ‰ ï¼š append()ï¼šåœ¨åˆ—è¡¨æœ«å°¾å¢åŠ ä¸€ä¸ªæ•°æ®é¡¹ pop()ï¼šåœ¨åˆ—è¡¨çš„æœ«å°¾åˆ é™¤æ•°æ® extend(æ•°æ®é¡¹é›†åˆ)ï¼šåœ¨åˆ—è¡¨çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæ•°æ®é¡¹é›†åˆ remove(é¡¹)ï¼šåˆ é™¤ä¸€ä¸ªç‰¹å®šæ•°æ®çš„é¡¹ insert(åºå·, æ•°æ®é¡¹)ï¼šåœ¨æŒ‡å®šåºå·çš„å‰é¢æ’å…¥æ•°æ®é¡¹ åˆ—è¡¨çš„éå†ä¹‹ for å¾ªç¯: åˆ—è¡¨çš„éå†éœ€è¦ç”¨åˆ° for å¾ªç¯ï¼Œå…¶åŸºæœ¬è¯­æ³•æ˜¯ï¼šfor å˜é‡ in åˆ—è¡¨é¡¹ï¼šï¼Œç”±æ­¤å¯ä»¥å°†åˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹ï¼ˆåªä¼šéå†ä¸€çº§åˆ—è¡¨ï¼‰é€šè¿‡ print() å‡½æ•°è¾“å‡ºã€‚ åµŒå¥—åˆ—è¡¨çš„éå†ä¹‹ if åˆ¤æ–­: å¯¹äºåµŒå¥—åˆ—è¡¨çš„éå†ï¼Œéœ€è¦åˆ¤æ–­ for å¾ªç¯æ—¶æ¯ä¸€é¡¹æ˜¯å¦æ˜¯åˆ—è¡¨é¡¹ï¼Œå› æ­¤éœ€è¦ç”¨åˆ° if åˆ¤æ–­è¯­å¥å’Œ isinstanceï¼Œisinstance(å˜é‡, list) ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åˆ—è¡¨ï¼Œif çš„è¯­æ³•æ˜¯ï¼š 1234if æŸä¸ªæ¡ä»¶æ»¡è¶³: Trueç»„else: Falseç»„ åµŒå¥—åˆ—è¡¨çš„éå†ä¹‹å®šä¹‰å‡½æ•°ï¼š ä¸Šè¿°æœ€å¤šåªèƒ½å¤Ÿå¤„ç†ä¸€å±‚åµŒå¥—çš„åˆ—è¡¨ï¼Œå¦‚æœå¸Œæœ›å¤„ç†å¤šå±‚åµŒå¥—çš„åˆ—è¡¨åˆ™éœ€è¦å®šä¹‰å‡½æ•°å¹¶å»é€’å½’è°ƒç”¨ï¼Œå…¶åŸºæœ¬è¯­æ³•æ˜¯ï¼š 12def å‡½æ•°å(å‚æ•°): ä»£ç å— è½¬æ¢ä¸ºæ¨¡å—ï¼š ä»£ç å—ä¿å­˜ä¸º .py æ–‡ä»¶ï¼Œåˆ›å»º setup.py çš„æ–‡ä»¶ï¼ŒåŒ…å«å¦‚ä¸‹å†…å®¹ï¼š 12345678910from distutils.core import setupsetup( name='HelloWorld', version='1.0.0', py_modules=['nester'], url='http://www.headfirstlabs', author='firstdream', author_email='firstdream10@icloud.com', description='A simple printer of nested lists') æ„å»ºå‘å¸ƒæ–‡ä»¶ (windows ä¸‹): python setup.py sdist å®‰è£… Python å‰¯æœ¬åˆ°æœ¬åœ°ï¼š python setup.py install å¯¼å…¥æ¨¡å—ï¼š import æ¨¡å—å å‘ PyPl ä¸Šä¼ ä»£ç ï¼š python setup.py register(ç¬¬ä¸€æ¬¡ä¸Šä¼ ) python setup.py sdist upload å¸¸ç”¨ BIF 1234567891011121314#åˆ›å»ºä¸€ä¸ªç©ºçš„åˆ—è¡¨list()#è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ ¹æ®éœ€è¦ç”Ÿæˆä¸€ä¸ªæŒ‡å®šèŒƒå›´çš„æ•°å­—ï¼Œå¸¸é…åˆ for å¾ªç¯ä½¿ç”¨range()for num in range(4): print(num)ï¼ƒåˆ›å»ºæˆå¯¹æ•°æ®çš„ä¸€ä¸ªç¼–å·åˆ—è¡¨ï¼Œä» 0 å¼€å§‹enumerate()#å°†ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å¦ä¸€ä¸ªæ•°è½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°(å¦‚æœå¯è¡Œ)int()#è¿”å›ä¸€ä¸ª Python æ•°æ®å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†id()#è¿”å›ä¸€ä¸ªå¯è¿­ä»£æ•°æ®ç»“æ„ä¸­çš„ä¸‹ä¸€é¡¹next() ä¸ºå‡½æ•°æä¾›é»˜è®¤å‚æ•° def å‡½æ•°å(å‚æ•°=ç¼ºçœå€¼): 2016.10.7 æ–‡ä»¶æ“ä½œ 123456789101112#ä»¥é»˜è®¤çš„ r æ¨¡å¼æ‰“å¼€æ–‡ä»¶the_file = open("æ–‡ä»¶å")#ä»¥ w æ¨¡å¼æ‰“å¼€æ–‡ä»¶out = open("æ–‡ä»¶å", "w")#å…³é—­æ–‡ä»¶the_file.close()#è¯»å–æ–‡ä»¶æ•°æ®è¡Œthe_file.readline()#è¿”å›æ–‡ä»¶èµ·å§‹ä½ç½®the_file.seek(0)#å†™å…¥æ•°æ®åˆ°æ–‡ä»¶print("å†…å®¹", file=æ–‡ä»¶å¯¹è±¡å) å¼‚å¸¸å¤„ç† 1234567891011121314try: å¯èƒ½å‘ç”Ÿé”™è¯¯çš„ä»£ç except: é”™è¯¯æ¢å¤ä»£ç finally: æœ€åçš„æ‰§è¡Œä»£ç #æ•°æ®ä¸ç¬¦åˆæœŸæœ›çš„æ ¼å¼æ—¶ä¼šå‡ºç° ValueError#æ•°æ®æ— æ³•æ­£å¸¸è®¿é—®æ—¶ä¼šå‡ºç° IOError#ç”¨withå¤„ç†æ–‡ä»¶ï¼Œå¯ä¸éœ€è¦ finally æ¨¡å—try: with open() as data: ä»£ç except å¼‚å¸¸ï¼š ä»£ç  å…¶ä½™æ–¹æ³• 123456789101112131415161718#æ˜¾ç¤ºå½“å‰ç›®å½•åŠæ›´æ”¹å½“å‰ç›®å½•import osos.getcwd()os.chdir("è·¯å¾„")#split() åˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨(role, line_spoken) = each_line.split(":")#åˆ©ç”¨ split çš„å¯é€‰å‚æ•°æŒ‡å®šä¸ºä¸¤éƒ¨åˆ†split(":", 1)#find() æŸ¥æ‰¾å­—ç¬¦ä¸²each_line.find(":")#not å–ååˆ¤æ–­æ¡ä»¶if not each_line.find(':') == -1:#pass ä½œä¸ºPythonçš„ç©ºè¯­å¥æˆ–nullè¯­å¥#strip() æ–¹æ³•ä»å­—ç¬¦ä¸²ä¸­å»é™¤ä¸æƒ³è¦çš„ç©ºç™½ç¬¦line_spoken.strip()#str() å¯ä»¥ç”¨æ¥è®¿é—®ä»»ä½•æ•°æ®å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤º#locals() è¿”å›å½“å‰ä½œç”¨åŸŸä¸­çš„å˜é‡é›†åˆif 'man_file' in locals(): 2016.10.15 pickle &quot;è…Œåˆ¶&quot;æ•°æ®å’Œæ¢å¤æ•°æ® Python æä¾›äº†ä¸€ä¸ªæ ‡å‡†åº“ pickle ç”¨äºä¿å­˜å’ŒåŠ è½½ Python çš„æ•°æ®å¯¹è±¡ï¼Œä½¿ç”¨æ–¹æ³•ï¼š 12345678import pickle...#pickle å¤„ç†æ–‡ä»¶æ•°æ®æ—¶å¿…é¡»ä»¥äºŒè¿›åˆ¶è®¿é—®with open('mydata.pickle', 'wb') as mysavedata: pickle.dump([1, 2, ''three], mysavedata) ...with open('mydata.pickle', 'rb') as myrestoredata: a_list = pickle.load(myrestoredata) åˆ—è¡¨æ¨å¯¼ åˆ—è¡¨æ¨å¯¼ç”¨äºå‡å°‘è½¬æ¢åˆ—è¡¨æ—¶çš„ä»£ç é‡ 12345æ–°åˆ—è¡¨ = [è½¬æ¢å‡½æ•°(t) for t in åŸåˆ—è¡¨]new_l = []for t in old_l: new_l.append(len(t))new_l = [len(t) for t in old_l] é›†åˆ set Python æä¾›ä¸€ç§åä¸ºé›†åˆçš„æ•°æ®ç»“æ„ï¼Œé›†åˆä¸­çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œè€Œä¸”ä¸å…è®¸é‡å¤ åˆ›å»ºé›†åˆï¼š 123#set() -&gt; new empty set object#set(iterable) -&gt; new set objecté›†åˆå = set(object) å­—å…¸ å­—å…¸å°† value å’Œ key å…³è”ï¼Œä½¿ç”¨å­—å…¸: 123456#åˆ›å»ºå­—å…¸å­—å…¸å = &#123;&#125;å­—å…¸å = dict()#å¢åŠ æ•°æ®å­—å…¸å[key] = value #vlaueå¯ä»¥ä¸ºä»»æ„æ•°æ®ç±»å‹å­—å…¸å = &#123;â€™keyâ€˜:value, 'key':value&#125; ç±» 123456#å®šä¹‰ç±»class ç±»å: def _init_(self): #åˆå§‹åŒ–å¯¹è±¡çš„ä»£ç #åˆ›å»ºå¯¹è±¡å®ä¾‹å¯¹è±¡ = ç±»å() ç»§æ‰¿ 123class ç±»å(ç»§æ‰¿çš„ç±»å): def _init_(self, å‚æ•°):#åˆå§‹åŒ–å¯¹è±¡çš„ä»£ç  å…¶å®ƒ print(åˆ—è¡¨[-1]) è¾“å‡ºæœ€åä¸€ä¸ªæ•°æ®é¡¹ strip() æ–¹æ³•å¯ä»¥ä»å­—ç¬¦ä¸²ä¸­å»é™¤ä¸æƒ³è¦çš„ç©ºç™½ç¬¦ in æ“ä½œç¬¦ç”¨äºæ£€æŸ¥æˆå‘˜å…³ç³» åŸåœ°æ’åº sort()ï¼ŒåŸåˆ—è¡¨é¡ºåºæ”¹å˜ å¤åˆ¶æ’åº sorted()ï¼Œè¿”å›ä¸€ä¸ªæ’åºè¿‡çš„åŸåˆ—è¡¨å‰¯æœ¬ åˆ†ç‰‡è®¿é—®åˆ—è¡¨åˆ—è¡¨[èµ·å§‹å€¼ï¼šç»“æŸå€¼]å¯ä»¥è®¿é—®èµ·å§‹åˆ°ç»“æŸ(ä¸åŒ…æ‹¬ç»“æŸå€¼)çš„åˆ—è¡¨é¡¹]]></content>
      <categories>
        <category>PythonåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>åŸºç¡€è¯­æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android ä¸‹è·å– activity_main.xml çš„æ ¹ View]]></title>
    <url>%2F2016%2F09%2F22%2FAndroid%E4%B8%8B%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8DXML%E7%9A%84%E6%A0%B9View%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åšæµ‹è¯•çš„æ—¶å€™éœ€è¦è·å–å½“å‰ XML çš„æ ¹è§†å›¾è¿›è¡Œæ“ä½œï¼ŒæŸ¥è¯¢åå‘ç°ç½‘ä¸Šæåˆ°äº† getDecorView()ï¼ŒgetRootView()ï¼Œå‚ç…§åˆ«äººçš„æµ‹è¯•è‡ªå·±ä¹Ÿåšäº†ä¸€ä¸ªå°çš„æµ‹è¯•ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ª View å±‚æ¬¡ç»“æ„å›¾ï¼Œæ–¹ä¾¿ç†è§£æµ‹è¯•ï¼ŒåŸæ–‡åœ°å€åœ¨æ–‡ç« æœ€åï¼š activity_main å’Œ btn_lay å¸ƒå±€å¦‚ä¸‹ï¼š 12345678910111213141516&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;android.support.constraint.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="com.rookieyang.test.MainActivity"&gt; &lt;Button android:id="@+id/btn" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="hello" /&gt; &lt;include layout="@layout/btn_lay" /&gt;&lt;/android.support.constraint.ConstraintLayout&gt; 12345678910111213&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical"&gt; &lt;Button android:id="@+id/btn2" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="test" /&gt;&lt;/LinearLayout&gt; æ¥ä¸‹æ¥æ˜¯æµ‹è¯•ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class MainActivity extends AppCompatActivity &#123; private View mDecorView; private View mRootView; private View mContentView; private View mCurrentView; private View mCurrentView2; private TextView mOneText; private TextView mTwoText; private Button mBtn; private Button mBtn2; private Button mBtn3; private View mView; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); init(); logView(); &#125; private void init() &#123; mDecorView = getWindow().getDecorView(); mRootView = mDecorView.getRootView(); mContentView = mDecorView.findViewById(android.R.id.content); mCurrentView = ((ViewGroup) mContentView).getChildAt(0); mOneText = (TextView) ((ViewGroup) mCurrentView).getChildAt(0); mCurrentView2 = ((ViewGroup) mRootView .findViewById(android.R.id.content)).getChildAt(0); mTwoText = (TextView) ((ViewGroup) mCurrentView2).getChildAt(0); mView = LayoutInflater.from(this).inflate(R.layout.btn_lay, null); mBtn = (Button) findViewById(R.id.btn); mBtn2 = (Button) mView.findViewById(R.id.btn2); mBtn3 = (Button) findViewById(R.id.btn2); &#125; private void logView() &#123; Log.i("MainActivity", "DecorView:" + mDecorView ); Log.i("MainActivity", "DecorView ID:" + mDecorView.getId()); Log.i("MainActivity", "RootView:" + mRootView); Log.i("MainActivity", "RootView ID:" + mRootView.getId()); Log.i("MainActivity", "ContentView:" + mContentView); Log.i("MainActivity", "ContentView ID:" + mContentView.getId()); Log.i("MainActivity", "CurrentView:" + mCurrentView); Log.i("MainActivity", "CurrentView ID:" + mCurrentView.getId()); Log.i("MainActivity", "CurrentView2:" + mCurrentView2); Log.i("MainActivity", "CurrentView2 ID:" + mCurrentView2.getId()); Log.i("MainActivity", "mOneText ID:" + mOneText.getText()); Log.i("MainActivity", "mTwoText ID:" + mTwoText.getText()); Log.i("MainActivity", "mBtn RootView:" + mBtn.getRootView()); Log.i("MainActivity", "mBtn2 RootView:" + mBtn2.getRootView()); Log.i("MainActivity", "mBtn3 RootView:" + mBtn3.getRootView()); &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š é¦–å…ˆå¯ä»¥çœ‹åˆ° getWindow().getDecorView() å’Œ getDecorView().getRootView() è·å¾—çš„ View å’Œ id æ˜¯ä¸€æ ·çš„ï¼Œ è¯´æ˜ DecorView æ˜¯æ•´ä¸ª Window ç•Œé¢æœ€é¡¶å±‚çš„ Viewã€‚ ä½†æ˜¯å¯¹æ¯” mBtn2.getRootView() å’Œ mBtn3.getRootView() å´å‘ç°ä¸¤è€…è¾“å‡ºç»“æœå®Œå…¨ä¸åŒï¼ŒmBtn3.getRootView() è·å–åˆ°çš„æ˜¯ DecorViewï¼Œè€Œ mBtn2.getRootView() è·å–åˆ°çš„åˆ™æ˜¯ LinearLayoutï¼Œä¸¤è€…çš„ä¸åŒä¹‹å¤„åœ¨äº mBtn2 é€šè¿‡ mView.findViewById(R.id.btn2) è·å–ï¼ŒmBtn3 å´æ˜¯ç›´æ¥é€šè¿‡ findViewById(R.id.btn2) è·å–ã€‚åœ¨æŸ¥è¯¢ LayoutInflater çš„ API æ–‡æ¡£åï¼Œç¬¬ä¸€è¡Œçš„æè¿°æ˜¯è¿™æ ·çš„ï¼š ã€ŒInstantiates a layout XML file into its corresponding View objectsã€ ä¹Ÿå°±è¯´é€šè¿‡ LayoutInflater.from(this).inflate(R.layout.btn_lay, null)ï¼Œbtn_lay å¸ƒå±€è¢«å®ä¾‹åŒ–äº†åˆ°å¯¹åº”çš„ View å¯¹è±¡ä¸­ï¼Œæ‰€ä»¥å¯¼è‡´ mView çš„æ ¹è§†å›¾æ˜¯ LinearLayoutï¼Œè‡ªç„¶ mBtn2 çš„æ ¹è§†å›¾ä¹Ÿæ˜¯ LinearLayoutã€‚ findViewById(android.R.id.content) ç”¨äºè·å– activity_main å¤–å±‚çš„è§†å›¾ï¼Œå³ä¸Šå›¾çš„ mContentParentã€‚ åœ¨è·å–äº† mContentParent ä¹‹åï¼Œç”±äº activity_main çš„æ ¹è§†å›¾æ˜¯ mContentParent çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ ï¼Œæ‰€ä»¥åˆ©ç”¨ getChildAt(0) å³å¯è·å– ConstraintLayoutã€‚mCurrentView å’Œ mCurrentView2 çš„è¾“å‡ºç»“æœå¯ä»¥å°è¯è¯¥ç‚¹ã€‚ æ€»ç»“ï¼š è·å– activity_main.xml æ ¹ Viewï¼š 12View rootView = ((ViewGroup)(getWindow().getDecorView() .findViewById(android.R.id.content))).getChildAt(0); è·å– btn_lay.xml æ ¹ View: 1View rootView = LayoutInflater.from(this).inflate(R.layout.btn_lay, null).getRootView(); getDecorView(): Retrieve the top-level window decor view (containing the standard window frame/decorations and the client's content inside of that), which can be added as a window to the window manager. getRootView(): Finds the topmost view in the current view hierarchy. å‚è€ƒé“¾æ¥ view.getRootView() çš„çœŸæ­£å«ä¹‰åŠæµ‹è¯• Android View æºç è§£è¯»]]></content>
      <categories>
        <category>Androidé—®é¢˜è®°å½•</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>åŸºç¡€é—®é¢˜è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨ TabLayout å’Œ ToolBar å®ç°æ»‘åŠ¨æ ‡ç­¾é¡µ]]></title>
    <url>%2F2016%2F09%2F08%2FAndroid%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%E5%88%A9%E7%94%A8TabLayout%E5%92%8CToolBar%E5%AE%9E%E7%8E%B0%E6%BB%91%E5%8A%A8%E6%A0%87%E7%AD%BE%E9%A1%B5%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨å®ç°ä¾¿ç­¾æ»‘åŠ¨é¡µçš„æ—¶å€™çªç„¶å‘ç° ActionBar å·²ç»ä¸è¢«å®˜æ–¹æ¨èä½¿ç”¨ï¼Œæ¯”è¾ƒå¥½çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯åˆ©ç”¨ ToolBar å’Œ TabLayout æ¥å®ç°ï¼Œä»¥ä¸‹æ˜¯å®ç°æ­¥éª¤ï¼š TalLayout æ˜¯ Android Support Design ä¸­çš„ä¸€ä¸ªæ§ä»¶ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦åœ¨ build.gradle æ–‡ä»¶ä¸­æ·»åŠ compile'com.android.support:design:23.2.0' æ‰èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚ å¯¹ values ä¸­çš„ style æ–‡ä»¶è¿›è¡Œè®¾ç½®ä»¥å±è”½ Activity çš„ ActionBarï¼Œè®©ä¸»é¢˜ç»§æ‰¿äº NoActionBarï¼Œå¦‚æœéœ€è¦æ”¹å˜ Acitivity çš„èƒŒæ™¯é¢œè‰²è®¾ç½® windowBackground å³å¯ï¼š 123456789&lt;!-- Base application theme. --&gt;&lt;style name="AppTheme" parent="Theme.AppCompat.NoActionBar"&gt; &lt;!-- Customize your theme here. --&gt; &lt;item name="colorPrimary"&gt;@color/material_blue_grey_800&lt;/item&gt; &lt;!--Status bar color--&gt; &lt;item name="colorPrimaryDark"&gt;@color/accent_material_light&lt;/item&gt; &lt;!--Window color--&gt; &lt;item name="colorAccent"&gt;@color/colorAccent&lt;/item&gt;&lt;/style&gt; ç”±äºéœ€è¦å®ç°æ ‡ç­¾é¡µçš„æ»‘åŠ¨æ•ˆæœæ‰€ä»¥éœ€è¦ç”¨åˆ° ViewPager ï¼ŒåŠ ä¸Š TabLayout å’Œ TooBar åŸºæœ¬çš„å¸ƒå±€å¦‚ä¸‹ï¼š 12345678910111213141516171819&lt;android.support.v7.widget.Toolbar android:id="@+id/topToolBar" android:layout_width="match_parent" android:layout_height="wrap_content" android:paddingTop="@dimen/bar_top_padding"&gt;&lt;/android.support.v7.widget.Toolbar&gt;&lt;android.support.design.widget.TabLayout android:id="@+id/tabLayout" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_below="@id/topToolBar" app:tabSelectedTextColor="#3da6a2" app:tabTextColor="#817f7f"&gt;&lt;/android.support.design.widget.TabLayout&gt;&lt;android.support.v4.view.ViewPager android:id="@+id/viewPager" android:layout_width="match_parent" android:layout_height="match_parent" android:layout_below="@id/tabLayout"&gt;&lt;/android.support.v4.view.ViewPager&gt; å…¶ä¸­ TabLayout ä¸­tabSelectedTextColor ç”¨äºè®¾ç½®é€‰ä¸­Tabçš„å­—ä½“é¢œè‰²ï¼ŒtabTextColor ç”¨äºè®¾ç½®æœªé€‰ä¸­çš„Tabå­—ä½“çš„é¢œè‰²ï¼ŒToolbar ä¸­è®¾ç½® paddingTop ä¸»è¦ç”¨äº4.4ä¸­æ²‰æµ¸å¼çŠ¶æ€æ çš„é€‚é…ï¼Œé˜²æ­¢ ToolBar å’ŒçŠ¶æ€æ é‡åˆã€‚ ä¹‹åæ˜¯ä¸º ToolBar è®¾ç½®å„ç§å±æ€§åˆ›å»º FramePagerAdapterï¼Œå¯¹ ViewPager å’Œ TabLayout è®¾ç½®ç›‘å¬äº‹ä»¶ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697public class Bar_Activity extends AppCompatActivity &#123; Toolbar topToolBar; TabLayout tabLayout; ViewPager viewPager; FragmentPagerAdapter pagerAdapter; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_bar_); init(); topToolBar.setTitle("BarDemo"); setSupportActionBar(topToolBar); /*è®¾ç½®çŠ¶æ€æ ä¸ºé€æ˜*/ WindowManager.LayoutParams layoutParams = getWindow().getAttributes(); layoutParams.flags = (WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS | layoutParams.flags); getSupportActionBar().setDisplayHomeAsUpEnabled(false); //éå†FragmentPagerAdapterä¸ºTabLayoutæ·»åŠ Tab for (int i = 0; i &lt; pagerAdapter.getCount(); i++) &#123; tabLayout.addTab( tabLayout.newTab().setText(pagerAdapter.getPageTitle(i))); &#125; //ä¸ºViewPagerè®¾ç½®é€‚é…å™¨ viewPager.setAdapter(pagerAdapter); //ä¸ºviewPagerè®¾ç½®ç›‘å¬äº‹ä»¶ï¼Œå½“frameæ”¹å˜æ—¶æ›´æ”¹Tab viewPager.addOnPageChangeListener( new TabLayout.TabLayoutOnPageChangeListener(tabLayout)); //ä¸ºtabLayoutè®¾ç½®ç›‘å¬äº‹ä»¶ï¼Œå½“é€‰ä¸­tabçš„æ—¶å€™åˆ‡æ¢frame tabLayout.setOnTabSelectedListener(new TabLayout.OnTabSelectedListener() &#123; @Override public void onTabSelected(TabLayout.Tab tab) &#123; viewPager.setCurrentItem(tab.getPosition()); &#125; @Override public void onTabUnselected(TabLayout.Tab tab) &#123; &#125; @Override public void onTabReselected(TabLayout.Tab tab) &#123; &#125; &#125;); topToolBar.setNavigationIcon(R.drawable.ic_account_circle_white_24dp); &#125; protected void init() &#123; topToolBar = (Toolbar) findViewById(R.id.topToolBar); tabLayout = (TabLayout) findViewById(R.id.tabLayout); viewPager = (ViewPager) findViewById(R.id.viewPager); topToolBar.setBackgroundColor(Color.parseColor("#1aae98")); tabLayout.setBackgroundColor(Color.GRAY); //åˆ›å»ºé’ˆå¯¹ViewPagerçš„FragmentPagerAdapter pagerAdapter = new FragmentPagerAdapter(getSupportFragmentManager()) &#123; @Override public Fragment getItem(int position) &#123; Fragment tabFragment = new TabFragment(); Bundle args = new Bundle(); args.putInt(TabFragment.FLAG_TAB, position + 1); tabFragment.setArguments(args); return tabFragment; &#125; @Override public int getCount() &#123; return 3; &#125; @Override public CharSequence getPageTitle(int position) &#123; switch (position) &#123; case 0: return "tab1"; case 1: return "tab2"; case 2: return "tab3"; &#125; return null; &#125; &#125;; &#125; //è®¾ç½® toolBar å³ä¸Šè§’çš„èœå•é¡¹ @Override public boolean onCreateOptionsMenu(Menu menu) &#123; getMenuInflater().inflate(R.menu.menu, menu); return true; &#125; @Override public boolean onOptionsItemSelected(MenuItem item) &#123; return super.onOptionsItemSelected(item); &#125;&#125; æœ€åçœ‹ä¸‹ menu æ–‡ä»¶ 12345678&lt;menu xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto"&gt; &lt;item android:id="@+id/search_item" android:title="search" android:icon="@drawable/ic_search_white_24dp" app:actionViewClass="android.support.v7.widget.SearchView" app:showAsAction="ifRoom|collapseActionView"&gt;&lt;/item&gt;&lt;/menu&gt; æœ€ç»ˆå®ç°æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨è§†å›¾æ˜¾ç¤ºå›¾ç‰‡å’Œèœå•]]></title>
    <url>%2F2016%2F05%2F27%2F%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87%E5%92%8C%E8%8F%9C%E5%8D%95%2F</url>
    <content type="text"><![CDATA[æ˜¾ç¤ºå›¾ç‰‡çš„è§†å›¾æ§ä»¶ GridView æ·»åŠ æ–¹å¼ï¼š 123456789&lt;GridView android:layout_width="wrap_content" android:layout_height="wrap_content" android:id="@+id/gridview" android:numColumns="auto_fit" android:verticalSpacing="10dp" android:horizontalSpacing="10dp" android:columnWidth="90dp" android:stretchMode="columnWidth"/&gt;//ç¼©æ”¾ä¸åˆ—å®½åŒæ­¥ å…¶ä¸­ verticalSpacing è¡¨ç¤º grid å…ƒç´ ä¹‹é—´çš„ç«–ç›´è·ç¦»ï¼ŒhorizontalSpacing è¡¨ç¤º grid å…ƒç´ ä¹‹é—´çš„æ°´å¹³è·ç¦»ã€‚ å¸¸ç”¨æ–¹æ³•: 1234567gridView.setAdapter(new ImageAdapter(this));gridView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123; @Override public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123; Toast.makeText(getBaseContext(), "pic" + (position + 1) + "selected", Toast.LENGTH_SHORT).show(); &#125;&#125;); æ˜¾ç¤ºæ•ˆæœï¼š èœå•å’Œè§†å›¾ä¸€èµ·æ˜¾ç¤º å¸¸ç”¨æ–¹æ³•ï¼š CreateMenu(Menu menu) åˆ›å»ºèœå•é¡¹ 1234567891011private void CreateMenu(Menu menu) &#123; MenuItem mnu1 = menu.add(0, 0, 0, "Item 1"); &#123; mnu1.setAlphabeticShortcut('a'); &#125; MenuItem mnu2 = menu.add(0, 1, 1, "Item 2"); &#123; mnu2.setAlphabeticShortcut('a'); &#125;&#125; add() æ–¹æ³•ä¸­4ä¸ªå‚æ•°ï¼š groupId èœå•é¡¹æ‰€åœ¨çš„ç»„çš„æ ‡è¯†ç¬¦ï¼Œ0 è¡¨ç¤ºä¸åœ¨ä¸€ä¸ªç»„ä¸­ã€‚ itemId å”¯ä¸€çš„èœå•é¡¹ID order èœå•é¡¹æ˜¾ç¤ºçš„é¡ºåº title èœå•é¡¹æ˜¾ç¤ºçš„æ–‡æœ¬ MenuChoice(MenuItem item) ç”¨äºåˆ¤æ–­èœå•é¡¹æ˜¯å¦è¢«é€‰ä¸­ 1234567891011private boolean MenuChoice(MenuItem item) &#123; switch (item.getItemId()) &#123; case 0: Toast.makeText(this, "You clicked on Item1", Toast.LENGTH_SHORT).show(); return true; case 1: Toast.makeText(this, "You clicked on Item2", Toast.LENGTH_SHORT).show(); return true; &#125; return false;&#125;= onCreateOptionsMenu() å½“ MENU æŒ‰é’®æŒ‰ä¸‹æ—¶è°ƒç”¨ 12345public boolean onCreateOptionsMenu (Menu menu) &#123; super.onCreateOptionsMenu(menu); CreateMenu(menu); return true;&#125; onOptionsItemSelected() é€‰æ‹©èœå•æ—¶è°ƒç”¨ 123public boolean onOptionsItemSelected (MenuItem item)&#123; return MenuChoice(item);&#125; setOnCreateContextMenuListener è®¾ç½®ä¸Šä¸‹æ–‡èœå• é€šè¿‡è®¾ç½® setOnCreateContextMenuListener æ–¹æ³•ï¼Œç„¶åå®ç° onCreateContextMenu æ–¹æ³•å³å¯ã€‚ 12345public void onCreateContextMenu(ContextMenu menu, View view, ContextMenuInfo menuInfo) &#123; super.onCreateContextMenu(menu, view, menuInfo); CreateMenu(menu); &#125; å®ç°æ•ˆæœå¦‚å›¾ï¼š WebView æ·»åŠ  WebView 1234&lt;WebView android:layout_width="wrap_content" android:layout_height="wrap_content" android:id="@+id/webview"/&gt; é¿å…å¯åŠ¨è®¾å¤‡çš„ Web æµè§ˆå™¨ å®ç° WebViewClient ç±»é‡å†™ shouldOverrideUrlLoading 1234567webView.setWebViewClient(new CallBack());public class CallBack extends WebViewClient &#123; @Override public boolean shouldOverrideUrlLoading(WebView view, String url) &#123; return (false); &#125;&#125;]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>åŸºç¡€æ§ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ§ä»¶æ·»åŠ å³é”®èœå•é¡¹]]></title>
    <url>%2F2016%2F04%2F22%2FJava%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8E%A7%E4%BB%B6%E6%B7%BB%E5%8A%A0%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95%E9%A1%B9%2F</url>
    <content type="text"><![CDATA[ä»¥ JList æ§ä»¶ä¸ºä¾‹ é¦–å…ˆæ§ä»¶éœ€è¦æ·»åŠ é¼ æ ‡çš„ç›‘å¬äº‹ä»¶ 12345678mUserList.addMouseListener(new MouseAdapter() &#123; @Override public void mouseReleased(MouseEvent e) &#123; super.mouseReleased(e); showPopup(e); &#125;&#125;); showPopup() æ˜¾ç¤ºèœå•çš„åŠŸèƒ½ 1234567public void showPopup(MouseEvent e) &#123; if (e.isPopupTrigger() &amp;&amp; mUserList.getSelectedIndex() != -1 &amp;&amp; !mUserList.getSelectedValue().equals("ç®¡ç†å‘˜")) &#123; Object selected = mUserName.getElementAt(mUserList.getSelectedIndex()); popupMenu.show(e.getComponent(), e.getX(), e.getY()); &#125;&#125; e.isPopupTrigger() æ£€æµ‹æ˜¯å¦æ˜¯å³é”®ï¼ŒmUserList.getSelectedIndex() é˜²æ­¢åœ¨åˆ—è¡¨ç©ºç™½å¤„ç‚¹å‡»]]></content>
      <categories>
        <category>JavaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>AWT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DialogFragment å®ç°TimePickerDialog]]></title>
    <url>%2F2016%2F04%2F22%2FDialogFragment%E5%AE%9E%E7%8E%B0TimePickerDialog%2F</url>
    <content type="text"><![CDATA[åœ¨å®ç° onCreateDialog(int id) å‘ç°æ–¹æ³•å·²è¿‡æ—¶ï¼Œæ–°çš„æ–¹æ³•æ˜¯ DialogFragmentï¼ŒFragmentManager 12345678910111213141516171819202122public class TimePickerFragment extends DialogFragment implements TimePickerDialog.OnTimeSetListener &#123; int hour, minute; public Dialog onCreateDialog(Bundle savedInstanceState) &#123; return new TimePickerDialog(getActivity(), this, hour, minute, false);//è¿”å›ä¸€ä¸ªTimePickerDialog &#125; @Override public void onTimeSet(TimePicker view, int hourOfDay, int minuteOfHour) &#123; hour = hourOfDay; minute = minuteOfHour; SimpleDateFormat simpleDateFormat = new SimpleDateFormat("hh:mm aa"); Date date; Calendar calendar = Calendar.getInstance();//Dateæ„é€ æ–¹æ³•è¿‡æ—¶ï¼ŒCalendarè½¬Date calendar.set(0,0,0,hour,minute); date = calendar.getTime(); String strDate = simpleDateFormat.format(date); Toast.makeText(getActivity(), "you have selected" + strDate, Toast.LENGTH_SHORT).show(); &#125;&#125; æ˜¾ç¤º Dialog 12DialogFragment dialogFragment = new TimePickerFragment();dialogFragment.show(getSupportFragmentManager(),"timePicker");]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>åŸºç¡€æ§ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android è§†å›¾è®¾è®¡ç”¨æˆ·ç•Œé¢]]></title>
    <url>%2F2016%2F04%2F21%2FAndroid%E8%A7%86%E5%9B%BE%E8%AE%BE%E8%AE%A1%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%2F</url>
    <content type="text"><![CDATA[åŸºæœ¬è§†å›¾ ToggleButtonï¼ŒRadioButtonï¼ŒRadioGroupï¼ŒAutoCompleteTextView ToggleButton ç”¨ä¸€ä¸ªç¯å…‰æŒ‡ç¤ºå™¨æ¥æ˜¾ç¤ºé€‰ä¸­/æœªé€‰ä¸­çŠ¶æ€ 12345&lt;ToggleButton android:id="@+id/toggle1" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_below="@id/rdbGp1"/&gt; RadioButton å’Œ RaidoGroup RadioButton æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼šé€‰ä¸­æˆ–æœªé€‰ä¸­ã€‚ RaidoGroup ç”¨æ¥æŠŠä¸€ä¸ªæˆ–å¤šä¸ª RaidoButton è§†å›¾ç»„åˆåœ¨ä¸€èµ·ï¼Œä»è€Œåªå…è®¸ä¸€ä¸ª RaidoButton è¢«é€‰ä¸­ã€‚ 1234567891011121314151617&lt;RadioGroup android:id="@+id/rdbGp1" android:layout_width="fill_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:layout_below="@id/star"&gt; &lt;RadioButton android:id="@+id/rdb1" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Option 1" /&gt; &lt;RadioButton android:id="@+id/rdb2" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Option 2" /&gt;&lt;/RadioGroup&gt; è§†å›¾æ•ˆæœå¦‚ä¸‹ï¼š AutoCompleteTextViewï¼šä¸ EditText ç±»ä¼¼ï¼Œè¾“å…¥æ—¶æä¾›å€™é€‰é¡¹ 123456&lt;AutoCompleteTextView android:id="@+id/txtCountries" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_alignParentStart="true" android:layout_below="@+id/textView" /&gt; 1234ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_dropdown_item_1line,presidents);//åˆ›å»ºå®¹å™¨AutoCompleteTextView textView = (AutoCompleteTextView) findViewById(R.id.txtCountries); textView.setThreshold(3); textView.setAdapter(adapter);//è®¾ç½®å€™é€‰é¡¹ è§†å›¾æ•ˆæœï¼š CheckBoxï¼ŒRadioButton è§†å›¾äº‹ä»¶ CheckBoxï¼šéœ€å°† onClick() æ–¹æ³•çš„å‚æ•°ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªCheckBox ï¼Œç„¶åæ£€æŸ¥ isCheckBox() æ–¹æ³•æ¥ç¡®å®šå…¶æ˜¯å¦è¢«é€‰ä¸­ 12345678910CheckBox checkBox = (CheckBox)findViewById(R.id.chkAutosave);checkBox.setOnClickListener(new View.OnClickListener() &#123;@Overridepublic void onClick(View v) &#123; if (((CheckBox) v).isChecked()) DisplayToast("CheckBox is checked"); else DisplayToast("CheckBox is unchecked"); &#125;&#125;); RadioButtonï¼šéœ€è¦ä½¿ç”¨ RadioGroup çš„ setOnCheckedChangeListener() æ–¹æ³•æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°, ä»¥ä¾¿è¯¥ç»„ä¸­çš„è¢«é€‰ä¸­çš„ RadioButton å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è°ƒç”¨ã€‚ 123456789101112RadioGroup radioGroup = (RadioGroup)findViewById(R.id.rdbGp1);radioGroup.setOnCheckedChangeListener(new OnCheckedChangeListener() &#123;@Overridepublic void onCheckedChanged(RadioGroup group, int checkedId) &#123; RadioButton rb1 = (RadioButton) findViewById(R.id.rdb1); if (rb1.isChecked()) &#123; DisplayToast("Option 1 checked"); &#125; else &#123; DisplayToast("Option 2 checked"); &#125; &#125;&#125;); åˆ—è¡¨è§†å›¾ ListView,Spinner ListViewï¼š 12345setListAdapter(new ArrayAdapter&lt;String&gt;(this,android.R.layout.simple_list_item_checked, presidents));//è®¾ç½®åˆ—è¡¨é¡¹public void onListItemClick(ListView parent, View v, int position, long id) &#123; Toast.makeText(this, "you have selected:" + presidents[position], Toast.LENGTH_SHORT).show();&#125; getListView() è·å–å½“å‰çš„åˆ—è¡¨è§†å›¾ï¼Œåªæœ‰å½“å‰ Activity ç»§æ‰¿ ListAcitvity æ—¶æ‰èƒ½ç”¨ã€‚ Spinnerï¼š 12345&lt;Spinner android:layout_width="wrap_content" android:layout_height="wrap_content" android:id="@+id/spinner" android:drawSelectorOnTop="true"/&gt; è®¾ç½®åˆ—è¡¨å’Œåˆ¤æ–­é€‰æ‹© 1234567891011121314151617 Spinner spinner = (Spinner) findViewById(R.id.spinner); ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,android.R.layout.simple_spinner_item, prisidents); spinner.setAdapter(adapter);//è®¾ç½®åˆ—è¡¨é¡¹ spinner.setOnItemSelectedListener(new OnItemSelectedListener() &#123;@Overridepublic void onItemSelected(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123; int index = parent.getSelectedItemPosition(); Toast.makeText(BasicViews6Activity.this, "you have selected item :" + prisidents[index], Toast.LENGTH_SHORT).show();&#125;@Overridepublic void onNothingSelected(AdapterView&lt;?&gt; parent) &#123;&#125; &#125;);//åˆ¤æ–­å“ªä¸€é¡¹è¢«é€‰æ‹©äº† ç‰¹æ®Šç¢ç‰‡ ListFragmentï¼ŒDialogFramentï¼ŒPerferenceFragment è¦ä½¿ç”¨ ListFragment é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª ListFragment çš„ç±» (fragmnet1)ï¼Œåˆ›å»ºä¸€ä¸ªå…³äº fragment1 çš„è§†å›¾ï¼Œåœ¨ Activity çš„ Layout ä¸­å£°æ˜ç¢ç‰‡ã€‚åœ¨ Activity ä¸­æ˜¾ç¤ºäº fragment1 çš„è§†å›¾ï¼Œå¯ä»¥ä½¿ç”¨ FragmentManger å’Œ FragmentTransaction ç±»ï¼› 1234567FragmentManager fragmentManager = getFragmentManager();FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();Fragment1 fragment1 = new Fragment1();fragmentTransaction.replace(android.R.id.content,fragment1);fragmentTransaction.addToBackStack(null);fragmentTransaction.commit(); PerferenceFragment ä¸­ PreferenceCategory ç”¨äºåˆ›å»ºç±»åˆ« PreferenceScreen ç”¨äºæ˜¾ç¤ºä¸€ä¸ª PerferenceFragmnet ç•Œé¢ ç»ƒä¹  è®¿é—®æ”¾åœ¨ Strings.xml æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²èµ„æº getResources() è·å–å½“å‰æ—¥æœŸ 1234Calendar today = Calendar.getInstance();yr = today.get(Calendar.YEAR);month = today.get(Calendar.MONTH);day = today.get(Calendar.DAY_OF_MONTH);]]></content>
      <categories>
        <category>AndroidåŸºç¡€</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>åŸºç¡€æ§ä»¶</tag>
      </tags>
  </entry>
</search>
